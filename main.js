/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var be=Object.defineProperty;var pn=Object.getOwnPropertyDescriptor;var mn=Object.getOwnPropertyNames;var fn=Object.prototype.hasOwnProperty;var hn=(s,n)=>{for(var t in n)be(s,t,{get:n[t],enumerable:!0})},gn=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of mn(n))!fn.call(s,r)&&r!==t&&be(s,r,{get:()=>n[r],enumerable:!(e=pn(n,r))||e.enumerable});return s};var yn=s=>gn(be({},"__esModule",{value:!0}),s);var Yn={};hn(Yn,{default:()=>ye});module.exports=yn(Yn);var Zt=require("obsidian");var le=require("obsidian"),Se="chartnotes-view",bn=["bar","stacked-bar","line","stacked-area","pie","scatter","gantt"],Sn=["sum","count","cumulative-sum"];var ae="(missing)",xn="__no_series__",An=60,$e=6e4;function wn(s){let n=String(s!=null?s:"bar").trim().toLowerCase();return bn.includes(n)?n:"bar"}function vn(s){let n=String(s!=null?s:"sum").trim().toLowerCase();return Sn.includes(n)?n:"sum"}var ce=class extends le.BasesView{constructor(t,e,r){super(t);this.type=Se;this.renderer=r,this.rootEl=e.createDiv("chartnotes-bases-view")}onDataUpdated(){var I,P,W;this.rootEl.empty();let t=this.data,e=(I=t==null?void 0:t.groupedData)!=null?I:[];if(!e.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let r=this.config,o=wn((P=r==null?void 0:r.get("chartType"))!=null?P:"bar"),i=o==="pie",l=o==="scatter",a=o==="gantt",c=vn(r==null?void 0:r.get("aggregateMode")),m=c==="cumulative-sum"&&!(o==="line"||o==="stacked-area")?"sum":c,S=i||l||a?"none":"auto",d=this.getPropFromConfig("xProperty"),h=this.getPropFromConfig("ganttLabelProperty"),x=this.getPropFromConfig("yProperty"),g=this.getPropFromConfig("seriesProperty");i&&(g={id:null,name:null});let N=this.getPropFromConfig("startProperty"),A=this.getPropFromConfig("endProperty"),D=this.getPropFromConfig("dueProperty"),E=this.getPropFromConfig("durationProperty"),V=this.getPropFromConfig("groupProperty");if(!a&&!d.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / category' property in view options."});return}if(l&&(!d.id||!x.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(a&&!(N.id||A.id||D.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt needs Start/End or Due with Duration."});return}let H=a&&h.id?h:a?d:{id:null,name:null},v;if(a)v=this.buildRowsForGantt(e,H,g,N,A,D,E,V);else if(l)v=this.buildRowsForScatter(e,d,x,g);else{let K=i;v=this.buildRowsForAggregatedCharts(e,d,x,g,m,S,K)}if(!v.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let T={rows:v},w=((W=r==null?void 0:r.get("title"))!=null?W:"").trim()||(r==null?void 0:r.name)||"Chart Notes (Bases)",f=r==null?void 0:r.get("drilldown"),k=typeof f=="boolean"?f:!0,R=this.buildEncoding({x:d,y:x,series:g,start:N,end:A,due:D,duration:E,group:V,label:H,aggMode:m,chartType:o}),L={type:o,source:{type:"properties",query:""},encoding:R,options:{title:w,drilldown:k}},F={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,L,T,F)}getPropFromConfig(t){var l,a;let e=this.config,r=(l=e==null?void 0:e.get)==null?void 0:l.call(e,t);if(!r)return{id:null,name:null};let o=r.trim();if(!o||o==="undefined"||o==="null")return{id:null,name:null};let i=o;try{let c=(0,le.parsePropertyId)(i);return{id:i,name:(a=c.name)!=null?a:i}}catch(c){return{id:i,name:i}}}readValue(t,e){if(!e.id)return null;let r;try{r=t.getValue(e.id)}catch(o){return null}if(!r)return null;try{if(typeof r.isEmpty=="function"&&r.isEmpty())return null}catch(o){}try{let o=r.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let e=new Date(t.trim());return Number.isNaN(e.getTime())?null:e}compareX(t,e){let r=this.parseDate(t!=null?String(t):null),o=this.parseDate(e!=null?String(e):null);if(r&&o)return r.getTime()-o.getTime();let i=Number(t),l=Number(e);return!Number.isNaN(i)&&!Number.isNaN(l)?i-l:String(t!=null?t:"").localeCompare(String(e!=null?e:""))}fmtDate(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${o}`}startOfWeek(t){let e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=(e.getDay()+6)%7;return e.setDate(e.getDate()-r),e.setHours(0,0,0,0),e}bucketX(t,e){let r=this.parseDate(t);if(!r)return t;switch(e){case"none":return t;case"auto":case"day":return this.fmtDate(new Date(r.getFullYear(),r.getMonth(),r.getDate()));case"week":{let o=this.startOfWeek(r);return`${this.fmtDate(o)} (W)`}case"month":{let o=String(r.getMonth()+1).padStart(2,"0");return`${r.getFullYear()}-${o}`}case"quarter":{let o=Math.floor(r.getMonth()/3)+1;return`${r.getFullYear()}-Q${o}`}case"year":return`${r.getFullYear()}`;default:return t}}getXValuesForEntry(t,e,r,o){var p,m;let i=[],l=S=>this.bucketX(S,r);if(!e.id){let S=t.file,d=S!=null&&S.name?String(S.name):String((p=S==null?void 0:S.path)!=null?p:ae);return i.push(l(d)),i}if(!o){let S=(m=this.readValue(t,e))!=null?m:ae;return i.push(l(S)),i}let a=null;try{a=t.getValue(e.id)}catch(S){a=null}let c=S=>{if(!S)return;let d=String(S).trim();d&&i.push(l(d))};if(a==null)c(ae);else if(typeof a=="string"){let S=a.trim();if(S){let d=S.split(/\s+/);for(let h of d)c(h)}}else if(Array.isArray(a))for(let S of a){if(S==null)continue;let d;try{d=S.toString()}catch(h){continue}c(d)}else if(typeof a.toArray=="function"){let S=a.toArray();if(Array.isArray(S))for(let d of S){if(d==null)continue;let h;try{h=d.toString()}catch(x){continue}c(h)}else{let d;try{d=a.toString()}catch(h){d=""}c(d)}}else{let S;try{S=a.toString()}catch(d){S=""}c(S)}return i.length||c(ae),i}buildRowsForAggregatedCharts(t,e,r,o,i,l,a){let c=new Map,p=a||i==="count"||!r.id&&i!=="sum",m=r.name||"y";for(let d of t)for(let h of d.entries){let x=h.file,g=this.getXValuesForEntry(h,e,l,a),N=1,A=null;if(!p&&r.id){if(A=this.readValue(h,r),A==null)continue;let V=Number(A);if(Number.isNaN(V))continue;N=V}else N=1;let D=this.readValue(h,o),E=D!=null?String(D):void 0;for(let V of g){let H=`${V}@@${E!=null?E:""}`,v=c.get(H);v||(v={x:V,y:0,series:E,notes:[],props:{}},c.set(H,v)),v.y+=N,x!=null&&x.path&&v.notes.push(x.path),v.props&&e.name&&(v.props[e.name]=V),!p&&v.props&&m&&A!=null&&(v.props[m]=v.y),p&&v.props&&(v.props[m]=v.y),v.props&&o.name&&D!=null&&(v.props[o.name]=D)}}let S=Array.from(c.values());return i==="cumulative-sum"?this.toCumulative(S):S}toCumulative(t){var o,i;let e=new Map;for(let l of t){let a=(o=l.series)!=null?o:xn,c=e.get(a);c||(c=[],e.set(a,c)),c.push(l)}let r=[];for(let[,l]of e){let a=[...l].sort((p,m)=>this.compareX(p.x,m.x)),c=0;for(let p of a){let m=Number((i=p.y)!=null?i:0);Number.isNaN(m)||(c+=m,r.push({...p,y:c}))}}return r.sort((l,a)=>this.compareX(l.x,a.x)),r}buildRowsForScatter(t,e,r,o){let i=[];for(let l of t)for(let a of l.entries){let c=a.file,p=this.readValue(a,e),m=this.readValue(a,r);if(p==null||m==null)continue;let S=Number(p),d=Number(m);if(Number.isNaN(S)||Number.isNaN(d))continue;let h=this.readValue(a,o),x=h!=null?String(h):void 0;i.push({x:S,y:d,series:x,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,e,r,o,i,l,a,c){var x;let p=[],m=An*$e,S=g=>{let N=[g==null?void 0:g.label,g==null?void 0:g.name,g==null?void 0:g.value,g==null?void 0:g.key,g==null?void 0:g.group,g==null?void 0:g.groupLabel];for(let A of N)if(A!=null&&String(A).trim()!=="")return String(A);return""},d=e;try{let g=this.getPropFromConfig("ganttLabelProperty");g&&g.id&&(d=g)}catch(g){}let h=!!c.id;for(let g of t){let N=S(g);for(let A of(x=g.entries)!=null?x:[]){let D=A.file,E=this.readValue(A,o),V=this.readValue(A,i),H=this.readValue(A,l),v=this.readValue(A,a),T=v!=null?Number(v):NaN,y=Number.isFinite(T)&&T>0,w=y?T*$e:m,f=this.parseDate(E),k=this.parseDate(V),R=this.parseDate(H),L=f,F=k;if(L&&!F&&(F=new Date(L.getTime()+w)),!L&&F&&(L=new Date(F.getTime()-w)),!L&&!F&&R&&(y?(F=R,L=new Date(R.getTime()-w)):(L=R,F=new Date(R.getTime()+m))),!L||!F)continue;if(L.getTime()>F.getTime()){let Q=L;L=F,F=Q}let I=this.readValue(A,d);(I==null||String(I).trim()==="")&&(D!=null&&D.name?I=String(D.name).replace(/\.md$/i,""):D!=null&&D.path?I=String(D.path):I="(no title)");let P=this.readValue(A,r),W=P!=null?String(P):void 0,K={};if(N&&(K.__basesGroup=N),h){let Q=this.readValue(A,c);Q!=null&&c.name&&(K[c.name]=Q)}d.name&&(K[d.name]=I),K.label=I,o.name&&E!=null&&(K[o.name]=E),i.name&&V!=null&&(K[i.name]=V),l.name&&H!=null&&(K[l.name]=H),y&&a.name&&(K[a.name]=T);let _=D==null?void 0:D.path;p.push({x:I,y:0,series:W,start:L,end:F,due:R!=null?R:void 0,notes:_?[_]:[],props:K})}}return p.sort((g,N)=>!g.start||!N.start?0:g.start.getTime()-N.start.getTime()),p}buildEncoding(t){var l,a,c,p,m,S,d,h,x,g,N;let e=(l=t.x.name)!=null?l:"x",r=(a=t.y.name)!=null?a:"y",o=(m=(p=(c=t.label.name)!=null?c:t.x.name)!=null?p:t.group.name)!=null?m:"label",i=t.chartType==="gantt"?"__basesGroup":(S=t.group.name)!=null?S:"group";return{x:e,y:r,series:(d=t.series.name)!=null?d:"series",start:(h=t.start.name)!=null?h:"start",end:(x=t.end.name)!=null?x:"end",due:(g=t.due.name)!=null?g:"due",duration:(N=t.duration.name)!=null?N:"duration",group:i,label:o}}};var Ve=require("obsidian"),ue=class{constructor(n){this.index=new Map;this.app=n}async buildIndex(){this.index.clear();let n=this.app.vault.getMarkdownFiles();for(let t of n)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(n){if(n.extension!=="md")return;let t={};try{let r=(await this.app.vault.read(n)).match(/^---\n([\s\S]*?)\n---\n?/);if(r){let i=(0,Ve.parseYaml)(r[1])||{};if(i&&typeof i=="object")for(let[l,a]of Object.entries(i))l!=="position"&&(t[l]=a)}let o=this.app.metadataCache.getFileCache(n);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(e){console.error("Chart Notes: erro ao indexar",n.path,e)}this.index.set(n.path,{path:n.path,props:t})}removeFile(n){this.index.delete(n.path)}};function Be(s,n){if(!n||n.length===0)return!0;for(let t of n){if(t===".")return!0;let e=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(e))return!0}return!1}function Ke(s,n){if(!n||n.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let r of n)if(t.includes(r)||t.includes("#"+r))return!0;return!1}let e=String(t);for(let r of n)if(e===r||e==="#"+r)return!0;return!1}function pe(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function Qt(s){if(s instanceof Date&&!isNaN(s.getTime()))return s;if(typeof s!="string")return null;let n=s.trim(),t=n.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(t){let r=Number(t[1]),o=Number(t[2])-1,i=Number(t[3]),l=t[4]?Number(t[4]):0,a=t[5]?Number(t[5]):0,c=t[6]?Number(t[6]):0;return Number.isNaN(r)||Number.isNaN(o)||Number.isNaN(i)||Number.isNaN(l)||Number.isNaN(a)||Number.isNaN(c)?null:new Date(r,o,i,l,a,c,0)}let e=new Date(n);return isNaN(e.getTime())?null:e}function mt(s){let n=new Date(s);return n.setHours(0,0,0,0),n}function de(s,n){let t=new Date(s);return t.setDate(t.getDate()-n),t}function Dn(s,n){return de(s,n*7)}function En(s,n){let t=new Date(s);return t.setMonth(t.getMonth()-n),t}function Ae(s,n){let t=new Date(s);return t.setDate(t.getDate()+n),t}function Nn(s,n){return Ae(s,n*7)}function Tn(s,n){let t=new Date(s);return t.setMonth(t.getMonth()+n),t}function Ge(s){let n=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(n)||n.endsWith("date")||n.endsWith("at")||n.endsWith("on"))}function He(s,n){let t=n?new Date(n):new Date,e=mt(t),r=s.trim().toLowerCase();if(r==="today")return e;if(r==="yesterday")return mt(de(e,1));if(/^-\d+$/.test(r)){let o=parseInt(r.slice(1),10);return mt(de(e,o))}if(/^-\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(de(e,o))}if(/^-\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Dn(e,o))}if(/^-\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(En(e,o))}if(/^\+\d+$/.test(r)){let o=parseInt(r.slice(1),10);return mt(Ae(e,o))}if(/^\+\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Ae(e,o))}if(/^\+\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Nn(e,o))}if(/^\+\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Tn(e,o))}return null}function Qe(s){let n=s.trim(),t=n.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let p=t[1].trim(),m=t[2].trim(),S=t[3].trim(),d=Ge(p),h=xe(m,d),x=xe(S,d),g=h.valueType==="date"||x.valueType==="date"?"date":h.valueType;return{field:p,op:"between",value:h.value,value2:x.value,valueType:g}}let e=/(==|!=|>=|<=|>|<)/,r=n.split(e);if(r.length!==3)throw new Error(`Invalid WHERE expression: ${s}`);let o=r[0].trim(),i=r[1].trim(),l=r[2].trim(),a=Ge(o),c=xe(l,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function xe(s,n){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let e=t.toLowerCase(),r=e==="today"||e==="yesterday"||e.startsWith("-")||e.startsWith("+");if(n){if(t==="0"||e==="today")return{value:mt(new Date),valueType:"date"};let i=He(t);if(i)return{value:i,valueType:"date"}}else if(r){let i=He(t);if(i)return{value:i,valueType:"date"}}if(pe(t)){let i=Qt(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Oe(s,n){let t=s[n.field];if(t==null)return!1;if(n.valueType==="date"){let o=t instanceof Date?mt(t):pe(t)?mt(Qt(t)):null;if(!o)return!1;let i=n.value instanceof Date?n.value:null,l=n.value2 instanceof Date?n.value2:null;if(!i)return!1;let a=o.getTime(),c=mt(i).getTime();switch(n.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!l)return!1;let p=mt(l).getTime();return a>=c&&a<=p}}if(n.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(n.value);switch(n.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof n.value2!="number"?!1:o>=i&&o<=n.value2}}let e=String(t),r=String(n.value);switch(n.op){case"==":return e===r;case"!=":return e!==r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r;case"between":return!1}return!1}var Ye="__no_series__",Rn="||",Cn=6e4;function Mn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(pe(s)){let n=Qt(s);if(n)return{key:n,isDate:!0}}return{key:s,isDate:!1}}function kn(s,n){let t=s.x,e=n.x;if(t instanceof Date&&e instanceof Date)return t.getTime()-e.getTime();let r=String(t),o=String(e);return r<o?-1:r>o?1:0}function Pn(s,n){var o,i;let t=kn(s,n);if(t!==0)return t;let e=(o=s.series)!=null?o:"",r=(i=n.series)!=null?i:"";return e<r?-1:e>r?1:0}function Ln(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let n=s.trim().match(/^(\d+)/);if(n){let t=Number(n[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`Invalid aggregate.rolling: ${String(s)}`)}function In(s){var e,r;let n=new Map,t=[];for(let o of s){let i=(e=o.series)!=null?e:Ye,a=((r=n.get(i))!=null?r:0)+o.y;n.set(i,a),t.push({...o,y:a})}return t}function _n(s,n){var i,l;let t=Ln(n);if(!t||t<=1)return[...s];let e=new Map,r=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:Ye,p=e.get(c);p||(p=[],e.set(c,p));let m=(l=r.get(c))!=null?l:0;if(p.push(a.y),m+=a.y,p.length>t){let h=p.shift();m-=h}r.set(c,m);let S=p.length||1,d=m/S;o.push({...a,y:d})}return o}var me=class{constructor(n,t){this.getIndex=n,this.defaultPaths=t}run(n){var i,l,a;let t=this.getIndex(),e=(i=n.source)!=null&&i.paths&&n.source.paths.length?n.source.paths:this.defaultPaths,r=(l=n.source)!=null&&l.tags&&n.source.tags.length?n.source.tags:[],o=[];for(let c of t){let p=e&&e.length?Be(c.path,e):!0,m=r&&r.length?Ke(c.props,r):!0;if(!p||!m)continue;let S=!0;if((a=n.source)!=null&&a.where&&n.source.where.length>0)for(let d of n.source.where){let h;try{h=Qe(d)}catch(x){throw new Error(`Invalid condition: ${d} (${x.message})`)}if(!Oe(c.props,h)){S=!1;break}}S&&o.push(c)}return n.type==="gantt"?this.runGantt(n,o):n.type==="table"?this.runTable(n,o):this.runStandard(n,o)}runTable(n,t){var r,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(r=n.encoding)==null?void 0:r.x,yField:(o=n.encoding)==null?void 0:o.y}}runGantt(n,t){var m,S,d;let e=(m=n.encoding)!=null?m:{},r=e.start,o=e.end,i=(S=e.label)!=null?S:e.x,l=e.series,a=e.duration,c=e.due,p=[];for(let h of t){let x=(d=h.props)!=null?d:{},g=v=>Array.isArray(v)?v[0]:v,N=null;if(o){let v=g(x[o]),T=Qt(v);T&&(N=T)}if(!N)continue;let A=null;if(r){let v=g(x[r]),T=Qt(v);T&&(A=T)}if(!A&&a){let v=g(x[a]),T=Number(v);Number.isNaN(T)||(A=new Date(N.getTime()-T*Cn))}A||(A=new Date(N.getTime()));let D;if(c){let v=g(x[c]),T=Qt(v);T&&(D=T)}let E;if(i){let v=g(x[i]);(v==null||v==="")&&(v=h.path),E=v}else E=h.path;let V;if(l){let v=g(x[l]);v!=null&&(V=String(v))}let H={x:E,y:0,notes:[h.path],series:V,start:A,end:N,props:x};D&&(H.due=D),p.push(H)}return p.sort((h,x)=>{let g=h.start?h.start.getTime():0,N=x.start?x.start.getTime():0;return g-N}),{rows:p,xField:i,yField:o}}runStandard(n,t){var h,x,g,N,A,D,E,V,H,v;let e=(h=n.encoding)==null?void 0:h.x,r=(x=n.encoding)==null?void 0:x.y,o=(g=n.encoding)==null?void 0:g.series;if(!e)throw new Error("encoding.x is required.");let i=(N=n.aggregate)!=null?N:{},l=(A=i.y)!=null?A:null,a=!!i.cumulative,c=i.rolling;if(!r&&l!=="count")throw new Error("encoding.y is required (except when aggregate.y = 'count').");let p=[];for(let T of t){let y=(D=T.props)!=null?D:{},w=P=>Array.isArray(P)?P[0]:P,f=w(y[e]);if(f==null)continue;let k=Mn(f),R=k.key,L=k.isDate,F;if(o){let P=w(y[o]);P!=null&&String(P).trim()!==""&&(F=String(P))}let I;if(l==="count")I=1;else{let P=w(y[r]);if(P==null)continue;let W=Number(P);if(Number.isNaN(W))continue;I=W}p.push({x:R,y:I,notes:[T.path],series:F,props:y,_isDate:L,_origX:f})}if(p.length===0)return{rows:[],xField:e,yField:r};let m=[];if(l){let T=new Map;for(let y of p){let w=(E=y.series)!=null?E:"",f=y.x instanceof Date?y.x.toISOString().slice(0,10):String(y.x),k=w+Rn+f,R=(V=T.get(k))!=null?V:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:y.x,isDate:y._isDate,series:y.series,props:y.props};R.sum+=y.y,R.count+=1,y.y<R.min&&(R.min=y.y),y.y>R.max&&(R.max=y.y),R.notes.push(...y.notes),R.props=(H=y.props)!=null?H:R.props,T.set(k,R)}for(let[,y]of T){let w=y.sum;switch(l){case"sum":w=y.sum;break;case"avg":w=y.sum/y.count;break;case"min":w=y.min;break;case"max":w=y.max;break;case"count":w=y.count;break}m.push({x:y.xRep,y:w,notes:y.notes,series:y.series,props:y.props})}}else m=p.map(T=>({x:T.x,y:T.y,notes:T.notes,series:T.series,props:T.props}));if(m.length===0)return{rows:[],xField:e,yField:r};let S=((v=n.sort)==null?void 0:v.x)==="desc"?"desc":"asc";if(m.sort((T,y)=>{let w=Pn(T,y);return S==="asc"?w:-w}),(a||c)&&!(n.type==="line"||n.type==="stacked-area"))throw new Error("aggregate.cumulative / aggregate.rolling are only supported for type: 'line' or 'stacked-area'.");if(a&&c)throw new Error("It is not yet possible to use 'cumulative' and 'rolling' together in the same chart.");let d=m;return c?d=_n(m,c):a&&(d=In(m)),{rows:d,xField:e,yField:r}}};var Rt=require("obsidian");var Ue=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ut(s,n){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((e,r)=>e*33+r.charCodeAt(0)>>>0,0);return Ue[t%Ue.length]}function xt(s,n){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let e=t.createDiv({cls:"chart-notes-inner"});e.style.display="block",e.style.minHeight=`${300}px`,n&&(e.style.background=n);let r="http://www.w3.org/2000/svg",o=document.createElementNS(r,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",e.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let l=s.createDiv({cls:"chart-notes-details"});return l.style.display="none",{scroll:t,inner:e,svg:o,tooltip:i,details:l}}function gt(s,n,t,e,r,o){let i=s.getBoundingClientRect(),l=typeof e=="number"?Number.isInteger(e)?String(e):e.toFixed(2):String(e);n.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${l}</div>
    <div class="chart-notes-tooltip-notes">${r} nota${r===1?"":"s"}</div>
  `,n.style.display="block";let a=n.getBoundingClientRect(),c=o.clientX-i.left+6,p=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),p+a.height>i.height-4&&(p=i.height-a.height-4),p<4&&(p=4),n.style.left=c+"px",n.style.top=p+"px"}function yt(s){s.style.display="none"}function bt(s,n,t,e,r,o){if(!o)return;if(n.empty(),!r||r.length===0){n.style.display="none";return}n.style.display="block";let i=n.createEl("div",{cls:"chart-notes-details-header"}),l=i.createEl("div",{cls:"chart-notes-details-title"});l.textContent=`Notas em "${t}" (${r.length})`+(Number.isFinite(e)&&e!==0?` \u2013 valor ${Number.isInteger(e)?e:e.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{n.style.display="none"});let c=n.createEl("ul",{cls:"chart-notes-details-list"});for(let p of r){let S=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:p});S.href="#",S.addEventListener("click",d=>{d.preventDefault(),app.workspace.openLinkText(p,"",!1)})}}function $t(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let n=s.getUTCDate().toString().padStart(2,"0"),t=(s.getUTCMonth()+1).toString().padStart(2,"0");return`${n}/${t}`}function We(s){if(!s)return!1;let n=s.trim().toLowerCase();if(n==="#fff"||n==="#ffffff"||n==="white")return!0;if(!n.startsWith("#"))return!1;let t,e,r;if(n.length===4)t=parseInt(n[1]+n[1],16),e=parseInt(n[2]+n[2],16),r=parseInt(n[3]+n[3],16);else if(n.length===7)t=parseInt(n.slice(1,3),16),e=parseInt(n.slice(3,5),16),r=parseInt(n.slice(5,7),16);else return!1;return(.2126*t+.7152*e+.0722*r)/255>.7}var we=class extends Rt.Modal{constructor(t,e,r,o){var l;super(app);this.notePath=t,this.spec=e,this.refresh=r,this.reindexFile=o;let i=(l=e.encoding)!=null?l:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var v,T;let{contentEl:t}=this;t.empty(),this.titleEl.setText("Edit task");let e=this.app.vault.getAbstractFileByPath(this.notePath);if(!(e instanceof Rt.TFile)){t.createEl("p",{text:"File not found: "+this.notePath});return}this.titleEl.setText(`Edit task \u2013 ${e.basename}`);let r=await this.app.vault.read(e),o={},i=r,l=r.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);if(l){try{o=(v=(0,Rt.parseYaml)(l[1]))!=null?v:{}}catch(y){o={}}i=(T=l[2])!=null?T:""}let a=t.createDiv({cls:"gantt-edit-form"}),c=y=>{let w=a.createDiv({cls:"gantt-edit-row"}),f=w.createDiv({cls:"gantt-edit-label"});f.textContent=y;let k=w.createDiv({cls:"gantt-edit-field"});return{row:w,field:k}},p=y=>{if(!y)return null;if(y instanceof Date&&!isNaN(y.getTime()))return y;let f=String(y).trim().match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!f)return null;let k=Number(f[1]),R=Number(f[2])-1,L=Number(f[3]),F=f[4]?Number(f[4]):0,I=f[5]?Number(f[5]):0,P=f[6]?Number(f[6]):0;return Number.isNaN(k)||Number.isNaN(R)||Number.isNaN(L)||Number.isNaN(F)||Number.isNaN(I)||Number.isNaN(P)?null:new Date(k,R,L,F,I,P,0)},m=y=>{let w=p(y);if(!w)return"";let f=P=>P.toString().padStart(2,"0"),k=w.getFullYear(),R=f(w.getMonth()+1),L=f(w.getDate()),F=f(w.getHours()),I=f(w.getMinutes());return`${k}-${R}-${L}T${F}:${I}`},S=y=>{if(y=y.trim(),!y)return;let w=y.match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2}))?$/);if(!w)return;let f=`${w[1]}-${w[2]}-${w[3]}`;if(w[4]){let k=w[4],R=w[5];return`${f}T${k}:${R}`}return f},d=null,h=null,x=null,g=null;if(this.startKey){let{field:y}=c(`In\xEDcio (${this.startKey})`);d=y.createEl("input"),d.type="datetime-local",d.value=m(o[this.startKey])}if(this.endKey){let{field:y}=c(`Fim (${this.endKey})`);h=y.createEl("input"),h.type="datetime-local",h.value=m(o[this.endKey])}if(this.durationKey){let{field:y}=c(`Dura\xE7\xE3o (min) (${this.durationKey})`);x=y.createEl("input"),x.type="number";let w=o[this.durationKey];x.value=typeof w=="number"&&!Number.isNaN(w)?String(w):""}if(this.dueKey){let{field:y}=c(`Due (${this.dueKey})`);g=y.createEl("input"),g.type="datetime-local",g.value=m(o[this.dueKey])}let N=a.createDiv({cls:"gantt-edit-actions-row"});N.style.marginTop="0.75rem",N.style.display="flex",N.style.justifyContent="space-between",N.style.alignItems="center";let A=N.createDiv({cls:"gantt-edit-actions-left"});A.style.display="flex";let D=N.createDiv({cls:"gantt-edit-actions-right"});D.style.display="flex",D.style.gap="0.5rem";let E=A.createEl("button",{text:"Open note"}),V=D.createEl("button",{text:"Save"}),H=D.createEl("button",{text:"Cancel"});E.addEventListener("click",()=>{this.app.workspace.openLinkText(this.notePath,"",!1),this.close()}),H.addEventListener("click",()=>this.close()),V.addEventListener("click",async()=>{if(this.startKey&&d){let f=S(d.value);f?o[this.startKey]=f:delete o[this.startKey]}if(this.endKey&&h){let f=S(h.value);f?o[this.endKey]=f:delete o[this.endKey]}if(this.durationKey&&x){let f=x.value.trim();if(f==="")delete o[this.durationKey];else{let k=Number(f);Number.isNaN(k)||(o[this.durationKey]=k)}}if(this.dueKey&&g){let f=S(g.value);f?o[this.dueKey]=f:delete o[this.dueKey]}let w=`---
${(0,Rt.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(e,w),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(f){}if(this.refresh)try{this.refresh()}catch(f){}new Rt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function fe(s,n,t,e){var Ne,Te,Re,Ce,Me,ke,Pe,Le;let r=(Ne=n.options)!=null?Ne:{},o=r.background,i=(Te=r.drilldown)!=null?Te:!0,l=!0,a=b=>{if(b==null)return"";let G=String(b).trim();if(!G)return"";let O=G.match(/^\[\[(.+?)\]\]$/);O&&(G=O[1]);let j=G.lastIndexOf("/");return j>=0&&j<G.length-1&&(G=G.slice(j+1)),G};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(b=>b.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let c=t.rows.filter(b=>b.start&&b.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: missing date fields."});return}let p=n.encoding,m=p.group,S=p.duration,d=(b,G)=>{if(!b||!G)return;let O=b[G];return Array.isArray(O)?O[0]:O},h="__chartnotes_no_group__",g=c.map(b=>{var pt,vt;let G=b.start,O=b.end,j=b.props,Kt=typeof b.x=="string"?b.x:b.x instanceof Date?$t(G):String(b.x),Pt=a(Kt),Tt=m!=null&&m!==""?d(j,m):void 0,Lt=Tt!=null&&String(Tt).trim().length>0?String(Tt):h,ht=(pt=b.notes)==null?void 0:pt[0],It=ht?(vt=ht.replace(/\.md$/i,"").split("/").pop())!=null?vt:ht:Pt,Wt=b.due,Gt,wt=d(j,S);if(wt!=null){let _t=Number(wt);Number.isNaN(_t)||(Gt=_t)}return{row:b,start:G,end:O,props:j,fullName:Pt,groupKey:Lt,notePath:ht,noteTitle:It,due:Wt,estMinutes:Gt}}).filter(b=>b.start instanceof Date&&!isNaN(b.start.getTime())&&b.end instanceof Date&&!isNaN(b.end.getTime()));if(g.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid dates."});return}g.sort((b,G)=>{if(b.groupKey<G.groupKey)return-1;if(b.groupKey>G.groupKey)return 1;let O=b.start.getTime(),j=G.start.getTime();return O!==j?O-j:b.fullName.localeCompare(G.fullName)});let N=26,A=0,D=null;for(let b of g)b.groupKey!==D&&(D=b.groupKey,b.groupKey!==h&&(A+=1)),A+=1;let E=Math.min(...g.map(b=>b.start.getTime())),V=Math.max(...g.map(b=>b.end.getTime()));if(!isFinite(E)||!isFinite(V)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid date range."});return}let H=24*60*60*1e3,v=b=>{let G=new Date(b);return G.setHours(0,0,0,0),G.getTime()},T=v(E),y=v(V),w=s.querySelector(".prop-charts-title-row");w||(w=s.createDiv({cls:"prop-charts-title-row"}));let f=s.dataset.ganttZoomMode||String((Re=r.zoomMode)!=null?Re:"100");s.dataset.ganttZoomMode=f;let k=s.dataset.ganttLabelMode||String((Ce=r.labelMode)!=null?Ce:"compact");s.dataset.ganttLabelMode=k;let R=w.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(b=>{let G=R.createEl("button",{cls:"gantt-zoom-btn",text:b.label});b.id===f&&G.addClass("is-active"),G.addEventListener("click",O=>{O.preventDefault(),s.dataset.ganttZoomMode=b.id,fe(s,n,t,e)})});let F=Number(r.labelWidth),I=!Number.isNaN(F)&&F>120?F:260,P=k==="wide"?I+160:I,W=s.getBoundingClientRect().width||600,K=Math.max(W,820),_;if(f==="fit")_=W;else{let b=Number(f)/100||1;_=K*b}let{inner:Q,svg:u,tooltip:C,details:M}=xt(s,o);Q.style.width=_+"px";let B=(b,G,O,j,Kt,Pt,Tt,te,Lt)=>{if(!b)return;let ht=Math.max(40,j-8),Wt=Math.max(8,Math.floor(ht/6)),Gt=b.split(/\s+/),wt=[],pt="";for(let Ft of Gt){if(!pt){pt=Ft;continue}(pt+" "+Ft).length<=Wt?pt+=" "+Ft:(wt.push(pt),pt=Ft)}pt&&wt.push(pt);let vt=Kt+2,_t=wt.length*vt,ee=O-_t/2+Kt;wt.forEach((Ft,oe)=>{let dt=document.createElementNS(u.namespaceURI,"text");dt.setAttribute("x",String(G)),dt.setAttribute("y",String(ee+oe*vt)),dt.setAttribute("text-anchor","start"),dt.setAttribute("font-size",String(Kt)),dt.setAttribute("fill","#111111"),Pt&&dt.setAttribute("font-weight",Pt),dt.textContent=Ft,Tt&&dt.addEventListener("mouseenter",lt=>Tt(lt)),te&&dt.addEventListener("mouseleave",()=>te()),Lt&&(dt.style.cursor="pointer",dt.addEventListener("click",lt=>Lt(lt))),u.appendChild(dt)})},$=28,tt=28,X=10,rt=Math.max(300,$+tt+A*N+24);u.setAttribute("height",String(rt));let Y=_-P-X,q=$+6;u.style.color="#111111";let ot=y+H-T||1,et=T-ot*.02,it=y+H+ot*.08,at=b=>P+(b-et)/(it-et)*Y,Z=(it-et)/H,U=Math.max(4,Math.min(12,Math.floor(Y/90)||4)),ft=Z/U,ct=[1,2,3,5,7,10,14,21,30,60,90,180,365],nt=ct[ct.length-1];for(let b of ct)if(b>=ft){nt=b;break}let St=[],At=v(et);for(let b=At;b<=it+.5*H;b+=nt*H)St.push(b);let kt=document.createElementNS(u.namespaceURI,"line");kt.setAttribute("x1",String(P)),kt.setAttribute("y1",String(q)),kt.setAttribute("x2",String(_-X)),kt.setAttribute("y2",String(q)),kt.setAttribute("stroke","#111111"),u.appendChild(kt);for(let b of St){let G=at(b),O=document.createElementNS(u.namespaceURI,"line");O.setAttribute("x1",String(G)),O.setAttribute("y1",String(q)),O.setAttribute("x2",String(G)),O.setAttribute("y2",String(rt-tt)),O.setAttribute("stroke","#111111"),O.setAttribute("stroke-opacity","0.20"),O.setAttribute("stroke-dasharray","2,4"),u.appendChild(O);let j=document.createElementNS(u.namespaceURI,"text");j.setAttribute("x",String(G)),j.setAttribute("y",String(q-4)),j.setAttribute("text-anchor","middle"),j.setAttribute("font-size","10"),j.setAttribute("fill","#111111"),j.textContent=$t(new Date(b)),u.appendChild(j)}let Jt=new Date;Jt.setHours(0,0,0,0);let Ot=Jt.getTime();if(Ot>=et&&Ot<=it){let b=at(Ot),G=document.createElementNS(u.namespaceURI,"line");G.setAttribute("x1",String(b)),G.setAttribute("y1",String(q)),G.setAttribute("x2",String(b)),G.setAttribute("y2",String(rt-tt)),G.setAttribute("stroke","#4caf50"),G.setAttribute("stroke-width","2"),G.setAttribute("stroke-dasharray","4,2"),u.appendChild(G);let O=document.createElementNS(u.namespaceURI,"text");O.setAttribute("x",String(b+4)),O.setAttribute("y",String(q+12)),O.setAttribute("font-size","10"),O.setAttribute("fill","#4caf50"),O.textContent="today",u.appendChild(O)}let Nt=Q.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Nt.setAttr("title",k==="wide"?"Compact names":"Expand names"),Nt.style.left=`${P}px`,Nt.style.top="4px",Nt.addEventListener("click",b=>{b.preventDefault();let O=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=O,fe(s,n,t,e)});let Bt=["status","priority"],Yt=Array.isArray(r.tooltipFields)?r.tooltipFields.map(b=>String(b)):null,dn=Yt&&Yt.length?Yt:Bt,Ut=0,se=null;for(let b of g){let G=b.start,O=b.end,j=(O.getTime()-G.getTime())/6e4,Kt=b.props,Pt=b.notePath,Tt=b.noteTitle,te=(ke=(Me=b.row.notes)==null?void 0:Me.length)!=null?ke:0,Lt=b.due,ht=b.estMinutes,It=[];It.push(`${$t(G)} \u2192 ${$t(O)}`),typeof ht=="number"&&!Number.isNaN(ht)?It.push(`est: ${Math.round(ht)} min`):j>0&&It.push(`dura\xE7\xE3o: ${Math.round(j)} min`),Lt instanceof Date&&It.push(`due: ${$t(Lt)}`);for(let st of dn){let z=d(Kt,st);z!=null&&String(z).trim()!==""&&It.push(`${st}: ${String(z)}`)}let Wt=It.join("<br>"),Gt=st=>{var z;st.preventDefault(),l&&Pt?new we(Pt,n,e==null?void 0:e.refresh,e==null?void 0:e.reindexFile).open():bt(s,M,Tt,ht!=null?ht:j,(z=b.row.notes)!=null?z:[],i)},wt=st=>{Tt&&Wt&&gt(s,C,Tt,Wt,te,st)},pt=()=>yt(C);if(b.groupKey!==se&&(se=b.groupKey,se!==h)){let st=q+8+Ut*N+N/2,z=a(se);B(z,4,st,P-12,11,"600"),Ut+=1}let vt=q+8+Ut*N,_t=N-10,ee=at(G.getTime()),Ft=at(O.getTime()),oe=Math.max(4,Ft-ee),dt=b.fullName,lt=document.createElementNS(u.namespaceURI,"rect");lt.setAttribute("x",String(ee)),lt.setAttribute("y",String(vt)),lt.setAttribute("width",String(oe)),lt.setAttribute("height",String(_t)),lt.setAttribute("rx","3"),lt.setAttribute("ry","3"),lt.setAttribute("fill",ut((Pe=b.row.series)!=null?Pe:dt,Ut)),lt.setAttribute("stroke","rgba(0,0,0,0.25)"),lt.setAttribute("stroke-width","0.5"),lt.style.cursor=l&&Pt?"pointer":"default",lt.addEventListener("mouseenter",wt),lt.addEventListener("mouseleave",pt),lt.addEventListener("click",Gt),u.appendChild(lt);let Ie=vt+_t/2;if(oe>=6){let st=ut((Le=b.row.series)!=null?Le:dt,Ut),z=document.createElementNS(u.namespaceURI,"circle");z.setAttribute("cx",String(ee)),z.setAttribute("cy",String(Ie)),z.setAttribute("r","3.5"),z.setAttribute("fill","#ffffff"),z.setAttribute("stroke",st),z.setAttribute("stroke-width","1.5"),u.appendChild(z);let Ht=document.createElementNS(u.namespaceURI,"circle");Ht.setAttribute("cx",String(Ft)),Ht.setAttribute("cy",String(Ie)),Ht.setAttribute("r","3.5"),Ht.setAttribute("fill","#ffffff"),Ht.setAttribute("stroke",st),Ht.setAttribute("stroke-width","1.5"),u.appendChild(Ht)}let _e=vt+_t/2+2,ie=4;if(k==="wide")B(dt,ie,_e,P-ie-4,11,null,wt,pt,Gt);else{let st=dt,z=Math.max(40,P-ie-8),Fe=Math.max(8,Math.floor(z/6));st.length>Fe&&(st=st.slice(0,Fe-1)+"\u2026");let Dt=document.createElementNS(u.namespaceURI,"text");Dt.setAttribute("x",String(ie)),Dt.setAttribute("y",String(_e)),Dt.setAttribute("text-anchor","start"),Dt.setAttribute("font-size","11"),Dt.setAttribute("fill","#111111"),Dt.textContent=st,Dt.style.cursor="pointer",Dt.addEventListener("mouseenter",wt),Dt.addEventListener("mouseleave",pt),Dt.addEventListener("click",Gt),u.appendChild(Dt)}if(Lt instanceof Date){let st=at(Lt.getTime()),z=document.createElementNS(u.namespaceURI,"line");z.setAttribute("x1",String(st)),z.setAttribute("y1",String(vt)),z.setAttribute("x2",String(st)),z.setAttribute("y2",String(vt+_t)),z.setAttribute("stroke","#ff6b6b"),z.setAttribute("stroke-width","2"),z.setAttribute("stroke-dasharray","4,2"),u.appendChild(z)}Ut+=1}if(l){let b=s.createDiv({cls:"prop-charts-empty"});b.textContent="Click on a bar or name to adjust dates and task estimate."}}function ve(s,n,t){var W,K,_,Q;let e=(W=n.options)!=null?W:{},r=e.background,o=(K=e.drilldown)!=null?K:!0,i=(_=t.rows)!=null?_:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let{inner:l,svg:a,tooltip:c,details:p}=xt(s,r),m=s.getBoundingClientRect().width||600,S=Math.max(m,480);l.style.width=S+"px";let d=40,h=16,x=18,g=28,N=300;a.setAttribute("height",String(N));let A=S-d-h,D=N-x-g,E=new Map;for(let u of i){let C=String(u.x),M=(Q=E.get(C))!=null?Q:{label:u.x,rows:[]};M.rows.push(u),E.set(C,M)}let H=Array.from(E.keys()).sort((u,C)=>u<C?-1:u>C?1:0).map(u=>E.get(u)),v=H.length,T=u=>String(u!=null?u:""),y=new Set;i.forEach(u=>{u.series!=null&&y.add(T(u.series))});let w=Array.from(y),f=w.length>1,k=f?"grouped":"single",R=0;i.forEach(u=>{u.y>R&&(R=u.y)}),(!isFinite(R)||R<=0)&&(R=1);let L=u=>x+D-u/(R||1)*D,F=L(0),I=4;for(let u=0;u<=I;u++){let C=R*u/I,M=L(C),B=document.createElementNS(a.namespaceURI,"line");B.setAttribute("x1",String(d)),B.setAttribute("y1",String(M)),B.setAttribute("x2",String(S-h)),B.setAttribute("y2",String(M)),B.setAttribute("stroke","#cccccc"),B.setAttribute("stroke-opacity","0.25"),a.appendChild(B);let $=document.createElementNS(a.namespaceURI,"text");$.setAttribute("x",String(d-4)),$.setAttribute("y",String(M+3)),$.setAttribute("text-anchor","end"),$.setAttribute("font-size","10"),$.setAttribute("fill","#111111"),$.textContent=String(Math.round(C)),a.appendChild($)}let P=v>0?A/v:A;if(H.forEach((u,C)=>{let M=d+P*(C+.5),B=String(u.label),$=document.createElementNS(a.namespaceURI,"text");$.setAttribute("x",String(M)),$.setAttribute("y",String(N-g+12)),$.setAttribute("text-anchor","middle"),$.setAttribute("font-size","10"),$.setAttribute("fill","#111111"),$.textContent=B,a.appendChild($)}),f){let u=s.createDiv({cls:"chart-notes-legend"});w.forEach((C,M)=>{let B=u.createDiv({cls:"chart-notes-legend-item"}),$=B.createDiv();$.style.width="10px",$.style.height="10px",$.style.borderRadius="999px",$.style.backgroundColor=ut(C,M),B.createSpan({text:C})})}H.forEach((u,C)=>{let M=d+P*(C+.5),B=u.rows;if(k==="single"){let Y=B[0],q=Y.y,ot=P*.6,et=M-ot/2,it=L(q),at=Math.max(2,F-it),Z=ut("bar",C),J=document.createElementNS(a.namespaceURI,"rect");J.setAttribute("x",String(et)),J.setAttribute("y",String(it)),J.setAttribute("width",String(ot)),J.setAttribute("height",String(at)),J.setAttribute("fill",Z),J.setAttribute("stroke","rgba(0,0,0,0.25)"),J.setAttribute("stroke-width","0.5"),J.style.cursor="pointer";let U=String(u.label),ft=`valor: ${Math.round(q*100)/100}`;J.addEventListener("mouseenter",ct=>{var nt,St;return gt(s,c,U,ft,(St=(nt=Y.notes)==null?void 0:nt.length)!=null?St:0,ct)}),J.addEventListener("mouseleave",()=>yt(c)),J.addEventListener("click",ct=>{var nt;ct.preventDefault(),bt(s,p,U,q,(nt=Y.notes)!=null?nt:[],o)}),a.appendChild(J);return}let $=w.length,tt=P/Math.max($+1,2),X=$*tt,rt=M-X/2;w.forEach((Y,q)=>{let ot=B.find(nt=>nt.series!=null&&T(nt.series)===Y);if(!ot)return;let et=ot.y,it=rt+q*tt,at=L(et),Z=Math.max(2,F-at),J=ut(Y,q),U=document.createElementNS(a.namespaceURI,"rect");U.setAttribute("x",String(it)),U.setAttribute("y",String(at)),U.setAttribute("width",String(tt)),U.setAttribute("height",String(Z)),U.setAttribute("fill",J),U.setAttribute("stroke","rgba(0,0,0,0.25)"),U.setAttribute("stroke-width","0.5"),U.style.cursor="pointer";let ft=`${Y} @ ${String(u.label)}`,ct=`valor: ${Math.round(et*100)/100}`;U.addEventListener("mouseenter",nt=>{var St,At;return gt(s,c,ft,ct,(At=(St=ot.notes)==null?void 0:St.length)!=null?At:0,nt)}),U.addEventListener("mouseleave",()=>yt(c)),U.addEventListener("click",nt=>{var St;nt.preventDefault(),bt(s,p,ft,et,(St=ot.notes)!=null?St:[],o)}),a.appendChild(U)})})}function Xe(s,n,t){var I,P,W,K;let e=(I=n.options)!=null?I:{},r=e.background,o=(P=e.drilldown)!=null?P:!0,i=(W=t.rows)!=null?W:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let l=new Map;for(let _ of i){let Q=String(_.x),u=(K=l.get(Q))!=null?K:{label:_.x,rows:[]};u.rows.push(_),l.set(Q,u)}let c=Array.from(l.keys()).sort((_,Q)=>_<Q?-1:_>Q?1:0).map(_=>l.get(_)),p=c.length,m=_=>String(_!=null?_:""),S=new Set(i.map(_=>m(_.series))),d=Array.from(S);if(d.length===1&&d[0]===""){ve(s,n,t);return}let{inner:h,svg:x,tooltip:g,details:N}=xt(s,r),A=s.getBoundingClientRect().width||600,D=Math.max(A,480);h.style.width=D+"px",x.setAttribute("width",String(D));let E=40,V=16,H=18,v=28,T=300;x.setAttribute("height",String(T));let y=D-E-V,w=T-H-v,f=0;c.forEach(_=>{let Q=_.rows.reduce((u,C)=>u+(C.y||0),0);Q>f&&(f=Q)}),(!isFinite(f)||f<=0)&&(f=1);let k=_=>H+w-_/(f||1)*w,R=4;for(let _=0;_<=R;_++){let Q=f*_/R,u=k(Q),C=document.createElementNS(x.namespaceURI,"line");C.setAttribute("x1",String(E)),C.setAttribute("y1",String(u)),C.setAttribute("x2",String(D-V)),C.setAttribute("y2",String(u)),C.setAttribute("stroke","#cccccc"),C.setAttribute("stroke-opacity","0.25"),x.appendChild(C);let M=document.createElementNS(x.namespaceURI,"text");M.setAttribute("x",String(E-4)),M.setAttribute("y",String(u+3)),M.setAttribute("text-anchor","end"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=String(Math.round(Q)),x.appendChild(M)}let L=p>0?y/p:y;c.forEach((_,Q)=>{let u=E+L*(Q+.5),C=String(_.label),M=document.createElementNS(x.namespaceURI,"text");M.setAttribute("x",String(u)),M.setAttribute("y",String(T-v+12)),M.setAttribute("text-anchor","middle"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=C,x.appendChild(M)});let F=h.createDiv({cls:"chart-notes-legend"});d.forEach((_,Q)=>{if(_==="")return;let u=F.createDiv({cls:"chart-notes-legend-item"}),C=u.createDiv();C.style.width="10px",C.style.height="10px",C.style.borderRadius="999px",C.style.backgroundColor=ut(_,Q),u.createSpan({text:_})}),c.forEach((_,Q)=>{let u=E+L*(Q+.5),C=L*.6,M=u-C/2,B=0;d.forEach(($,tt)=>{if($==="")return;let X=_.rows.find(ft=>m(ft.series)===$);if(!X)return;let rt=X.y||0,Y=B,q=B+rt;B=q;let ot=k(Y),et=k(q),it=Math.max(2,ot-et),at=ut($,tt),Z=document.createElementNS(x.namespaceURI,"rect");Z.setAttribute("x",String(M)),Z.setAttribute("y",String(et)),Z.setAttribute("width",String(C)),Z.setAttribute("height",String(it)),Z.setAttribute("fill",at),Z.setAttribute("stroke","rgba(0,0,0,0.25)"),Z.setAttribute("stroke-width","0.5"),Z.style.cursor="pointer";let J=`${$} @ ${String(_.label)}`,U=`valor: ${Math.round(rt*100)/100}`;Z.addEventListener("mouseenter",ft=>{var ct,nt;return gt(s,g,J,U,(nt=(ct=X.notes)==null?void 0:ct.length)!=null?nt:0,ft)}),Z.addEventListener("mouseleave",()=>yt(g)),Z.addEventListener("click",ft=>{var ct;ft.preventDefault(),bt(s,N,J,rt,(ct=X.notes)!=null?ct:[],o)}),x.appendChild(Z)})})}var Ct=40,zt=16,qt=18,je=28,Fn=.6,$n=2,ne="__default__";var De=[1,2,3,5,7,10,14,21,30,60,90,180,365],Vn=90,ze=3,Gn=10,jt=.02,qe=4,Hn=100,Ze="No data available.";function Mt(s){if(!s)return null;if(s instanceof Date){let n=s.getTime();return Number.isNaN(n)?null:s}if(typeof s=="string"){let n=s.trim();if(!n||/^\d+$/.test(n))return null;let t=new Date(n);if(!Number.isNaN(t.getTime()))return t}return null}function Je(s){var t;let n=new Map;for(let e of s){let r=e.series!=null&&e.series!==""?String(e.series):ne,o=(t=n.get(r))!=null?t:[];o.push(e),n.set(r,o)}return n}function tn(s){let n=s.map(t=>Mt(t.x)).filter(t=>!!t);return n.length>=$n&&n.length>=s.length*Fn}function en(s,n,t){let o=s.map(d=>Mt(d.x)).filter(d=>!!d).map(d=>d.getTime()).sort((d,h)=>d-h),i=o[0],l=o[o.length-1];i===l&&(i-=864e5,l+=864e5);let a=l-i||864e5,c=i-a*jt,p=l+a*jt;return{xScale:d=>{let h=Mt(d);if(!h)return t;let x=h.getTime();return t+(x-c)/(p-c||1)*n},xLabelOf:d=>{let h=Mt(d);return h?$t(h):String(d)}}}function nn(s,n,t){let e=[],r=new Set;for(let a of s){let c=String(a.x);r.has(c)||(r.add(c),e.push(a.x))}let o=e.length||1;return{xScale:a=>{let c=String(a),p=e.findIndex(m=>String(m)===c);return p<0?t:o===1?t+n/2:t+p/(o-1)*n},xLabelOf:a=>String(a)}}function rn(s,n,t,e,r,o,i,l,a){let p=i+r,m=document.createElementNS(s.namespaceURI,"line");m.setAttribute("x1",String(o)),m.setAttribute("y1",String(p)),m.setAttribute("x2",String(a-l)),m.setAttribute("y2",String(p)),m.setAttribute("stroke","#111111"),m.setAttribute("stroke-width","1"),s.appendChild(m);let S=(t-n)/864e5,d=Math.max(ze,Math.min(Gn,Math.floor(e/Vn)||ze)),h=S/d,x=De[De.length-1];for(let A of De)if(A>=h){x=A;break}let N=(A=>{let D=new Date(A);return D.setHours(0,0,0,0),D.getTime()})(n);for(let A=N;A<=t+.5*864e5;A+=x*864e5){let D=o+(A-n)/(t-n)*e,E=document.createElementNS(s.namespaceURI,"line");E.setAttribute("x1",String(D)),E.setAttribute("y1",String(i)),E.setAttribute("x2",String(D)),E.setAttribute("y2",String(p)),E.setAttribute("stroke","#111111"),E.setAttribute("stroke-opacity","0.18"),E.setAttribute("stroke-dasharray","2,4"),s.appendChild(E);let V=document.createElementNS(s.namespaceURI,"text");V.setAttribute("x",String(D)),V.setAttribute("y",String(p+12)),V.setAttribute("text-anchor","middle"),V.setAttribute("font-size","10"),V.setAttribute("fill","#111111"),V.textContent=$t(new Date(A)),s.appendChild(V)}}function Bn(s){let n=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(let e of s)e.y<n&&(n=e.y),e.y>t&&(t=e.y);return!isFinite(n)||!isFinite(t)?{min:0,max:1}:n===t?n===0?{min:0,max:1}:{min:0,max:t}:{min:n,max:t}}function sn(s,n,t,e){return r=>e+t-(r-s)/(n-s||1)*t}function on(s,n,t,e,r,o,i){for(let l=0;l<=qe;l++){let a=n+(t-n)*l/qe,c=e(a),p=document.createElementNS(s.namespaceURI,"line");p.setAttribute("x1",String(o)),p.setAttribute("y1",String(c)),p.setAttribute("x2",String(r+o+i)),p.setAttribute("y2",String(c)),p.setAttribute("stroke","#cccccc"),p.setAttribute("stroke-opacity","0.25"),s.appendChild(p);let m=document.createElementNS(s.namespaceURI,"text");m.setAttribute("x",String(o-4)),m.setAttribute("y",String(c+3)),m.setAttribute("text-anchor","end"),m.setAttribute("font-size","10"),m.setAttribute("fill","#111111"),m.textContent=Math.abs(a)>=Hn?String(Math.round(a)):String(Math.round(a*10)/10),s.appendChild(m)}}function an(s,n,t=!0){let e=t?n.filter(o=>o!==ne):n;if(e.length<=1)return;let r=s.createDiv({cls:"chart-notes-legend"});e.forEach((o,i)=>{let l=r.createDiv({cls:"chart-notes-legend-item"}),a=l.createDiv();a.style.width="10px",a.style.height="10px",a.style.borderRadius="999px",a.style.backgroundColor=ut(o,i),l.createSpan({text:o})})}function Kn(s,n){let t=[...s];return n&&t.sort((e,r)=>{let o=Mt(e.x),i=Mt(r.x),l=o?o.getTime():0,a=i?i.getTime():0;return l-a}),t}function Qn(s,n,t,e,r){let o="";if(s.forEach((i,l)=>{let a=n(i.x),c=t(i.y);o+=l===0?`M ${a} ${c}`:` L ${a} ${c}`}),e&&s.length>0){let i=s[0],l=s[s.length-1],a=n(i.x),c=n(l.x),p=t(r);o+=` L ${c} ${p} L ${a} ${p} Z`}return o}function On(s,n,t,e,r,o,i,l,a,c,p){n.forEach(m=>{let S=t(m.x),d=e(m.y),h=document.createElementNS(s.namespaceURI,"circle");h.setAttribute("cx",String(S)),h.setAttribute("cy",String(d)),h.setAttribute("r","3"),h.setAttribute("fill","#ffffff"),h.setAttribute("stroke",o),h.setAttribute("stroke-width","1.5"),h.style.cursor="pointer";let x=r(m.x),g=i?`${i} @ ${x}`:x,N=`value: ${Math.round(m.y*100)/100}`;h.addEventListener("mouseenter",A=>{var D,E;return gt(l,a,g,N,(E=(D=m.notes)==null?void 0:D.length)!=null?E:0,A)}),h.addEventListener("mouseleave",()=>yt(a)),h.addEventListener("click",A=>{var D;A.preventDefault(),bt(l,c,g,m.y,(D=m.notes)!=null?D:[],p)}),s.appendChild(h)})}function Ee(s,n,t,e){var w,f,k;let r=(w=n.options)!=null?w:{},o=r.background,i=(f=r.drilldown)!=null?f:!0,l=(k=t.rows)!=null?k:[];if(!l.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let{inner:a,svg:c,tooltip:p,details:m}=xt(s,o),S=s.getBoundingClientRect().width||600,d=Math.max(S,480);a.style.width=d+"px";let h=300;c.setAttribute("height",String(h));let x=d-Ct-zt,g=h-qt-je,N=tn(l),A=Je(l),D=Array.from(A.keys()),E=N?en(l,x,Ct):nn(l,x,Ct),{xScale:V,xLabelOf:H}=E;if(N){let L=l.map(Q=>Mt(Q.x)).filter(Q=>!!Q).map(Q=>Q.getTime()).sort((Q,u)=>Q-u),F=L[0],I=L[L.length-1],P=24*60*60*1e3;F===I&&(F-=P,I+=P);let W=I-F||P,K=F-W*jt,_=I+W*jt;rn(c,K,_,x,g,Ct,qt,zt,d)}let{min:v,max:T}=Bn(l),y=sn(v,T,g,qt);on(c,v,T,y,x,Ct,zt),an(s,D),D.forEach((R,L)=>{let F=A.get(R);if(!(F!=null&&F.length))return;let I=R===ne?ut("line",L):ut(R,L),P=Kn(F,N),W=Qn(P,V,y,e,v),K=document.createElementNS(c.namespaceURI,"path");K.setAttribute("d",W),K.setAttribute("fill",e?I:"none"),K.setAttribute("fill-opacity",e?"0.18":"0"),K.setAttribute("stroke",I),K.setAttribute("stroke-width",e?"1.5":"2"),c.appendChild(K);let _=R===ne?"":String(R);On(c,P,V,y,H,I,_,s,p,m,i)})}function cn(s,n,t){var R,L,F,I,P,W,K,_,Q;let e=(R=n.options)!=null?R:{},r=e.background,o=(L=e.drilldown)!=null?L:!0,i=(F=t.rows)!=null?F:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let l=Je(i),a=Array.from(l.keys()).filter(u=>u!==ne);if(a.length===0){Ee(s,n,t,!0);return}let{inner:c,svg:p,tooltip:m,details:S}=xt(s,r),d=s.getBoundingClientRect().width||600,h=Math.max(d,480);c.style.width=h+"px";let x=300;p.setAttribute("height",String(x));let g=h-Ct-zt,N=x-qt-je,A=tn(i),D=[],E=new Set;for(let u of i){let C=String(u.x);E.has(C)||(E.add(C),D.push(u.x))}let V=A?en(i,g,Ct):nn(i,g,Ct),{xScale:H,xLabelOf:v}=V;if(A&&D.sort((u,C)=>{let M=Mt(u),B=Mt(C),$=M?M.getTime():0,tt=B?B.getTime():0;return $-tt}),A){let C=i.map(Y=>Mt(Y.x)).filter(Y=>!!Y).map(Y=>Y.getTime()).sort((Y,q)=>Y-q),M=C[0],B=C[C.length-1],$=24*60*60*1e3;M===B&&(M-=$,B+=$);let tt=B-M||$,X=M-tt*jt,rt=B+tt*jt;rn(p,X,rt,g,N,Ct,qt,zt,h)}let T=new Map,y=new Map;for(let u of D)T.set(String(u),new Map);for(let u of a){let C=(I=l.get(u))!=null?I:[],M=new Map;for(let B of C){let $=String(B.x);M.set($,(P=B.y)!=null?P:0)}y.set(u,M)}for(let u of a){let C=(W=y.get(u))!=null?W:new Map,M=0;for(let B of D){let $=String(B),tt=C.get($);tt!==void 0&&(M=tt);let X=T.get($);X&&X.set(u,M)}}let w=[];for(let u of D){let C=String(u),M=new Map,B=new Map,$=T.get(C);for(let X of a){let rt=(K=$==null?void 0:$.get(X))!=null?K:0;M.set(X,rt)}let tt=0;for(let X of a){let rt=(_=M.get(X))!=null?_:0;B.set(X,tt),tt+=rt}w.push({x:u,seriesValues:M,stackedValues:B})}let f=0;for(let u of w){let C=0;for(let M of a)C+=(Q=u.seriesValues.get(M))!=null?Q:0;C>f&&(f=C)}(!isFinite(f)||f<=0)&&(f=1);let k=sn(0,f,N,qt);on(p,0,f,k,g,Ct,zt),a.length>0&&an(s,a,!1),a.forEach((u,C)=>{let M=ut(u,C),B="";w.forEach((Y,q)=>{var J,U;let ot=H(Y.x),et=(J=Y.stackedValues.get(u))!=null?J:0,it=(U=Y.seriesValues.get(u))!=null?U:0,at=et+it,Z=k(at);B+=q===0?`M ${ot} ${Z}`:` L ${ot} ${Z}`});let $=w.slice().reverse().map(Y=>{var it;let q=H(Y.x),ot=(it=Y.stackedValues.get(u))!=null?it:0,et=k(ot);return`${q} ${et}`}).join(" L "),tt=`${B} L ${$} Z`,X=document.createElementNS(p.namespaceURI,"path");X.setAttribute("d",tt),X.setAttribute("fill",M),X.setAttribute("fill-opacity","0.18"),X.setAttribute("stroke",M),X.setAttribute("stroke-width","1.5"),p.appendChild(X);let rt=y.get(u);w.forEach(Y=>{var kt,Jt,Ot;let q=String(Y.x);if(!(rt==null?void 0:rt.has(q)))return;let et=H(Y.x),it=(kt=Y.stackedValues.get(u))!=null?kt:0,at=(Jt=Y.seriesValues.get(u))!=null?Jt:0,Z=it+at,J=k(Z),U=document.createElementNS(p.namespaceURI,"circle");U.setAttribute("cx",String(et)),U.setAttribute("cy",String(J)),U.setAttribute("r","3"),U.setAttribute("fill","#ffffff"),U.setAttribute("stroke",M),U.setAttribute("stroke-width","1.5"),U.style.cursor="pointer";let ft=v(Y.x),ct=`${u} @ ${ft}`,nt=`value: ${Math.round(at*100)/100}`,At=((Ot=l.get(u))!=null?Ot:[]).find(Nt=>String(Nt.x)===String(Y.x));U.addEventListener("mouseenter",Nt=>{var Bt,Yt;return gt(s,m,ct,nt,(Yt=(Bt=At==null?void 0:At.notes)==null?void 0:Bt.length)!=null?Yt:0,Nt)}),U.addEventListener("mouseleave",()=>yt(m)),U.addEventListener("click",Nt=>{var Bt;Nt.preventDefault(),bt(s,S,ct,at,(Bt=At==null?void 0:At.notes)!=null?Bt:[],o)}),p.appendChild(U)})})}function ln(s,n,t){var D;let{background:e,drilldown:r=!0}=(D=n.options)!=null?D:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=We(e)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:l,svg:a,tooltip:c,details:p}=xt(s,e),m=Math.max(i,420);l.style.width=m+"px",o&&(a.style.color=o);let S=300,d=m/2,h=(S-28+28)/2,x=Math.min(m/2-20,S/2-20),N=t.rows.map(E=>Math.max(0,E.y)).reduce((E,V)=>E+V,0)||1,A=-Math.PI/2;t.rows.forEach((E,V)=>{var I;let H=E.x instanceof Date?E.x.toISOString().slice(0,10):String(E.x),v=E.y,T=v/N*Math.PI*2,y=d+x*Math.cos(A),w=h+x*Math.sin(A),f=d+x*Math.cos(A+T),k=h+x*Math.sin(A+T),R=T>Math.PI?1:0,L=document.createElementNS(a.namespaceURI,"path"),F=[`M ${d} ${h}`,`L ${y} ${w}`,`A ${x} ${x} 0 ${R} 1 ${f} ${k}`,"Z"].join(" ");L.setAttribute("d",F),L.setAttribute("fill",ut((I=E.series)!=null?I:H,V)),L.style.cursor="pointer",L.addEventListener("mouseenter",P=>{var W,K;return gt(s,c,H,v,(K=(W=E.notes)==null?void 0:W.length)!=null?K:0,P)}),L.addEventListener("mouseleave",()=>yt(c)),L.addEventListener("click",()=>{var P;return bt(s,p,H,v,(P=E.notes)!=null?P:[],r)}),a.appendChild(L),A+=T})}function un(s,n,t){var w;let{background:e,drilldown:r=!0}=(w=n.options)!=null?w:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=e?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:l,svg:a,tooltip:c,details:p}=xt(s,e),m=Math.max(i,700);l.style.width=m+"px",o&&(a.style.color=o);let S=300,d=m-48-10,h=S-28-28,x=t.rows.map(f=>{let k=f.x;if(k instanceof Date)return k.getTime();if(typeof k=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(k)){let L=new Date(k);if(!isNaN(L.getTime()))return L.getTime()}let R=Number(k);return isNaN(R)?null:R}return typeof k=="number"?k:null}),g=t.rows.map(f=>f.y),N=x.filter(f=>f!==null);if(N.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data (X is not numeric/date)."});return}let A=Math.min(...N),D=Math.max(...N),E=Math.min(...g),V=Math.max(...g),H=f=>48+(f-A)/(D-A||1)*d,v=f=>S-28-(f-E)/(V-E||1)*h,T=document.createElementNS(a.namespaceURI,"line");T.setAttribute("x1",String(48)),T.setAttribute("y1",String(28)),T.setAttribute("x2",String(48)),T.setAttribute("y2",String(S-28)),T.setAttribute("stroke","currentColor"),a.appendChild(T);let y=document.createElementNS(a.namespaceURI,"line");y.setAttribute("x1",String(48)),y.setAttribute("y1",String(S-28)),y.setAttribute("x2",String(m-10)),y.setAttribute("y2",String(S-28)),y.setAttribute("stroke","currentColor"),a.appendChild(y),t.rows.forEach((f,k)=>{let R=x[k];if(R==null)return;let L=H(R),F=v(g[k]),I=document.createElementNS(a.namespaceURI,"circle");I.setAttribute("cx",String(L)),I.setAttribute("cy",String(F)),I.setAttribute("r","4"),I.setAttribute("fill",ut(f.series,k)),I.style.cursor="pointer";let P=f.x instanceof Date?f.x.toISOString().slice(0,10):typeof f.x=="string"?f.x:String(f.x);I.addEventListener("mouseenter",W=>{var K,_;return gt(s,c,P,f.y,(_=(K=f.notes)==null?void 0:K.length)!=null?_:0,W)}),I.addEventListener("mouseleave",()=>yt(c)),I.addEventListener("click",W=>{var K;W.preventDefault(),bt(s,p,P,f.y,(K=f.notes)!=null?K:[],r)}),a.appendChild(I)})}var ge=class{render(n,t,e,r){var a;let{title:o}=(a=t.options)!=null?a:{};n.empty(),n.addClass("prop-charts-container");let l=n.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(o&&(l.textContent=o),t.type){case"bar":ve(n,t,e);break;case"stacked-bar":Xe(n,t,e);break;case"line":Ee(n,t,e,!1);break;case"stacked-area":cn(n,t,e);break;case"pie":ln(n,t,e);break;case"scatter":un(n,t,e);break;case"gantt":fe(n,t,e,r);break;default:n.createDiv({text:"Chart Notes: unsupported type: "+t.type})}}};var ye=class extends Zt.Plugin{constructor(t,e){super(t,e)}async onload(){console.log("Chart Notes: loading plugin (Bases-only)"),this.indexer=new ue(this.app),await this.indexer.buildIndex(),this.query=new me(()=>this.indexer.getAll(),[]),this.renderer=new ge,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Zt.TFile&&this.indexer.removeFile(t)})),this.registerBasesView(Se,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,e)=>new ce(t,e,this.renderer),options:()=>{let t=[];return t.push({type:"dropdown",key:"chartType",displayName:"Chart type",description:"Type of chart to render",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line","stacked-area":"Stacked area",pie:"Pie",scatter:"Scatter",gantt:"Gantt"}}),t.push({type:"property",key:"xProperty",displayName:"X axis / category (bars & slices)",description:"Property used for the X axis or categories (for pie, this is the slice).",shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")==="gantt"}}),t.push({type:"property",key:"ganttLabelProperty",displayName:"Task label (Gantt)",description:`Label for each task bar.
If empty, uses the note title.`,shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"yProperty",displayName:"Y value (empty = count)",description:`Numeric property summed on the Y axis.
Leave empty to just count notes.`,shouldHide:e=>{var o;let r=String((o=e.get("chartType"))!=null?o:"bar");return r==="pie"||r==="gantt"}}),t.push({type:"property",key:"seriesProperty",displayName:"Series / color (optional)",description:"Property that defines series / color for bars, lines and stacked area.",shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")==="pie"}}),t.push({type:"dropdown",key:"aggregateMode",displayName:"Value aggregation (Y)",description:`How to aggregate Y when multiple notes share the same X/series.
For line/stacked-area, 'Cumulative sum' turns the series into a running total.`,default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:e=>{var o;let r=String((o=e.get("chartType"))!=null?o:"bar");return r==="scatter"||r==="gantt"||r==="stacked-bar"}}),t.push({type:"property",key:"startProperty",displayName:"Start (Gantt)",description:"Start date/datetime for the task.",shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"endProperty",displayName:"End (Gantt)",description:"End date/datetime for the task.",shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"dueProperty",displayName:"Due (deadline, optional)",description:"Due date / deadline for the task.",shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"durationProperty",displayName:"Duration in minutes (optional)",description:`Duration of the task in minutes.
Used together with start/end/due.`,shouldHide:e=>{var r;return String((r=e.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0}),t.push({type:"text",key:"title",displayName:"Title (optional)",description:`Custom chart title.
Falls back to the view name.`}),t}})}onunload(){console.log("Chart Notes: unloading plugin")}};
