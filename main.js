/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var be=Object.defineProperty;var Ke=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Oe=Object.prototype.hasOwnProperty;var Xe=(s,r)=>{for(var t in r)be(s,t,{get:r[t],enumerable:!0})},ze=(s,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let e of We(r))!Oe.call(s,e)&&e!==t&&be(s,e,{get:()=>r[e],enumerable:!(n=Ke(r,e))||n.enumerable});return s};var qe=s=>ze(be({},"__esModule",{value:!0}),s);var fn={};Xe(fn,{default:()=>ye});module.exports=qe(fn);var Jt=require("obsidian");var le=require("obsidian"),xe="chartnotes-view",je=["bar","stacked-bar","line","stacked-area","pie","scatter","gantt"];function Ze(s){let r=String(s!=null?s:"bar").trim().toLowerCase();return je.includes(r)?r:"bar"}var Je=["sum","count","cumulative-sum"];function tn(s){let r=String(s!=null?s:"sum").trim().toLowerCase();return Je.includes(r)?r:"sum"}var en=["auto","none","day","week","month","quarter","year"];function nn(s){let r=String(s!=null?s:"auto").trim().toLowerCase();return en.includes(r)?r:"auto"}var ae="(missing)",ce=class extends le.BasesView{constructor(t,n,e){super(t);this.type=xe;this.renderer=e,this.rootEl=n.createDiv("chartnotes-bases-view")}onDataUpdated(){var _,et,st;this.rootEl.empty();let t=this.data,n=(_=t==null?void 0:t.groupedData)!=null?_:[];if(!n.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let e=this.config,o=Ze((et=e==null?void 0:e.get("chartType"))!=null?et:"bar"),i=o==="pie",u=o==="scatter",a=o==="gantt",c=tn(e==null?void 0:e.get("aggregateMode")),N=c==="cumulative-sum"&&!(o==="line"||o==="stacked-area")?"sum":c,x=nn(e==null?void 0:e.get("xBucket")),b=i||u||a?"none":x,h=this.getPropFromConfig("xProperty"),S=this.getPropFromConfig("ganttLabelProperty"),P=this.getPropFromConfig("yProperty"),y=this.getPropFromConfig("seriesProperty");i&&(y={id:null,name:null});let B=this.getPropFromConfig("startProperty"),I=this.getPropFromConfig("endProperty"),T=this.getPropFromConfig("dueProperty"),X=this.getPropFromConfig("durationProperty"),O=this.getPropFromConfig("groupProperty");if(!a&&!h.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / category' property in view options."});return}if(u&&(!h.id||!P.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(a&&!(B.id||I.id||T.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt needs Start/End or Due with Duration."});return}let v=a&&S.id?S:a?h:{id:null,name:null},E;if(a)E=this.buildRowsForGantt(n,v,y,B,I,T,X,O);else if(u)E=this.buildRowsForScatter(n,h,P,y);else{let m=i;E=this.buildRowsForAggregatedCharts(n,h,P,y,N,b,m)}if(!E.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let p={rows:E},d=((st=e==null?void 0:e.get("title"))!=null?st:"").trim()||(e==null?void 0:e.name)||"Chart Notes (Bases)",M=e==null?void 0:e.get("drilldown"),V=typeof M=="boolean"?M:!0,G=this.buildEncoding({x:h,y:P,series:y,start:B,end:I,due:T,duration:X,group:O,label:v,aggMode:N,xBucket:b,chartType:o}),Y={type:o,source:{type:"properties",query:""},encoding:G,options:{title:d,drilldown:V}},$={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,Y,p,$)}getPropFromConfig(t){var u,a;let n=this.config,e=(u=n==null?void 0:n.get)==null?void 0:u.call(n,t);if(!e)return{id:null,name:null};let o=e.trim();if(!o||o==="undefined"||o==="null")return{id:null,name:null};let i=o;try{let c=(0,le.parsePropertyId)(i);return{id:i,name:(a=c.name)!=null?a:i}}catch(c){return{id:i,name:i}}}readValue(t,n){if(!n.id)return null;let e;try{e=t.getValue(n.id)}catch(o){return null}if(!e)return null;try{if(typeof e.isEmpty=="function"&&e.isEmpty())return null}catch(o){}try{let o=e.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let n=new Date(t.trim());return Number.isNaN(n.getTime())?null:n}compareX(t,n){let e=this.parseDate(t!=null?String(t):null),o=this.parseDate(n!=null?String(n):null);if(e&&o)return e.getTime()-o.getTime();let i=Number(t),u=Number(n);return!Number.isNaN(i)&&!Number.isNaN(u)?i-u:String(t!=null?t:"").localeCompare(String(n!=null?n:""))}fmtDate(t){let n=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${n}-${e}-${o}`}startOfWeek(t){let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e=(n.getDay()+6)%7;return n.setDate(n.getDate()-e),n.setHours(0,0,0,0),n}bucketX(t,n){let e=this.parseDate(t);if(!e)return t;switch(n){case"none":return t;case"auto":case"day":return this.fmtDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()));case"week":{let o=this.startOfWeek(e);return`${this.fmtDate(o)} (W)`}case"month":{let o=String(e.getMonth()+1).padStart(2,"0");return`${e.getFullYear()}-${o}`}case"quarter":{let o=Math.floor(e.getMonth()/3)+1;return`${e.getFullYear()}-Q${o}`}case"year":return`${e.getFullYear()}`;default:return t}}getXValuesForEntry(t,n,e,o){var f,N;let i=[],u=x=>this.bucketX(x,e);if(!n.id){let x=t.file,b=x!=null&&x.name?String(x.name):String((f=x==null?void 0:x.path)!=null?f:ae);return i.push(u(b)),i}if(!o){let x=(N=this.readValue(t,n))!=null?N:ae;return i.push(u(x)),i}let a=null;try{a=t.getValue(n.id)}catch(x){a=null}let c=x=>{if(!x)return;let b=String(x).trim();b&&i.push(u(b))};if(a==null)c(ae);else if(typeof a=="string"){let x=a.trim();if(x){let b=x.split(/\s+/);for(let h of b)c(h)}}else if(Array.isArray(a))for(let x of a){if(x==null)continue;let b;try{b=x.toString()}catch(h){continue}c(b)}else if(typeof a.toArray=="function"){let x=a.toArray();if(Array.isArray(x))for(let b of x){if(b==null)continue;let h;try{h=b.toString()}catch(S){continue}c(h)}else{let b;try{b=a.toString()}catch(h){b=""}c(b)}}else{let x;try{x=a.toString()}catch(b){x=""}c(x)}return i.length||c(ae),i}buildRowsForAggregatedCharts(t,n,e,o,i,u,a){let c=new Map,f=a||i==="count"||!e.id&&i!=="sum",N=e.name||"y";for(let b of t)for(let h of b.entries){let S=h.file,P=this.getXValuesForEntry(h,n,u,a),y=1,B=null;if(!f&&e.id){if(B=this.readValue(h,e),B==null)continue;let X=Number(B);if(Number.isNaN(X))continue;y=X}else y=1;let I=this.readValue(h,o),T=I!=null?String(I):void 0;for(let X of P){let O=`${X}@@${T!=null?T:""}`,v=c.get(O);v||(v={x:X,y:0,series:T,notes:[],props:{}},c.set(O,v)),v.y+=y,S!=null&&S.path&&v.notes.push(S.path),v.props&&n.name&&(v.props[n.name]=X),!f&&v.props&&N&&B!=null&&(v.props[N]=v.y),f&&v.props&&(v.props[N]=v.y),v.props&&o.name&&I!=null&&(v.props[o.name]=I)}}let x=Array.from(c.values());return i==="cumulative-sum"?this.toCumulative(x):x}toCumulative(t){var o,i;let n=new Map;for(let u of t){let a=(o=u.series)!=null?o:"__no_series__",c=n.get(a);c||(c=[],n.set(a,c)),c.push(u)}let e=[];for(let[,u]of n){let a=[...u].sort((f,N)=>this.compareX(f.x,N.x)),c=0;for(let f of a){let N=Number((i=f.y)!=null?i:0);Number.isNaN(N)||(c+=N,e.push({...f,y:c}))}}return e.sort((u,a)=>this.compareX(u.x,a.x)),e}buildRowsForScatter(t,n,e,o){let i=[];for(let u of t)for(let a of u.entries){let c=a.file,f=this.readValue(a,n),N=this.readValue(a,e);if(f==null||N==null)continue;let x=Number(f),b=Number(N);if(Number.isNaN(x)||Number.isNaN(b))continue;let h=this.readValue(a,o),S=h!=null?String(h):void 0;i.push({x,y:b,series:S,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,n,e,o,i,u,a,c){var P;let f=[],b=y=>{let B=[y==null?void 0:y.label,y==null?void 0:y.name,y==null?void 0:y.value,y==null?void 0:y.key,y==null?void 0:y.group,y==null?void 0:y.groupLabel];for(let I of B)if(I!=null&&String(I).trim()!=="")return String(I);return""},h=n;try{let y=this.getPropFromConfig("ganttLabelProperty");y&&y.id&&(h=y)}catch(y){}let S=!!c.id;for(let y of t){let B=b(y);for(let I of(P=y.entries)!=null?P:[]){let T=I.file,X=this.readValue(I,o),O=this.readValue(I,i),v=this.readValue(I,u),E=this.readValue(I,a),p=E!=null?Number(E):NaN,w=Number.isFinite(p)&&p>0,d=w?p*6e4:36e5,M=this.parseDate(X),V=this.parseDate(O),G=this.parseDate(v),Y=M,$=V;if(Y&&!$&&($=new Date(Y.getTime()+d)),!Y&&$&&(Y=new Date($.getTime()-d)),!Y&&!$&&G&&(w?($=G,Y=new Date(G.getTime()-d)):(Y=G,$=new Date(G.getTime()+36e5))),!Y||!$)continue;if(Y.getTime()>$.getTime()){let l=Y;Y=$,$=l}let _=this.readValue(I,h);(_==null||String(_).trim()==="")&&(T!=null&&T.name?_=String(T.name).replace(/\.md$/i,""):T!=null&&T.path?_=String(T.path):_="(sem t\xEDtulo)");let et=this.readValue(I,e),st=et!=null?String(et):void 0,m={};if(B&&(m.__basesGroup=B),S){let l=this.readValue(I,c);l!=null&&c.name&&(m[c.name]=l)}h.name&&(m[h.name]=_),m.label=_,o.name&&X!=null&&(m[o.name]=X),i.name&&O!=null&&(m[i.name]=O),u.name&&v!=null&&(m[u.name]=v),w&&a.name&&(m[a.name]=p);let H=T==null?void 0:T.path;f.push({x:_,y:0,series:st,start:Y,end:$,due:G!=null?G:void 0,notes:H?[H]:[],props:m})}}return f.sort((y,B)=>!y.start||!B.start?0:y.start.getTime()-B.start.getTime()),f}buildEncoding(t){var u,a,c,f,N,x,b,h,S,P,y;let n=(u=t.x.name)!=null?u:"x",e=(a=t.y.name)!=null?a:"y",o=(N=(f=(c=t.label.name)!=null?c:t.x.name)!=null?f:t.group.name)!=null?N:"label",i=t.chartType==="gantt"?"__basesGroup":(x=t.group.name)!=null?x:"group";return{x:n,y:e,series:(b=t.series.name)!=null?b:"series",start:(h=t.start.name)!=null?h:"start",end:(S=t.end.name)!=null?S:"end",due:(P=t.due.name)!=null?P:"due",duration:(y=t.duration.name)!=null?y:"duration",group:i,label:o}}};var Pe=require("obsidian"),ue=class{constructor(r){this.index=new Map;this.app=r}async buildIndex(){this.index.clear();let r=this.app.vault.getMarkdownFiles();for(let t of r)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(r){if(r.extension!=="md")return;let t={};try{let e=(await this.app.vault.read(r)).match(/^---\n([\s\S]*?)\n---\n?/);if(e){let i=(0,Pe.parseYaml)(e[1])||{};if(i&&typeof i=="object")for(let[u,a]of Object.entries(i))u!=="position"&&(t[u]=a)}let o=this.app.metadataCache.getFileCache(r);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",r.path,n)}this.index.set(r.path,{path:r.path,props:t})}removeFile(r){this.index.delete(r.path)}};function _e(s,r){if(!r||r.length===0)return!0;for(let t of r){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function Fe(s,r){if(!r||r.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let e of r)if(t.includes(e)||t.includes("#"+e))return!0;return!1}let n=String(t);for(let e of r)if(n===e||n==="#"+e)return!0;return!1}function pe(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function qt(s){if(s instanceof Date&&!isNaN(s.getTime()))return s;if(typeof s!="string")return null;let r=s.trim(),t=r.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(t){let e=Number(t[1]),o=Number(t[2])-1,i=Number(t[3]),u=t[4]?Number(t[4]):0,a=t[5]?Number(t[5]):0,c=t[6]?Number(t[6]):0;return Number.isNaN(e)||Number.isNaN(o)||Number.isNaN(i)||Number.isNaN(u)||Number.isNaN(a)||Number.isNaN(c)?null:new Date(e,o,i,u,a,c,0)}let n=new Date(r);return isNaN(n.getTime())?null:n}function St(s){let r=new Date(s);return r.setHours(0,0,0,0),r}function de(s,r){let t=new Date(s);return t.setDate(t.getDate()-r),t}function rn(s,r){return de(s,r*7)}function sn(s,r){let t=new Date(s);return t.setMonth(t.getMonth()-r),t}function Ae(s,r){let t=new Date(s);return t.setDate(t.getDate()+r),t}function on(s,r){return Ae(s,r*7)}function an(s,r){let t=new Date(s);return t.setMonth(t.getMonth()+r),t}function Le(s){let r=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(r)||r.endsWith("date")||r.endsWith("at")||r.endsWith("on"))}function Ie(s,r){let t=r?new Date(r):new Date,n=St(t),e=s.trim().toLowerCase();if(e==="today")return n;if(e==="yesterday")return St(de(n,1));if(/^-\d+$/.test(e)){let o=parseInt(e.slice(1),10);return St(de(n,o))}if(/^-\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(de(n,o))}if(/^-\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(rn(n,o))}if(/^-\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(sn(n,o))}if(/^\+\d+$/.test(e)){let o=parseInt(e.slice(1),10);return St(Ae(n,o))}if(/^\+\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(Ae(n,o))}if(/^\+\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(on(n,o))}if(/^\+\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(an(n,o))}return null}function $e(s){let r=s.trim(),t=r.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let f=t[1].trim(),N=t[2].trim(),x=t[3].trim(),b=Le(f),h=Se(N,b),S=Se(x,b),P=h.valueType==="date"||S.valueType==="date"?"date":h.valueType;return{field:f,op:"between",value:h.value,value2:S.value,valueType:P}}let n=/(==|!=|>=|<=|>|<)/,e=r.split(n);if(e.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+s);let o=e[0].trim(),i=e[1].trim(),u=e[2].trim(),a=Le(o),c=Se(u,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function Se(s,r){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),e=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(r){if(t==="0"||n==="today")return{value:St(new Date),valueType:"date"};let i=Ie(t);if(i)return{value:i,valueType:"date"}}else if(e){let i=Ie(t);if(i)return{value:i,valueType:"date"}}if(pe(t)){let i=qt(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Ve(s,r){let t=s[r.field];if(t==null)return!1;if(r.valueType==="date"){let o=t instanceof Date?St(t):pe(t)?St(qt(t)):null;if(!o)return!1;let i=r.value instanceof Date?r.value:null,u=r.value2 instanceof Date?r.value2:null;if(!i)return!1;let a=o.getTime(),c=St(i).getTime();switch(r.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!u)return!1;let f=St(u).getTime();return a>=c&&a<=f}}if(r.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(r.value);switch(r.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof r.value2!="number"?!1:o>=i&&o<=r.value2}}let n=String(t),e=String(r.value);switch(r.op){case"==":return n===e;case"!=":return n!==e;case">":return n>e;case">=":return n>=e;case"<":return n<e;case"<=":return n<=e;case"between":return!1}}function cn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(pe(s)){let r=qt(s);if(r)return{key:r,isDate:!0}}return{key:s,isDate:!1}}function ln(s,r){let t=s.x,n=r.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let e=String(t),o=String(n);return e<o?-1:e>o?1:0}function un(s,r){var o,i;let t=ln(s,r);if(t!==0)return t;let n=(o=s.series)!=null?o:"",e=(i=r.series)!=null?i:"";return n<e?-1:n>e?1:0}function dn(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let r=s.trim().match(/^(\d+)/);if(r){let t=Number(r[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(s)}`)}function pn(s){var n,e;let r=new Map,t=[];for(let o of s){let i=(n=o.series)!=null?n:"__no_series__",a=((e=r.get(i))!=null?e:0)+o.y;r.set(i,a),t.push({...o,y:a})}return t}function mn(s,r){var i,u;let t=dn(r);if(!t||t<=1)return[...s];let n=new Map,e=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:"__no_series__",f=n.get(c);f||(f=[],n.set(c,f));let N=(u=e.get(c))!=null?u:0;if(f.push(a.y),N+=a.y,f.length>t){let h=f.shift();N-=h}e.set(c,N);let x=f.length||1,b=N/x;o.push({...a,y:b})}return o}var me=class{constructor(r,t){this.getIndex=r,this.defaultPaths=t}run(r){var i,u,a;let t=this.getIndex(),n=(i=r.source)!=null&&i.paths&&r.source.paths.length?r.source.paths:this.defaultPaths,e=(u=r.source)!=null&&u.tags&&r.source.tags.length?r.source.tags:[],o=[];for(let c of t){let f=n&&n.length?_e(c.path,n):!0,N=e&&e.length?Fe(c.props,e):!0;if(!f||!N)continue;let x=!0;if((a=r.source)!=null&&a.where&&r.source.where.length>0)for(let b of r.source.where){let h;try{h=$e(b)}catch(S){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${b} (${S.message})`)}if(!Ve(c.props,h)){x=!1;break}}x&&o.push(c)}return r.type==="gantt"?this.runGantt(r,o):r.type==="table"?this.runTable(r,o):this.runStandard(r,o)}runTable(r,t){var e,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(e=r.encoding)==null?void 0:e.x,yField:(o=r.encoding)==null?void 0:o.y}}runGantt(r,t){var N,x,b;let n=(N=r.encoding)!=null?N:{},e=n.start,o=n.end,i=(x=n.label)!=null?x:n.x,u=n.series,a=n.duration,c=n.due,f=[];for(let h of t){let S=(b=h.props)!=null?b:{},P=v=>Array.isArray(v)?v[0]:v,y=null;if(o){let v=P(S[o]),E=qt(v);E&&(y=E)}if(!y)continue;let B=null;if(e){let v=P(S[e]),E=qt(v);E&&(B=E)}if(!B&&a){let v=P(S[a]),E=Number(v);Number.isNaN(E)||(B=new Date(y.getTime()-E*6e4))}B||(B=new Date(y.getTime()));let I;if(c){let v=P(S[c]),E=qt(v);E&&(I=E)}let T;if(i){let v=P(S[i]);(v==null||v==="")&&(v=h.path),T=v}else T=h.path;let X;if(u){let v=P(S[u]);v!=null&&(X=String(v))}let O={x:T,y:0,notes:[h.path],series:X,start:B,end:y,props:S};I&&(O.due=I),f.push(O)}return f.sort((h,S)=>{let P=h.start?h.start.getTime():0,y=S.start?S.start.getTime():0;return P-y}),{rows:f,xField:i,yField:o}}runStandard(r,t){var h,S,P,y,B,I,T,X,O,v;let n=(h=r.encoding)==null?void 0:h.x,e=(S=r.encoding)==null?void 0:S.y,o=(P=r.encoding)==null?void 0:P.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(y=r.aggregate)!=null?y:{},u=(B=i.y)!=null?B:null,a=!!i.cumulative,c=i.rolling;if(!e&&u!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let f=[];for(let E of t){let p=(I=E.props)!=null?I:{},w=_=>Array.isArray(_)?_[0]:_,d=w(p[n]);if(d==null)continue;let M=cn(d),V=M.key,G=M.isDate,Y;if(o){let _=w(p[o]);_!=null&&String(_).trim()!==""&&(Y=String(_))}let $;if(u==="count")$=1;else{let _=w(p[e]);if(_==null)continue;let et=Number(_);if(Number.isNaN(et))continue;$=et}f.push({x:V,y:$,notes:[E.path],series:Y,props:p,_isDate:G,_origX:d})}if(f.length===0)return{rows:[],xField:n,yField:e};let N=[];if(u){let E=new Map;for(let p of f){let w=(T=p.series)!=null?T:"",d=p.x instanceof Date?p.x.toISOString().slice(0,10):String(p.x),M=w+"||"+d,V=(X=E.get(M))!=null?X:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:p.x,isDate:p._isDate,series:p.series,props:p.props};V.sum+=p.y,V.count+=1,p.y<V.min&&(V.min=p.y),p.y>V.max&&(V.max=p.y),V.notes.push(...p.notes),V.props=(O=p.props)!=null?O:V.props,E.set(M,V)}for(let[,p]of E){let w=p.sum;switch(u){case"sum":w=p.sum;break;case"avg":w=p.sum/p.count;break;case"min":w=p.min;break;case"max":w=p.max;break;case"count":w=p.count;break}N.push({x:p.xRep,y:w,notes:p.notes,series:p.series,props:p.props})}}else N=f.map(E=>({x:E.x,y:E.y,notes:E.notes,series:E.series,props:E.props}));if(N.length===0)return{rows:[],xField:n,yField:e};let x=((v=r.sort)==null?void 0:v.x)==="desc"?"desc":"asc";if(N.sort((E,p)=>{let w=un(E,p);return x==="asc"?w:-w}),(a||c)&&!(r.type==="line"||r.type==="stacked-area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'stacked-area'.");if(a&&c)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let b=N;return c?b=mn(N,c):a&&(b=pn(N)),{rows:b,xField:n,yField:e}}};var Ft=require("obsidian");var Be=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ft(s,r){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,e)=>n*33+e.charCodeAt(0)>>>0,0);return Be[t%Be.length]}function Tt(s,r){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,r&&(n.style.background=r);let e="http://www.w3.org/2000/svg",o=document.createElementNS(e,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let u=s.createDiv({cls:"chart-notes-details"});return u.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:u}}function wt(s,r,t,n,e,o){let i=s.getBoundingClientRect(),u=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);r.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${u}</div>
    <div class="chart-notes-tooltip-notes">${e} nota${e===1?"":"s"}</div>
  `,r.style.display="block";let a=r.getBoundingClientRect(),c=o.clientX-i.left+6,f=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),f+a.height>i.height-4&&(f=i.height-a.height-4),f<4&&(f=4),r.style.left=c+"px",r.style.top=f+"px"}function vt(s){s.style.display="none"}function Dt(s,r,t,n,e,o){if(!o)return;if(r.empty(),!e||e.length===0){r.style.display="none";return}r.style.display="block";let i=r.createEl("div",{cls:"chart-notes-details-header"}),u=i.createEl("div",{cls:"chart-notes-details-title"});u.textContent=`Notas em "${t}" (${e.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{r.style.display="none"});let c=r.createEl("ul",{cls:"chart-notes-details-list"});for(let f of e){let x=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:f});x.href="#",x.addEventListener("click",b=>{b.preventDefault(),app.workspace.openLinkText(f,"",!1)})}}function Pt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let r=s.getUTCDate().toString().padStart(2,"0"),t=(s.getUTCMonth()+1).toString().padStart(2,"0");return`${r}/${t}`}function Ge(s){if(!s)return!1;let r=s.trim().toLowerCase();if(r==="#fff"||r==="#ffffff"||r==="white")return!0;if(!r.startsWith("#"))return!1;let t,n,e;if(r.length===4)t=parseInt(r[1]+r[1],16),n=parseInt(r[2]+r[2],16),e=parseInt(r[3]+r[3],16);else if(r.length===7)t=parseInt(r.slice(1,3),16),n=parseInt(r.slice(3,5),16),e=parseInt(r.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*e)/255>.7}var we=class extends Ft.Modal{constructor(t,n,e,o){var u;super(app);this.notePath=t,this.spec=n,this.refresh=e,this.reindexFile=o;let i=(u=n.encoding)!=null?u:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var v,E;let{contentEl:t}=this;t.empty(),this.titleEl.setText("Editar tarefa");let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Ft.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}this.titleEl.setText(`Editar tarefa \u2013 ${n.basename}`);let e=await this.app.vault.read(n),o={},i=e,u=e.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);if(u){try{o=(v=(0,Ft.parseYaml)(u[1]))!=null?v:{}}catch(p){o={}}i=(E=u[2])!=null?E:""}let a=t.createDiv({cls:"gantt-edit-form"}),c=p=>{let w=a.createDiv({cls:"gantt-edit-row"}),d=w.createDiv({cls:"gantt-edit-label"});d.textContent=p;let M=w.createDiv({cls:"gantt-edit-field"});return{row:w,field:M}},f=p=>{if(!p)return null;if(p instanceof Date&&!isNaN(p.getTime()))return p;let d=String(p).trim().match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!d)return null;let M=Number(d[1]),V=Number(d[2])-1,G=Number(d[3]),Y=d[4]?Number(d[4]):0,$=d[5]?Number(d[5]):0,_=d[6]?Number(d[6]):0;return Number.isNaN(M)||Number.isNaN(V)||Number.isNaN(G)||Number.isNaN(Y)||Number.isNaN($)||Number.isNaN(_)?null:new Date(M,V,G,Y,$,_,0)},N=p=>{let w=f(p);if(!w)return"";let d=_=>_.toString().padStart(2,"0"),M=w.getFullYear(),V=d(w.getMonth()+1),G=d(w.getDate()),Y=d(w.getHours()),$=d(w.getMinutes());return`${M}-${V}-${G}T${Y}:${$}`},x=p=>{if(p=p.trim(),!p)return;let w=p.match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2}))?$/);if(!w)return;let d=`${w[1]}-${w[2]}-${w[3]}`;if(w[4]){let M=w[4],V=w[5];return`${d}T${M}:${V}`}return d},b=null,h=null,S=null,P=null;if(this.startKey){let{field:p}=c(`In\xEDcio (${this.startKey})`);b=p.createEl("input"),b.type="datetime-local",b.value=N(o[this.startKey])}if(this.endKey){let{field:p}=c(`Fim (${this.endKey})`);h=p.createEl("input"),h.type="datetime-local",h.value=N(o[this.endKey])}if(this.durationKey){let{field:p}=c(`Dura\xE7\xE3o (min) (${this.durationKey})`);S=p.createEl("input"),S.type="number";let w=o[this.durationKey];S.value=typeof w=="number"&&!Number.isNaN(w)?String(w):""}if(this.dueKey){let{field:p}=c(`Due (${this.dueKey})`);P=p.createEl("input"),P.type="datetime-local",P.value=N(o[this.dueKey])}let y=a.createDiv({cls:"gantt-edit-actions-row"});y.style.marginTop="0.75rem",y.style.display="flex",y.style.justifyContent="space-between",y.style.alignItems="center";let B=y.createDiv({cls:"gantt-edit-actions-left"});B.style.display="flex";let I=y.createDiv({cls:"gantt-edit-actions-right"});I.style.display="flex",I.style.gap="0.5rem";let T=B.createEl("button",{text:"Abrir nota"}),X=I.createEl("button",{text:"Salvar"}),O=I.createEl("button",{text:"Cancelar"});T.addEventListener("click",()=>{this.app.workspace.openLinkText(this.notePath,"",!1),this.close()}),O.addEventListener("click",()=>this.close()),X.addEventListener("click",async()=>{if(this.startKey&&b){let d=x(b.value);d?o[this.startKey]=d:delete o[this.startKey]}if(this.endKey&&h){let d=x(h.value);d?o[this.endKey]=d:delete o[this.endKey]}if(this.durationKey&&S){let d=S.value.trim();if(d==="")delete o[this.durationKey];else{let M=Number(d);Number.isNaN(M)||(o[this.durationKey]=M)}}if(this.dueKey&&P){let d=x(P.value);d?o[this.dueKey]=d:delete o[this.dueKey]}let w=`---
${(0,Ft.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,w),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(d){}if(this.refresh)try{this.refresh()}catch(d){}new Ft.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function fe(s,r,t,n){var te,Yt,Kt,ee,Ee,Ne,Te,ke;let e=(te=r.options)!=null?te:{},o=e.background,i=(Yt=e.drilldown)!=null?Yt:!0,u=!0,a=g=>{if(g==null)return"";let W=String(g).trim();if(!W)return"";let j=W.match(/^\[\[(.+?)\]\]$/);j&&(W=j[1]);let ut=W.lastIndexOf("/");return ut>=0&&ut<W.length-1&&(W=W.slice(ut+1)),W};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(g=>g.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let c=t.rows.filter(g=>g.start&&g.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let f=r.encoding,N=f.group,x=f.duration,b=(g,W)=>{if(!g||!W)return;let j=g[W];return Array.isArray(j)?j[0]:j},h="__chartnotes_no_group__",P=c.map(g=>{var xt,Rt;let W=g.start,j=g.end,ut=g.props,zt=typeof g.x=="string"?g.x:g.x instanceof Date?Pt(W):String(g.x),Vt=a(zt),_t=N!=null&&N!==""?b(ut,N):void 0,Bt=_t!=null&&String(_t).trim().length>0?String(_t):h,At=(xt=g.notes)==null?void 0:xt[0],Gt=At?(Rt=At.replace(/\.md$/i,"").split("/").pop())!=null?Rt:At:Vt,jt=g.due,Wt,Ct=b(ut,x);if(Ct!=null){let Ht=Number(Ct);Number.isNaN(Ht)||(Wt=Ht)}return{row:g,start:W,end:j,props:ut,fullName:Vt,groupKey:Bt,notePath:At,noteTitle:Gt,due:jt,estMinutes:Wt}}).filter(g=>g.start instanceof Date&&!isNaN(g.start.getTime())&&g.end instanceof Date&&!isNaN(g.end.getTime()));if(P.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}P.sort((g,W)=>{if(g.groupKey<W.groupKey)return-1;if(g.groupKey>W.groupKey)return 1;let j=g.start.getTime(),ut=W.start.getTime();return j!==ut?j-ut:g.fullName.localeCompare(W.fullName)});let y=26,B=0,I=null;for(let g of P)g.groupKey!==I&&(I=g.groupKey,g.groupKey!==h&&(B+=1)),B+=1;let T=Math.min(...P.map(g=>g.start.getTime())),X=Math.max(...P.map(g=>g.end.getTime()));if(!isFinite(T)||!isFinite(X)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let O=24*60*60*1e3,v=g=>{let W=new Date(g);return W.setHours(0,0,0,0),W.getTime()},E=v(T),p=v(X),w=s.querySelector(".prop-charts-title-row");w||(w=s.createDiv({cls:"prop-charts-title-row"}));let d=s.dataset.ganttZoomMode||String((Kt=e.zoomMode)!=null?Kt:"100");s.dataset.ganttZoomMode=d;let M=s.dataset.ganttLabelMode||String((ee=e.labelMode)!=null?ee:"compact");s.dataset.ganttLabelMode=M;let V=w.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(g=>{let W=V.createEl("button",{cls:"gantt-zoom-btn",text:g.label});g.id===d&&W.addClass("is-active"),W.addEventListener("click",j=>{j.preventDefault(),s.dataset.ganttZoomMode=g.id,fe(s,r,t,n)})});let Y=Number(e.labelWidth),$=!Number.isNaN(Y)&&Y>120?Y:260,_=M==="wide"?$+160:$,et=s.getBoundingClientRect().width||600,st=Math.max(et,820),m;if(d==="fit")m=et;else{let g=Number(d)/100||1;m=st*g}let{inner:H,svg:l,tooltip:D,details:R}=Tt(s,o);H.style.width=m+"px";let K=(g,W,j,ut,zt,Vt,_t,ne,Bt)=>{if(!g)return;let At=Math.max(40,ut-8),jt=Math.max(8,Math.floor(At/6)),Wt=g.split(/\s+/),Ct=[],xt="";for(let Ut of Wt){if(!xt){xt=Ut;continue}(xt+" "+Ut).length<=jt?xt+=" "+Ut:(Ct.push(xt),xt=Ut)}xt&&Ct.push(xt);let Rt=zt+2,Ht=Ct.length*Rt,re=j-Ht/2+zt;Ct.forEach((Ut,oe)=>{let yt=document.createElementNS(l.namespaceURI,"text");yt.setAttribute("x",String(W)),yt.setAttribute("y",String(re+oe*Rt)),yt.setAttribute("text-anchor","start"),yt.setAttribute("font-size",String(zt)),yt.setAttribute("fill","#111111"),Vt&&yt.setAttribute("font-weight",Vt),yt.textContent=Ut,_t&&yt.addEventListener("mouseenter",ht=>_t(ht)),ne&&yt.addEventListener("mouseleave",()=>ne()),Bt&&(yt.style.cursor="pointer",yt.addEventListener("click",ht=>Bt(ht))),l.appendChild(yt)})},C=28,ct=28,rt=10,A=Math.max(300,C+ct+B*y+24);l.setAttribute("height",String(A));let F=m-_-rt,k=C+6;l.style.color="#111111";let Q=p+O-E||1,U=E-Q*.02,J=p+O+Q*.08,q=g=>_+(g-U)/(J-U)*F,Z=(J-U)/O,z=Math.max(4,Math.min(12,Math.floor(F/90)||4)),nt=Z/z,tt=[1,2,3,5,7,10,14,21,30,60,90,180,365],ot=tt[tt.length-1];for(let g of tt)if(g>=nt){ot=g;break}let dt=[],Et=v(U);for(let g=Et;g<=J+.5*O;g+=ot*O)dt.push(g);let Nt=document.createElementNS(l.namespaceURI,"line");Nt.setAttribute("x1",String(_)),Nt.setAttribute("y1",String(k)),Nt.setAttribute("x2",String(m-rt)),Nt.setAttribute("y2",String(k)),Nt.setAttribute("stroke","#111111"),l.appendChild(Nt);for(let g of dt){let W=q(g),j=document.createElementNS(l.namespaceURI,"line");j.setAttribute("x1",String(W)),j.setAttribute("y1",String(k)),j.setAttribute("x2",String(W)),j.setAttribute("y2",String(A-ct)),j.setAttribute("stroke","#111111"),j.setAttribute("stroke-opacity","0.20"),j.setAttribute("stroke-dasharray","2,4"),l.appendChild(j);let ut=document.createElementNS(l.namespaceURI,"text");ut.setAttribute("x",String(W)),ut.setAttribute("y",String(k-4)),ut.setAttribute("text-anchor","middle"),ut.setAttribute("font-size","10"),ut.setAttribute("fill","#111111"),ut.textContent=Pt(new Date(g)),l.appendChild(ut)}let pt=new Date;pt.setHours(0,0,0,0);let at=pt.getTime();if(at>=U&&at<=J){let g=q(at),W=document.createElementNS(l.namespaceURI,"line");W.setAttribute("x1",String(g)),W.setAttribute("y1",String(k)),W.setAttribute("x2",String(g)),W.setAttribute("y2",String(A-ct)),W.setAttribute("stroke","#4caf50"),W.setAttribute("stroke-width","2"),W.setAttribute("stroke-dasharray","4,2"),l.appendChild(W);let j=document.createElementNS(l.namespaceURI,"text");j.setAttribute("x",String(g+4)),j.setAttribute("y",String(k+12)),j.setAttribute("font-size","10"),j.setAttribute("fill","#4caf50"),j.textContent="hoje",l.appendChild(j)}let lt=H.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});lt.setAttr("title",M==="wide"?"Compactar nomes":"Expandir nomes"),lt.style.left=`${_}px`,lt.style.top="4px",lt.addEventListener("click",g=>{g.preventDefault();let j=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=j,fe(s,r,t,n)});let gt=["status","priority"],bt=Array.isArray(e.tooltipFields)?e.tooltipFields.map(g=>String(g)):null,It=bt&&bt.length?bt:gt,kt=0,Xt=null;for(let g of P){let W=g.start,j=g.end,ut=(j.getTime()-W.getTime())/6e4,zt=g.props,Vt=g.notePath,_t=g.noteTitle,ne=(Ne=(Ee=g.row.notes)==null?void 0:Ee.length)!=null?Ne:0,Bt=g.due,At=g.estMinutes,Gt=[];Gt.push(`${Pt(W)} \u2192 ${Pt(j)}`),typeof At=="number"&&!Number.isNaN(At)?Gt.push(`est: ${Math.round(At)} min`):ut>0&&Gt.push(`dura\xE7\xE3o: ${Math.round(ut)} min`),Bt instanceof Date&&Gt.push(`due: ${Pt(Bt)}`);for(let mt of It){let it=b(zt,mt);it!=null&&String(it).trim()!==""&&Gt.push(`${mt}: ${String(it)}`)}let jt=Gt.join("<br>"),Wt=mt=>{var it;mt.preventDefault(),u&&Vt?new we(Vt,r,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():Dt(s,R,_t,At!=null?At:ut,(it=g.row.notes)!=null?it:[],i)},Ct=mt=>{_t&&jt&&wt(s,D,_t,jt,ne,mt)},xt=()=>vt(D);if(g.groupKey!==Xt&&(Xt=g.groupKey,Xt!==h)){let mt=k+8+kt*y+y/2,it=a(Xt);K(it,4,mt,_-12,11,"600"),kt+=1}let Rt=k+8+kt*y,Ht=y-10,re=q(W.getTime()),Ut=q(j.getTime()),oe=Math.max(4,Ut-re),yt=g.fullName,ht=document.createElementNS(l.namespaceURI,"rect");ht.setAttribute("x",String(re)),ht.setAttribute("y",String(Rt)),ht.setAttribute("width",String(oe)),ht.setAttribute("height",String(Ht)),ht.setAttribute("rx","3"),ht.setAttribute("ry","3"),ht.setAttribute("fill",ft((Te=g.row.series)!=null?Te:yt,kt)),ht.setAttribute("stroke","rgba(0,0,0,0.25)"),ht.setAttribute("stroke-width","0.5"),ht.style.cursor=u&&Vt?"pointer":"default",ht.addEventListener("mouseenter",Ct),ht.addEventListener("mouseleave",xt),ht.addEventListener("click",Wt),l.appendChild(ht);let Ce=Rt+Ht/2;if(oe>=6){let mt=ft((ke=g.row.series)!=null?ke:yt,kt),it=document.createElementNS(l.namespaceURI,"circle");it.setAttribute("cx",String(re)),it.setAttribute("cy",String(Ce)),it.setAttribute("r","3.5"),it.setAttribute("fill","#ffffff"),it.setAttribute("stroke",mt),it.setAttribute("stroke-width","1.5"),l.appendChild(it);let Ot=document.createElementNS(l.namespaceURI,"circle");Ot.setAttribute("cx",String(Ut)),Ot.setAttribute("cy",String(Ce)),Ot.setAttribute("r","3.5"),Ot.setAttribute("fill","#ffffff"),Ot.setAttribute("stroke",mt),Ot.setAttribute("stroke-width","1.5"),l.appendChild(Ot)}let Re=Rt+Ht/2+2,ie=4;if(M==="wide")K(yt,ie,Re,_-ie-4,11,null,Ct,xt,Wt);else{let mt=yt,it=Math.max(40,_-ie-8),Me=Math.max(8,Math.floor(it/6));mt.length>Me&&(mt=mt.slice(0,Me-1)+"\u2026");let Mt=document.createElementNS(l.namespaceURI,"text");Mt.setAttribute("x",String(ie)),Mt.setAttribute("y",String(Re)),Mt.setAttribute("text-anchor","start"),Mt.setAttribute("font-size","11"),Mt.setAttribute("fill","#111111"),Mt.textContent=mt,Mt.style.cursor="pointer",Mt.addEventListener("mouseenter",Ct),Mt.addEventListener("mouseleave",xt),Mt.addEventListener("click",Wt),l.appendChild(Mt)}if(Bt instanceof Date){let mt=q(Bt.getTime()),it=document.createElementNS(l.namespaceURI,"line");it.setAttribute("x1",String(mt)),it.setAttribute("y1",String(Rt)),it.setAttribute("x2",String(mt)),it.setAttribute("y2",String(Rt+Ht)),it.setAttribute("stroke","#ff6b6b"),it.setAttribute("stroke-width","2"),it.setAttribute("stroke-dasharray","4,2"),l.appendChild(it)}kt+=1}if(u){let g=s.createDiv({cls:"prop-charts-empty"});g.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function ve(s,r,t){var et,st,m,H;let n=(et=r.options)!=null?et:{},e=n.background,o=(st=n.drilldown)!=null?st:!0,i=(m=t.rows)!=null?m:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:u,svg:a,tooltip:c,details:f}=Tt(s,e),N=s.getBoundingClientRect().width||600,x=Math.max(N,480);u.style.width=x+"px";let b=40,h=16,S=18,P=28,y=300;a.setAttribute("height",String(y));let B=x-b-h,I=y-S-P,T=new Map;for(let l of i){let D=String(l.x),R=(H=T.get(D))!=null?H:{label:l.x,rows:[]};R.rows.push(l),T.set(D,R)}let O=Array.from(T.keys()).sort((l,D)=>l<D?-1:l>D?1:0).map(l=>T.get(l)),v=O.length,E=l=>String(l!=null?l:""),p=new Set;i.forEach(l=>{l.series!=null&&p.add(E(l.series))});let w=Array.from(p),d=w.length>1,M=d?"grouped":"single",V=0;i.forEach(l=>{l.y>V&&(V=l.y)}),(!isFinite(V)||V<=0)&&(V=1);let G=l=>S+I-l/(V||1)*I,Y=G(0),$=4;for(let l=0;l<=$;l++){let D=V*l/$,R=G(D),K=document.createElementNS(a.namespaceURI,"line");K.setAttribute("x1",String(b)),K.setAttribute("y1",String(R)),K.setAttribute("x2",String(x-h)),K.setAttribute("y2",String(R)),K.setAttribute("stroke","#cccccc"),K.setAttribute("stroke-opacity","0.25"),a.appendChild(K);let C=document.createElementNS(a.namespaceURI,"text");C.setAttribute("x",String(b-4)),C.setAttribute("y",String(R+3)),C.setAttribute("text-anchor","end"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=String(Math.round(D)),a.appendChild(C)}let _=v>0?B/v:B;if(O.forEach((l,D)=>{let R=b+_*(D+.5),K=String(l.label),C=document.createElementNS(a.namespaceURI,"text");C.setAttribute("x",String(R)),C.setAttribute("y",String(y-P+12)),C.setAttribute("text-anchor","middle"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=K,a.appendChild(C)}),d){let l=s.createDiv({cls:"chart-notes-legend"});w.forEach((D,R)=>{let K=l.createDiv({cls:"chart-notes-legend-item"}),C=K.createDiv();C.style.width="10px",C.style.height="10px",C.style.borderRadius="999px",C.style.backgroundColor=ft(D,R),K.createSpan({text:D})})}O.forEach((l,D)=>{let R=b+_*(D+.5),K=l.rows;if(M==="single"){let F=K[0],k=F.y,Q=_*.6,U=R-Q/2,J=G(k),q=Math.max(2,Y-J),Z=ft("bar",D),L=document.createElementNS(a.namespaceURI,"rect");L.setAttribute("x",String(U)),L.setAttribute("y",String(J)),L.setAttribute("width",String(Q)),L.setAttribute("height",String(q)),L.setAttribute("fill",Z),L.setAttribute("stroke","rgba(0,0,0,0.25)"),L.setAttribute("stroke-width","0.5"),L.style.cursor="pointer";let z=String(l.label),nt=`valor: ${Math.round(k*100)/100}`;L.addEventListener("mouseenter",tt=>{var ot,dt;return wt(s,c,z,nt,(dt=(ot=F.notes)==null?void 0:ot.length)!=null?dt:0,tt)}),L.addEventListener("mouseleave",()=>vt(c)),L.addEventListener("click",tt=>{var ot;tt.preventDefault(),Dt(s,f,z,k,(ot=F.notes)!=null?ot:[],o)}),a.appendChild(L);return}let C=w.length,ct=_/Math.max(C+1,2),rt=C*ct,A=R-rt/2;w.forEach((F,k)=>{let Q=K.find(ot=>ot.series!=null&&E(ot.series)===F);if(!Q)return;let U=Q.y,J=A+k*ct,q=G(U),Z=Math.max(2,Y-q),L=ft(F,k),z=document.createElementNS(a.namespaceURI,"rect");z.setAttribute("x",String(J)),z.setAttribute("y",String(q)),z.setAttribute("width",String(ct)),z.setAttribute("height",String(Z)),z.setAttribute("fill",L),z.setAttribute("stroke","rgba(0,0,0,0.25)"),z.setAttribute("stroke-width","0.5"),z.style.cursor="pointer";let nt=`${F} @ ${String(l.label)}`,tt=`valor: ${Math.round(U*100)/100}`;z.addEventListener("mouseenter",ot=>{var dt,Et;return wt(s,c,nt,tt,(Et=(dt=Q.notes)==null?void 0:dt.length)!=null?Et:0,ot)}),z.addEventListener("mouseleave",()=>vt(c)),z.addEventListener("click",ot=>{var dt;ot.preventDefault(),Dt(s,f,nt,U,(dt=Q.notes)!=null?dt:[],o)}),a.appendChild(z)})})}function He(s,r,t){var $,_,et,st;let n=($=r.options)!=null?$:{},e=n.background,o=(_=n.drilldown)!=null?_:!0,i=(et=t.rows)!=null?et:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let u=new Map;for(let m of i){let H=String(m.x),l=(st=u.get(H))!=null?st:{label:m.x,rows:[]};l.rows.push(m),u.set(H,l)}let c=Array.from(u.keys()).sort((m,H)=>m<H?-1:m>H?1:0).map(m=>u.get(m)),f=c.length,N=m=>String(m!=null?m:""),x=new Set(i.map(m=>N(m.series))),b=Array.from(x);if(b.length===1&&b[0]===""){ve(s,r,t);return}let{inner:h,svg:S,tooltip:P,details:y}=Tt(s,e),B=s.getBoundingClientRect().width||600,I=Math.max(B,480);h.style.width=I+"px",S.setAttribute("width",String(I));let T=40,X=16,O=18,v=28,E=300;S.setAttribute("height",String(E));let p=I-T-X,w=E-O-v,d=0;c.forEach(m=>{let H=m.rows.reduce((l,D)=>l+(D.y||0),0);H>d&&(d=H)}),(!isFinite(d)||d<=0)&&(d=1);let M=m=>O+w-m/(d||1)*w,V=4;for(let m=0;m<=V;m++){let H=d*m/V,l=M(H),D=document.createElementNS(S.namespaceURI,"line");D.setAttribute("x1",String(T)),D.setAttribute("y1",String(l)),D.setAttribute("x2",String(I-X)),D.setAttribute("y2",String(l)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),S.appendChild(D);let R=document.createElementNS(S.namespaceURI,"text");R.setAttribute("x",String(T-4)),R.setAttribute("y",String(l+3)),R.setAttribute("text-anchor","end"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=String(Math.round(H)),S.appendChild(R)}let G=f>0?p/f:p;c.forEach((m,H)=>{let l=T+G*(H+.5),D=String(m.label),R=document.createElementNS(S.namespaceURI,"text");R.setAttribute("x",String(l)),R.setAttribute("y",String(E-v+12)),R.setAttribute("text-anchor","middle"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=D,S.appendChild(R)});let Y=h.createDiv({cls:"chart-notes-legend"});b.forEach((m,H)=>{if(m==="")return;let l=Y.createDiv({cls:"chart-notes-legend-item"}),D=l.createDiv();D.style.width="10px",D.style.height="10px",D.style.borderRadius="999px",D.style.backgroundColor=ft(m,H),l.createSpan({text:m})}),c.forEach((m,H)=>{let l=T+G*(H+.5),D=G*.6,R=l-D/2,K=0;b.forEach((C,ct)=>{if(C==="")return;let rt=m.rows.find(nt=>N(nt.series)===C);if(!rt)return;let A=rt.y||0,F=K,k=K+A;K=k;let Q=M(F),U=M(k),J=Math.max(2,Q-U),q=ft(C,ct),Z=document.createElementNS(S.namespaceURI,"rect");Z.setAttribute("x",String(R)),Z.setAttribute("y",String(U)),Z.setAttribute("width",String(D)),Z.setAttribute("height",String(J)),Z.setAttribute("fill",q),Z.setAttribute("stroke","rgba(0,0,0,0.25)"),Z.setAttribute("stroke-width","0.5"),Z.style.cursor="pointer";let L=`${C} @ ${String(m.label)}`,z=`valor: ${Math.round(A*100)/100}`;Z.addEventListener("mouseenter",nt=>{var tt,ot;return wt(s,P,L,z,(ot=(tt=rt.notes)==null?void 0:tt.length)!=null?ot:0,nt)}),Z.addEventListener("mouseleave",()=>vt(P)),Z.addEventListener("click",nt=>{var tt;nt.preventDefault(),Dt(s,y,L,A,(tt=rt.notes)!=null?tt:[],o)}),S.appendChild(Z)})})}function $t(s){if(!s)return null;if(s instanceof Date){let r=s.getTime();return Number.isNaN(r)?null:s}if(typeof s=="string"){let r=s.trim();if(!r||/^\d+$/.test(r))return null;let t=new Date(r);if(!Number.isNaN(t.getTime()))return t}return null}function De(s,r,t,n){var $,_,et,st;let e=($=r.options)!=null?$:{},o=e.background,i=(_=e.drilldown)!=null?_:!0,u=(et=t.rows)!=null?et:[];if(!u.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:c,tooltip:f,details:N}=Tt(s,o),x=s.getBoundingClientRect().width||600,b=Math.max(x,480);a.style.width=b+"px";let h=40,S=16,P=18,y=28,B=300;c.setAttribute("height",String(B));let I=b-h-S,T=B-P-y,X=u.map(m=>$t(m.x)).filter(m=>!!m),O=X.length>=2&&X.length>=u.length*.6,v=new Map;for(let m of u){let H=m.series!=null&&m.series!==""?String(m.series):"__default__",l=(st=v.get(H))!=null?st:[];l.push(m),v.set(H,l)}let E=Array.from(v.keys()),p,w;if(O){let H=X.map(L=>L.getTime()).sort((L,z)=>L-z),l=H[0],D=H[H.length-1];l===D&&(l-=864e5,D+=864e5);let R=D-l||864e5,K=l-R*.02,C=D+R*.02;p=L=>{let z=$t(L);if(!z)return h;let nt=z.getTime();return h+(nt-K)/(C-K||1)*I},w=L=>{let z=$t(L);return z?Pt(z):String(L)};let ct=P+T,rt=document.createElementNS(c.namespaceURI,"line");rt.setAttribute("x1",String(h)),rt.setAttribute("y1",String(ct)),rt.setAttribute("x2",String(b-S)),rt.setAttribute("y2",String(ct)),rt.setAttribute("stroke","#111111"),rt.setAttribute("stroke-width","1"),c.appendChild(rt);let A=(C-K)/864e5,k=Math.max(3,Math.min(10,Math.floor(I/90)||3)),Q=A/k,U=[1,2,3,5,7,10,14,21,30,60,90,180,365],J=U[U.length-1];for(let L of U)if(L>=Q){J=L;break}let Z=(L=>{let z=new Date(L);return z.setHours(0,0,0,0),z.getTime()})(K);for(let L=Z;L<=C+.5*864e5;L+=J*864e5){let z=h+(L-K)/(C-K)*I,nt=document.createElementNS(c.namespaceURI,"line");nt.setAttribute("x1",String(z)),nt.setAttribute("y1",String(P)),nt.setAttribute("x2",String(z)),nt.setAttribute("y2",String(ct)),nt.setAttribute("stroke","#111111"),nt.setAttribute("stroke-opacity","0.18"),nt.setAttribute("stroke-dasharray","2,4"),c.appendChild(nt);let tt=document.createElementNS(c.namespaceURI,"text");tt.setAttribute("x",String(z)),tt.setAttribute("y",String(ct+12)),tt.setAttribute("text-anchor","middle"),tt.setAttribute("font-size","10"),tt.setAttribute("fill","#111111"),tt.textContent=Pt(new Date(L)),c.appendChild(tt)}}else{let m=[],H=new Set;for(let D of u){let R=String(D.x);H.has(R)||(H.add(R),m.push(D.x))}let l=m.length||1;p=D=>{let R=String(D),K=m.findIndex(C=>String(C)===R);return K<0?h:l===1?h+I/2:h+K/(l-1)*I},w=D=>String(D)}let d=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let m of u)m.y<d&&(d=m.y),m.y>M&&(M=m.y);(!isFinite(d)||!isFinite(M))&&(d=0,M=1),d===M&&(d===0?M=1:d=0);let V=m=>P+T-(m-d)/(M-d||1)*T,G=4;for(let m=0;m<=G;m++){let H=d+(M-d)*m/G,l=V(H),D=document.createElementNS(c.namespaceURI,"line");D.setAttribute("x1",String(h)),D.setAttribute("y1",String(l)),D.setAttribute("x2",String(b-S)),D.setAttribute("y2",String(l)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),c.appendChild(D);let R=document.createElementNS(c.namespaceURI,"text");R.setAttribute("x",String(h-4)),R.setAttribute("y",String(l+3)),R.setAttribute("text-anchor","end"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=Math.abs(H)>=100?String(Math.round(H)):String(Math.round(H*10)/10),c.appendChild(R)}let Y=E.filter(m=>m!=="__default__");if(Y.length>1){let m=s.createDiv({cls:"chart-notes-legend"});Y.forEach((H,l)=>{let D=H,R=m.createDiv({cls:"chart-notes-legend-item"}),K=R.createDiv();K.style.width="10px",K.style.height="10px",K.style.borderRadius="999px",K.style.backgroundColor=ft(D,l),R.createSpan({text:D})})}E.forEach((m,H)=>{let l=v.get(m);if(!(l!=null&&l.length))return;let D=m==="__default__"?ft("line",H):ft(m,H),R=[...l];O&&R.sort((C,ct)=>{let rt=$t(C.x),A=$t(ct.x),F=rt?rt.getTime():0,k=A?A.getTime():0;return F-k});let K="";if(R.forEach((C,ct)=>{let rt=p(C.x),A=V(C.y);K+=(ct===0?"M ":" L ")+rt+" "+A}),n){let C=R[0],ct=R[R.length-1],rt=p(C.x),A=p(ct.x),F=V(d);K+=` L ${A} ${F} L ${rt} ${F} Z`;let k=document.createElementNS(c.namespaceURI,"path");k.setAttribute("d",K),k.setAttribute("fill",D),k.setAttribute("fill-opacity","0.18"),k.setAttribute("stroke",D),k.setAttribute("stroke-width","1.5"),c.appendChild(k)}else{let C=document.createElementNS(c.namespaceURI,"path");C.setAttribute("d",K),C.setAttribute("fill","none"),C.setAttribute("stroke",D),C.setAttribute("stroke-width","2"),c.appendChild(C)}R.forEach(C=>{let ct=p(C.x),rt=V(C.y),A=document.createElementNS(c.namespaceURI,"circle");A.setAttribute("cx",String(ct)),A.setAttribute("cy",String(rt)),A.setAttribute("r","3"),A.setAttribute("fill","#ffffff"),A.setAttribute("stroke",D),A.setAttribute("stroke-width","1.5"),A.style.cursor="pointer";let F=w(C.x),k=m==="__default__"?"":String(C.series),Q=k?`${k} @ ${F}`:F,U=`valor: ${Math.round(C.y*100)/100}`;A.addEventListener("mouseenter",J=>{var q,Z;return wt(s,f,Q,U,(Z=(q=C.notes)==null?void 0:q.length)!=null?Z:0,J)}),A.addEventListener("mouseleave",()=>vt(f)),A.addEventListener("click",J=>{var q;J.preventDefault(),Dt(s,N,Q,C.y,(q=C.notes)!=null?q:[],i)}),c.appendChild(A)})})}function Ue(s,r,t){var st,m,H,l,D,R,K,C,ct,rt;let n=(st=r.options)!=null?st:{},e=n.background,o=(m=n.drilldown)!=null?m:!0,i=(H=t.rows)!=null?H:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let u=new Map;for(let A of i){let F=A.series!=null&&A.series!==""?String(A.series):"__default__",k=(l=u.get(F))!=null?l:[];k.push(A),u.set(F,k)}let a=Array.from(u.keys()).filter(A=>A!=="__default__");if(a.length===0){De(s,r,t,!0);return}let{inner:c,svg:f,tooltip:N,details:x}=Tt(s,e),b=s.getBoundingClientRect().width||600,h=Math.max(b,480);c.style.width=h+"px";let S=40,P=16,y=18,B=28,I=300;f.setAttribute("height",String(I));let T=h-S-P,X=I-y-B,O=i.map(A=>$t(A.x)).filter(A=>!!A),v=O.length>=2&&O.length>=i.length*.6,E,p,w=[],d=new Set;for(let A of i){let F=String(A.x);d.has(F)||(d.add(F),w.push(A.x))}if(v){let F=O.map(at=>at.getTime()).sort((at,lt)=>at-lt),k=F[0],Q=F[F.length-1];k===Q&&(k-=864e5,Q+=864e5);let U=Q-k||864e5,J=k-U*.02,q=Q+U*.02;E=at=>{let lt=$t(at);if(!lt)return S;let gt=lt.getTime();return S+(gt-J)/(q-J||1)*T},p=at=>{let lt=$t(at);return lt?Pt(lt):String(at)},w.sort((at,lt)=>{let gt=$t(at),bt=$t(lt),It=gt?gt.getTime():0,kt=bt?bt.getTime():0;return It-kt});let Z=y+X,L=document.createElementNS(f.namespaceURI,"line");L.setAttribute("x1",String(S)),L.setAttribute("y1",String(Z)),L.setAttribute("x2",String(h-P)),L.setAttribute("y2",String(Z)),L.setAttribute("stroke","#111111"),L.setAttribute("stroke-width","1"),f.appendChild(L);let z=(q-J)/864e5,tt=Math.max(3,Math.min(10,Math.floor(T/90)||3)),ot=z/tt,dt=[1,2,3,5,7,10,14,21,30,60,90,180,365],Et=dt[dt.length-1];for(let at of dt)if(at>=ot){Et=at;break}let pt=(at=>{let lt=new Date(at);return lt.setHours(0,0,0,0),lt.getTime()})(J);for(let at=pt;at<=q+.5*864e5;at+=Et*864e5){let lt=S+(at-J)/(q-J)*T,gt=document.createElementNS(f.namespaceURI,"line");gt.setAttribute("x1",String(lt)),gt.setAttribute("y1",String(y)),gt.setAttribute("x2",String(lt)),gt.setAttribute("y2",String(Z)),gt.setAttribute("stroke","#111111"),gt.setAttribute("stroke-opacity","0.18"),gt.setAttribute("stroke-dasharray","2,4"),f.appendChild(gt);let bt=document.createElementNS(f.namespaceURI,"text");bt.setAttribute("x",String(lt)),bt.setAttribute("y",String(Z+12)),bt.setAttribute("text-anchor","middle"),bt.setAttribute("font-size","10"),bt.setAttribute("fill","#111111"),bt.textContent=Pt(new Date(at)),f.appendChild(bt)}}else{let A=w.length||1;E=F=>{let k=String(F),Q=w.findIndex(U=>String(U)===k);return Q<0?S:A===1?S+T/2:S+Q/(A-1)*T},p=F=>String(F)}let M=new Map;for(let A of w)M.set(String(A),new Map);let V=new Map;for(let A of a){let F=(D=u.get(A))!=null?D:[],k=new Map;for(let Q of F){let U=String(Q.x);k.set(U,(R=Q.y)!=null?R:0)}V.set(A,k)}for(let A of a){let F=(K=V.get(A))!=null?K:new Map,k=0;for(let Q of w){let U=String(Q),J=F.get(U);J!==void 0&&(k=J);let q=M.get(U);q&&q.set(A,k)}}let G=[];for(let A of w){let F=String(A),k=new Map,Q=new Map,U=M.get(F);for(let q of a){let Z=(C=U==null?void 0:U.get(q))!=null?C:0;k.set(q,Z)}let J=0;for(let q of a){let Z=(ct=k.get(q))!=null?ct:0;Q.set(q,J),J+=Z}G.push({x:A,seriesValues:k,stackedValues:Q})}let Y=0;for(let A of G){let F=0;for(let k of a)F+=(rt=A.seriesValues.get(k))!=null?rt:0;F>Y&&(Y=F)}(!isFinite(Y)||Y<=0)&&(Y=1);let $=A=>y+X-A/(Y||1)*X,_=$(0),et=4;for(let A=0;A<=et;A++){let F=Y*A/et,k=$(F),Q=document.createElementNS(f.namespaceURI,"line");Q.setAttribute("x1",String(S)),Q.setAttribute("y1",String(k)),Q.setAttribute("x2",String(h-P)),Q.setAttribute("y2",String(k)),Q.setAttribute("stroke","#cccccc"),Q.setAttribute("stroke-opacity","0.25"),f.appendChild(Q);let U=document.createElementNS(f.namespaceURI,"text");U.setAttribute("x",String(S-4)),U.setAttribute("y",String(k+3)),U.setAttribute("text-anchor","end"),U.setAttribute("font-size","10"),U.setAttribute("fill","#111111"),U.textContent=Math.abs(F)>=100?String(Math.round(F)):String(Math.round(F*10)/10),f.appendChild(U)}if(a.length>0){let A=s.createDiv({cls:"chart-notes-legend"});a.forEach((F,k)=>{let Q=A.createDiv({cls:"chart-notes-legend-item"}),U=Q.createDiv();U.style.width="10px",U.style.height="10px",U.style.borderRadius="999px",U.style.backgroundColor=ft(F,k),Q.createSpan({text:F})})}a.forEach((A,F)=>{let k=ft(A,F),Q="";G.forEach((L,z)=>{var Nt,pt;let nt=E(L.x),tt=(Nt=L.stackedValues.get(A))!=null?Nt:0,ot=(pt=L.seriesValues.get(A))!=null?pt:0,dt=tt+ot,Et=$(dt);z===0?Q+=`M ${nt} ${Et}`:Q+=` L ${nt} ${Et}`});let U=G.slice().reverse().map(L=>{var ot;let z=E(L.x),nt=(ot=L.stackedValues.get(A))!=null?ot:0,tt=$(nt);return`${z} ${tt}`}).join(" L "),J=`${Q} L ${U} Z`,q=document.createElementNS(f.namespaceURI,"path");q.setAttribute("d",J),q.setAttribute("fill",k),q.setAttribute("fill-opacity","0.18"),q.setAttribute("stroke",k),q.setAttribute("stroke-width","1.5"),f.appendChild(q);let Z=V.get(A);G.forEach(L=>{var kt,Xt,te;let z=String(L.x);if(!(Z==null?void 0:Z.has(z)))return;let tt=E(L.x),ot=(kt=L.stackedValues.get(A))!=null?kt:0,dt=(Xt=L.seriesValues.get(A))!=null?Xt:0,Et=ot+dt,Nt=$(Et),pt=document.createElementNS(f.namespaceURI,"circle");pt.setAttribute("cx",String(tt)),pt.setAttribute("cy",String(Nt)),pt.setAttribute("r","3"),pt.setAttribute("fill","#ffffff"),pt.setAttribute("stroke",k),pt.setAttribute("stroke-width","1.5"),pt.style.cursor="pointer";let at=p(L.x),lt=`${A} @ ${at}`,gt=`valor: ${Math.round(dt*100)/100}`,It=((te=u.get(A))!=null?te:[]).find(Yt=>String(Yt.x)===String(L.x));pt.addEventListener("mouseenter",Yt=>{var Kt,ee;return wt(s,N,lt,gt,(ee=(Kt=It==null?void 0:It.notes)==null?void 0:Kt.length)!=null?ee:0,Yt)}),pt.addEventListener("mouseleave",()=>vt(N)),pt.addEventListener("click",Yt=>{var Kt;Yt.preventDefault(),Dt(s,x,lt,dt,(Kt=It==null?void 0:It.notes)!=null?Kt:[],o)}),f.appendChild(pt)})})}function Qe(s,r,t){var I;let{background:n,drilldown:e=!0}=(I=r.options)!=null?I:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=Ge(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:u,svg:a,tooltip:c,details:f}=Tt(s,n),N=Math.max(i,420);u.style.width=N+"px",o&&(a.style.color=o);let x=300,b=N/2,h=(x-28+28)/2,S=Math.min(N/2-20,x/2-20),y=t.rows.map(T=>Math.max(0,T.y)).reduce((T,X)=>T+X,0)||1,B=-Math.PI/2;t.rows.forEach((T,X)=>{var $;let O=T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x),v=T.y,E=v/y*Math.PI*2,p=b+S*Math.cos(B),w=h+S*Math.sin(B),d=b+S*Math.cos(B+E),M=h+S*Math.sin(B+E),V=E>Math.PI?1:0,G=document.createElementNS(a.namespaceURI,"path"),Y=[`M ${b} ${h}`,`L ${p} ${w}`,`A ${S} ${S} 0 ${V} 1 ${d} ${M}`,"Z"].join(" ");G.setAttribute("d",Y),G.setAttribute("fill",ft(($=T.series)!=null?$:O,X)),G.style.cursor="pointer",G.addEventListener("mouseenter",_=>{var et,st;return wt(s,c,O,v,(st=(et=T.notes)==null?void 0:et.length)!=null?st:0,_)}),G.addEventListener("mouseleave",()=>vt(c)),G.addEventListener("click",()=>{var _;return Dt(s,f,O,v,(_=T.notes)!=null?_:[],e)}),a.appendChild(G),B+=E})}function Ye(s,r,t){var w;let{background:n,drilldown:e=!0}=(w=r.options)!=null?w:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:u,svg:a,tooltip:c,details:f}=Tt(s,n),N=Math.max(i,700);u.style.width=N+"px",o&&(a.style.color=o);let x=300,b=N-48-10,h=x-28-28,S=t.rows.map(d=>{let M=d.x;if(M instanceof Date)return M.getTime();if(typeof M=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(M)){let G=new Date(M);if(!isNaN(G.getTime()))return G.getTime()}let V=Number(M);return isNaN(V)?null:V}return typeof M=="number"?M:null}),P=t.rows.map(d=>d.y),y=S.filter(d=>d!==null);if(y.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let B=Math.min(...y),I=Math.max(...y),T=Math.min(...P),X=Math.max(...P),O=d=>48+(d-B)/(I-B||1)*b,v=d=>x-28-(d-T)/(X-T||1)*h,E=document.createElementNS(a.namespaceURI,"line");E.setAttribute("x1",String(48)),E.setAttribute("y1",String(28)),E.setAttribute("x2",String(48)),E.setAttribute("y2",String(x-28)),E.setAttribute("stroke","currentColor"),a.appendChild(E);let p=document.createElementNS(a.namespaceURI,"line");p.setAttribute("x1",String(48)),p.setAttribute("y1",String(x-28)),p.setAttribute("x2",String(N-10)),p.setAttribute("y2",String(x-28)),p.setAttribute("stroke","currentColor"),a.appendChild(p),t.rows.forEach((d,M)=>{let V=S[M];if(V==null)return;let G=O(V),Y=v(P[M]),$=document.createElementNS(a.namespaceURI,"circle");$.setAttribute("cx",String(G)),$.setAttribute("cy",String(Y)),$.setAttribute("r","4"),$.setAttribute("fill",ft(d.series,M)),$.style.cursor="pointer";let _=d.x instanceof Date?d.x.toISOString().slice(0,10):typeof d.x=="string"?d.x:String(d.x);$.addEventListener("mouseenter",et=>{var st,m;return wt(s,c,_,d.y,(m=(st=d.notes)==null?void 0:st.length)!=null?m:0,et)}),$.addEventListener("mouseleave",()=>vt(c)),$.addEventListener("click",et=>{var st;et.preventDefault(),Dt(s,f,_,d.y,(st=d.notes)!=null?st:[],e)}),a.appendChild($)})}var ge=class{render(r,t,n,e){var a;let{title:o}=(a=t.options)!=null?a:{};r.empty(),r.addClass("prop-charts-container");let u=r.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(o&&(u.textContent=o),t.type){case"bar":ve(r,t,n);break;case"stacked-bar":He(r,t,n);break;case"line":De(r,t,n,!1);break;case"stacked-area":Ue(r,t,n);break;case"pie":Qe(r,t,n);break;case"scatter":Ye(r,t,n);break;case"gantt":fe(r,t,n,e);break;default:r.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}}};var ye=class extends Jt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("Chart Notes: loading plugin (Bases-only)"),this.indexer=new ue(this.app),await this.indexer.buildIndex(),this.query=new me(()=>this.indexer.getAll(),[]),this.renderer=new ge,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Jt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Jt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Jt.TFile&&this.indexer.removeFile(t)})),this.registerBasesView(xe,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new ce(t,n,this.renderer),options:()=>{let t=[];return t.push({type:"dropdown",key:"chartType",displayName:"Chart type",description:"Type of chart to render",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line","stacked-area":"Stacked area",pie:"Pie",scatter:"Scatter",gantt:"Gantt"}}),t.push({type:"property",key:"xProperty",displayName:"X axis / category (bars & slices)",description:"Property used for the X axis or categories (for pie, this is the slice).",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")==="gantt"}}),t.push({type:"property",key:"ganttLabelProperty",displayName:"Task label (Gantt)",description:`Label for each task bar.
If empty, uses the note title.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"yProperty",displayName:"Y value (empty = count)",description:`Numeric property summed on the Y axis.
Leave empty to just count notes.`,shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="pie"||e==="gantt"}}),t.push({type:"property",key:"seriesProperty",displayName:"Series / color (optional)",description:"Property that defines series / color for bars, lines and stacked area.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")==="pie"}}),t.push({type:"dropdown",key:"aggregateMode",displayName:"Value aggregation (Y)",description:`How to aggregate Y when multiple notes share the same X/series.
For line/stacked-area, 'Cumulative sum' turns the series into a running total.`,default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="scatter"||e==="gantt"}}),t.push({type:"dropdown",key:"xBucket",displayName:"X bucket (dates)",description:"How to bucket dates on the X axis for line / stacked area charts (day, week, month...).",default:"auto",options:{auto:"Auto",none:"None",day:"Day",week:"Week",month:"Month",quarter:"Quarter",year:"Year"},shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return!(e==="line"||e==="stacked-area")}}),t.push({type:"property",key:"startProperty",displayName:"Start (Gantt)",description:"Start date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"endProperty",displayName:"End (Gantt)",description:"End date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"dueProperty",displayName:"Due (deadline, optional)",description:"Due date / deadline for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"durationProperty",displayName:"Duration in minutes (optional)",description:`Duration of the task in minutes.
Used together with start/end/due.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0}),t.push({type:"text",key:"title",displayName:"Title (optional)",description:`Custom chart title.
Falls back to the view name.`}),t}})}onunload(){console.log("Chart Notes: unloading plugin")}};
