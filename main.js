/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ce=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Be=Object.prototype.hasOwnProperty;var Ue=(s,e)=>{for(var t in e)ce(s,t,{get:e[t],enumerable:!0})},Ye=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ke(e))!Be.call(s,r)&&r!==t&&ce(s,r,{get:()=>e[r],enumerable:!(n=We(e,r))||n.enumerable});return s};var Xe=s=>Ye(ce({},"__esModule",{value:!0}),s);var dn={};Ue(dn,{default:()=>se});module.exports=Xe(dn);var Lt=require("obsidian");var qt=require("obsidian"),le="chartnotes-view",qe=["bar","stacked-bar","line","area","pie","scatter","gantt"];function je(s){let e=String(s!=null?s:"bar").trim().toLowerCase();return qe.includes(e)?e:"bar"}var Ze=["sum","count","cumulative-sum"];function Je(s){let e=String(s!=null?s:"sum").trim().toLowerCase();return Ze.includes(e)?e:"sum"}var Xt=class extends qt.BasesView{constructor(t,n,r){super(t);this.type=le;this.renderer=r,this.rootEl=n.createDiv("chartnotes-bases-view")}onDataUpdated(){var b,T,G;this.rootEl.empty();let t=this.data,n=(b=t==null?void 0:t.groupedData)!=null?b:[];if(!n.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let r=this.config,o=(T=r==null?void 0:r.get("chartType"))!=null?T:"bar",i=je(o),h=r==null?void 0:r.get("aggregateMode"),a=Je(h),c=this.getPropFromConfig("xProperty"),p=this.getPropFromConfig("yProperty"),f=this.getPropFromConfig("seriesProperty"),w=this.getPropFromConfig("startProperty"),x=this.getPropFromConfig("endProperty"),m=this.getPropFromConfig("dueProperty"),u=this.getPropFromConfig("durationProperty"),C=this.getPropFromConfig("groupProperty"),k=i==="gantt",N=i==="scatter";if(!k&&!c.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / label' property in view options."});return}if(N&&(!c.id||!p.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(k&&(!w.id||!x.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt charts need Start and End properties configured."});return}let F;if(k?F=this.buildRowsForGantt(n,c,f,w,x,m,u,C):N?F=this.buildRowsForScatter(n,c,p,f):F=this.buildRowsForAggregatedCharts(n,c,p,f,a),!F.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let P={rows:F},I=this.buildEncoding({x:c,y:p,series:f,start:w,end:x,due:m,duration:u,group:C,aggMode:a}),R=((G=r==null?void 0:r.get("title"))!=null?G:"").trim()||(r==null?void 0:r.name)||"Chart Notes (Bases)",v=r==null?void 0:r.get("drilldown"),S={type:i,source:{type:"properties",query:""},encoding:I,options:{title:R,drilldown:typeof v=="boolean"?v:!0}},A={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,S,P,A)}getPropFromConfig(t){var i,h;let n=this.config,r=(i=n==null?void 0:n.get)==null?void 0:i.call(n,t),o=r&&r.trim().length?r.trim():null;if(!o)return{id:null,name:null};try{let a=(0,qt.parsePropertyId)(o);return{id:o,name:(h=a.name)!=null?h:o}}catch(a){return{id:o,name:o}}}readValue(t,n){if(!n.id)return null;let r;try{r=t.getValue(n.id)}catch(o){return null}if(!r)return null;try{if(typeof r.isEmpty=="function"&&r.isEmpty())return null}catch(o){}try{let o=r.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let n=t.trim();if(!n)return null;let r=new Date(n);return Number.isNaN(r.getTime())?null:r}compareX(t,n){let r=this.parseDate(t!=null?String(t):null),o=this.parseDate(n!=null?String(n):null);if(r&&o)return r.getTime()-o.getTime();let i=Number(t),h=Number(n);return!Number.isNaN(i)&&!Number.isNaN(h)?i-h:String(t!=null?t:"").localeCompare(String(n!=null?n:""))}buildRowsForAggregatedCharts(t,n,r,o,i){var p,f;let h=new Map,a=i==="count"||!r.id&&i!=="sum";for(let w of t)for(let x of w.entries){let m=x.file,u=(f=this.readValue(x,n))!=null?f:m!=null&&m.name?String(m.name):String((p=m==null?void 0:m.path)!=null?p:""),C=1,k=null;if(!a&&r.id){if(k=this.readValue(x,r),k==null)continue;let H=Number(k);if(Number.isNaN(H))continue;C=H}else C=1;let N=this.readValue(x,o),F=N!=null?String(N):void 0,P=`${u}@@${F!=null?F:""}`,I=h.get(P);I||(I={x:u,y:0,series:F,notes:[],props:{}},h.set(P,I)),I.y+=C,m!=null&&m.path&&I.notes.push(m.path),I.props&&n.name&&(I.props[n.name]=u),!a&&I.props&&r.name&&k!=null&&(I.props[r.name]=I.y),I.props&&o.name&&N!=null&&(I.props[o.name]=N)}let c=Array.from(h.values());return i==="cumulative-sum"?this.toCumulative(c):c}toCumulative(t){var o,i;let n=new Map;for(let h of t){let a=(o=h.series)!=null?o:"__no_series__",c=n.get(a);c||(c=[],n.set(a,c)),c.push(h)}let r=[];for(let[,h]of n){let a=[...h].sort((p,f)=>this.compareX(p.x,f.x)),c=0;for(let p of a){let f=Number((i=p.y)!=null?i:0);Number.isNaN(f)||(c+=f,p.y=c,r.push(p))}}return r}buildRowsForScatter(t,n,r,o){let i=[];for(let h of t)for(let a of h.entries){let c=a.file,p=this.readValue(a,n),f=this.readValue(a,r);if(p==null||f==null)continue;let w=Number(p),x=Number(f);if(Number.isNaN(w)||Number.isNaN(x))continue;let m=this.readValue(a,o),u=m!=null?String(m):void 0;i.push({x:w,y:x,series:u,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,n,r,o,i,h,a,c){var f,w;let p=[];for(let x of t)for(let m of x.entries){let u=m.file,C=this.readValue(m,o),k=this.readValue(m,i);if(!C||!k)continue;let N=this.parseDate(C),F=this.parseDate(k);if(!N||!F)continue;let P=(w=this.readValue(m,n))!=null?w:u!=null&&u.name?String(u.name).replace(/\.md$/i,""):String((f=u==null?void 0:u.path)!=null?f:""),I=this.readValue(m,h),H=this.parseDate(I!=null?I:null),R=this.readValue(m,a),v=R!=null?Number(R):void 0,d=typeof v=="number"&&!Number.isNaN(v),S=this.readValue(m,r),A=S!=null?String(S):void 0,b=this.readValue(m,c),T={};a.name&&d&&(T[a.name]=v),c.name&&b!=null&&(T[c.name]=b),p.push({x:P,y:0,series:A,start:N,end:F,due:H!=null?H:void 0,notes:u!=null&&u.path?[u.path]:[],props:T})}return p}buildEncoding(t){var r,o,i,h,a,c,p,f;let n=t.aggMode==="count"?"Count":(r=t.y.name)!=null?r:"y";return{x:(o=t.x.name)!=null?o:"x",y:n,series:(i=t.series.name)!=null?i:"series",start:(h=t.start.name)!=null?h:"start",end:(a=t.end.name)!=null?a:"end",due:(c=t.due.name)!=null?c:"due",duration:(p=t.duration.name)!=null?p:"duration",group:(f=t.group.name)!=null?f:"group"}}};var Ne=require("obsidian"),jt=class{constructor(e){this.index=new Map;this.app=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(e){if(e.extension!=="md")return;let t={};try{let r=(await this.app.vault.read(e)).match(/^---\n([\s\S]*?)\n---\n?/);if(r){let i=(0,Ne.parseYaml)(r[1])||{};if(i&&typeof i=="object")for(let[h,a]of Object.entries(i))h!=="position"&&(t[h]=a)}let o=this.app.metadataCache.getFileCache(e);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",e.path,n)}this.index.set(e.path,{path:e.path,props:t})}removeFile(e){this.index.delete(e.path)}};function ke(s,e){if(!e||e.length===0)return!0;for(let t of e){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function Pe(s,e){if(!e||e.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let r of e)if(t.includes(r)||t.includes("#"+r))return!0;return!1}let n=String(t);for(let r of e)if(n===r||n==="#"+r)return!0;return!1}function Jt(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function $t(s){if(s instanceof Date)return s;if(typeof s!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(s)){let[t,n,r]=s.split("-");return new Date(Number(t),Number(n)-1,Number(r),0,0,0,0)}let e=new Date(s);return isNaN(e.getTime())?null:e}function ut(s){let e=new Date(s);return e.setHours(0,0,0,0),e}function Zt(s,e){let t=new Date(s);return t.setDate(t.getDate()-e),t}function tn(s,e){return Zt(s,e*7)}function en(s,e){let t=new Date(s);return t.setMonth(t.getMonth()-e),t}function de(s,e){let t=new Date(s);return t.setDate(t.getDate()+e),t}function nn(s,e){return de(s,e*7)}function rn(s,e){let t=new Date(s);return t.setMonth(t.getMonth()+e),t}function Te(s){let e=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(e)||e.endsWith("date")||e.endsWith("at")||e.endsWith("on"))}function Me(s,e){let t=e?new Date(e):new Date,n=ut(t),r=s.trim().toLowerCase();if(r==="today")return n;if(r==="yesterday")return ut(Zt(n,1));if(/^-\d+$/.test(r)){let o=parseInt(r.slice(1),10);return ut(Zt(n,o))}if(/^-\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(Zt(n,o))}if(/^-\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(tn(n,o))}if(/^-\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(en(n,o))}if(/^\+\d+$/.test(r)){let o=parseInt(r.slice(1),10);return ut(de(n,o))}if(/^\+\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(de(n,o))}if(/^\+\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(nn(n,o))}if(/^\+\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return ut(rn(n,o))}return null}function Le(s){let e=s.trim(),t=e.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let p=t[1].trim(),f=t[2].trim(),w=t[3].trim(),x=Te(p),m=ue(f,x),u=ue(w,x),C=m.valueType==="date"||u.valueType==="date"?"date":m.valueType;return{field:p,op:"between",value:m.value,value2:u.value,valueType:C}}let n=/(==|!=|>=|<=|>|<)/,r=e.split(n);if(r.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+s);let o=r[0].trim(),i=r[1].trim(),h=r[2].trim(),a=Te(o),c=ue(h,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function ue(s,e){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),r=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(e){if(t==="0"||n==="today")return{value:ut(new Date),valueType:"date"};let i=Me(t);if(i)return{value:i,valueType:"date"}}else if(r){let i=Me(t);if(i)return{value:i,valueType:"date"}}if(Jt(t)){let i=$t(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Ie(s,e){let t=s[e.field];if(t==null)return!1;if(e.valueType==="date"){let o=t instanceof Date?ut(t):Jt(t)?ut($t(t)):null;if(!o)return!1;let i=e.value instanceof Date?e.value:null,h=e.value2 instanceof Date?e.value2:null;if(!i)return!1;let a=o.getTime(),c=ut(i).getTime();switch(e.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!h)return!1;let p=ut(h).getTime();return a>=c&&a<=p}}if(e.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(e.value);switch(e.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof e.value2!="number"?!1:o>=i&&o<=e.value2}}let n=String(t),r=String(e.value);switch(e.op){case"==":return n===r;case"!=":return n!==r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r;case"between":return!1}}function sn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(Jt(s)){let e=$t(s);if(e)return{key:e,isDate:!0}}return{key:s,isDate:!1}}function on(s,e){let t=s.x,n=e.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let r=String(t),o=String(n);return r<o?-1:r>o?1:0}function an(s,e){var o,i;let t=on(s,e);if(t!==0)return t;let n=(o=s.series)!=null?o:"",r=(i=e.series)!=null?i:"";return n<r?-1:n>r?1:0}function cn(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let e=s.trim().match(/^(\d+)/);if(e){let t=Number(e[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(s)}`)}function ln(s){var n,r;let e=new Map,t=[];for(let o of s){let i=(n=o.series)!=null?n:"__no_series__",a=((r=e.get(i))!=null?r:0)+o.y;e.set(i,a),t.push({...o,y:a})}return t}function un(s,e){var i,h;let t=cn(e);if(!t||t<=1)return[...s];let n=new Map,r=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:"__no_series__",p=n.get(c);p||(p=[],n.set(c,p));let f=(h=r.get(c))!=null?h:0;if(p.push(a.y),f+=a.y,p.length>t){let m=p.shift();f-=m}r.set(c,f);let w=p.length||1,x=f/w;o.push({...a,y:x})}return o}var te=class{constructor(e,t){this.getIndex=e,this.defaultPaths=t}run(e){var i,h,a;let t=this.getIndex(),n=(i=e.source)!=null&&i.paths&&e.source.paths.length?e.source.paths:this.defaultPaths,r=(h=e.source)!=null&&h.tags&&e.source.tags.length?e.source.tags:[],o=[];for(let c of t){let p=n&&n.length?ke(c.path,n):!0,f=r&&r.length?Pe(c.props,r):!0;if(!p||!f)continue;let w=!0;if((a=e.source)!=null&&a.where&&e.source.where.length>0)for(let x of e.source.where){let m;try{m=Le(x)}catch(u){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${x} (${u.message})`)}if(!Ie(c.props,m)){w=!1;break}}w&&o.push(c)}return e.type==="gantt"?this.runGantt(e,o):e.type==="table"?this.runTable(e,o):this.runStandard(e,o)}runTable(e,t){var r,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(r=e.encoding)==null?void 0:r.x,yField:(o=e.encoding)==null?void 0:o.y}}runGantt(e,t){var f,w,x;let n=(f=e.encoding)!=null?f:{},r=n.start,o=n.end,i=(w=n.label)!=null?w:n.x,h=n.series,a=n.duration,c=n.due,p=[];for(let m of t){let u=(x=m.props)!=null?x:{},C=R=>Array.isArray(R)?R[0]:R,k=null;if(o){let R=C(u[o]),v=$t(R);v&&(k=v)}if(!k)continue;let N=null;if(r){let R=C(u[r]),v=$t(R);v&&(N=v)}if(!N&&a){let R=C(u[a]),v=Number(R);Number.isNaN(v)||(N=new Date(k.getTime()-v*6e4))}N||(N=new Date(k.getTime()));let F;if(c){let R=C(u[c]),v=$t(R);v&&(F=v)}let P;if(i){let R=C(u[i]);(R==null||R==="")&&(R=m.path),P=R}else P=m.path;let I;if(h){let R=C(u[h]);R!=null&&(I=String(R))}let H={x:P,y:0,notes:[m.path],series:I,start:N,end:k,props:u};F&&(H.due=F),p.push(H)}return p.sort((m,u)=>{let C=m.start?m.start.getTime():0,k=u.start?u.start.getTime():0;return C-k}),{rows:p,xField:i,yField:o}}runStandard(e,t){var m,u,C,k,N,F,P,I,H,R;let n=(m=e.encoding)==null?void 0:m.x,r=(u=e.encoding)==null?void 0:u.y,o=(C=e.encoding)==null?void 0:C.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(k=e.aggregate)!=null?k:{},h=(N=i.y)!=null?N:null,a=!!i.cumulative,c=i.rolling;if(!r&&h!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let p=[];for(let v of t){let d=(F=v.props)!=null?F:{},S=Q=>Array.isArray(Q)?Q[0]:Q,A=S(d[n]);if(A==null)continue;let b=sn(A),T=b.key,G=b.isDate,nt;if(o){let Q=S(d[o]);Q!=null&&String(Q).trim()!==""&&(nt=String(Q))}let z;if(h==="count")z=1;else{let Q=S(d[r]);if(Q==null)continue;let j=Number(Q);if(Number.isNaN(j))continue;z=j}p.push({x:T,y:z,notes:[v.path],series:nt,props:d,_isDate:G,_origX:A})}if(p.length===0)return{rows:[],xField:n,yField:r};let f=[];if(h){let v=new Map;for(let d of p){let S=(P=d.series)!=null?P:"",A=d.x instanceof Date?d.x.toISOString().slice(0,10):String(d.x),b=S+"||"+A,T=(I=v.get(b))!=null?I:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:d.x,isDate:d._isDate,series:d.series,props:d.props};T.sum+=d.y,T.count+=1,d.y<T.min&&(T.min=d.y),d.y>T.max&&(T.max=d.y),T.notes.push(...d.notes),T.props=(H=d.props)!=null?H:T.props,v.set(b,T)}for(let[,d]of v){let S=d.sum;switch(h){case"sum":S=d.sum;break;case"avg":S=d.sum/d.count;break;case"min":S=d.min;break;case"max":S=d.max;break;case"count":S=d.count;break}f.push({x:d.xRep,y:S,notes:d.notes,series:d.series,props:d.props})}}else f=p.map(v=>({x:v.x,y:v.y,notes:v.notes,series:v.series,props:v.props}));if(f.length===0)return{rows:[],xField:n,yField:r};let w=((R=e.sort)==null?void 0:R.x)==="desc"?"desc":"asc";if(f.sort((v,d)=>{let S=an(v,d);return w==="asc"?S:-S}),(a||c)&&!(e.type==="line"||e.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(a&&c)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let x=f;return c?x=un(f,c):a&&(x=ln(f)),{rows:x,xField:n,yField:r}}};var Ct=require("obsidian");var Fe=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function it(s,e){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,r)=>n*33+r.charCodeAt(0)>>>0,0);return Fe[t%Fe.length]}function wt(s,e){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,e&&(n.style.background=e);let r="http://www.w3.org/2000/svg",o=document.createElementNS(r,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let h=s.createDiv({cls:"chart-notes-details"});return h.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:h}}function gt(s,e,t,n,r,o){let i=s.getBoundingClientRect(),h=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);e.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${h}</div>
    <div class="chart-notes-tooltip-notes">${r} nota${r===1?"":"s"}</div>
  `,e.style.display="block";let a=e.getBoundingClientRect(),c=o.clientX-i.left+6,p=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),p+a.height>i.height-4&&(p=i.height-a.height-4),p<4&&(p=4),e.style.left=c+"px",e.style.top=p+"px"}function ft(s){s.style.display="none"}function yt(s,e,t,n,r,o){if(!o)return;if(e.empty(),!r||r.length===0){e.style.display="none";return}e.style.display="block";let i=e.createEl("div",{cls:"chart-notes-details-header"}),h=i.createEl("div",{cls:"chart-notes-details-title"});h.textContent=`Notas em "${t}" (${r.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{e.style.display="none"});let c=e.createEl("ul",{cls:"chart-notes-details-list"});for(let p of r){let w=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:p});w.href="#",w.addEventListener("click",x=>{x.preventDefault(),app.workspace.openLinkText(p,"",!1)})}}function Gt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let e=s.getDate().toString().padStart(2,"0"),t=(s.getMonth()+1).toString().padStart(2,"0");return`${e}/${t}`}function _e(s){if(!s)return!1;let e=s.trim().toLowerCase();if(e==="#fff"||e==="#ffffff"||e==="white")return!0;if(!e.startsWith("#"))return!1;let t,n,r;if(e.length===4)t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),r=parseInt(e[3]+e[3],16);else if(e.length===7)t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*r)/255>.7}var pe=class extends Ct.Modal{constructor(t,n,r,o){var h;super(app);this.notePath=t,this.spec=n,this.refresh=r,this.reindexFile=o;let i=(h=n.encoding)!=null?h:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var R,v;let{contentEl:t}=this;t.empty();let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Ct.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let r=await this.app.vault.read(n),o={},i=r,h=/^---\n([\s\S]*?)\n---\n?/m.exec(r);if(h){try{o=(R=(0,Ct.parseYaml)(h[1]))!=null?R:{}}catch(d){o={}}i=r.slice(h[0].length)}(typeof o!="object"||o==null)&&(o={});let a=(v=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?v:this.notePath,c=t.createDiv({cls:"gantt-edit-header"}),p=c.createEl("a",{text:a,cls:"gantt-edit-title"});p.href="#",p.addEventListener("click",d=>{d.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let f=c.createDiv({cls:"gantt-edit-subtitle"});f.textContent=this.notePath;let w=t.createDiv({cls:"gantt-edit-form"}),x=d=>{let S=w.createDiv({cls:"gantt-edit-row"}),A=S.createDiv({cls:"gantt-edit-label"});A.textContent=d;let b=S.createDiv({cls:"gantt-edit-field"});return{row:S,field:b}},m=d=>{if(!d)return"";let A=String(d).match(/^(\d{4}-\d{2}-\d{2})/);return A?A[1]:""},u=d=>{if(d=d.trim(),!!d&&/^\d{4}-\d{2}-\d{2}$/.test(d))return d},C=null;if(this.startKey){let{field:d}=x(this.startKey+" (in\xEDcio)");C=d.createEl("input",{type:"date"}),C.value=m(o[this.startKey])}let k=null;if(this.endKey){let{field:d}=x(this.endKey+" (fim)");k=d.createEl("input",{type:"date"}),k.value=m(o[this.endKey])}let N=null;if(this.durationKey){let{field:d}=x(this.durationKey+" (minutos)");N=d.createEl("input",{type:"number"});let S=o[this.durationKey];N.value=S!=null?String(S):"",N.min="0",N.step="5"}let F=null;if(this.dueKey){let{field:d}=x(this.dueKey+" (due)");F=d.createEl("input",{type:"date"}),F.value=m(o[this.dueKey])}let P=t.createDiv({cls:"gantt-edit-buttons"}),I=P.createEl("button",{text:"Salvar",cls:"mod-cta"});P.createEl("button",{text:"Cancelar"}).addEventListener("click",d=>{d.preventDefault(),this.close()}),I.addEventListener("click",async d=>{if(d.preventDefault(),this.startKey&&C){let b=u(C.value);b?o[this.startKey]=b:delete o[this.startKey]}if(this.endKey&&k){let b=u(k.value);b?o[this.endKey]=b:delete o[this.endKey]}if(this.durationKey&&N){let b=N.value.trim();if(b==="")delete o[this.durationKey];else{let T=Number(b);Number.isNaN(T)||(o[this.durationKey]=T)}}if(this.dueKey&&F){let b=u(F.value);b?o[this.dueKey]=b:delete o[this.dueKey]}let A=`---
${(0,Ct.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,A),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(b){}if(this.refresh)try{this.refresh()}catch(b){}new Ct.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function ee(s,e,t,n){var ye,be,xe,ve,Se,we,Ae,Ee;let r=(ye=e.options)!=null?ye:{},o=r.background,i=(be=r.drilldown)!=null?be:!0,h=!0,a=l=>{if(l==null)return"";let M=String(l).trim();if(!M)return"";let $=M.match(/^\[\[(.+?)\]\]$/);$&&(M=$[1]);let U=M.lastIndexOf("/");return U>=0&&U<M.length-1&&(M=M.slice(U+1)),M};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(l=>l.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let c=t.rows.filter(l=>l.start&&l.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let p=e.encoding,f=p.group,w=p.duration,x=(l,M)=>{if(!l||!M)return;let $=l[M];return Array.isArray($)?$[0]:$},u=c.map(l=>{var xt,lt;let M=l.start,$=l.end,U=l.props,It=typeof l.x=="string"?l.x:l.x instanceof Date?Gt(M):String(l.x),At=a(It),bt,Ft=f?x(U,f):void 0;Ft!=null?bt=String(Ft):l.series!=null?bt=String(l.series):bt=At;let mt=(xt=l.notes)==null?void 0:xt[0],Et=mt?(lt=mt.replace(/\.md$/i,"").split("/").pop())!=null?lt:mt:At,Rt=l.due,_t,kt=x(U,w);if(kt!=null){let vt=Number(kt);Number.isNaN(vt)||(_t=vt)}return{row:l,start:M,end:$,props:U,fullName:At,groupKey:bt,notePath:mt,noteTitle:Et,due:Rt,estMinutes:_t}}).filter(l=>l.start instanceof Date&&!isNaN(l.start.getTime())&&l.end instanceof Date&&!isNaN(l.end.getTime()));if(u.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}u.sort((l,M)=>{if(l.groupKey<M.groupKey)return-1;if(l.groupKey>M.groupKey)return 1;let $=l.start.getTime(),U=M.start.getTime();return $!==U?$-U:l.fullName.localeCompare(M.fullName)});let C=26,k=0,N=null;for(let l of u)l.groupKey!==N&&(N=l.groupKey,k+=1),k+=1;let F=Math.min(...u.map(l=>l.start.getTime())),P=Math.max(...u.map(l=>l.end.getTime()));if(!isFinite(F)||!isFinite(P)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let I=24*60*60*1e3,H=l=>{let M=new Date(l);return M.setHours(0,0,0,0),M.getTime()},R=H(F),v=H(P),d=s.querySelector(".prop-charts-title-row");d||(d=s.createDiv({cls:"prop-charts-title-row"}));let S=s.dataset.ganttZoomMode||String((xe=r.zoomMode)!=null?xe:"100");s.dataset.ganttZoomMode=S;let A=s.dataset.ganttLabelMode||String((ve=r.labelMode)!=null?ve:"compact");s.dataset.ganttLabelMode=A;let b=d.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(l=>{let M=b.createEl("button",{cls:"gantt-zoom-btn",text:l.label});l.id===S&&M.addClass("is-active"),M.addEventListener("click",$=>{$.preventDefault(),s.dataset.ganttZoomMode=l.id,ee(s,e,t,n)})}),b.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",l=>{l.preventDefault();let M=s.querySelector(".chart-notes-zoom-button");M&&M.click()});let nt=Number(r.labelWidth),z=!Number.isNaN(nt)&&nt>120?nt:260,Q=A==="wide"?z+160:z,j=s.getBoundingClientRect().width||600,tt=Math.max(j,820),_;if(S==="fit")_=j;else{let l=Number(S)/100||1;_=tt*l}let{inner:g,svg:y,tooltip:E,details:D}=wt(s,o);g.style.width=_+"px";let L=(l,M,$,U,It,At,bt,Ft,mt)=>{if(!l)return;let Et=Math.max(40,U-8),_t=Math.max(8,Math.floor(Et/6)),kt=l.split(/\s+/),xt=[],lt="";for(let Nt of kt){if(!lt){lt=Nt;continue}(lt+" "+Nt).length<=_t?lt+=" "+Nt:(xt.push(lt),lt=Nt)}lt&&xt.push(lt);let vt=It+2,Ot=xt.length*vt,Wt=$-Ot/2+It;xt.forEach((Nt,Ut)=>{let ot=document.createElementNS(y.namespaceURI,"text");ot.setAttribute("x",String(M)),ot.setAttribute("y",String(Wt+Ut*vt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(It)),ot.setAttribute("fill","#111111"),At&&ot.setAttribute("font-weight",At),ot.textContent=Nt,bt&&ot.addEventListener("mouseenter",rt=>bt(rt)),Ft&&ot.addEventListener("mouseleave",()=>Ft()),mt&&(ot.style.cursor="pointer",ot.addEventListener("click",rt=>mt(rt))),y.appendChild(ot)})},Z=28,V=28,st=10,Y=Math.max(300,Z+V+k*C+24);y.setAttribute("height",String(Y));let W=_-Q-st,K=Z+6;y.style.color="#111111";let J=v+I-R||1,at=R-J*.02,ht=v+I+J*.08,ct=l=>Q+(l-at)/(ht-at)*W,O=(ht-at)/I,Mt=Math.max(4,Math.min(12,Math.floor(W/90)||4)),dt=O/Mt,q=[1,2,3,5,7,10,14,21,30,60,90,180,365],pt=q[q.length-1];for(let l of q)if(l>=dt){pt=l;break}let Vt=[],Ge=H(at);for(let l=Ge;l<=ht+.5*I;l+=pt*I)Vt.push(l);let Ht=document.createElementNS(y.namespaceURI,"line");Ht.setAttribute("x1",String(Q)),Ht.setAttribute("y1",String(K)),Ht.setAttribute("x2",String(_-st)),Ht.setAttribute("y2",String(K)),Ht.setAttribute("stroke","#111111"),y.appendChild(Ht);for(let l of Vt){let M=ct(l),$=document.createElementNS(y.namespaceURI,"line");$.setAttribute("x1",String(M)),$.setAttribute("y1",String(K)),$.setAttribute("x2",String(M)),$.setAttribute("y2",String(Y-V)),$.setAttribute("stroke","#111111"),$.setAttribute("stroke-opacity","0.20"),$.setAttribute("stroke-dasharray","2,4"),y.appendChild($);let U=document.createElementNS(y.namespaceURI,"text");U.setAttribute("x",String(M)),U.setAttribute("y",String(K-4)),U.setAttribute("text-anchor","middle"),U.setAttribute("font-size","10"),U.setAttribute("fill","#111111"),U.textContent=Gt(new Date(l)),y.appendChild(U)}let fe=new Date;fe.setHours(0,0,0,0);let oe=fe.getTime();if(oe>=at&&oe<=ht){let l=ct(oe),M=document.createElementNS(y.namespaceURI,"line");M.setAttribute("x1",String(l)),M.setAttribute("y1",String(K)),M.setAttribute("x2",String(l)),M.setAttribute("y2",String(Y-V)),M.setAttribute("stroke","#4caf50"),M.setAttribute("stroke-width","2"),M.setAttribute("stroke-dasharray","4,2"),y.appendChild(M);let $=document.createElementNS(y.namespaceURI,"text");$.setAttribute("x",String(l+4)),$.setAttribute("y",String(K+12)),$.setAttribute("font-size","10"),$.setAttribute("fill","#4caf50"),$.textContent="hoje",y.appendChild($)}let Bt=g.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Bt.setAttr("title",A==="wide"?"Compactar nomes":"Expandir nomes"),Bt.style.left=`${Q}px`,Bt.style.top="4px",Bt.addEventListener("click",l=>{l.preventDefault();let $=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=$,ee(s,e,t,n)});let ze=["status","priority"],ie=Array.isArray(r.tooltipFields)?r.tooltipFields.map(l=>String(l)):null,Ve=ie&&ie.length?ie:ze,Qt=0,ae=null;for(let l of u){let M=l.start,$=l.end,U=($.getTime()-M.getTime())/6e4,It=l.props,At=l.notePath,bt=l.noteTitle,Ft=(we=(Se=l.row.notes)==null?void 0:Se.length)!=null?we:0,mt=l.due,Et=l.estMinutes,Rt=[];Rt.push(`${Gt(M)} \u2192 ${Gt($)}`),typeof Et=="number"&&!Number.isNaN(Et)?Rt.push(`est: ${Math.round(Et)} min`):U>0&&Rt.push(`dura\xE7\xE3o: ${Math.round(U)} min`),mt instanceof Date&&Rt.push(`due: ${Gt(mt)}`);for(let et of Ve){let B=x(It,et);B!=null&&String(B).trim()!==""&&Rt.push(`${et}: ${String(B)}`)}let _t=Rt.join("<br>"),kt=et=>{var B;et.preventDefault(),h&&At?new pe(At,e,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():yt(s,D,bt,Et!=null?Et:U,(B=l.row.notes)!=null?B:[],i)},xt=et=>{bt&&_t&&gt(s,E,bt,_t,Ft,et)},lt=()=>ft(E);if(l.groupKey!==ae){ae=l.groupKey;let et=K+8+Qt*C+C/2,B=a(ae);L(B,4,et,Q-12,11,"600"),Qt+=1}let vt=K+8+Qt*C,Ot=C-10,Wt=ct(M.getTime()),Nt=ct($.getTime()),Ut=Math.max(4,Nt-Wt),ot=l.fullName,rt=document.createElementNS(y.namespaceURI,"rect");rt.setAttribute("x",String(Wt)),rt.setAttribute("y",String(vt)),rt.setAttribute("width",String(Ut)),rt.setAttribute("height",String(Ot)),rt.setAttribute("rx","3"),rt.setAttribute("ry","3"),rt.setAttribute("fill",it((Ae=l.row.series)!=null?Ae:ot,Qt)),rt.setAttribute("stroke","rgba(0,0,0,0.25)"),rt.setAttribute("stroke-width","0.5"),rt.style.cursor=h&&At?"pointer":"default",rt.addEventListener("mouseenter",xt),rt.addEventListener("mouseleave",lt),rt.addEventListener("click",kt),y.appendChild(rt);let De=vt+Ot/2;if(Ut>=6){let et=it((Ee=l.row.series)!=null?Ee:ot,Qt),B=document.createElementNS(y.namespaceURI,"circle");B.setAttribute("cx",String(Wt)),B.setAttribute("cy",String(De)),B.setAttribute("r","3.5"),B.setAttribute("fill","#ffffff"),B.setAttribute("stroke",et),B.setAttribute("stroke-width","1.5"),y.appendChild(B);let Pt=document.createElementNS(y.namespaceURI,"circle");Pt.setAttribute("cx",String(Nt)),Pt.setAttribute("cy",String(De)),Pt.setAttribute("r","3.5"),Pt.setAttribute("fill","#ffffff"),Pt.setAttribute("stroke",et),Pt.setAttribute("stroke-width","1.5"),y.appendChild(Pt)}let Ce=vt+Ot/2+2,Yt=f?16:4;if(A==="wide")L(ot,Yt,Ce,Q-Yt-4,11,null,xt,lt,kt);else{let et=ot,B=Math.max(40,Q-Yt-8),Re=Math.max(8,Math.floor(B/6));et.length>Re&&(et=et.slice(0,Re-1)+"\u2026");let St=document.createElementNS(y.namespaceURI,"text");St.setAttribute("x",String(Yt)),St.setAttribute("y",String(Ce)),St.setAttribute("text-anchor","start"),St.setAttribute("font-size","11"),St.setAttribute("fill","#111111"),St.textContent=et,St.style.cursor="pointer",St.addEventListener("mouseenter",xt),St.addEventListener("mouseleave",lt),St.addEventListener("click",kt),y.appendChild(St)}if(mt instanceof Date){let et=ct(mt.getTime()),B=document.createElementNS(y.namespaceURI,"line");B.setAttribute("x1",String(et)),B.setAttribute("y1",String(vt)),B.setAttribute("x2",String(et)),B.setAttribute("y2",String(vt+Ot)),B.setAttribute("stroke","#ff6b6b"),B.setAttribute("stroke-width","2"),B.setAttribute("stroke-dasharray","4,2"),y.appendChild(B)}Qt+=1}if(h){let l=s.createDiv({cls:"prop-charts-empty"});l.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function he(s,e,t){var Q,j,tt,_;let n=(Q=e.options)!=null?Q:{},r=n.background,o=(j=n.drilldown)!=null?j:!0,i=(tt=t.rows)!=null?tt:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:a,tooltip:c,details:p}=wt(s,r),f=s.getBoundingClientRect().width||600,w=Math.max(f,480);h.style.width=w+"px";let x=40,m=16,u=18,C=28,k=300;a.setAttribute("height",String(k));let N=w-x-m,F=k-u-C,P=new Map;for(let g of i){let y=String(g.x),E=(_=P.get(y))!=null?_:{label:g.x,rows:[]};E.rows.push(g),P.set(y,E)}let H=Array.from(P.keys()).sort((g,y)=>g<y?-1:g>y?1:0).map(g=>P.get(g)),R=H.length,v=new Set;i.forEach(g=>{g.series!=null&&v.add(String(g.series))});let d=Array.from(v),S=d.length>1,A=S?"grouped":"single",b=0;i.forEach(g=>{g.y>b&&(b=g.y)}),(!isFinite(b)||b<=0)&&(b=1);let T=g=>u+F-g/(b||1)*F,G=T(0),nt=4;for(let g=0;g<=nt;g++){let y=b*g/nt,E=T(y),D=document.createElementNS(a.namespaceURI,"line");D.setAttribute("x1",String(x)),D.setAttribute("y1",String(E)),D.setAttribute("x2",String(w-m)),D.setAttribute("y2",String(E)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),a.appendChild(D);let L=document.createElementNS(a.namespaceURI,"text");L.setAttribute("x",String(x-4)),L.setAttribute("y",String(E+3)),L.setAttribute("text-anchor","end"),L.setAttribute("font-size","10"),L.setAttribute("fill","#111111"),L.textContent=String(Math.round(y)),a.appendChild(L)}let z=R>0?N/R:N;if(H.forEach((g,y)=>{let E=x+z*(y+.5),D=String(g.label),L=document.createElementNS(a.namespaceURI,"text");L.setAttribute("x",String(E)),L.setAttribute("y",String(k-C+12)),L.setAttribute("text-anchor","middle"),L.setAttribute("font-size","10"),L.setAttribute("fill","#111111"),L.textContent=D,a.appendChild(L)}),S){let g=s.createDiv({cls:"chart-notes-legend"});d.forEach((y,E)=>{let D=g.createDiv({cls:"chart-notes-legend-item"}),L=D.createDiv();L.style.width="10px",L.style.height="10px",L.style.borderRadius="999px",L.style.backgroundColor=it(y,E),D.createSpan({text:y})})}H.forEach((g,y)=>{let E=x+z*(y+.5),D=g.rows;if(A==="single"){let Y=D[0],W=Y.y,K=z*.6,J=E-K/2,at=T(W),ht=Math.max(2,G-at),ct=it("bar",y),O=document.createElementNS(a.namespaceURI,"rect");O.setAttribute("x",String(J)),O.setAttribute("y",String(at)),O.setAttribute("width",String(K)),O.setAttribute("height",String(ht)),O.setAttribute("fill",ct),O.setAttribute("stroke","rgba(0,0,0,0.25)"),O.setAttribute("stroke-width","0.5"),O.style.cursor="pointer";let X=String(g.label),Mt=`valor: ${Math.round(W*100)/100}`;O.addEventListener("mouseenter",dt=>{var q,pt;return gt(s,c,X,Mt,(pt=(q=Y.notes)==null?void 0:q.length)!=null?pt:0,dt)}),O.addEventListener("mouseleave",()=>ft(c)),O.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(s,p,X,W,(q=Y.notes)!=null?q:[],o)}),a.appendChild(O);return}let L=d.length,Z=z/Math.max(L+1,2),V=L*Z,st=E-V/2;d.forEach((Y,W)=>{let K=D.find(q=>(q.series!=null?String(q.series):"")===Y);if(!K)return;let J=K.y,at=st+W*Z,ht=T(J),ct=Math.max(2,G-ht),O=it(Y,W),X=document.createElementNS(a.namespaceURI,"rect");X.setAttribute("x",String(at)),X.setAttribute("y",String(ht)),X.setAttribute("width",String(Z)),X.setAttribute("height",String(ct)),X.setAttribute("fill",O),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let Mt=`${Y} @ ${String(g.label)}`,dt=`valor: ${Math.round(J*100)/100}`;X.addEventListener("mouseenter",q=>{var pt,Vt;return gt(s,c,Mt,dt,(Vt=(pt=K.notes)==null?void 0:pt.length)!=null?Vt:0,q)}),X.addEventListener("mouseleave",()=>ft(c)),X.addEventListener("click",q=>{var pt;q.preventDefault(),yt(s,p,Mt,J,(pt=K.notes)!=null?pt:[],o)}),a.appendChild(X)})})}function $e(s,e,t){var z,Q,j,tt;let n=(z=e.options)!=null?z:{},r=n.background,o=(Q=n.drilldown)!=null?Q:!0,i=(j=t.rows)!=null?j:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:a,tooltip:c,details:p}=wt(s,r),f=s.getBoundingClientRect().width||600,w=Math.max(f,480);h.style.width=w+"px";let x=40,m=16,u=18,C=28,k=300;a.setAttribute("height",String(k));let N=w-x-m,F=k-u-C,P=new Map;for(let _ of i){let g=String(_.x),y=(tt=P.get(g))!=null?tt:{label:_.x,rows:[]};y.rows.push(_),P.set(g,y)}let H=Array.from(P.keys()).sort((_,g)=>_<g?-1:_>g?1:0).map(_=>P.get(_)),R=H.length,v=new Set;i.forEach(_=>{_.series!=null&&v.add(String(_.series))});let d=Array.from(v);if(!d.length){he(s,e,t);return}let S=0;H.forEach(_=>{let g=_.rows.reduce((y,E)=>y+E.y,0);g>S&&(S=g)}),(!isFinite(S)||S<=0)&&(S=1);let A=_=>u+F-_/(S||1)*F,b=A(0),T=4;for(let _=0;_<=T;_++){let g=S*_/T,y=A(g),E=document.createElementNS(a.namespaceURI,"line");E.setAttribute("x1",String(x)),E.setAttribute("y1",String(y)),E.setAttribute("x2",String(w-m)),E.setAttribute("y2",String(y)),E.setAttribute("stroke","#cccccc"),E.setAttribute("stroke-opacity","0.25"),a.appendChild(E);let D=document.createElementNS(a.namespaceURI,"text");D.setAttribute("x",String(x-4)),D.setAttribute("y",String(y+3)),D.setAttribute("text-anchor","end"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=String(Math.round(g)),a.appendChild(D)}let G=R>0?N/R:N;H.forEach((_,g)=>{let y=x+G*(g+.5),E=String(_.label),D=document.createElementNS(a.namespaceURI,"text");D.setAttribute("x",String(y)),D.setAttribute("y",String(k-C+12)),D.setAttribute("text-anchor","middle"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=E,a.appendChild(D)});let nt=s.createDiv({cls:"chart-notes-legend"});d.forEach((_,g)=>{let y=nt.createDiv({cls:"chart-notes-legend-item"}),E=y.createDiv();E.style.width="10px",E.style.height="10px",E.style.borderRadius="999px",E.style.backgroundColor=it(_,g),y.createSpan({text:_})}),H.forEach((_,g)=>{let y=x+G*(g+.5),E=G*.6,D=y-E/2,L=0;d.forEach((Z,V)=>{let st=_.rows.find(dt=>(dt.series!=null?String(dt.series):"")===Z);if(!st)return;let Y=st.y,W=L,K=L+Y;L=K;let J=A(W),at=A(K),ht=Math.max(2,J-at),ct=it(Z,V),O=document.createElementNS(a.namespaceURI,"rect");O.setAttribute("x",String(D)),O.setAttribute("y",String(at)),O.setAttribute("width",String(E)),O.setAttribute("height",String(ht)),O.setAttribute("fill",ct),O.setAttribute("stroke","rgba(0,0,0,0.25)"),O.setAttribute("stroke-width","0.5"),O.style.cursor="pointer";let X=`${Z} @ ${String(_.label)}`,Mt=`valor: ${Math.round(Y*100)/100}`;O.addEventListener("mouseenter",dt=>{var q,pt;return gt(s,c,X,Mt,(pt=(q=st.notes)==null?void 0:q.length)!=null?pt:0,dt)}),O.addEventListener("mouseleave",()=>ft(c)),O.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(s,p,X,Y,(q=st.notes)!=null?q:[],o)}),a.appendChild(O)})})}function me(s,e,t,n){var Q,j,tt,_;let r=(Q=e.options)!=null?Q:{},o=r.background,i=(j=r.drilldown)!=null?j:!0,h=(tt=t.rows)!=null?tt:[];if(!h.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:c,tooltip:p,details:f}=wt(s,o),w=s.getBoundingClientRect().width||600,x=Math.max(w,480);a.style.width=x+"px";let m=40,u=16,C=18,k=24,N=300;c.setAttribute("height",String(N));let F=x-m-u,P=N-C-k,I=new Map;for(let g of h){let y=g.series!=null?String(g.series):"__default__",E=(_=I.get(y))!=null?_:[];E.push(g),I.set(y,E)}let H=Array.from(I.keys()),R=[],v=new Set;for(let g of h){let y=String(g.x);v.has(y)||(v.add(y),R.push(g.x))}let d=R.length||1,S=g=>{let y=String(g),E=R.findIndex(D=>String(D)===y);return E<0?m:d===1?m+F/2:m+E/(d-1)*F},A=g=>String(g),b=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY;for(let g of h)g.y<b&&(b=g.y),g.y>T&&(T=g.y);(!isFinite(b)||!isFinite(T))&&(b=0,T=1),b===T&&(b===0?T=1:b=0);let G=g=>C+P-(g-b)/(T-b||1)*P,nt=4;for(let g=0;g<=nt;g++){let y=b+(T-b)*g/nt,E=G(y),D=document.createElementNS(c.namespaceURI,"line");D.setAttribute("x1",String(m)),D.setAttribute("y1",String(E)),D.setAttribute("x2",String(x-u)),D.setAttribute("y2",String(E)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),c.appendChild(D);let L=document.createElementNS(c.namespaceURI,"text");L.setAttribute("x",String(m-4)),L.setAttribute("y",String(E+3)),L.setAttribute("text-anchor","end"),L.setAttribute("font-size","10"),L.setAttribute("fill","#111111"),L.textContent=Math.abs(y)>=100?String(Math.round(y)):String(Math.round(y*10)/10),c.appendChild(L)}let z=H.filter(g=>g!=="__default__");if(z.length>1){let g=s.createDiv({cls:"chart-notes-legend"});z.forEach((y,E)=>{let D=y,L=g.createDiv({cls:"chart-notes-legend-item"}),Z=L.createDiv();Z.style.width="10px",Z.style.height="10px",Z.style.borderRadius="999px",Z.style.backgroundColor=it(D,E),L.createSpan({text:D})})}H.forEach((g,y)=>{let E=I.get(g);if(!(E!=null&&E.length))return;let D=g==="__default__"?it("line",y):it(g,y),L=[...E].sort((V,st)=>{let Y=R.findIndex(K=>String(K)===String(V.x)),W=R.findIndex(K=>String(K)===String(st.x));return Y-W}),Z="";if(L.forEach((V,st)=>{let Y=S(V.x),W=G(V.y);Z+=(st===0?"M ":" L ")+Y+" "+W}),n){let V=L[0],st=L[L.length-1],Y=S(V.x),W=S(st.x),K=G(b);Z+=` L ${W} ${K} L ${Y} ${K} Z`;let J=document.createElementNS(c.namespaceURI,"path");J.setAttribute("d",Z),J.setAttribute("fill",D),J.setAttribute("fill-opacity","0.18"),J.setAttribute("stroke",D),J.setAttribute("stroke-width","1.5"),c.appendChild(J)}else{let V=document.createElementNS(c.namespaceURI,"path");V.setAttribute("d",Z),V.setAttribute("fill","none"),V.setAttribute("stroke",D),V.setAttribute("stroke-width","2"),c.appendChild(V)}L.forEach(V=>{let st=S(V.x),Y=G(V.y),W=document.createElementNS(c.namespaceURI,"circle");W.setAttribute("cx",String(st)),W.setAttribute("cy",String(Y)),W.setAttribute("r","3"),W.setAttribute("fill","#ffffff"),W.setAttribute("stroke",D),W.setAttribute("stroke-width","1.5"),W.style.cursor="pointer";let K=A(V.x),J=g==="__default__"?"":String(V.series),at=J?`${J} @ ${K}`:K,ht=`valor: ${Math.round(V.y*100)/100}`;W.addEventListener("mouseenter",ct=>{var O,X;return gt(s,p,at,ht,(X=(O=V.notes)==null?void 0:O.length)!=null?X:0,ct)}),W.addEventListener("mouseleave",()=>ft(p)),W.addEventListener("click",ct=>{var O;ct.preventDefault(),yt(s,f,at,V.y,(O=V.notes)!=null?O:[],i)}),c.appendChild(W)})})}function He(s,e,t){var F;let{background:n,drilldown:r=!0}=(F=e.options)!=null?F:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=_e(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:h,svg:a,tooltip:c,details:p}=wt(s,n),f=Math.max(i,420);h.style.width=f+"px",o&&(a.style.color=o);let w=300,x=f/2,m=(w-28+28)/2,u=Math.min(f/2-20,w/2-20),k=t.rows.map(P=>Math.max(0,P.y)).reduce((P,I)=>P+I,0)||1,N=-Math.PI/2;t.rows.forEach((P,I)=>{var z;let H=P.x instanceof Date?P.x.toISOString().slice(0,10):String(P.x),R=P.y,v=R/k*Math.PI*2,d=x+u*Math.cos(N),S=m+u*Math.sin(N),A=x+u*Math.cos(N+v),b=m+u*Math.sin(N+v),T=v>Math.PI?1:0,G=document.createElementNS(a.namespaceURI,"path"),nt=[`M ${x} ${m}`,`L ${d} ${S}`,`A ${u} ${u} 0 ${T} 1 ${A} ${b}`,"Z"].join(" ");G.setAttribute("d",nt),G.setAttribute("fill",it((z=P.series)!=null?z:H,I)),G.style.cursor="pointer",G.addEventListener("mouseenter",Q=>{var j,tt;return gt(s,c,H,R,(tt=(j=P.notes)==null?void 0:j.length)!=null?tt:0,Q)}),G.addEventListener("mouseleave",()=>ft(c)),G.addEventListener("click",()=>{var Q;return yt(s,p,H,R,(Q=P.notes)!=null?Q:[],r)}),a.appendChild(G),N+=v})}function Qe(s,e,t){var S;let{background:n,drilldown:r=!0}=(S=e.options)!=null?S:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:h,svg:a,tooltip:c,details:p}=wt(s,n),f=Math.max(i,700);h.style.width=f+"px",o&&(a.style.color=o);let w=300,x=f-48-10,m=w-28-28,u=t.rows.map(A=>{let b=A.x;if(b instanceof Date)return b.getTime();if(typeof b=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(b)){let G=new Date(b);if(!isNaN(G.getTime()))return G.getTime()}let T=Number(b);return isNaN(T)?null:T}return typeof b=="number"?b:null}),C=t.rows.map(A=>A.y),k=u.filter(A=>A!==null);if(k.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let N=Math.min(...k),F=Math.max(...k),P=Math.min(...C),I=Math.max(...C),H=A=>48+(A-N)/(F-N||1)*x,R=A=>w-28-(A-P)/(I-P||1)*m,v=document.createElementNS(a.namespaceURI,"line");v.setAttribute("x1",String(48)),v.setAttribute("y1",String(28)),v.setAttribute("x2",String(48)),v.setAttribute("y2",String(w-28)),v.setAttribute("stroke","currentColor"),a.appendChild(v);let d=document.createElementNS(a.namespaceURI,"line");d.setAttribute("x1",String(48)),d.setAttribute("y1",String(w-28)),d.setAttribute("x2",String(f-10)),d.setAttribute("y2",String(w-28)),d.setAttribute("stroke","currentColor"),a.appendChild(d),t.rows.forEach((A,b)=>{let T=u[b];if(T==null)return;let G=H(T),nt=R(C[b]),z=document.createElementNS(a.namespaceURI,"circle");z.setAttribute("cx",String(G)),z.setAttribute("cy",String(nt)),z.setAttribute("r","4"),z.setAttribute("fill",it(A.series,b)),z.style.cursor="pointer";let Q=A.x instanceof Date?A.x.toISOString().slice(0,10):typeof A.x=="string"?A.x:String(A.x);z.addEventListener("mouseenter",j=>{var tt,_;return gt(s,c,Q,A.y,(_=(tt=A.notes)==null?void 0:tt.length)!=null?_:0,j)}),z.addEventListener("mouseleave",()=>ft(c)),z.addEventListener("click",j=>{var tt;j.preventDefault(),yt(s,p,Q,A.y,(tt=A.notes)!=null?tt:[],r)}),a.appendChild(z)})}var Oe=require("obsidian"),re=class{render(e,t,n,r,o=!1){var c;let{title:i}=(c=t.options)!=null?c:{};e.empty(),e.addClass("prop-charts-container");let a=e.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(a.textContent=i),t.type){case"bar":he(e,t,n);break;case"stacked-bar":$e(e,t,n);break;case"line":me(e,t,n,!1);break;case"area":me(e,t,n,!0);break;case"pie":He(e,t,n);break;case"scatter":Qe(e,t,n);break;case"gantt":ee(e,t,n,r);break;default:e.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}if(!o){let p=e.createEl("button",{cls:"chart-notes-zoom-button"});p.setAttr("type","button"),p.setAttr("aria-label","Expandir gr\xE1fico"),p.textContent="\u2922",p.addEventListener("click",f=>{f.preventDefault(),new ge(t,n,this,r).open()})}}},ge=class extends Oe.Modal{constructor(t,n,r,o){super(app);this.size="large";this.spec=t,this.data=n,this.renderer=r,this.ctx=o}onOpen(){var a;let{contentEl:t}=this;t.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),t.addClass("chart-notes-zoom-modal"),this.applySize();let n=t.createDiv({cls:"chart-notes-zoom-header"}),r=(a=this.spec.options)!=null&&a.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";n.createEl("div",{text:r,cls:"chart-notes-zoom-title"});let o=n.createDiv({cls:"chart-notes-zoom-sizes"}),i=(c,p)=>{let f=o.createEl("button",{cls:"chart-notes-zoom-size-btn",text:c});(()=>{f.toggleClass("is-active",this.size===p)})(),f.addEventListener("click",x=>{x.preventDefault(),this.size=p,this.applySize(),o.querySelectorAll(".chart-notes-zoom-size-btn").forEach(u=>u.classList.remove("is-active")),f.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let h=t.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(h,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let t=this.modalEl;if(!t)return;let n="95vw",r="85vh";switch(this.size){case"small":n="60vw",r="55vh";break;case"medium":n="80vw",r="70vh";break;case"large":default:n="95vw",r="85vh";break}t.style.maxWidth=n,t.style.width=n,t.style.height=r,t.style.maxHeight=r}};var se=class extends Lt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("Chart Notes: loading plugin"),this.indexer=new jt(this.app),await this.indexer.buildIndex(),this.query=new te(()=>this.indexer.getAll(),[]),this.renderer=new re,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Lt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Lt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Lt.TFile&&this.indexer.removeFile(t)})),this.registerMarkdownCodeBlockProcessor("chart",async(t,n,r)=>{var p;let o;try{let f=(0,Lt.parseYaml)(t);if(!f||typeof f!="object"){n.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}o=f}catch(f){n.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+f.message});return}if(!o.type){n.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=o.type==="gantt",h=o.type==="table";if(!i&&!h){if(!o.encoding||!o.encoding.x){n.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let w=((p=o.aggregate)==null?void 0:p.y)==="count";if(!o.encoding.y&&!w){n.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}o.encoding||(o.encoding={}),o.source||(o.source={});let c;try{c=this.query.run(o)}catch(f){n.createEl("div",{text:"Chart Notes: erro na query: "+f.message});return}this.renderer.render(n,o,c)}),this.registerBasesView(le,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new Xt(t,n,this.renderer),options:()=>[{type:"dropdown",key:"chartType",displayName:"Chart type",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line",area:"Area",pie:"Pie",scatter:"Scatter",gantt:"Gantt"}},{type:"property",key:"xProperty",displayName:"X axis / label"},{type:"property",key:"yProperty",displayName:"Y axis / value (empty = count)"},{type:"property",key:"seriesProperty",displayName:"Series / color (optional)"},{type:"dropdown",key:"aggregateMode",displayName:"Aggregation (Y)",default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:m=>{var C;let u=String((C=m.get("chartType"))!=null?C:"bar");return u==="scatter"||u==="gantt"}},{type:"property",key:"startProperty",displayName:"Start (Gantt)",shouldHide:m=>{var u;return String((u=m.get("chartType"))!=null?u:"")!=="gantt"}},{type:"property",key:"endProperty",displayName:"End (Gantt)",shouldHide:m=>{var u;return String((u=m.get("chartType"))!=null?u:"")!=="gantt"}},{type:"property",key:"dueProperty",displayName:"Due (Gantt, optional)",shouldHide:m=>{var u;return String((u=m.get("chartType"))!=null?u:"")!=="gantt"}},{type:"property",key:"durationProperty",displayName:"Duration in minutes (Gantt, optional)",shouldHide:m=>{var u;return String((u=m.get("chartType"))!=null?u:"")!=="gantt"}},{type:"property",key:"groupProperty",displayName:"Group / lane (Gantt, optional)",shouldHide:m=>{var u;return String((u=m.get("chartType"))!=null?u:"")!=="gantt"}},{type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0},{type:"text",key:"title",displayName:"Title (optional)"}]})}onunload(){console.log("Chart Notes: unloading plugin")}};
