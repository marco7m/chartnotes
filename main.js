"use strict";var te=Object.defineProperty;var ke=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Ne=Object.prototype.hasOwnProperty;var Re=(i,t)=>{for(var e in t)te(i,e,{get:t[e],enumerable:!0})},Te=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Me(t))!Ne.call(i,n)&&n!==e&&te(i,n,{get:()=>t[n],enumerable:!(s=ke(t,n))||s.enumerable});return i};var Le=i=>Te(te({},"__esModule",{value:!0}),i);var Be={};Re(Be,{default:()=>Xt});module.exports=Le(Be);var qt=require("obsidian");var pe=require("obsidian"),Qt=class{constructor(t){this.index=new Map;this.app=t}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)await this.updateFile(e)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(t){if(t.extension!=="md")return;let e={};try{let n=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/);if(n){let a=(0,pe.parseYaml)(n[1])||{};if(a&&typeof a=="object")for(let[g,p]of Object.entries(a))g!=="position"&&(e[g]=p)}let r=this.app.metadataCache.getFileCache(t);r?.tags&&!e.tags&&(e.tags=r.tags.map(a=>a.tag.replace(/^#/,"")))}catch(s){console.error("Chart Notes: erro ao indexar",t.path,s)}this.index.set(t.path,{path:t.path,props:e})}removeFile(t){this.index.delete(t.path)}};function ge(i,t){if(!t||t.length===0)return!0;for(let e of t){if(e===".")return!0;let s=e.endsWith("/")?e:e+"/";if(i===e||i.startsWith(s))return!0}return!1}function me(i,t){if(!t||t.length===0)return!0;let e=i.tags;if(!e)return!1;if(Array.isArray(e)){for(let n of t)if(e.includes(n)||e.includes("#"+n))return!0;return!1}let s=String(e);for(let n of t)if(s===n||s==="#"+n)return!0;return!1}function Ut(i){return typeof i!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(i)}function kt(i){if(i instanceof Date)return i;if(typeof i!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(i)){let[e,s,n]=i.split("-");return new Date(Number(e),Number(s)-1,Number(n),0,0,0,0)}let t=new Date(i);return isNaN(t.getTime())?null:t}function st(i){let t=new Date(i);return t.setHours(0,0,0,0),t}function Bt(i,t){let e=new Date(i);return e.setDate(e.getDate()-t),e}function Ie(i,t){return Bt(i,t*7)}function Pe(i,t){let e=new Date(i);return e.setMonth(e.getMonth()-t),e}function ne(i,t){let e=new Date(i);return e.setDate(e.getDate()+t),e}function Fe(i,t){return ne(i,t*7)}function $e(i,t){let e=new Date(i);return e.setMonth(e.getMonth()+t),e}function he(i){let t=i.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(t)||t.endsWith("date")||t.endsWith("at")||t.endsWith("on"))}function fe(i,t){let e=t?new Date(t):new Date,s=st(e),n=i.trim().toLowerCase();if(n==="today")return s;if(n==="yesterday")return st(Bt(s,1));if(/^-\d+$/.test(n)){let r=parseInt(n.slice(1),10);return st(Bt(s,r))}if(/^-\d+d$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st(Bt(s,r))}if(/^-\d+w$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st(Ie(s,r))}if(/^-\d+m$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st(Pe(s,r))}if(/^\+\d+$/.test(n)){let r=parseInt(n.slice(1),10);return st(ne(s,r))}if(/^\+\d+d$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st(ne(s,r))}if(/^\+\d+w$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st(Fe(s,r))}if(/^\+\d+m$/.test(n)){let r=parseInt(n.slice(1,-1),10);return st($e(s,r))}return null}function ye(i){let t=i.trim(),e=t.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(e){let u=e[1].trim(),C=e[2].trim(),S=e[3].trim(),D=he(u),h=ee(C,D),d=ee(S,D),y=h.valueType==="date"||d.valueType==="date"?"date":h.valueType;return{field:u,op:"between",value:h.value,value2:d.value,valueType:y}}let s=/(==|!=|>=|<=|>|<)/,n=t.split(s);if(n.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+i);let r=n[0].trim(),a=n[1].trim(),g=n[2].trim(),p=he(r),o=ee(g,p);return{field:r,op:a,value:o.value,valueType:o.valueType}}function ee(i,t){let e=i.trim();if(e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"'))return{value:e.slice(1,-1),valueType:"string"};let s=e.toLowerCase(),n=s==="today"||s==="yesterday"||s.startsWith("-")||s.startsWith("+");if(t){if(e==="0"||s==="today")return{value:st(new Date),valueType:"date"};let a=fe(e);if(a)return{value:a,valueType:"date"}}else if(n){let a=fe(e);if(a)return{value:a,valueType:"date"}}if(Ut(e)){let a=kt(e);if(a)return{value:a,valueType:"date"}}let r=Number(e);return Number.isNaN(r)?{value:e,valueType:"string"}:{value:r,valueType:"number"}}function be(i,t){let e=i[t.field];if(e==null)return!1;if(t.valueType==="date"){let r=e instanceof Date?st(e):Ut(e)?st(kt(e)):null;if(!r)return!1;let a=t.value instanceof Date?t.value:null,g=t.value2 instanceof Date?t.value2:null;if(!a)return!1;let p=r.getTime(),o=st(a).getTime();switch(t.op){case"==":return p===o;case"!=":return p!==o;case">":return p>o;case">=":return p>=o;case"<":return p<o;case"<=":return p<=o;case"between":if(!g)return!1;let u=st(g).getTime();return p>=o&&p<=u}}if(t.valueType==="number"){let r=Number(e);if(isNaN(r))return!1;let a=Number(t.value);switch(t.op){case"==":return r===a;case"!=":return r!==a;case">":return r>a;case">=":return r>=a;case"<":return r<a;case"<=":return r<=a;case"between":return typeof t.value2!="number"?!1:r>=a&&r<=t.value2}}let s=String(e),n=String(t.value);switch(t.op){case"==":return s===n;case"!=":return s!==n;case">":return s>n;case">=":return s>=n;case"<":return s<n;case"<=":return s<=n;case"between":return!1}}function _e(i){if(typeof i=="string"&&/^\d{4}-\d{2}-\d{2}/.test(i))return{key:i.slice(0,10),isDate:!0};if(Ut(i)){let t=kt(i);if(t)return{key:t,isDate:!0}}return{key:i,isDate:!1}}function ze(i,t){let e=i.x,s=t.x;if(e instanceof Date&&s instanceof Date)return e.getTime()-s.getTime();let n=String(e),r=String(s);return n<r?-1:n>r?1:0}function We(i,t){let e=ze(i,t);if(e!==0)return e;let s=i.series??"",n=t.series??"";return s<n?-1:s>n?1:0}function Ke(i){if(i==null)return 0;if(typeof i=="number")return i>0?Math.floor(i):0;if(typeof i=="string"){let t=i.trim().match(/^(\d+)/);if(t){let e=Number(t[1]);return Number.isFinite(e)&&e>0?Math.floor(e):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(i)}`)}function He(i){let t=new Map,e=[];for(let s of i){let n=s.series??"__no_series__",a=(t.get(n)??0)+s.y;t.set(n,a),e.push({...s,y:a})}return e}function Qe(i,t){let e=Ke(t);if(!e||e<=1)return[...i];let s=new Map,n=new Map,r=[];for(let a of i){let g=a.series??"__no_series__",p=s.get(g);p||(p=[],s.set(g,p));let o=n.get(g)??0;if(p.push(a.y),o+=a.y,p.length>e){let S=p.shift();o-=S}n.set(g,o);let u=p.length||1,C=o/u;r.push({...a,y:C})}return r}var Yt=class{constructor(t,e){this.getIndex=t,this.defaultPaths=e}run(t){let e=this.getIndex(),s=t.source?.paths&&t.source.paths.length?t.source.paths:this.defaultPaths,n=t.source?.tags&&t.source.tags.length?t.source.tags:[],r=[];for(let a of e){let g=s&&s.length?ge(a.path,s):!0,p=n&&n.length?me(a.props,n):!0;if(!g||!p)continue;let o=!0;if(t.source?.where&&t.source.where.length>0)for(let u of t.source.where){let C;try{C=ye(u)}catch(S){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${u} (${S.message})`)}if(!be(a.props,C)){o=!1;break}}o&&r.push(a)}return t.type==="gantt"?this.runGantt(t,r):t.type==="table"?this.runTable(t,r):this.runStandard(t,r)}runTable(t,e){return{rows:e.map(n=>({x:n.path,y:0,notes:[n.path],props:n.props})),xField:t.encoding?.x,yField:t.encoding?.y}}runGantt(t,e){let s=t.encoding??{},n=s.start,r=s.end,a=s.label??s.x,g=s.series,p=s.duration,o=s.due,u=[];for(let C of e){let S=C.props??{},D=w=>Array.isArray(w)?w[0]:w,h=null;if(r){let w=D(S[r]),T=kt(w);T&&(h=T)}if(!h)continue;let d=null;if(n){let w=D(S[n]),T=kt(w);T&&(d=T)}if(!d&&p){let w=D(S[p]),T=Number(w);Number.isNaN(T)||(d=new Date(h.getTime()-T*6e4))}d||(d=new Date(h.getTime()));let y;if(o){let w=D(S[o]),T=kt(w);T&&(y=T)}let I;if(a){let w=D(S[a]);(w==null||w==="")&&(w=C.path),I=w}else I=C.path;let _;if(g){let w=D(S[g]);w!=null&&(_=String(w))}let R={x:I,y:0,notes:[C.path],series:_,start:d,end:h,props:S};y&&(R.due=y),u.push(R)}return u.sort((C,S)=>{let D=C.start?C.start.getTime():0,h=S.start?S.start.getTime():0;return D-h}),{rows:u,xField:a,yField:r}}runStandard(t,e){let s=t.encoding?.x,n=t.encoding?.y,r=t.encoding?.series;if(!s)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let a=t.aggregate??{},g=a.y??null,p=!!a.cumulative,o=a.rolling;if(!n&&g!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let u=[];for(let h of e){let d=h.props??{},y=M=>Array.isArray(M)?M[0]:M,I=y(d[s]);if(I==null)continue;let _=_e(I),R=_.key,w=_.isDate,T;if(r){let M=y(d[r]);M!=null&&String(M).trim()!==""&&(T=String(M))}let E;if(g==="count")E=1;else{let M=y(d[n]);if(M==null)continue;let z=Number(M);if(Number.isNaN(z))continue;E=z}u.push({x:R,y:E,notes:[h.path],series:T,props:d,_isDate:w,_origX:I})}if(u.length===0)return{rows:[],xField:s,yField:n};let C=[];if(g){let h=new Map;for(let d of u){let y=d.series??"",I=d.x instanceof Date?d.x.toISOString().slice(0,10):String(d.x),_=y+"||"+I,R=h.get(_)??{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:d.x,isDate:d._isDate,series:d.series,props:d.props};R.sum+=d.y,R.count+=1,d.y<R.min&&(R.min=d.y),d.y>R.max&&(R.max=d.y),R.notes.push(...d.notes),R.props=d.props??R.props,h.set(_,R)}for(let[,d]of h){let y=d.sum;switch(g){case"sum":y=d.sum;break;case"avg":y=d.sum/d.count;break;case"min":y=d.min;break;case"max":y=d.max;break;case"count":y=d.count;break}C.push({x:d.xRep,y,notes:d.notes,series:d.series,props:d.props})}}else C=u.map(h=>({x:h.x,y:h.y,notes:h.notes,series:h.series,props:h.props}));if(C.length===0)return{rows:[],xField:s,yField:n};let S=t.sort?.x==="desc"?"desc":"asc";if(C.sort((h,d)=>{let y=We(h,d);return S==="asc"?y:-y}),(p||o)&&!(t.type==="line"||t.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(p&&o)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let D=C;return o?D=Qe(C,o):p&&(D=He(C)),{rows:D,xField:s,yField:n}}};var gt=require("obsidian"),_t=48,se=10,Ot=28,Mt=28;var At=300,xe=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function dt(i,t){if(!i)return"var(--text-accent, #5b6cff)";let e=Array.from(i).reduce((s,n)=>s*33+n.charCodeAt(0)>>>0,0);return xe[e%xe.length]}function Nt(i,t){i.addClass("prop-charts-container"),i.style.width="100%",i.style.maxWidth="100%",i.style.position="relative";let e=i.createDiv({cls:"chart-notes-scroll"});e.style.overflowX="auto",e.style.overflowY="hidden",e.style.width="100%",e.style.maxWidth="100%";let s=e.createDiv({cls:"chart-notes-inner"});s.style.display="block",s.style.minHeight=`${At}px`,t&&(s.style.background=t);let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width","100%"),r.setAttribute("height",String(At)),r.style.display="block",s.appendChild(r);let a=i.createDiv({cls:"chart-notes-tooltip"});a.style.display="none";let g=i.createDiv({cls:"chart-notes-details"});return g.style.display="none",{scroll:e,inner:s,svg:r,tooltip:a,details:g}}function Rt(i,t,e,s,n,r){let a=i.getBoundingClientRect(),g=typeof s=="number"?Number.isInteger(s)?String(s):s.toFixed(2):String(s);t.innerHTML=`
    <div class="chart-notes-tooltip-title">${e}</div>
    <div class="chart-notes-tooltip-value">${g}</div>
    <div class="chart-notes-tooltip-notes">${n} nota${n===1?"":"s"}</div>
  `,t.style.display="block";let p=t.getBoundingClientRect(),o=r.clientX-a.left+6,u=r.clientY-a.top+6;o+p.width>a.width-4&&(o=a.width-p.width-4),o<4&&(o=4),u+p.height>a.height-4&&(u=a.height-p.height-4),u<4&&(u=4),t.style.left=o+"px",t.style.top=u+"px"}function Tt(i){i.style.display="none"}function Lt(i,t,e,s,n,r){if(!r)return;if(t.empty(),!n||n.length===0){t.style.display="none";return}t.style.display="block";let a=t.createEl("div",{cls:"chart-notes-details-header"}),g=a.createEl("div",{cls:"chart-notes-details-title"});g.textContent=`Notas em "${e}" (${n.length})`+(Number.isFinite(s)&&s!==0?` \u2013 valor ${Number.isInteger(s)?s:s.toFixed(2)}`:"");let p=a.createEl("button",{cls:"chart-notes-details-close"});p.textContent="\xD7",p.addEventListener("click",()=>{t.style.display="none"});let o=t.createEl("ul",{cls:"chart-notes-details-list"});for(let u of n){let S=o.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:u});S.href="#",S.addEventListener("click",D=>{D.preventDefault(),app.workspace.openLinkText(u,"",!1)})}}function zt(i){if(!(i instanceof Date)||isNaN(i.getTime()))return"";let t=i.getDate().toString().padStart(2,"0"),e=(i.getMonth()+1).toString().padStart(2,"0");return`${t}/${e}`}function ve(i){if(!i)return!1;let t=i.trim().toLowerCase();if(t==="#fff"||t==="#ffffff"||t==="white")return!0;if(!t.startsWith("#"))return!1;let e,s,n;if(t.length===4)e=parseInt(t[1]+t[1],16),s=parseInt(t[2]+t[2],16),n=parseInt(t[3]+t[3],16);else if(t.length===7)e=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);else return!1;return(.2126*e+.7152*s+.0722*n)/255>.7}var Gt=class{render(t,e,s,n,r=!1){let{title:a}=e.options??{};t.empty(),t.addClass("prop-charts-container");let p=t.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(a&&(p.textContent=a),e.type){case"bar":this.renderBar(t,e,s);break;case"line":this.renderLine(t,e,s,!1);break;case"area":this.renderLine(t,e,s,!0);break;case"pie":this.renderPie(t,e,s);break;case"scatter":this.renderScatter(t,e,s);break;case"table":this.renderTable(t,e,s);break;case"gantt":this.renderGantt(t,e,s,n);break;case"stacked-bar":this.renderStackedBar(t,e,s);break;default:t.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+e.type})}if(!r){let o=t.createEl("button",{cls:"chart-notes-zoom-button"});o.setAttr("type","button"),o.setAttr("aria-label","Expandir gr\xE1fico"),o.textContent="\u2922",o.addEventListener("click",u=>{u.preventDefault(),new ie(e,s,this,n).open()})}}renderBar(t,e,s){let n=e.options??{},r=n.background,a=n.drilldown??!0,g=s.rows??[];if(!g.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:p,svg:o,tooltip:u,details:C}=Nt(t,r),S=t.getBoundingClientRect().width||600,D=Math.max(S,480);p.style.width=D+"px";let h=40,d=16,y=18,I=28,_=At;o.setAttribute("height",String(_));let R=D-h-d,w=_-y-I,T=new Map;for(let l of g){let f=String(l.x),b=T.get(f)??{label:l.x,rows:[]};b.rows.push(l),T.set(f,b)}let M=Array.from(T.keys()).sort((l,f)=>l<f?-1:l>f?1:0).map(l=>T.get(l)),z=M.length,F=new Set;g.forEach(l=>{l.series!=null&&F.add(String(l.series))});let H=Array.from(F),k=H.length>1,Q=k?"grouped":"single",$=0;k?g.forEach(l=>{l.y>$&&($=l.y)}):g.forEach(l=>{l.y>$&&($=l.y)}),(!isFinite($)||$<=0)&&($=1);let W=l=>y+w-l/($||1)*w,nt=W(0),Y=4;for(let l=0;l<=Y;l++){let f=$*l/Y,b=W(f),m=document.createElementNS(o.namespaceURI,"line");m.setAttribute("x1",String(h)),m.setAttribute("y1",String(b)),m.setAttribute("x2",String(D-d)),m.setAttribute("y2",String(b)),m.setAttribute("stroke","#cccccc"),m.setAttribute("stroke-opacity","0.25"),o.appendChild(m);let x=document.createElementNS(o.namespaceURI,"text");x.setAttribute("x",String(h-4)),x.setAttribute("y",String(b+3)),x.setAttribute("text-anchor","end"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=String(Math.round(f)),o.appendChild(x)}let N=z>0?R/z:R;if(M.forEach((l,f)=>{let b=h+N*(f+.5),m=String(l.label),x=document.createElementNS(o.namespaceURI,"text");x.setAttribute("x",String(b)),x.setAttribute("y",String(_-I+12)),x.setAttribute("text-anchor","middle"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=m,o.appendChild(x)}),k){let l=t.createDiv({cls:"chart-notes-legend"});H.forEach((f,b)=>{let m=l.createDiv({cls:"chart-notes-legend-item"}),x=m.createDiv();x.style.width="10px",x.style.height="10px",x.style.borderRadius="999px",x.style.backgroundColor=dt(f,b),m.createSpan({text:f})})}M.forEach((l,f)=>{let b=h+N*(f+.5),m=l.rows;if(Q==="single"){let G=m[0],K=G.y,O=N*.6,X=b-O/2,rt=W(K),it=Math.max(2,nt-rt),ot=dt("bar",f),P=document.createElementNS(o.namespaceURI,"rect");P.setAttribute("x",String(X)),P.setAttribute("y",String(rt)),P.setAttribute("width",String(O)),P.setAttribute("height",String(it)),P.setAttribute("fill",ot),P.setAttribute("stroke","rgba(0,0,0,0.25)"),P.setAttribute("stroke-width","0.5"),P.style.cursor="pointer";let q=String(l.label),at=`valor: ${Math.round(K*100)/100}`;P.addEventListener("mouseenter",tt=>Rt(t,u,q,at,G.notes?.length??0,tt)),P.addEventListener("mouseleave",()=>Tt(u)),P.addEventListener("click",tt=>{tt.preventDefault(),Lt(t,C,q,K,G.notes??[],a)}),o.appendChild(P);return}let x=H.length,j=N/Math.max(x+1,2),v=x*j,J=b-v/2;H.forEach((G,K)=>{let O=m.find(ct=>(ct.series!=null?String(ct.series):"")===G);if(!O)return;let X=O.y,rt=J+K*j,it=W(X),ot=Math.max(2,nt-it),P=dt(G,K),q=document.createElementNS(o.namespaceURI,"rect");q.setAttribute("x",String(rt)),q.setAttribute("y",String(it)),q.setAttribute("width",String(j)),q.setAttribute("height",String(ot)),q.setAttribute("fill",P),q.setAttribute("stroke","rgba(0,0,0,0.25)"),q.setAttribute("stroke-width","0.5"),q.style.cursor="pointer";let at=`${G} @ ${String(l.label)}`,tt=`valor: ${Math.round(X*100)/100}`;q.addEventListener("mouseenter",ct=>Rt(t,u,at,tt,O.notes?.length??0,ct)),q.addEventListener("mouseleave",()=>Tt(u)),q.addEventListener("click",ct=>{ct.preventDefault(),Lt(t,C,at,X,O.notes??[],a)}),o.appendChild(q)})})}renderStackedBar(t,e,s){let n=e.options??{},r=n.background,a=n.drilldown??!0,g=s.rows??[];if(!g.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:p,svg:o,tooltip:u,details:C}=Nt(t,r),S=t.getBoundingClientRect().width||600,D=Math.max(S,480);p.style.width=D+"px";let h=40,d=16,y=18,I=28,_=At;o.setAttribute("height",String(_));let R=D-h-d,w=_-y-I,T=new Map;for(let N of g){let l=String(N.x),f=T.get(l)??{label:N.x,rows:[]};f.rows.push(N),T.set(l,f)}let M=Array.from(T.keys()).sort((N,l)=>N<l?-1:N>l?1:0).map(N=>T.get(N)),z=M.length,F=new Set;g.forEach(N=>{N.series!=null&&F.add(String(N.series))});let H=Array.from(F);if(!H.length){this.renderBar(t,e,s);return}let k=0;M.forEach(N=>{let l=N.rows.reduce((f,b)=>f+b.y,0);l>k&&(k=l)}),(!isFinite(k)||k<=0)&&(k=1);let Q=N=>y+w-N/(k||1)*w,$=Q(0),W=4;for(let N=0;N<=W;N++){let l=k*N/W,f=Q(l),b=document.createElementNS(o.namespaceURI,"line");b.setAttribute("x1",String(h)),b.setAttribute("y1",String(f)),b.setAttribute("x2",String(D-d)),b.setAttribute("y2",String(f)),b.setAttribute("stroke","#cccccc"),b.setAttribute("stroke-opacity","0.25"),o.appendChild(b);let m=document.createElementNS(o.namespaceURI,"text");m.setAttribute("x",String(h-4)),m.setAttribute("y",String(f+3)),m.setAttribute("text-anchor","end"),m.setAttribute("font-size","10"),m.setAttribute("fill","#111111"),m.textContent=String(Math.round(l)),o.appendChild(m)}let nt=z>0?R/z:R;M.forEach((N,l)=>{let f=h+nt*(l+.5),b=String(N.label),m=document.createElementNS(o.namespaceURI,"text");m.setAttribute("x",String(f)),m.setAttribute("y",String(_-I+12)),m.setAttribute("text-anchor","middle"),m.setAttribute("font-size","10"),m.setAttribute("fill","#111111"),m.textContent=b,o.appendChild(m)});let Y=t.createDiv({cls:"chart-notes-legend"});H.forEach((N,l)=>{let f=Y.createDiv({cls:"chart-notes-legend-item"}),b=f.createDiv();b.style.width="10px",b.style.height="10px",b.style.borderRadius="999px",b.style.backgroundColor=dt(N,l),f.createSpan({text:N})}),M.forEach((N,l)=>{let f=h+nt*(l+.5),b=nt*.6,m=f-b/2,x=0;H.forEach((j,v)=>{let J=N.rows.find(tt=>(tt.series!=null?String(tt.series):"")===j);if(!J)return;let G=J.y,K=x,O=x+G;x=O;let X=Q(K),rt=Q(O),it=Math.max(2,X-rt),ot=dt(j,v),P=document.createElementNS(o.namespaceURI,"rect");P.setAttribute("x",String(m)),P.setAttribute("y",String(rt)),P.setAttribute("width",String(b)),P.setAttribute("height",String(it)),P.setAttribute("fill",ot),P.setAttribute("stroke","rgba(0,0,0,0.25)"),P.setAttribute("stroke-width","0.5"),P.style.cursor="pointer";let q=`${j} @ ${String(N.label)}`,at=`valor: ${Math.round(G*100)/100}`;P.addEventListener("mouseenter",tt=>Rt(t,u,q,at,J.notes?.length??0,tt)),P.addEventListener("mouseleave",()=>Tt(u)),P.addEventListener("click",tt=>{tt.preventDefault(),Lt(t,C,q,G,J.notes??[],a)}),o.appendChild(P)})})}renderLine(t,e,s,n){let r=e.options??{},a=r.background,g=r.drilldown??!0,p=s.rows??[];if(!p.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:o,svg:u,tooltip:C,details:S}=Nt(t,a),D=t.getBoundingClientRect().width||600,h=Math.max(D,480);o.style.width=h+"px";let d=40,y=16,I=18,_=24,R=At;u.setAttribute("height",String(R));let w=h-d-y,T=R-I-_,E=new Map;for(let l of p){let f=l.series!=null?String(l.series):"__default__",b=E.get(f)??[];b.push(l),E.set(f,b)}let M=Array.from(E.keys()),z=[],F=new Set;for(let l of p){let f=String(l.x);F.has(f)||(F.add(f),z.push(l.x))}let H=z.length||1,k=l=>{let f=String(l),b=z.findIndex(m=>String(m)===f);return b<0?d:H===1?d+w/2:d+b/(H-1)*w},Q=l=>String(l),$=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY;for(let l of p)l.y<$&&($=l.y),l.y>W&&(W=l.y);(!isFinite($)||!isFinite(W))&&($=0,W=1),$===W&&($===0?W=1:$=0);let nt=l=>I+T-(l-$)/(W-$||1)*T,Y=4;for(let l=0;l<=Y;l++){let f=$+(W-$)*l/Y,b=nt(f),m=document.createElementNS(u.namespaceURI,"line");m.setAttribute("x1",String(d)),m.setAttribute("y1",String(b)),m.setAttribute("x2",String(h-y)),m.setAttribute("y2",String(b)),m.setAttribute("stroke","#cccccc"),m.setAttribute("stroke-opacity","0.25"),u.appendChild(m);let x=document.createElementNS(u.namespaceURI,"text");x.setAttribute("x",String(d-4)),x.setAttribute("y",String(b+3)),x.setAttribute("text-anchor","end"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=Math.abs(f)>=100?String(Math.round(f)):String(Math.round(f*10)/10),u.appendChild(x)}let N=M.filter(l=>l!=="__default__");if(N.length>1){let l=t.createDiv({cls:"chart-notes-legend"});N.forEach((f,b)=>{let m=f,x=l.createDiv({cls:"chart-notes-legend-item"}),j=x.createDiv();j.style.width="10px",j.style.height="10px",j.style.borderRadius="999px",j.style.backgroundColor=dt(m,b),x.createSpan({text:m})})}M.forEach((l,f)=>{let b=E.get(l);if(!b?.length)return;let m=dt(l==="__default__"?"line":l,f),x=[...b].sort((v,J)=>{let G=z.findIndex(O=>String(O)===String(v.x)),K=z.findIndex(O=>String(O)===String(J.x));return G-K}),j="";if(x.forEach((v,J)=>{let G=k(v.x),K=nt(v.y);j+=(J===0?"M ":" L ")+G+" "+K}),n){let v=x[0],J=x[x.length-1],G=k(v.x),K=k(J.x),O=nt($);j+=` L ${K} ${O} L ${G} ${O} Z`;let X=document.createElementNS(u.namespaceURI,"path");X.setAttribute("d",j),X.setAttribute("fill",m),X.setAttribute("fill-opacity","0.18"),X.setAttribute("stroke",m),X.setAttribute("stroke-width","1.5"),u.appendChild(X)}else{let v=document.createElementNS(u.namespaceURI,"path");v.setAttribute("d",j),v.setAttribute("fill","none"),v.setAttribute("stroke",m),v.setAttribute("stroke-width","2"),u.appendChild(v)}x.forEach(v=>{let J=k(v.x),G=nt(v.y),K=document.createElementNS(u.namespaceURI,"circle");K.setAttribute("cx",String(J)),K.setAttribute("cy",String(G)),K.setAttribute("r","3"),K.setAttribute("fill","#ffffff"),K.setAttribute("stroke",m),K.setAttribute("stroke-width","1.5"),K.style.cursor="pointer";let O=Q(v.x),X=l==="__default__"?"":String(v.series),rt=X?`${X} @ ${O}`:O,it=`valor: ${Math.round(v.y*100)/100}`;K.addEventListener("mouseenter",ot=>Rt(t,C,rt,it,v.notes?.length??0,ot)),K.addEventListener("mouseleave",()=>Tt(C)),K.addEventListener("click",ot=>{ot.preventDefault(),Lt(t,S,rt,v.y,v.notes??[],g)}),u.appendChild(K)})})}renderPie(t,e,s){let{background:n,drilldown:r=!0}=e.options??{};if(s.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let a=ve(n)?"#000000":void 0,g=t.getBoundingClientRect().width||600,{inner:p,svg:o,tooltip:u,details:C}=Nt(t,n),S=Math.max(g,420);p.style.width=S+"px",a&&(o.style.color=a);let D=At,h=S/2,d=(D-Mt+Ot)/2,y=Math.min(S/2-20,D/2-20),_=s.rows.map(w=>Math.max(0,w.y)).reduce((w,T)=>w+T,0)||1,R=-Math.PI/2;s.rows.forEach((w,T)=>{let E=w.x instanceof Date?w.x.toISOString().slice(0,10):String(w.x),M=w.y,z=M/_*Math.PI*2,F=h+y*Math.cos(R),H=d+y*Math.sin(R),k=h+y*Math.cos(R+z),Q=d+y*Math.sin(R+z),$=z>Math.PI?1:0,W=document.createElementNS(o.namespaceURI,"path"),nt=[`M ${h} ${d}`,`L ${F} ${H}`,`A ${y} ${y} 0 ${$} 1 ${k} ${Q}`,"Z"].join(" ");W.setAttribute("d",nt),W.setAttribute("fill",dt(w.series??E,T)),W.style.cursor="pointer",W.addEventListener("mouseenter",Y=>Rt(t,u,E,M,w.notes?.length??0,Y)),W.addEventListener("mouseleave",()=>Tt(u)),W.addEventListener("click",()=>Lt(t,C,E,M,w.notes??[],r)),o.appendChild(W),R+=z})}renderScatter(t,e,s){let{background:n,drilldown:r=!0}=e.options??{};if(s.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let a=ve(n)?"#000000":void 0,g=t.getBoundingClientRect().width||600,{inner:p,svg:o,tooltip:u,details:C}=Nt(t,n),S=Math.max(g,700);p.style.width=S+"px",a&&(o.style.color=a);let D=At,h=S-_t-se,d=D-Ot-Mt,y=s.rows.map(k=>{let Q=k.x;if(Q instanceof Date)return Q.getTime();if(typeof Q=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(Q)){let W=new Date(Q);if(!isNaN(W.getTime()))return W.getTime()}let $=Number(Q);return isNaN($)?null:$}return typeof Q=="number"?Q:null}),I=s.rows.map(k=>k.y),_=y.filter(k=>k!==null);if(_.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let R=Math.min(..._),w=Math.max(..._),T=Math.min(...I),E=Math.max(...I),M=k=>_t+(k-R)/(w-R||1)*h,z=k=>D-Mt-(k-T)/(E-T||1)*d,F=document.createElementNS(o.namespaceURI,"line");F.setAttribute("x1",String(_t)),F.setAttribute("y1",String(Ot)),F.setAttribute("x2",String(_t)),F.setAttribute("y2",String(D-Mt)),F.setAttribute("stroke","currentColor"),o.appendChild(F);let H=document.createElementNS(o.namespaceURI,"line");H.setAttribute("x1",String(_t)),H.setAttribute("y1",String(D-Mt)),H.setAttribute("x2",String(S-se)),H.setAttribute("y2",String(D-Mt)),H.setAttribute("stroke","currentColor"),o.appendChild(H),s.rows.forEach((k,Q)=>{let $=y[Q];if($==null)return;let W=M($),nt=z(I[Q]),Y=document.createElementNS(o.namespaceURI,"circle");Y.setAttribute("cx",String(W)),Y.setAttribute("cy",String(nt)),Y.setAttribute("r","4"),Y.setAttribute("fill",dt(k.series,Q)),Y.style.cursor="pointer";let N=k.x instanceof Date?k.x.toISOString().slice(0,10):typeof k.x=="string"?k.x:String(k.x);Y.addEventListener("mouseenter",l=>Rt(t,u,N,k.y,k.notes?.length??0,l)),Y.addEventListener("mouseleave",()=>Tt(u)),Y.addEventListener("click",()=>Lt(t,C,N,k.y,k.notes??[],r)),o.appendChild(Y)})}renderTable(t,e,s){let{background:n}=e.options??{},{inner:r}=Nt(t,n),a=r.createEl("table",{cls:"chart-notes-table"}),p=a.createEl("thead").createEl("tr");p.createEl("th",{text:"X"}),p.createEl("th",{text:"Y"}),p.createEl("th",{text:"Notas"});let o=a.createEl("tbody");for(let u of s.rows){let C=o.createEl("tr");C.createEl("td",{text:u.x instanceof Date?u.x.toISOString().slice(0,10):String(u.x)}),C.createEl("td",{text:String(u.y)});let S=C.createEl("td");for(let D of u.notes??[])S.createEl("a",{text:D,href:"#"}).addEventListener("click",d=>{d.preventDefault(),app.workspace.openLinkText(D,"",!1)}),S.createSpan({text:" "})}}renderGantt(t,e,s,n){let r=e.options??{},a=r.background,g=r.drilldown??!0,p=!0,o=c=>{if(c==null)return"";let A=String(c).trim();if(!A)return"";let L=A.match(/^\[\[(.+?)\]\]$/);L&&(A=L[1]);let B=A.lastIndexOf("/");return B>=0&&B<A.length-1&&(A=A.slice(B+1)),A};if(Array.from(t.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(c=>c.remove()),s.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let u=s.rows.filter(c=>c.start&&c.end);if(u.length===0){t.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let C=e.encoding,S=C.group,D=C.duration,h=(c,A)=>{if(!c||!A)return;let L=c[A];return Array.isArray(L)?L[0]:L},y=u.map(c=>{let A=c.start,L=c.end,B=c.props,Et=typeof c.x=="string"?c.x:c.x instanceof Date?zt(A):String(c.x),mt=o(Et),pt,Dt=S?h(B,S):void 0;Dt!=null?pt=String(Dt):c.series!=null?pt=String(c.series):pt=mt;let lt=c.notes?.[0],xt=lt?lt.replace(/\.md$/i,"").split("/").pop()??lt:mt,yt=c.due,Ct,vt=h(B,D);if(vt!=null){let ht=Number(vt);Number.isNaN(ht)||(Ct=ht)}return{row:c,start:A,end:L,props:B,fullName:mt,groupKey:pt,notePath:lt,noteTitle:xt,due:yt,estMinutes:Ct}}).filter(c=>c.start instanceof Date&&!isNaN(c.start.getTime())&&c.end instanceof Date&&!isNaN(c.end.getTime()));if(y.length===0){t.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}y.sort((c,A)=>{if(c.groupKey<A.groupKey)return-1;if(c.groupKey>A.groupKey)return 1;let L=c.start.getTime(),B=A.start.getTime();return L!==B?L-B:c.fullName.localeCompare(A.fullName)});let I=26,_=0,R=null;for(let c of y)c.groupKey!==R&&(R=c.groupKey,_+=1),_+=1;let w=Math.min(...y.map(c=>c.start.getTime())),T=Math.max(...y.map(c=>c.end.getTime()));if(!isFinite(w)||!isFinite(T)){t.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let E=24*60*60*1e3,M=c=>{let A=new Date(c);return A.setHours(0,0,0,0),A.getTime()},z=M(w),F=M(T),H=t.querySelector(".prop-charts-title-row");H||(H=t.createDiv({cls:"prop-charts-title-row"}));let k=t.dataset.ganttZoomMode||r.zoomMode||"100";t.dataset.ganttZoomMode=k;let Q=t.dataset.ganttLabelMode||r.labelMode||"compact";t.dataset.ganttLabelMode=Q;let $=H.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(c=>{let A=$.createEl("button",{cls:"gantt-zoom-btn",text:c.label});c.id===k&&A.addClass("is-active"),A.addEventListener("click",L=>{L.preventDefault(),t.dataset.ganttZoomMode=c.id,this.renderGantt(t,e,s,n)})}),$.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",c=>{c.preventDefault();let A=t.querySelector(".chart-notes-zoom-button");A&&A.click()});let Y=Number(r.labelWidth),N=!Number.isNaN(Y)&&Y>120?Y:260,l=t.dataset.ganttLabelMode||"compact",f=l==="wide"?N+160:N,b=t.getBoundingClientRect().width||600,m=Math.max(b,820),x;if(k==="fit")x=b;else{let c=Number(k)/100||1;x=m*c}let{inner:j,svg:v,tooltip:J,details:G}=Nt(t,a);j.style.width=x+"px";let K=(c,A,L,B,Et,mt,pt,Dt,lt)=>{if(!c)return;let xt=Math.max(40,B-8),Ct=Math.max(8,Math.floor(xt/6)),vt=c.split(/\s+/),ht=[],ut="";for(let bt of vt){if(!ut){ut=bt;continue}(ut+" "+bt).length<=Ct?ut+=" "+bt:(ht.push(ut),ut=bt)}ut&&ht.push(ut);let St=Et+2,Ft=ht.length*St,$t=L-Ft/2+Et;ht.forEach((bt,Kt)=>{let et=document.createElementNS(v.namespaceURI,"text");et.setAttribute("x",String(A)),et.setAttribute("y",String($t+Kt*St)),et.setAttribute("text-anchor","start"),et.setAttribute("font-size",String(Et)),et.setAttribute("fill","#111111"),mt&&et.setAttribute("font-weight",mt),et.textContent=bt,pt&&et.addEventListener("mouseenter",Z=>pt(Z)),Dt&&et.addEventListener("mouseleave",()=>Dt()),lt&&(et.style.cursor="pointer",et.addEventListener("click",Z=>lt(Z))),v.appendChild(et)})},O=Ot,X=Mt,rt=se,it=Math.max(At,O+X+_*I+24);v.setAttribute("height",String(it));let ot=x-f-rt,P=O+6;v.style.color="#111111";let q=F+E-z||1,at=z-q*.02,tt=F+E+q*.08,ct=c=>f+(c-at)/(tt-at)*ot,Se=(tt-at)/E,we=Math.max(4,Math.min(12,Math.floor(ot/90)||4)),Ae=Se/we,jt=[1,2,3,5,7,10,14,21,30,60,90,180,365],oe=jt[jt.length-1];for(let c of jt)if(c>=Ae){oe=c;break}let ae=[],Ee=M(at);for(let c=Ee;c<=tt+.5*E;c+=oe*E)ae.push(c);let It=document.createElementNS(v.namespaceURI,"line");It.setAttribute("x1",String(f)),It.setAttribute("y1",String(P)),It.setAttribute("x2",String(x-rt)),It.setAttribute("y2",String(P)),It.setAttribute("stroke","#111111"),v.appendChild(It);for(let c of ae){let A=ct(c),L=document.createElementNS(v.namespaceURI,"line");L.setAttribute("x1",String(A)),L.setAttribute("y1",String(P)),L.setAttribute("x2",String(A)),L.setAttribute("y2",String(it-X)),L.setAttribute("stroke","#111111"),L.setAttribute("stroke-opacity","0.20"),L.setAttribute("stroke-dasharray","2,4"),v.appendChild(L);let B=document.createElementNS(v.namespaceURI,"text");B.setAttribute("x",String(A)),B.setAttribute("y",String(P-4)),B.setAttribute("text-anchor","middle"),B.setAttribute("font-size","10"),B.setAttribute("fill","#111111"),B.textContent=zt(new Date(c)),v.appendChild(B)}let ce=new Date;ce.setHours(0,0,0,0);let Vt=ce.getTime();if(Vt>=at&&Vt<=tt){let c=ct(Vt),A=document.createElementNS(v.namespaceURI,"line");A.setAttribute("x1",String(c)),A.setAttribute("y1",String(P)),A.setAttribute("x2",String(c)),A.setAttribute("y2",String(it-X)),A.setAttribute("stroke","#4caf50"),A.setAttribute("stroke-width","2"),A.setAttribute("stroke-dasharray","4,2"),v.appendChild(A);let L=document.createElementNS(v.namespaceURI,"text");L.setAttribute("x",String(c+4)),L.setAttribute("y",String(P+12)),L.setAttribute("font-size","10"),L.setAttribute("fill","#4caf50"),L.textContent="hoje",v.appendChild(L)}let Wt=j.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Wt.setAttr("title",l==="wide"?"Compactar nomes":"Expandir nomes"),Wt.style.left=`${f}px`,Wt.style.top="4px",Wt.addEventListener("click",c=>{c.preventDefault();let L=(t.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";t.dataset.ganttLabelMode=L,this.renderGantt(t,e,s,n)});let De=["status","priority"],Zt=Array.isArray(r.tooltipFields)?r.tooltipFields.map(c=>String(c)):null,Ce=Zt&&Zt.length?Zt:De,Pt=0,Jt=null;for(let c of y){let A=c.start,L=c.end,B=(L.getTime()-A.getTime())/6e4,Et=c.props,mt=c.notePath,pt=c.noteTitle,Dt=c.row.notes?.length??0,lt=c.due,xt=c.estMinutes,yt=[];yt.push(`${zt(A)} \u2192 ${zt(L)}`),typeof xt=="number"&&!Number.isNaN(xt)?yt.push(`est: ${Math.round(xt)} min`):B>0&&yt.push(`dura\xE7\xE3o: ${Math.round(B)} min`),lt instanceof Date&&yt.push(`due: ${zt(lt)}`);for(let V of Ce){let U=h(Et,V);U!=null&&String(U).trim()!==""&&yt.push(`${V}: ${String(U)}`)}let Ct=yt.join("<br>"),vt=V=>{V.preventDefault(),p&&mt?new re(mt,e,n?.refresh,n?.reindexFile).open():Lt(t,G,pt,xt??B,c.row.notes??[],g)},ht=V=>{pt&&Ct&&Rt(t,J,pt,Ct,Dt,V)},ut=()=>Tt(J);if(c.groupKey!==Jt){Jt=c.groupKey;let V=P+8+Pt*I+I/2,U=o(Jt);K(U,4,V,f-12,11,"600"),Pt+=1}let St=P+8+Pt*I,Ft=I-10,$t=ct(A.getTime()),bt=ct(L.getTime()),Kt=Math.max(4,bt-$t),et=c.fullName,Z=document.createElementNS(v.namespaceURI,"rect");Z.setAttribute("x",String($t)),Z.setAttribute("y",String(St)),Z.setAttribute("width",String(Kt)),Z.setAttribute("height",String(Ft)),Z.setAttribute("rx","3"),Z.setAttribute("ry","3"),Z.setAttribute("fill",dt(c.row.series??et,Pt)),Z.setAttribute("stroke","rgba(0,0,0,0.25)"),Z.setAttribute("stroke-width","0.5"),Z.style.cursor=p&&mt?"pointer":"default",Z.addEventListener("mouseenter",ht),Z.addEventListener("mouseleave",ut),Z.addEventListener("click",vt),v.appendChild(Z);let le=St+Ft/2;if(Kt>=6){let V=dt(c.row.series??et,Pt),U=document.createElementNS(v.namespaceURI,"circle");U.setAttribute("cx",String($t)),U.setAttribute("cy",String(le)),U.setAttribute("r","3.5"),U.setAttribute("fill","#ffffff"),U.setAttribute("stroke",V),U.setAttribute("stroke-width","1.5"),v.appendChild(U);let wt=document.createElementNS(v.namespaceURI,"circle");wt.setAttribute("cx",String(bt)),wt.setAttribute("cy",String(le)),wt.setAttribute("r","3.5"),wt.setAttribute("fill","#ffffff"),wt.setAttribute("stroke",V),wt.setAttribute("stroke-width","1.5"),v.appendChild(wt)}let ue=St+Ft/2+2,Ht=S?16:4;if(l==="wide")K(et,Ht,ue,f-Ht-4,11,null,ht,ut,vt);else{let V=et,U=Math.max(40,f-Ht-8),de=Math.max(8,Math.floor(U/6));V.length>de&&(V=V.slice(0,de-1)+"\u2026");let ft=document.createElementNS(v.namespaceURI,"text");ft.setAttribute("x",String(Ht)),ft.setAttribute("y",String(ue)),ft.setAttribute("text-anchor","start"),ft.setAttribute("font-size","11"),ft.setAttribute("fill","#111111"),ft.textContent=V,ft.style.cursor="pointer",ft.addEventListener("mouseenter",ht),ft.addEventListener("mouseleave",ut),ft.addEventListener("click",vt),v.appendChild(ft)}if(lt instanceof Date){let V=ct(lt.getTime()),U=document.createElementNS(v.namespaceURI,"line");U.setAttribute("x1",String(V)),U.setAttribute("y1",String(St)),U.setAttribute("x2",String(V)),U.setAttribute("y2",String(St+Ft)),U.setAttribute("stroke","#ff6b6b"),U.setAttribute("stroke-width","2"),U.setAttribute("stroke-dasharray","4,2"),v.appendChild(U)}Pt+=1}if(p){let c=t.createDiv({cls:"prop-charts-empty"});c.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}},re=class extends gt.Modal{constructor(t,e,s,n){super(app),this.notePath=t,this.spec=e,this.refresh=s,this.reindexFile=n;let r=e.encoding??{};this.startKey=r.start,this.endKey=r.end,this.durationKey=r.duration,this.dueKey=r.due}async onOpen(){let{contentEl:t}=this;t.empty();let e=this.app.vault.getAbstractFileByPath(this.notePath);if(!(e instanceof gt.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let s=await this.app.vault.read(e),n={},r=s,a=/^---\n([\s\S]*?)\n---\n?/m.exec(s);if(a){try{n=(0,gt.parseYaml)(a[1])??{}}catch{n={}}r=s.slice(a[0].length)}(typeof n!="object"||n==null)&&(n={});let g=this.notePath.replace(/\.md$/i,"").split("/").pop()??this.notePath,p=t.createDiv({cls:"gantt-edit-header"}),o=p.createEl("a",{text:g,cls:"gantt-edit-title"});o.href="#",o.addEventListener("click",E=>{E.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let u=p.createDiv({cls:"gantt-edit-subtitle"});u.textContent=this.notePath;let C=t.createDiv({cls:"gantt-edit-form"}),S=E=>{let M=C.createDiv({cls:"gantt-edit-row"}),z=M.createDiv({cls:"gantt-edit-label"});z.textContent=E;let F=M.createDiv({cls:"gantt-edit-field"});return{row:M,field:F}},D=E=>{if(!E)return"";let z=String(E).match(/^(\d{4}-\d{2}-\d{2})/);return z?z[1]:""},h=E=>{if(E=E.trim(),!!E&&/^\d{4}-\d{2}-\d{2}$/.test(E))return E},d=null;if(this.startKey){let{field:E}=S(this.startKey+" (in\xEDcio)");d=E.createEl("input",{type:"date"}),d.value=D(n[this.startKey])}let y=null;if(this.endKey){let{field:E}=S(this.endKey+" (fim)");y=E.createEl("input",{type:"date"}),y.value=D(n[this.endKey])}let I=null;if(this.durationKey){let{field:E}=S(this.durationKey+" (minutos)");I=E.createEl("input",{type:"number"});let M=n[this.durationKey];I.value=M!=null?String(M):"",I.min="0",I.step="5"}let _=null;if(this.dueKey){let{field:E}=S(this.dueKey+" (due)");_=E.createEl("input",{type:"date"}),_.value=D(n[this.dueKey])}let R=t.createDiv({cls:"gantt-edit-buttons"}),w=R.createEl("button",{text:"Salvar",cls:"mod-cta"});R.createEl("button",{text:"Cancelar"}).addEventListener("click",E=>{E.preventDefault(),this.close()}),w.addEventListener("click",async E=>{if(E.preventDefault(),this.startKey&&d){let F=h(d.value);F?n[this.startKey]=F:delete n[this.startKey]}if(this.endKey&&y){let F=h(y.value);F?n[this.endKey]=F:delete n[this.endKey]}if(this.durationKey&&I){let F=I.value.trim();if(F==="")delete n[this.durationKey];else{let H=Number(F);Number.isNaN(H)||(n[this.durationKey]=H)}}if(this.dueKey&&_){let F=h(_.value);F?n[this.dueKey]=F:delete n[this.dueKey]}let z=`---
${(0,gt.stringifyYaml)(n).trim()}
---
`+r;if(await this.app.vault.modify(e,z),this.reindexFile)try{this.reindexFile(this.notePath)}catch{}if(this.refresh)try{this.refresh()}catch{}new gt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}},ie=class extends gt.Modal{constructor(e,s,n,r){super(app);this.size="large";this.spec=e,this.data=s,this.renderer=n,this.ctx=r}onOpen(){let{contentEl:e}=this;e.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),e.addClass("chart-notes-zoom-modal"),this.applySize();let s=e.createDiv({cls:"chart-notes-zoom-header"}),n=this.spec.options?.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";s.createEl("div",{text:n,cls:"chart-notes-zoom-title"});let r=s.createDiv({cls:"chart-notes-zoom-sizes"}),a=(p,o)=>{let u=r.createEl("button",{cls:"chart-notes-zoom-size-btn",text:p});(()=>{u.toggleClass("is-active",this.size===o)})(),u.addEventListener("click",S=>{S.preventDefault(),this.size=o,this.applySize(),r.querySelectorAll(".chart-notes-zoom-size-btn").forEach(h=>h.classList.remove("is-active")),u.classList.add("is-active")})};a("S","small"),a("M","medium"),a("L","large");let g=e.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(g,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let e=this.modalEl;if(!e)return;let s="95vw",n="85vh";switch(this.size){case"small":s="60vw",n="55vh";break;case"medium":s="80vw",n="70vh";break;case"large":default:s="95vw",n="85vh";break}e.style.maxWidth=s,e.style.width=s,e.style.height=n,e.style.maxHeight=n}};var Xt=class extends qt.Plugin{constructor(t,e){super(t,e)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new Qt(this.app),await this.indexer.buildIndex(),this.query=new Yt(()=>this.indexer.getAll(),[]),this.renderer=new Gt,this.registerEvent(this.app.vault.on("modify",async t=>{await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{this.indexer.removeFile(t)})),this.registerMarkdownCodeBlockProcessor("chart",async(t,e,s)=>{let n;try{let o=(0,qt.parseYaml)(t);if(!o||typeof o!="object"){e.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}n=o}catch(o){e.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+o.message});return}if(!n.type){e.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let r=n.type==="gantt",a=n.type==="table";if(!r&&!a){if(!n.encoding||!n.encoding.x){e.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let u=n.aggregate?.y==="count";if(!n.encoding.y&&!u){e.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}n.encoding||(n.encoding={}),n.source||(n.source={});let p;try{p=this.query.run(n)}catch(o){e.createEl("div",{text:"Chart Notes: erro na query: "+o.message});return}this.renderer.render(e,n,p)})}onunload(){console.log("unloading Chart Notes plugin")}};
