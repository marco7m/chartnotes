/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var xe=Object.defineProperty;var Ke=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Oe=Object.prototype.hasOwnProperty;var Xe=(s,r)=>{for(var t in r)xe(s,t,{get:r[t],enumerable:!0})},ze=(s,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let e of We(r))!Oe.call(s,e)&&e!==t&&xe(s,e,{get:()=>r[e],enumerable:!(n=Ke(r,e))||n.enumerable});return s};var qe=s=>ze(xe({},"__esModule",{value:!0}),s);var fn={};Xe(fn,{default:()=>be});module.exports=qe(fn);var Jt=require("obsidian");var ue=require("obsidian"),Se="chartnotes-view",je=["bar","stacked-bar","line","stacked-area","pie","scatter","gantt"];function Ze(s){let r=String(s!=null?s:"bar").trim().toLowerCase();return je.includes(r)?r:"bar"}var Je=["sum","count","cumulative-sum"];function tn(s){let r=String(s!=null?s:"sum").trim().toLowerCase();return Je.includes(r)?r:"sum"}var en=["auto","none","day","week","month","quarter","year"];function nn(s){let r=String(s!=null?s:"auto").trim().toLowerCase();return en.includes(r)?r:"auto"}var ce="(missing)",le=class extends ue.BasesView{constructor(t,n,e){super(t);this.type=Se;this.renderer=e,this.rootEl=n.createDiv("chartnotes-bases-view")}onDataUpdated(){var F,et,it;this.rootEl.empty();let t=this.data,n=(F=t==null?void 0:t.groupedData)!=null?F:[];if(!n.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let e=this.config,o=Ze((et=e==null?void 0:e.get("chartType"))!=null?et:"bar"),i=o==="pie",d=o==="scatter",a=o==="gantt",c=tn(e==null?void 0:e.get("aggregateMode")),N=c==="cumulative-sum"&&!(o==="line"||o==="stacked-area")?"sum":c,y=nn(e==null?void 0:e.get("xBucket")),f=i||d||a?"none":y,g=this.getPropFromConfig("xProperty"),w=this.getPropFromConfig("ganttLabelProperty"),L=this.getPropFromConfig("yProperty"),b=this.getPropFromConfig("seriesProperty");i&&(b={id:null,name:null});let I=this.getPropFromConfig("startProperty"),P=this.getPropFromConfig("endProperty"),T=this.getPropFromConfig("dueProperty"),q=this.getPropFromConfig("durationProperty"),K=this.getPropFromConfig("groupProperty");if(!a&&!g.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / category' property in view options."});return}if(d&&(!g.id||!L.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(a&&!(I.id||P.id||T.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt needs Start/End or Due with Duration."});return}let x=a&&w.id?w:a?g:{id:null,name:null},E;if(a)E=this.buildRowsForGantt(n,x,b,I,P,T,q,K);else if(d)E=this.buildRowsForScatter(n,g,L,b);else{let m=i;E=this.buildRowsForAggregatedCharts(n,g,L,b,N,f,m)}if(!E.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let p={rows:E},u=((it=e==null?void 0:e.get("title"))!=null?it:"").trim()||(e==null?void 0:e.name)||"Chart Notes (Bases)",M=e==null?void 0:e.get("drilldown"),V=typeof M=="boolean"?M:!0,U=this.buildEncoding({x:g,y:L,series:b,start:I,end:P,due:T,duration:q,group:K,label:x,aggMode:N,xBucket:f,chartType:o}),Y={type:o,source:{type:"properties",query:""},encoding:U,options:{title:u,drilldown:V}},$={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,Y,p,$)}getPropFromConfig(t){var d,a;let n=this.config,e=(d=n==null?void 0:n.get)==null?void 0:d.call(n,t);if(!e)return{id:null,name:null};let o=e.trim();if(!o||o==="undefined"||o==="null")return{id:null,name:null};let i=o;try{let c=(0,ue.parsePropertyId)(i);return{id:i,name:(a=c.name)!=null?a:i}}catch(c){return{id:i,name:i}}}readValue(t,n){if(!n.id)return null;let e;try{e=t.getValue(n.id)}catch(o){return null}if(!e)return null;try{if(typeof e.isEmpty=="function"&&e.isEmpty())return null}catch(o){}try{let o=e.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let n=new Date(t.trim());return Number.isNaN(n.getTime())?null:n}compareX(t,n){let e=this.parseDate(t!=null?String(t):null),o=this.parseDate(n!=null?String(n):null);if(e&&o)return e.getTime()-o.getTime();let i=Number(t),d=Number(n);return!Number.isNaN(i)&&!Number.isNaN(d)?i-d:String(t!=null?t:"").localeCompare(String(n!=null?n:""))}fmtDate(t){let n=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${n}-${e}-${o}`}startOfWeek(t){let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e=(n.getDay()+6)%7;return n.setDate(n.getDate()-e),n.setHours(0,0,0,0),n}bucketX(t,n){let e=this.parseDate(t);if(!e)return t;switch(n){case"none":return t;case"auto":case"day":return this.fmtDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()));case"week":{let o=this.startOfWeek(e);return`${this.fmtDate(o)} (W)`}case"month":{let o=String(e.getMonth()+1).padStart(2,"0");return`${e.getFullYear()}-${o}`}case"quarter":{let o=Math.floor(e.getMonth()/3)+1;return`${e.getFullYear()}-Q${o}`}case"year":return`${e.getFullYear()}`;default:return t}}getXValuesForEntry(t,n,e,o){var S,N;let i=[],d=y=>this.bucketX(y,e);if(!n.id){let y=t.file,f=y!=null&&y.name?String(y.name):String((S=y==null?void 0:y.path)!=null?S:ce);return i.push(d(f)),i}if(!o){let y=(N=this.readValue(t,n))!=null?N:ce;return i.push(d(y)),i}let a=null;try{a=t.getValue(n.id)}catch(y){a=null}let c=y=>{if(!y)return;let f=String(y).trim();f&&i.push(d(f))};if(a==null)c(ce);else if(typeof a=="string"){let y=a.trim();if(y){let f=y.split(/\s+/);for(let g of f)c(g)}}else if(Array.isArray(a))for(let y of a){if(y==null)continue;let f;try{f=y.toString()}catch(g){continue}c(f)}else if(typeof a.toArray=="function"){let y=a.toArray();if(Array.isArray(y))for(let f of y){if(f==null)continue;let g;try{g=f.toString()}catch(w){continue}c(g)}else{let f;try{f=a.toString()}catch(g){f=""}c(f)}}else{let y;try{y=a.toString()}catch(f){y=""}c(y)}return i.length||c(ce),i}buildRowsForAggregatedCharts(t,n,e,o,i,d,a){let c=new Map,S=a||i==="count"||!e.id&&i!=="sum",N=e.name||"y";for(let f of t)for(let g of f.entries){let w=g.file,L=this.getXValuesForEntry(g,n,d,a),b=1,I=null;if(!S&&e.id){if(I=this.readValue(g,e),I==null)continue;let q=Number(I);if(Number.isNaN(q))continue;b=q}else b=1;let P=this.readValue(g,o),T=P!=null?String(P):void 0;for(let q of L){let K=`${q}@@${T!=null?T:""}`,x=c.get(K);x||(x={x:q,y:0,series:T,notes:[],props:{}},c.set(K,x)),x.y+=b,w!=null&&w.path&&x.notes.push(w.path),x.props&&n.name&&(x.props[n.name]=q),!S&&x.props&&N&&I!=null&&(x.props[N]=x.y),S&&x.props&&(x.props[N]=x.y),x.props&&o.name&&P!=null&&(x.props[o.name]=P)}}let y=Array.from(c.values());return i==="cumulative-sum"?this.toCumulative(y):y}toCumulative(t){var o,i;let n=new Map;for(let d of t){let a=(o=d.series)!=null?o:"__no_series__",c=n.get(a);c||(c=[],n.set(a,c)),c.push(d)}let e=[];for(let[,d]of n){let a=[...d].sort((S,N)=>this.compareX(S.x,N.x)),c=0;for(let S of a){let N=Number((i=S.y)!=null?i:0);Number.isNaN(N)||(c+=N,e.push({...S,y:c}))}}return e.sort((d,a)=>this.compareX(d.x,a.x)),e}buildRowsForScatter(t,n,e,o){let i=[];for(let d of t)for(let a of d.entries){let c=a.file,S=this.readValue(a,n),N=this.readValue(a,e);if(S==null||N==null)continue;let y=Number(S),f=Number(N);if(Number.isNaN(y)||Number.isNaN(f))continue;let g=this.readValue(a,o),w=g!=null?String(g):void 0;i.push({x:y,y:f,series:w,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,n,e,o,i,d,a,c){var L;let S=[],f=b=>{let I=[b==null?void 0:b.label,b==null?void 0:b.name,b==null?void 0:b.value,b==null?void 0:b.key,b==null?void 0:b.group,b==null?void 0:b.groupLabel];for(let P of I)if(P!=null&&String(P).trim()!=="")return String(P);return""},g=n;try{let b=this.getPropFromConfig("ganttLabelProperty");b&&b.id&&(g=b)}catch(b){}let w=!!c.id;for(let b of t){let I=f(b);for(let P of(L=b.entries)!=null?L:[]){let T=P.file,q=this.readValue(P,o),K=this.readValue(P,i),x=this.readValue(P,d),E=this.readValue(P,a),p=E!=null?Number(E):NaN,A=Number.isFinite(p)&&p>0,u=A?p*6e4:36e5,M=this.parseDate(q),V=this.parseDate(K),U=this.parseDate(x),Y=M,$=V;if(Y&&!$&&($=new Date(Y.getTime()+u)),!Y&&$&&(Y=new Date($.getTime()-u)),!Y&&!$&&U&&(A?($=U,Y=new Date(U.getTime()-u)):(Y=U,$=new Date(U.getTime()+36e5))),!Y||!$)continue;if(Y.getTime()>$.getTime()){let l=Y;Y=$,$=l}let F=this.readValue(P,g);(F==null||String(F).trim()==="")&&(T!=null&&T.name?F=String(T.name).replace(/\.md$/i,""):T!=null&&T.path?F=String(T.path):F="(sem t\xEDtulo)");let et=this.readValue(P,e),it=et!=null?String(et):void 0,m={};if(I&&(m.__basesGroup=I),w){let l=this.readValue(P,c);l!=null&&c.name&&(m[c.name]=l)}g.name&&(m[g.name]=F),m.label=F,o.name&&q!=null&&(m[o.name]=q),i.name&&K!=null&&(m[i.name]=K),d.name&&x!=null&&(m[d.name]=x),A&&a.name&&(m[a.name]=p);let Q=T==null?void 0:T.path;S.push({x:F,y:0,series:it,start:Y,end:$,due:U!=null?U:void 0,notes:Q?[Q]:[],props:m})}}return S.sort((b,I)=>!b.start||!I.start?0:b.start.getTime()-I.start.getTime()),S}buildEncoding(t){var d,a,c,S,N,y,f,g,w,L,b;let n=(d=t.x.name)!=null?d:"x",e=(a=t.y.name)!=null?a:"y",o=(N=(S=(c=t.label.name)!=null?c:t.x.name)!=null?S:t.group.name)!=null?N:"label",i=t.chartType==="gantt"?"__basesGroup":(y=t.group.name)!=null?y:"group";return{x:n,y:e,series:(f=t.series.name)!=null?f:"series",start:(g=t.start.name)!=null?g:"start",end:(w=t.end.name)!=null?w:"end",due:(L=t.due.name)!=null?L:"due",duration:(b=t.duration.name)!=null?b:"duration",group:i,label:o}}};var Pe=require("obsidian"),de=class{constructor(r){this.index=new Map;this.app=r}async buildIndex(){this.index.clear();let r=this.app.vault.getMarkdownFiles();for(let t of r)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(r){if(r.extension!=="md")return;let t={};try{let e=(await this.app.vault.read(r)).match(/^---\n([\s\S]*?)\n---\n?/);if(e){let i=(0,Pe.parseYaml)(e[1])||{};if(i&&typeof i=="object")for(let[d,a]of Object.entries(i))d!=="position"&&(t[d]=a)}let o=this.app.metadataCache.getFileCache(r);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",r.path,n)}this.index.set(r.path,{path:r.path,props:t})}removeFile(r){this.index.delete(r.path)}};function _e(s,r){if(!r||r.length===0)return!0;for(let t of r){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function Fe(s,r){if(!r||r.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let e of r)if(t.includes(e)||t.includes("#"+e))return!0;return!1}let n=String(t);for(let e of r)if(n===e||n==="#"+e)return!0;return!1}function me(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function qt(s){if(s instanceof Date&&!isNaN(s.getTime()))return s;if(typeof s!="string")return null;let r=s.trim(),t=r.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(t){let e=Number(t[1]),o=Number(t[2])-1,i=Number(t[3]),d=t[4]?Number(t[4]):0,a=t[5]?Number(t[5]):0,c=t[6]?Number(t[6]):0;return Number.isNaN(e)||Number.isNaN(o)||Number.isNaN(i)||Number.isNaN(d)||Number.isNaN(a)||Number.isNaN(c)?null:new Date(e,o,i,d,a,c,0)}let n=new Date(r);return isNaN(n.getTime())?null:n}function St(s){let r=new Date(s);return r.setHours(0,0,0,0),r}function pe(s,r){let t=new Date(s);return t.setDate(t.getDate()-r),t}function rn(s,r){return pe(s,r*7)}function sn(s,r){let t=new Date(s);return t.setMonth(t.getMonth()-r),t}function we(s,r){let t=new Date(s);return t.setDate(t.getDate()+r),t}function on(s,r){return we(s,r*7)}function an(s,r){let t=new Date(s);return t.setMonth(t.getMonth()+r),t}function Le(s){let r=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(r)||r.endsWith("date")||r.endsWith("at")||r.endsWith("on"))}function Ie(s,r){let t=r?new Date(r):new Date,n=St(t),e=s.trim().toLowerCase();if(e==="today")return n;if(e==="yesterday")return St(pe(n,1));if(/^-\d+$/.test(e)){let o=parseInt(e.slice(1),10);return St(pe(n,o))}if(/^-\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(pe(n,o))}if(/^-\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(rn(n,o))}if(/^-\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(sn(n,o))}if(/^\+\d+$/.test(e)){let o=parseInt(e.slice(1),10);return St(we(n,o))}if(/^\+\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(we(n,o))}if(/^\+\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(on(n,o))}if(/^\+\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return St(an(n,o))}return null}function $e(s){let r=s.trim(),t=r.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let S=t[1].trim(),N=t[2].trim(),y=t[3].trim(),f=Le(S),g=Ae(N,f),w=Ae(y,f),L=g.valueType==="date"||w.valueType==="date"?"date":g.valueType;return{field:S,op:"between",value:g.value,value2:w.value,valueType:L}}let n=/(==|!=|>=|<=|>|<)/,e=r.split(n);if(e.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+s);let o=e[0].trim(),i=e[1].trim(),d=e[2].trim(),a=Le(o),c=Ae(d,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function Ae(s,r){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),e=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(r){if(t==="0"||n==="today")return{value:St(new Date),valueType:"date"};let i=Ie(t);if(i)return{value:i,valueType:"date"}}else if(e){let i=Ie(t);if(i)return{value:i,valueType:"date"}}if(me(t)){let i=qt(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Ve(s,r){let t=s[r.field];if(t==null)return!1;if(r.valueType==="date"){let o=t instanceof Date?St(t):me(t)?St(qt(t)):null;if(!o)return!1;let i=r.value instanceof Date?r.value:null,d=r.value2 instanceof Date?r.value2:null;if(!i)return!1;let a=o.getTime(),c=St(i).getTime();switch(r.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!d)return!1;let S=St(d).getTime();return a>=c&&a<=S}}if(r.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(r.value);switch(r.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof r.value2!="number"?!1:o>=i&&o<=r.value2}}let n=String(t),e=String(r.value);switch(r.op){case"==":return n===e;case"!=":return n!==e;case">":return n>e;case">=":return n>=e;case"<":return n<e;case"<=":return n<=e;case"between":return!1}}function cn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(me(s)){let r=qt(s);if(r)return{key:r,isDate:!0}}return{key:s,isDate:!1}}function ln(s,r){let t=s.x,n=r.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let e=String(t),o=String(n);return e<o?-1:e>o?1:0}function un(s,r){var o,i;let t=ln(s,r);if(t!==0)return t;let n=(o=s.series)!=null?o:"",e=(i=r.series)!=null?i:"";return n<e?-1:n>e?1:0}function dn(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let r=s.trim().match(/^(\d+)/);if(r){let t=Number(r[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(s)}`)}function pn(s){var n,e;let r=new Map,t=[];for(let o of s){let i=(n=o.series)!=null?n:"__no_series__",a=((e=r.get(i))!=null?e:0)+o.y;r.set(i,a),t.push({...o,y:a})}return t}function mn(s,r){var i,d;let t=dn(r);if(!t||t<=1)return[...s];let n=new Map,e=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:"__no_series__",S=n.get(c);S||(S=[],n.set(c,S));let N=(d=e.get(c))!=null?d:0;if(S.push(a.y),N+=a.y,S.length>t){let g=S.shift();N-=g}e.set(c,N);let y=S.length||1,f=N/y;o.push({...a,y:f})}return o}var fe=class{constructor(r,t){this.getIndex=r,this.defaultPaths=t}run(r){var i,d,a;let t=this.getIndex(),n=(i=r.source)!=null&&i.paths&&r.source.paths.length?r.source.paths:this.defaultPaths,e=(d=r.source)!=null&&d.tags&&r.source.tags.length?r.source.tags:[],o=[];for(let c of t){let S=n&&n.length?_e(c.path,n):!0,N=e&&e.length?Fe(c.props,e):!0;if(!S||!N)continue;let y=!0;if((a=r.source)!=null&&a.where&&r.source.where.length>0)for(let f of r.source.where){let g;try{g=$e(f)}catch(w){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${f} (${w.message})`)}if(!Ve(c.props,g)){y=!1;break}}y&&o.push(c)}return r.type==="gantt"?this.runGantt(r,o):r.type==="table"?this.runTable(r,o):this.runStandard(r,o)}runTable(r,t){var e,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(e=r.encoding)==null?void 0:e.x,yField:(o=r.encoding)==null?void 0:o.y}}runGantt(r,t){var N,y,f;let n=(N=r.encoding)!=null?N:{},e=n.start,o=n.end,i=(y=n.label)!=null?y:n.x,d=n.series,a=n.duration,c=n.due,S=[];for(let g of t){let w=(f=g.props)!=null?f:{},L=x=>Array.isArray(x)?x[0]:x,b=null;if(o){let x=L(w[o]),E=qt(x);E&&(b=E)}if(!b)continue;let I=null;if(e){let x=L(w[e]),E=qt(x);E&&(I=E)}if(!I&&a){let x=L(w[a]),E=Number(x);Number.isNaN(E)||(I=new Date(b.getTime()-E*6e4))}I||(I=new Date(b.getTime()));let P;if(c){let x=L(w[c]),E=qt(x);E&&(P=E)}let T;if(i){let x=L(w[i]);(x==null||x==="")&&(x=g.path),T=x}else T=g.path;let q;if(d){let x=L(w[d]);x!=null&&(q=String(x))}let K={x:T,y:0,notes:[g.path],series:q,start:I,end:b,props:w};P&&(K.due=P),S.push(K)}return S.sort((g,w)=>{let L=g.start?g.start.getTime():0,b=w.start?w.start.getTime():0;return L-b}),{rows:S,xField:i,yField:o}}runStandard(r,t){var g,w,L,b,I,P,T,q,K,x;let n=(g=r.encoding)==null?void 0:g.x,e=(w=r.encoding)==null?void 0:w.y,o=(L=r.encoding)==null?void 0:L.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(b=r.aggregate)!=null?b:{},d=(I=i.y)!=null?I:null,a=!!i.cumulative,c=i.rolling;if(!e&&d!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let S=[];for(let E of t){let p=(P=E.props)!=null?P:{},A=F=>Array.isArray(F)?F[0]:F,u=A(p[n]);if(u==null)continue;let M=cn(u),V=M.key,U=M.isDate,Y;if(o){let F=A(p[o]);F!=null&&String(F).trim()!==""&&(Y=String(F))}let $;if(d==="count")$=1;else{let F=A(p[e]);if(F==null)continue;let et=Number(F);if(Number.isNaN(et))continue;$=et}S.push({x:V,y:$,notes:[E.path],series:Y,props:p,_isDate:U,_origX:u})}if(S.length===0)return{rows:[],xField:n,yField:e};let N=[];if(d){let E=new Map;for(let p of S){let A=(T=p.series)!=null?T:"",u=p.x instanceof Date?p.x.toISOString().slice(0,10):String(p.x),M=A+"||"+u,V=(q=E.get(M))!=null?q:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:p.x,isDate:p._isDate,series:p.series,props:p.props};V.sum+=p.y,V.count+=1,p.y<V.min&&(V.min=p.y),p.y>V.max&&(V.max=p.y),V.notes.push(...p.notes),V.props=(K=p.props)!=null?K:V.props,E.set(M,V)}for(let[,p]of E){let A=p.sum;switch(d){case"sum":A=p.sum;break;case"avg":A=p.sum/p.count;break;case"min":A=p.min;break;case"max":A=p.max;break;case"count":A=p.count;break}N.push({x:p.xRep,y:A,notes:p.notes,series:p.series,props:p.props})}}else N=S.map(E=>({x:E.x,y:E.y,notes:E.notes,series:E.series,props:E.props}));if(N.length===0)return{rows:[],xField:n,yField:e};let y=((x=r.sort)==null?void 0:x.x)==="desc"?"desc":"asc";if(N.sort((E,p)=>{let A=un(E,p);return y==="asc"?A:-A}),(a||c)&&!(r.type==="line"||r.type==="stacked-area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'stacked-area'.");if(a&&c)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let f=N;return c?f=mn(N,c):a&&(f=pn(N)),{rows:f,xField:n,yField:e}}};var _t=require("obsidian");var Be=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ht(s,r){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,e)=>n*33+e.charCodeAt(0)>>>0,0);return Be[t%Be.length]}function kt(s,r){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,r&&(n.style.background=r);let e="http://www.w3.org/2000/svg",o=document.createElementNS(e,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let d=s.createDiv({cls:"chart-notes-details"});return d.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:d}}function Et(s,r,t,n,e,o){let i=s.getBoundingClientRect(),d=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);r.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${d}</div>
    <div class="chart-notes-tooltip-notes">${e} nota${e===1?"":"s"}</div>
  `,r.style.display="block";let a=r.getBoundingClientRect(),c=o.clientX-i.left+6,S=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),S+a.height>i.height-4&&(S=i.height-a.height-4),S<4&&(S=4),r.style.left=c+"px",r.style.top=S+"px"}function Nt(s){s.style.display="none"}function Tt(s,r,t,n,e,o){if(!o)return;if(r.empty(),!e||e.length===0){r.style.display="none";return}r.style.display="block";let i=r.createEl("div",{cls:"chart-notes-details-header"}),d=i.createEl("div",{cls:"chart-notes-details-title"});d.textContent=`Notas em "${t}" (${e.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{r.style.display="none"});let c=r.createEl("ul",{cls:"chart-notes-details-list"});for(let S of e){let y=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:S});y.href="#",y.addEventListener("click",f=>{f.preventDefault(),app.workspace.openLinkText(S,"",!1)})}}function Pt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let r=s.getUTCDate().toString().padStart(2,"0"),t=(s.getUTCMonth()+1).toString().padStart(2,"0");return`${r}/${t}`}function Ge(s){if(!s)return!1;let r=s.trim().toLowerCase();if(r==="#fff"||r==="#ffffff"||r==="white")return!0;if(!r.startsWith("#"))return!1;let t,n,e;if(r.length===4)t=parseInt(r[1]+r[1],16),n=parseInt(r[2]+r[2],16),e=parseInt(r[3]+r[3],16);else if(r.length===7)t=parseInt(r.slice(1,3),16),n=parseInt(r.slice(3,5),16),e=parseInt(r.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*e)/255>.7}var ve=class extends _t.Modal{constructor(t,n,e,o){var d;super(app);this.notePath=t,this.spec=n,this.refresh=e,this.reindexFile=o;let i=(d=n.encoding)!=null?d:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var x,E;let{contentEl:t}=this;t.empty(),this.titleEl.setText("Editar tarefa");let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof _t.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}this.titleEl.setText(`Editar tarefa \u2013 ${n.basename}`);let e=await this.app.vault.read(n),o={},i=e,d=e.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);if(d){try{o=(x=(0,_t.parseYaml)(d[1]))!=null?x:{}}catch(p){o={}}i=(E=d[2])!=null?E:""}let a=t.createDiv({cls:"gantt-edit-form"}),c=p=>{let A=a.createDiv({cls:"gantt-edit-row"}),u=A.createDiv({cls:"gantt-edit-label"});u.textContent=p;let M=A.createDiv({cls:"gantt-edit-field"});return{row:A,field:M}},S=p=>{if(!p)return null;if(p instanceof Date&&!isNaN(p.getTime()))return p;let u=String(p).trim().match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!u)return null;let M=Number(u[1]),V=Number(u[2])-1,U=Number(u[3]),Y=u[4]?Number(u[4]):0,$=u[5]?Number(u[5]):0,F=u[6]?Number(u[6]):0;return Number.isNaN(M)||Number.isNaN(V)||Number.isNaN(U)||Number.isNaN(Y)||Number.isNaN($)||Number.isNaN(F)?null:new Date(M,V,U,Y,$,F,0)},N=p=>{let A=S(p);if(!A)return"";let u=F=>F.toString().padStart(2,"0"),M=A.getFullYear(),V=u(A.getMonth()+1),U=u(A.getDate()),Y=u(A.getHours()),$=u(A.getMinutes());return`${M}-${V}-${U}T${Y}:${$}`},y=p=>{if(p=p.trim(),!p)return;let A=p.match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2}))?$/);if(!A)return;let u=`${A[1]}-${A[2]}-${A[3]}`;if(A[4]){let M=A[4],V=A[5];return`${u}T${M}:${V}`}return u},f=null,g=null,w=null,L=null;if(this.startKey){let{field:p}=c(`In\xEDcio (${this.startKey})`);f=p.createEl("input"),f.type="datetime-local",f.value=N(o[this.startKey])}if(this.endKey){let{field:p}=c(`Fim (${this.endKey})`);g=p.createEl("input"),g.type="datetime-local",g.value=N(o[this.endKey])}if(this.durationKey){let{field:p}=c(`Dura\xE7\xE3o (min) (${this.durationKey})`);w=p.createEl("input"),w.type="number";let A=o[this.durationKey];w.value=typeof A=="number"&&!Number.isNaN(A)?String(A):""}if(this.dueKey){let{field:p}=c(`Due (${this.dueKey})`);L=p.createEl("input"),L.type="datetime-local",L.value=N(o[this.dueKey])}let b=a.createDiv({cls:"gantt-edit-actions-row"});b.style.marginTop="0.75rem",b.style.display="flex",b.style.justifyContent="space-between",b.style.alignItems="center";let I=b.createDiv({cls:"gantt-edit-actions-left"});I.style.display="flex";let P=b.createDiv({cls:"gantt-edit-actions-right"});P.style.display="flex",P.style.gap="0.5rem";let T=I.createEl("button",{text:"Abrir nota"}),q=P.createEl("button",{text:"Salvar"}),K=P.createEl("button",{text:"Cancelar"});T.addEventListener("click",()=>{this.app.workspace.openLinkText(this.notePath,"",!1),this.close()}),K.addEventListener("click",()=>this.close()),q.addEventListener("click",async()=>{if(this.startKey&&f){let u=y(f.value);u?o[this.startKey]=u:delete o[this.startKey]}if(this.endKey&&g){let u=y(g.value);u?o[this.endKey]=u:delete o[this.endKey]}if(this.durationKey&&w){let u=w.value.trim();if(u==="")delete o[this.durationKey];else{let M=Number(u);Number.isNaN(M)||(o[this.durationKey]=M)}}if(this.dueKey&&L){let u=y(L.value);u?o[this.dueKey]=u:delete o[this.dueKey]}let A=`---
${(0,_t.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,A),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(u){}if(this.refresh)try{this.refresh()}catch(u){}new _t.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function he(s,r,t,n){var te,ee,Kt,Wt,ne,Ne,Te,ke;let e=(te=r.options)!=null?te:{},o=e.background,i=(ee=e.drilldown)!=null?ee:!0,d=!0,a=h=>{if(h==null)return"";let O=String(h).trim();if(!O)return"";let j=O.match(/^\[\[(.+?)\]\]$/);j&&(O=j[1]);let lt=O.lastIndexOf("/");return lt>=0&&lt<O.length-1&&(O=O.slice(lt+1)),O};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(h=>h.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let c=t.rows.filter(h=>h.start&&h.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let S=r.encoding,N=S.group,y=S.duration,f=(h,O)=>{if(!h||!O)return;let j=h[O];return Array.isArray(j)?j[0]:j},g="__chartnotes_no_group__",L=c.map(h=>{var xt,Rt;let O=h.start,j=h.end,lt=h.props,zt=typeof h.x=="string"?h.x:h.x instanceof Date?Pt(O):String(h.x),Vt=a(zt),It=N!=null&&N!==""?f(lt,N):void 0,Bt=It!=null&&String(It).trim().length>0?String(It):g,Dt=(xt=h.notes)==null?void 0:xt[0],Gt=Dt?(Rt=Dt.replace(/\.md$/i,"").split("/").pop())!=null?Rt:Dt:Vt,jt=h.due,Ot,Ct=f(lt,y);if(Ct!=null){let Ht=Number(Ct);Number.isNaN(Ht)||(Ot=Ht)}return{row:h,start:O,end:j,props:lt,fullName:Vt,groupKey:Bt,notePath:Dt,noteTitle:Gt,due:jt,estMinutes:Ot}}).filter(h=>h.start instanceof Date&&!isNaN(h.start.getTime())&&h.end instanceof Date&&!isNaN(h.end.getTime()));if(L.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}L.sort((h,O)=>{if(h.groupKey<O.groupKey)return-1;if(h.groupKey>O.groupKey)return 1;let j=h.start.getTime(),lt=O.start.getTime();return j!==lt?j-lt:h.fullName.localeCompare(O.fullName)});let b=26,I=0,P=null;for(let h of L)h.groupKey!==P&&(P=h.groupKey,h.groupKey!==g&&(I+=1)),I+=1;let T=Math.min(...L.map(h=>h.start.getTime())),q=Math.max(...L.map(h=>h.end.getTime()));if(!isFinite(T)||!isFinite(q)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let K=24*60*60*1e3,x=h=>{let O=new Date(h);return O.setHours(0,0,0,0),O.getTime()},E=x(T),p=x(q),A=s.querySelector(".prop-charts-title-row");A||(A=s.createDiv({cls:"prop-charts-title-row"}));let u=s.dataset.ganttZoomMode||String((Kt=e.zoomMode)!=null?Kt:"100");s.dataset.ganttZoomMode=u;let M=s.dataset.ganttLabelMode||String((Wt=e.labelMode)!=null?Wt:"compact");s.dataset.ganttLabelMode=M;let V=A.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(h=>{let O=V.createEl("button",{cls:"gantt-zoom-btn",text:h.label});h.id===u&&O.addClass("is-active"),O.addEventListener("click",j=>{j.preventDefault(),s.dataset.ganttZoomMode=h.id,he(s,r,t,n)})});let Y=Number(e.labelWidth),$=!Number.isNaN(Y)&&Y>120?Y:260,F=M==="wide"?$+160:$,et=s.getBoundingClientRect().width||600,it=Math.max(et,820),m;if(u==="fit")m=et;else{let h=Number(u)/100||1;m=it*h}let{inner:Q,svg:l,tooltip:D,details:R}=kt(s,o);Q.style.width=m+"px";let W=(h,O,j,lt,zt,Vt,It,re,Bt)=>{if(!h)return;let Dt=Math.max(40,lt-8),jt=Math.max(8,Math.floor(Dt/6)),Ot=h.split(/\s+/),Ct=[],xt="";for(let Ut of Ot){if(!xt){xt=Ut;continue}(xt+" "+Ut).length<=jt?xt+=" "+Ut:(Ct.push(xt),xt=Ut)}xt&&Ct.push(xt);let Rt=zt+2,Ht=Ct.length*Rt,se=j-Ht/2+zt;Ct.forEach((Ut,ie)=>{let yt=document.createElementNS(l.namespaceURI,"text");yt.setAttribute("x",String(O)),yt.setAttribute("y",String(se+ie*Rt)),yt.setAttribute("text-anchor","start"),yt.setAttribute("font-size",String(zt)),yt.setAttribute("fill","#111111"),Vt&&yt.setAttribute("font-weight",Vt),yt.textContent=Ut,It&&yt.addEventListener("mouseenter",gt=>It(gt)),re&&yt.addEventListener("mouseleave",()=>re()),Bt&&(yt.style.cursor="pointer",yt.addEventListener("click",gt=>Bt(gt))),l.appendChild(yt)})},C=28,ct=28,rt=10,J=Math.max(300,C+ct+I*b+24);l.setAttribute("height",String(J));let v=m-F-rt,k=C+6;l.style.color="#111111";let G=p+K-E||1,B=E-G*.02,z=p+K+G*.08,Z=h=>F+(h-B)/(z-B)*v,X=(z-B)/K,_=Math.max(4,Math.min(12,Math.floor(v/90)||4)),tt=X/_,nt=[1,2,3,5,7,10,14,21,30,60,90,180,365],at=nt[nt.length-1];for(let h of nt)if(h>=tt){at=h;break}let dt=[],At=x(B);for(let h=At;h<=z+.5*K;h+=at*K)dt.push(h);let wt=document.createElementNS(l.namespaceURI,"line");wt.setAttribute("x1",String(F)),wt.setAttribute("y1",String(k)),wt.setAttribute("x2",String(m-rt)),wt.setAttribute("y2",String(k)),wt.setAttribute("stroke","#111111"),l.appendChild(wt);for(let h of dt){let O=Z(h),j=document.createElementNS(l.namespaceURI,"line");j.setAttribute("x1",String(O)),j.setAttribute("y1",String(k)),j.setAttribute("x2",String(O)),j.setAttribute("y2",String(J-ct)),j.setAttribute("stroke","#111111"),j.setAttribute("stroke-opacity","0.20"),j.setAttribute("stroke-dasharray","2,4"),l.appendChild(j);let lt=document.createElementNS(l.namespaceURI,"text");lt.setAttribute("x",String(O)),lt.setAttribute("y",String(k-4)),lt.setAttribute("text-anchor","middle"),lt.setAttribute("font-size","10"),lt.setAttribute("fill","#111111"),lt.textContent=Pt(new Date(h)),l.appendChild(lt)}let Yt=new Date;Yt.setHours(0,0,0,0);let pt=Yt.getTime();if(pt>=B&&pt<=z){let h=Z(pt),O=document.createElementNS(l.namespaceURI,"line");O.setAttribute("x1",String(h)),O.setAttribute("y1",String(k)),O.setAttribute("x2",String(h)),O.setAttribute("y2",String(J-ct)),O.setAttribute("stroke","#4caf50"),O.setAttribute("stroke-width","2"),O.setAttribute("stroke-dasharray","4,2"),l.appendChild(O);let j=document.createElementNS(l.namespaceURI,"text");j.setAttribute("x",String(h+4)),j.setAttribute("y",String(k+12)),j.setAttribute("font-size","10"),j.setAttribute("fill","#4caf50"),j.textContent="hoje",l.appendChild(j)}let st=Q.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});st.setAttr("title",M==="wide"?"Compactar nomes":"Expandir nomes"),st.style.left=`${F}px`,st.style.top="4px",st.addEventListener("click",h=>{h.preventDefault();let j=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=j,he(s,r,t,n)});let ut=["status","priority"],mt=Array.isArray(e.tooltipFields)?e.tooltipFields.map(h=>String(h)):null,vt=mt&&mt.length?mt:ut,bt=0,$t=null;for(let h of L){let O=h.start,j=h.end,lt=(j.getTime()-O.getTime())/6e4,zt=h.props,Vt=h.notePath,It=h.noteTitle,re=(Ne=(ne=h.row.notes)==null?void 0:ne.length)!=null?Ne:0,Bt=h.due,Dt=h.estMinutes,Gt=[];Gt.push(`${Pt(O)} \u2192 ${Pt(j)}`),typeof Dt=="number"&&!Number.isNaN(Dt)?Gt.push(`est: ${Math.round(Dt)} min`):lt>0&&Gt.push(`dura\xE7\xE3o: ${Math.round(lt)} min`),Bt instanceof Date&&Gt.push(`due: ${Pt(Bt)}`);for(let ft of vt){let ot=f(zt,ft);ot!=null&&String(ot).trim()!==""&&Gt.push(`${ft}: ${String(ot)}`)}let jt=Gt.join("<br>"),Ot=ft=>{var ot;ft.preventDefault(),d&&Vt?new ve(Vt,r,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():Tt(s,R,It,Dt!=null?Dt:lt,(ot=h.row.notes)!=null?ot:[],i)},Ct=ft=>{It&&jt&&Et(s,D,It,jt,re,ft)},xt=()=>Nt(D);if(h.groupKey!==$t&&($t=h.groupKey,$t!==g)){let ft=k+8+bt*b+b/2,ot=a($t);W(ot,4,ft,F-12,11,"600"),bt+=1}let Rt=k+8+bt*b,Ht=b-10,se=Z(O.getTime()),Ut=Z(j.getTime()),ie=Math.max(4,Ut-se),yt=h.fullName,gt=document.createElementNS(l.namespaceURI,"rect");gt.setAttribute("x",String(se)),gt.setAttribute("y",String(Rt)),gt.setAttribute("width",String(ie)),gt.setAttribute("height",String(Ht)),gt.setAttribute("rx","3"),gt.setAttribute("ry","3"),gt.setAttribute("fill",ht((Te=h.row.series)!=null?Te:yt,bt)),gt.setAttribute("stroke","rgba(0,0,0,0.25)"),gt.setAttribute("stroke-width","0.5"),gt.style.cursor=d&&Vt?"pointer":"default",gt.addEventListener("mouseenter",Ct),gt.addEventListener("mouseleave",xt),gt.addEventListener("click",Ot),l.appendChild(gt);let Ce=Rt+Ht/2;if(ie>=6){let ft=ht((ke=h.row.series)!=null?ke:yt,bt),ot=document.createElementNS(l.namespaceURI,"circle");ot.setAttribute("cx",String(se)),ot.setAttribute("cy",String(Ce)),ot.setAttribute("r","3.5"),ot.setAttribute("fill","#ffffff"),ot.setAttribute("stroke",ft),ot.setAttribute("stroke-width","1.5"),l.appendChild(ot);let Xt=document.createElementNS(l.namespaceURI,"circle");Xt.setAttribute("cx",String(Ut)),Xt.setAttribute("cy",String(Ce)),Xt.setAttribute("r","3.5"),Xt.setAttribute("fill","#ffffff"),Xt.setAttribute("stroke",ft),Xt.setAttribute("stroke-width","1.5"),l.appendChild(Xt)}let Re=Rt+Ht/2+2,ae=4;if(M==="wide")W(yt,ae,Re,F-ae-4,11,null,Ct,xt,Ot);else{let ft=yt,ot=Math.max(40,F-ae-8),Me=Math.max(8,Math.floor(ot/6));ft.length>Me&&(ft=ft.slice(0,Me-1)+"\u2026");let Mt=document.createElementNS(l.namespaceURI,"text");Mt.setAttribute("x",String(ae)),Mt.setAttribute("y",String(Re)),Mt.setAttribute("text-anchor","start"),Mt.setAttribute("font-size","11"),Mt.setAttribute("fill","#111111"),Mt.textContent=ft,Mt.style.cursor="pointer",Mt.addEventListener("mouseenter",Ct),Mt.addEventListener("mouseleave",xt),Mt.addEventListener("click",Ot),l.appendChild(Mt)}if(Bt instanceof Date){let ft=Z(Bt.getTime()),ot=document.createElementNS(l.namespaceURI,"line");ot.setAttribute("x1",String(ft)),ot.setAttribute("y1",String(Rt)),ot.setAttribute("x2",String(ft)),ot.setAttribute("y2",String(Rt+Ht)),ot.setAttribute("stroke","#ff6b6b"),ot.setAttribute("stroke-width","2"),ot.setAttribute("stroke-dasharray","4,2"),l.appendChild(ot)}bt+=1}if(d){let h=s.createDiv({cls:"prop-charts-empty"});h.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function De(s,r,t){var et,it,m,Q;let n=(et=r.options)!=null?et:{},e=n.background,o=(it=n.drilldown)!=null?it:!0,i=(m=t.rows)!=null?m:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:d,svg:a,tooltip:c,details:S}=kt(s,e),N=s.getBoundingClientRect().width||600,y=Math.max(N,480);d.style.width=y+"px";let f=40,g=16,w=18,L=28,b=300;a.setAttribute("height",String(b));let I=y-f-g,P=b-w-L,T=new Map;for(let l of i){let D=String(l.x),R=(Q=T.get(D))!=null?Q:{label:l.x,rows:[]};R.rows.push(l),T.set(D,R)}let K=Array.from(T.keys()).sort((l,D)=>l<D?-1:l>D?1:0).map(l=>T.get(l)),x=K.length,E=l=>String(l!=null?l:""),p=new Set;i.forEach(l=>{l.series!=null&&p.add(E(l.series))});let A=Array.from(p),u=A.length>1,M=u?"grouped":"single",V=0;i.forEach(l=>{l.y>V&&(V=l.y)}),(!isFinite(V)||V<=0)&&(V=1);let U=l=>w+P-l/(V||1)*P,Y=U(0),$=4;for(let l=0;l<=$;l++){let D=V*l/$,R=U(D),W=document.createElementNS(a.namespaceURI,"line");W.setAttribute("x1",String(f)),W.setAttribute("y1",String(R)),W.setAttribute("x2",String(y-g)),W.setAttribute("y2",String(R)),W.setAttribute("stroke","#cccccc"),W.setAttribute("stroke-opacity","0.25"),a.appendChild(W);let C=document.createElementNS(a.namespaceURI,"text");C.setAttribute("x",String(f-4)),C.setAttribute("y",String(R+3)),C.setAttribute("text-anchor","end"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=String(Math.round(D)),a.appendChild(C)}let F=x>0?I/x:I;if(K.forEach((l,D)=>{let R=f+F*(D+.5),W=String(l.label),C=document.createElementNS(a.namespaceURI,"text");C.setAttribute("x",String(R)),C.setAttribute("y",String(b-L+12)),C.setAttribute("text-anchor","middle"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=W,a.appendChild(C)}),u){let l=s.createDiv({cls:"chart-notes-legend"});A.forEach((D,R)=>{let W=l.createDiv({cls:"chart-notes-legend-item"}),C=W.createDiv();C.style.width="10px",C.style.height="10px",C.style.borderRadius="999px",C.style.backgroundColor=ht(D,R),W.createSpan({text:D})})}K.forEach((l,D)=>{let R=f+F*(D+.5),W=l.rows;if(M==="single"){let v=W[0],k=v.y,G=F*.6,B=R-G/2,z=U(k),Z=Math.max(2,Y-z),X=ht("bar",D),H=document.createElementNS(a.namespaceURI,"rect");H.setAttribute("x",String(B)),H.setAttribute("y",String(z)),H.setAttribute("width",String(G)),H.setAttribute("height",String(Z)),H.setAttribute("fill",X),H.setAttribute("stroke","rgba(0,0,0,0.25)"),H.setAttribute("stroke-width","0.5"),H.style.cursor="pointer";let _=String(l.label),tt=`valor: ${Math.round(k*100)/100}`;H.addEventListener("mouseenter",nt=>{var at,dt;return Et(s,c,_,tt,(dt=(at=v.notes)==null?void 0:at.length)!=null?dt:0,nt)}),H.addEventListener("mouseleave",()=>Nt(c)),H.addEventListener("click",nt=>{var at;nt.preventDefault(),Tt(s,S,_,k,(at=v.notes)!=null?at:[],o)}),a.appendChild(H);return}let C=A.length,ct=F/Math.max(C+1,2),rt=C*ct,J=R-rt/2;A.forEach((v,k)=>{let G=W.find(at=>at.series!=null&&E(at.series)===v);if(!G)return;let B=G.y,z=J+k*ct,Z=U(B),X=Math.max(2,Y-Z),H=ht(v,k),_=document.createElementNS(a.namespaceURI,"rect");_.setAttribute("x",String(z)),_.setAttribute("y",String(Z)),_.setAttribute("width",String(ct)),_.setAttribute("height",String(X)),_.setAttribute("fill",H),_.setAttribute("stroke","rgba(0,0,0,0.25)"),_.setAttribute("stroke-width","0.5"),_.style.cursor="pointer";let tt=`${v} @ ${String(l.label)}`,nt=`valor: ${Math.round(B*100)/100}`;_.addEventListener("mouseenter",at=>{var dt,At;return Et(s,c,tt,nt,(At=(dt=G.notes)==null?void 0:dt.length)!=null?At:0,at)}),_.addEventListener("mouseleave",()=>Nt(c)),_.addEventListener("click",at=>{var dt;at.preventDefault(),Tt(s,S,tt,B,(dt=G.notes)!=null?dt:[],o)}),a.appendChild(_)})})}function He(s,r,t){var $,F,et,it;let n=($=r.options)!=null?$:{},e=n.background,o=(F=n.drilldown)!=null?F:!0,i=(et=t.rows)!=null?et:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let d=new Map;for(let m of i){let Q=String(m.x),l=(it=d.get(Q))!=null?it:{label:m.x,rows:[]};l.rows.push(m),d.set(Q,l)}let c=Array.from(d.keys()).sort((m,Q)=>m<Q?-1:m>Q?1:0).map(m=>d.get(m)),S=c.length,N=m=>String(m!=null?m:""),y=new Set(i.map(m=>N(m.series))),f=Array.from(y);if(f.length===1&&f[0]===""){De(s,r,t);return}let{inner:g,svg:w,tooltip:L,details:b}=kt(s,e),I=s.getBoundingClientRect().width||600,P=Math.max(I,480);g.style.width=P+"px",w.setAttribute("width",String(P));let T=40,q=16,K=18,x=28,E=300;w.setAttribute("height",String(E));let p=P-T-q,A=E-K-x,u=0;c.forEach(m=>{let Q=m.rows.reduce((l,D)=>l+(D.y||0),0);Q>u&&(u=Q)}),(!isFinite(u)||u<=0)&&(u=1);let M=m=>K+A-m/(u||1)*A,V=4;for(let m=0;m<=V;m++){let Q=u*m/V,l=M(Q),D=document.createElementNS(w.namespaceURI,"line");D.setAttribute("x1",String(T)),D.setAttribute("y1",String(l)),D.setAttribute("x2",String(P-q)),D.setAttribute("y2",String(l)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),w.appendChild(D);let R=document.createElementNS(w.namespaceURI,"text");R.setAttribute("x",String(T-4)),R.setAttribute("y",String(l+3)),R.setAttribute("text-anchor","end"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=String(Math.round(Q)),w.appendChild(R)}let U=S>0?p/S:p;c.forEach((m,Q)=>{let l=T+U*(Q+.5),D=String(m.label),R=document.createElementNS(w.namespaceURI,"text");R.setAttribute("x",String(l)),R.setAttribute("y",String(E-x+12)),R.setAttribute("text-anchor","middle"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=D,w.appendChild(R)});let Y=g.createDiv({cls:"chart-notes-legend"});f.forEach((m,Q)=>{if(m==="")return;let l=Y.createDiv({cls:"chart-notes-legend-item"}),D=l.createDiv();D.style.width="10px",D.style.height="10px",D.style.borderRadius="999px",D.style.backgroundColor=ht(m,Q),l.createSpan({text:m})}),c.forEach((m,Q)=>{let l=T+U*(Q+.5),D=U*.6,R=l-D/2,W=0;f.forEach((C,ct)=>{if(C==="")return;let rt=m.rows.find(tt=>N(tt.series)===C);if(!rt)return;let J=rt.y||0,v=W,k=W+J;W=k;let G=M(v),B=M(k),z=Math.max(2,G-B),Z=ht(C,ct),X=document.createElementNS(w.namespaceURI,"rect");X.setAttribute("x",String(R)),X.setAttribute("y",String(B)),X.setAttribute("width",String(D)),X.setAttribute("height",String(z)),X.setAttribute("fill",Z),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let H=`${C} @ ${String(m.label)}`,_=`valor: ${Math.round(J*100)/100}`;X.addEventListener("mouseenter",tt=>{var nt,at;return Et(s,L,H,_,(at=(nt=rt.notes)==null?void 0:nt.length)!=null?at:0,tt)}),X.addEventListener("mouseleave",()=>Nt(L)),X.addEventListener("click",tt=>{var nt;tt.preventDefault(),Tt(s,b,H,J,(nt=rt.notes)!=null?nt:[],o)}),w.appendChild(X)})})}function Ft(s){if(!s)return null;if(s instanceof Date){let r=s.getTime();return Number.isNaN(r)?null:s}if(typeof s=="string"){let r=s.trim();if(!r||/^\d+$/.test(r))return null;let t=new Date(r);if(!Number.isNaN(t.getTime()))return t}return null}function Ee(s,r,t,n){var $,F,et,it;let e=($=r.options)!=null?$:{},o=e.background,i=(F=e.drilldown)!=null?F:!0,d=(et=t.rows)!=null?et:[];if(!d.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:c,tooltip:S,details:N}=kt(s,o),y=s.getBoundingClientRect().width||600,f=Math.max(y,480);a.style.width=f+"px";let g=40,w=16,L=18,b=28,I=300;c.setAttribute("height",String(I));let P=f-g-w,T=I-L-b,q=d.map(m=>Ft(m.x)).filter(m=>!!m),K=q.length>=2&&q.length>=d.length*.6,x=new Map;for(let m of d){let Q=m.series!=null&&m.series!==""?String(m.series):"__default__",l=(it=x.get(Q))!=null?it:[];l.push(m),x.set(Q,l)}let E=Array.from(x.keys()),p,A;if(K){let Q=q.map(H=>H.getTime()).sort((H,_)=>H-_),l=Q[0],D=Q[Q.length-1];l===D&&(l-=864e5,D+=864e5);let R=D-l||864e5,W=l-R*.02,C=D+R*.02;p=H=>{let _=Ft(H);if(!_)return g;let tt=_.getTime();return g+(tt-W)/(C-W||1)*P},A=H=>{let _=Ft(H);return _?Pt(_):String(H)};let ct=L+T,rt=document.createElementNS(c.namespaceURI,"line");rt.setAttribute("x1",String(g)),rt.setAttribute("y1",String(ct)),rt.setAttribute("x2",String(f-w)),rt.setAttribute("y2",String(ct)),rt.setAttribute("stroke","#111111"),rt.setAttribute("stroke-width","1"),c.appendChild(rt);let J=(C-W)/864e5,k=Math.max(3,Math.min(10,Math.floor(P/90)||3)),G=J/k,B=[1,2,3,5,7,10,14,21,30,60,90,180,365],z=B[B.length-1];for(let H of B)if(H>=G){z=H;break}let X=(H=>{let _=new Date(H);return _.setHours(0,0,0,0),_.getTime()})(W);for(let H=X;H<=C+.5*864e5;H+=z*864e5){let _=g+(H-W)/(C-W)*P,tt=document.createElementNS(c.namespaceURI,"line");tt.setAttribute("x1",String(_)),tt.setAttribute("y1",String(L)),tt.setAttribute("x2",String(_)),tt.setAttribute("y2",String(ct)),tt.setAttribute("stroke","#111111"),tt.setAttribute("stroke-opacity","0.18"),tt.setAttribute("stroke-dasharray","2,4"),c.appendChild(tt);let nt=document.createElementNS(c.namespaceURI,"text");nt.setAttribute("x",String(_)),nt.setAttribute("y",String(ct+12)),nt.setAttribute("text-anchor","middle"),nt.setAttribute("font-size","10"),nt.setAttribute("fill","#111111"),nt.textContent=Pt(new Date(H)),c.appendChild(nt)}}else{let m=[],Q=new Set;for(let D of d){let R=String(D.x);Q.has(R)||(Q.add(R),m.push(D.x))}let l=m.length||1;p=D=>{let R=String(D),W=m.findIndex(C=>String(C)===R);return W<0?g:l===1?g+P/2:g+W/(l-1)*P},A=D=>String(D)}let u=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let m of d)m.y<u&&(u=m.y),m.y>M&&(M=m.y);(!isFinite(u)||!isFinite(M))&&(u=0,M=1),u===M&&(u===0?M=1:u=0);let V=m=>L+T-(m-u)/(M-u||1)*T,U=4;for(let m=0;m<=U;m++){let Q=u+(M-u)*m/U,l=V(Q),D=document.createElementNS(c.namespaceURI,"line");D.setAttribute("x1",String(g)),D.setAttribute("y1",String(l)),D.setAttribute("x2",String(f-w)),D.setAttribute("y2",String(l)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),c.appendChild(D);let R=document.createElementNS(c.namespaceURI,"text");R.setAttribute("x",String(g-4)),R.setAttribute("y",String(l+3)),R.setAttribute("text-anchor","end"),R.setAttribute("font-size","10"),R.setAttribute("fill","#111111"),R.textContent=Math.abs(Q)>=100?String(Math.round(Q)):String(Math.round(Q*10)/10),c.appendChild(R)}let Y=E.filter(m=>m!=="__default__");if(Y.length>1){let m=s.createDiv({cls:"chart-notes-legend"});Y.forEach((Q,l)=>{let D=Q,R=m.createDiv({cls:"chart-notes-legend-item"}),W=R.createDiv();W.style.width="10px",W.style.height="10px",W.style.borderRadius="999px",W.style.backgroundColor=ht(D,l),R.createSpan({text:D})})}E.forEach((m,Q)=>{let l=x.get(m);if(!(l!=null&&l.length))return;let D=m==="__default__"?ht("line",Q):ht(m,Q),R=[...l];K&&R.sort((C,ct)=>{let rt=Ft(C.x),J=Ft(ct.x),v=rt?rt.getTime():0,k=J?J.getTime():0;return v-k});let W="";if(R.forEach((C,ct)=>{let rt=p(C.x),J=V(C.y);W+=(ct===0?"M ":" L ")+rt+" "+J}),n){let C=R[0],ct=R[R.length-1],rt=p(C.x),J=p(ct.x),v=V(u);W+=` L ${J} ${v} L ${rt} ${v} Z`;let k=document.createElementNS(c.namespaceURI,"path");k.setAttribute("d",W),k.setAttribute("fill",D),k.setAttribute("fill-opacity","0.18"),k.setAttribute("stroke",D),k.setAttribute("stroke-width","1.5"),c.appendChild(k)}else{let C=document.createElementNS(c.namespaceURI,"path");C.setAttribute("d",W),C.setAttribute("fill","none"),C.setAttribute("stroke",D),C.setAttribute("stroke-width","2"),c.appendChild(C)}R.forEach(C=>{let ct=p(C.x),rt=V(C.y),J=document.createElementNS(c.namespaceURI,"circle");J.setAttribute("cx",String(ct)),J.setAttribute("cy",String(rt)),J.setAttribute("r","3"),J.setAttribute("fill","#ffffff"),J.setAttribute("stroke",D),J.setAttribute("stroke-width","1.5"),J.style.cursor="pointer";let v=A(C.x),k=m==="__default__"?"":String(C.series),G=k?`${k} @ ${v}`:v,B=`valor: ${Math.round(C.y*100)/100}`;J.addEventListener("mouseenter",z=>{var Z,X;return Et(s,S,G,B,(X=(Z=C.notes)==null?void 0:Z.length)!=null?X:0,z)}),J.addEventListener("mouseleave",()=>Nt(S)),J.addEventListener("click",z=>{var Z;z.preventDefault(),Tt(s,N,G,C.y,(Z=C.notes)!=null?Z:[],i)}),c.appendChild(J)})})}function Ue(s,r,t){var m,Q,l,D,R,W,C,ct,rt,J;let n=(m=r.options)!=null?m:{},e=n.background,o=(Q=n.drilldown)!=null?Q:!0,i=(l=t.rows)!=null?l:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:d,svg:a,tooltip:c,details:S}=kt(s,e),N=s.getBoundingClientRect().width||600,y=Math.max(N,480);d.style.width=y+"px";let f=40,g=16,w=18,L=28,b=300;a.setAttribute("height",String(b));let I=y-f-g,P=b-w-L,T=i.map(v=>Ft(v.x)).filter(v=>!!v),q=T.length>=2&&T.length>=i.length*.6,K=new Map;for(let v of i){let k=v.series!=null&&v.series!==""?String(v.series):"__default__",G=(D=K.get(k))!=null?D:[];G.push(v),K.set(k,G)}let x=Array.from(K.keys()).filter(v=>v!=="__default__");if(x.length===0){Ee(s,r,t,!0);return}let E,p,A=[],u=new Set;for(let v of i){let k=String(v.x);u.has(k)||(u.add(k),A.push(v.x))}if(q){let k=T.map(st=>st.getTime()).sort((st,ut)=>st-ut),G=k[0],B=k[k.length-1];G===B&&(G-=864e5,B+=864e5);let z=B-G||864e5,Z=G-z*.02,X=B+z*.02;E=st=>{let ut=Ft(st);if(!ut)return f;let mt=ut.getTime();return f+(mt-Z)/(X-Z||1)*I},p=st=>{let ut=Ft(st);return ut?Pt(ut):String(st)},A.sort((st,ut)=>{let mt=Ft(st),vt=Ft(ut),bt=mt?mt.getTime():0,$t=vt?vt.getTime():0;return bt-$t});let H=w+P,_=document.createElementNS(a.namespaceURI,"line");_.setAttribute("x1",String(f)),_.setAttribute("y1",String(H)),_.setAttribute("x2",String(y-g)),_.setAttribute("y2",String(H)),_.setAttribute("stroke","#111111"),_.setAttribute("stroke-width","1"),a.appendChild(_);let tt=(X-Z)/864e5,at=Math.max(3,Math.min(10,Math.floor(I/90)||3)),dt=tt/at,At=[1,2,3,5,7,10,14,21,30,60,90,180,365],wt=At[At.length-1];for(let st of At)if(st>=dt){wt=st;break}let pt=(st=>{let ut=new Date(st);return ut.setHours(0,0,0,0),ut.getTime()})(Z);for(let st=pt;st<=X+.5*864e5;st+=wt*864e5){let ut=f+(st-Z)/(X-Z)*I,mt=document.createElementNS(a.namespaceURI,"line");mt.setAttribute("x1",String(ut)),mt.setAttribute("y1",String(w)),mt.setAttribute("x2",String(ut)),mt.setAttribute("y2",String(H)),mt.setAttribute("stroke","#111111"),mt.setAttribute("stroke-opacity","0.18"),mt.setAttribute("stroke-dasharray","2,4"),a.appendChild(mt);let vt=document.createElementNS(a.namespaceURI,"text");vt.setAttribute("x",String(ut)),vt.setAttribute("y",String(H+12)),vt.setAttribute("text-anchor","middle"),vt.setAttribute("font-size","10"),vt.setAttribute("fill","#111111"),vt.textContent=Pt(new Date(st)),a.appendChild(vt)}}else{let v=A.length||1;E=k=>{let G=String(k),B=A.findIndex(z=>String(z)===G);return B<0?f:v===1?f+I/2:f+B/(v-1)*I},p=k=>String(k)}let M=new Map;for(let v of A)M.set(String(v),new Map);let V=new Map;for(let v of x){let k=(R=K.get(v))!=null?R:[],G=new Map;for(let B of k){let z=String(B.x);G.set(z,(W=B.y)!=null?W:0)}V.set(v,G)}for(let v of x){let k=(C=V.get(v))!=null?C:new Map,G=0;for(let B of A){let z=String(B),Z=k.get(z);Z!==void 0&&(G=Z);let X=M.get(z);X&&X.set(v,G)}}let U=[];for(let v of A){let k=String(v),G=new Map,B=new Map,z=M.get(k);for(let X of x){let H=(ct=z==null?void 0:z.get(X))!=null?ct:0;G.set(X,H)}let Z=0;for(let X of x){let H=(rt=G.get(X))!=null?rt:0;B.set(X,Z),Z+=H}U.push({x:v,seriesValues:G,stackedValues:B})}let Y=0;for(let v of U){let k=0;for(let G of x)k+=(J=v.seriesValues.get(G))!=null?J:0;k>Y&&(Y=k)}(!isFinite(Y)||Y<=0)&&(Y=1);let $=v=>w+P-v/(Y||1)*P,F=$(0),et=4;for(let v=0;v<=et;v++){let k=Y*v/et,G=$(k),B=document.createElementNS(a.namespaceURI,"line");B.setAttribute("x1",String(f)),B.setAttribute("y1",String(G)),B.setAttribute("x2",String(y-g)),B.setAttribute("y2",String(G)),B.setAttribute("stroke","#cccccc"),B.setAttribute("stroke-opacity","0.25"),a.appendChild(B);let z=document.createElementNS(a.namespaceURI,"text");z.setAttribute("x",String(f-4)),z.setAttribute("y",String(G+3)),z.setAttribute("text-anchor","end"),z.setAttribute("font-size","10"),z.setAttribute("fill","#111111"),z.textContent=Math.abs(k)>=100?String(Math.round(k)):String(Math.round(k*10)/10),a.appendChild(z)}let it=s.createDiv({cls:"chart-notes-legend"});x.forEach((v,k)=>{let G=it.createDiv({cls:"chart-notes-legend-item"}),B=G.createDiv();B.style.width="10px",B.style.height="10px",B.style.borderRadius="999px",B.style.backgroundColor=ht(v,k),G.createSpan({text:v})}),x.forEach((v,k)=>{let G=ht(v,k),B="";U.forEach((_,tt)=>{var Yt,pt;let nt=E(_.x),at=(Yt=_.stackedValues.get(v))!=null?Yt:0,dt=(pt=_.seriesValues.get(v))!=null?pt:0,At=at+dt,wt=$(At);tt===0?B+=`M ${nt} ${wt}`:B+=` L ${nt} ${wt}`});let z=U.slice().reverse().map(_=>{var dt;let tt=E(_.x),nt=(dt=_.stackedValues.get(v))!=null?dt:0,at=$(nt);return`${tt} ${at}`}).join(" L "),Z=`${B} L ${z} Z`,X=document.createElementNS(a.namespaceURI,"path");X.setAttribute("d",Z),X.setAttribute("fill",G),X.setAttribute("fill-opacity","0.18"),X.setAttribute("stroke",G),X.setAttribute("stroke-width","1.5"),a.appendChild(X);let H=V.get(v);U.forEach(_=>{var $t,te,ee;let tt=String(_.x);if(!(H==null?void 0:H.has(tt)))return;let at=E(_.x),dt=($t=_.stackedValues.get(v))!=null?$t:0,At=(te=_.seriesValues.get(v))!=null?te:0,wt=dt+At,Yt=$(wt),pt=document.createElementNS(a.namespaceURI,"circle");pt.setAttribute("cx",String(at)),pt.setAttribute("cy",String(Yt)),pt.setAttribute("r","3"),pt.setAttribute("fill","#ffffff"),pt.setAttribute("stroke",G),pt.setAttribute("stroke-width","1.5"),pt.style.cursor="pointer";let st=p(_.x),ut=`${v} @ ${st}`,mt=`valor: ${Math.round(At*100)/100}`,bt=((ee=K.get(v))!=null?ee:[]).find(Kt=>String(Kt.x)===String(_.x));pt.addEventListener("mouseenter",Kt=>{var Wt,ne;return Et(s,c,ut,mt,(ne=(Wt=bt==null?void 0:bt.notes)==null?void 0:Wt.length)!=null?ne:0,Kt)}),pt.addEventListener("mouseleave",()=>Nt(c)),pt.addEventListener("click",Kt=>{var Wt;Kt.preventDefault(),Tt(s,S,ut,At,(Wt=bt==null?void 0:bt.notes)!=null?Wt:[],o)}),a.appendChild(pt)})})}function Qe(s,r,t){var P;let{background:n,drilldown:e=!0}=(P=r.options)!=null?P:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=Ge(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:d,svg:a,tooltip:c,details:S}=kt(s,n),N=Math.max(i,420);d.style.width=N+"px",o&&(a.style.color=o);let y=300,f=N/2,g=(y-28+28)/2,w=Math.min(N/2-20,y/2-20),b=t.rows.map(T=>Math.max(0,T.y)).reduce((T,q)=>T+q,0)||1,I=-Math.PI/2;t.rows.forEach((T,q)=>{var $;let K=T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x),x=T.y,E=x/b*Math.PI*2,p=f+w*Math.cos(I),A=g+w*Math.sin(I),u=f+w*Math.cos(I+E),M=g+w*Math.sin(I+E),V=E>Math.PI?1:0,U=document.createElementNS(a.namespaceURI,"path"),Y=[`M ${f} ${g}`,`L ${p} ${A}`,`A ${w} ${w} 0 ${V} 1 ${u} ${M}`,"Z"].join(" ");U.setAttribute("d",Y),U.setAttribute("fill",ht(($=T.series)!=null?$:K,q)),U.style.cursor="pointer",U.addEventListener("mouseenter",F=>{var et,it;return Et(s,c,K,x,(it=(et=T.notes)==null?void 0:et.length)!=null?it:0,F)}),U.addEventListener("mouseleave",()=>Nt(c)),U.addEventListener("click",()=>{var F;return Tt(s,S,K,x,(F=T.notes)!=null?F:[],e)}),a.appendChild(U),I+=E})}function Ye(s,r,t){var A;let{background:n,drilldown:e=!0}=(A=r.options)!=null?A:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:d,svg:a,tooltip:c,details:S}=kt(s,n),N=Math.max(i,700);d.style.width=N+"px",o&&(a.style.color=o);let y=300,f=N-48-10,g=y-28-28,w=t.rows.map(u=>{let M=u.x;if(M instanceof Date)return M.getTime();if(typeof M=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(M)){let U=new Date(M);if(!isNaN(U.getTime()))return U.getTime()}let V=Number(M);return isNaN(V)?null:V}return typeof M=="number"?M:null}),L=t.rows.map(u=>u.y),b=w.filter(u=>u!==null);if(b.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let I=Math.min(...b),P=Math.max(...b),T=Math.min(...L),q=Math.max(...L),K=u=>48+(u-I)/(P-I||1)*f,x=u=>y-28-(u-T)/(q-T||1)*g,E=document.createElementNS(a.namespaceURI,"line");E.setAttribute("x1",String(48)),E.setAttribute("y1",String(28)),E.setAttribute("x2",String(48)),E.setAttribute("y2",String(y-28)),E.setAttribute("stroke","currentColor"),a.appendChild(E);let p=document.createElementNS(a.namespaceURI,"line");p.setAttribute("x1",String(48)),p.setAttribute("y1",String(y-28)),p.setAttribute("x2",String(N-10)),p.setAttribute("y2",String(y-28)),p.setAttribute("stroke","currentColor"),a.appendChild(p),t.rows.forEach((u,M)=>{let V=w[M];if(V==null)return;let U=K(V),Y=x(L[M]),$=document.createElementNS(a.namespaceURI,"circle");$.setAttribute("cx",String(U)),$.setAttribute("cy",String(Y)),$.setAttribute("r","4"),$.setAttribute("fill",ht(u.series,M)),$.style.cursor="pointer";let F=u.x instanceof Date?u.x.toISOString().slice(0,10):typeof u.x=="string"?u.x:String(u.x);$.addEventListener("mouseenter",et=>{var it,m;return Et(s,c,F,u.y,(m=(it=u.notes)==null?void 0:it.length)!=null?m:0,et)}),$.addEventListener("mouseleave",()=>Nt(c)),$.addEventListener("click",et=>{var it;et.preventDefault(),Tt(s,S,F,u.y,(it=u.notes)!=null?it:[],e)}),a.appendChild($)})}var ye=class{render(r,t,n,e){var a;let{title:o}=(a=t.options)!=null?a:{};r.empty(),r.addClass("prop-charts-container");let d=r.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(o&&(d.textContent=o),t.type){case"bar":De(r,t,n);break;case"stacked-bar":He(r,t,n);break;case"line":Ee(r,t,n,!1);break;case"stacked-area":Ue(r,t,n);break;case"pie":Qe(r,t,n);break;case"scatter":Ye(r,t,n);break;case"gantt":he(r,t,n,e);break;default:r.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}}};var be=class extends Jt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("Chart Notes: loading plugin (Bases-only)"),this.indexer=new de(this.app),await this.indexer.buildIndex(),this.query=new fe(()=>this.indexer.getAll(),[]),this.renderer=new ye,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Jt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Jt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Jt.TFile&&this.indexer.removeFile(t)})),this.registerBasesView(Se,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new le(t,n,this.renderer),options:()=>{let t=[];return t.push({type:"dropdown",key:"chartType",displayName:"Chart type",description:"Type of chart to render",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line","stacked-area":"Stacked area",pie:"Pie",scatter:"Scatter",gantt:"Gantt"}}),t.push({type:"property",key:"xProperty",displayName:"X axis / category (bars & slices)",description:"Property used for the X axis or categories (for pie, this is the slice).",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")==="gantt"}}),t.push({type:"property",key:"ganttLabelProperty",displayName:"Task label (Gantt)",description:`Label for each task bar.
If empty, uses the note title.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"yProperty",displayName:"Y value (empty = count)",description:`Numeric property summed on the Y axis.
Leave empty to just count notes.`,shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="pie"||e==="gantt"}}),t.push({type:"property",key:"seriesProperty",displayName:"Series / color (optional)",description:"Property that defines series / color for bars, lines and stacked area.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")==="pie"}}),t.push({type:"dropdown",key:"aggregateMode",displayName:"Value aggregation (Y)",description:`How to aggregate Y when multiple notes share the same X/series.
For line/stacked-area, 'Cumulative sum' turns the series into a running total.`,default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="scatter"||e==="gantt"}}),t.push({type:"dropdown",key:"xBucket",displayName:"X bucket (dates)",description:"How to bucket dates on the X axis for line / stacked area charts (day, week, month...).",default:"auto",options:{auto:"Auto",none:"None",day:"Day",week:"Week",month:"Month",quarter:"Quarter",year:"Year"},shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return!(e==="line"||e==="stacked-area")}}),t.push({type:"property",key:"startProperty",displayName:"Start (Gantt)",description:"Start date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"endProperty",displayName:"End (Gantt)",description:"End date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"dueProperty",displayName:"Due (deadline, optional)",description:"Due date / deadline for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"durationProperty",displayName:"Duration in minutes (optional)",description:`Duration of the task in minutes.
Used together with start/end/due.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0}),t.push({type:"text",key:"title",displayName:"Title (optional)",description:`Custom chart title.
Falls back to the view name.`}),t}})}onunload(){console.log("Chart Notes: unloading plugin")}};
