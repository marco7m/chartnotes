/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ae=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Be=Object.getOwnPropertyNames;var Ue=Object.prototype.hasOwnProperty;var Ye=(s,e)=>{for(var t in e)ae(s,t,{get:e[t],enumerable:!0})},Oe=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Be(e))!Ue.call(s,o)&&o!==t&&ae(s,o,{get:()=>e[o],enumerable:!(n=Ve(e,o))||n.enumerable});return s};var Xe=s=>Oe(ae({},"__esModule",{value:!0}),s);var an={};Ye(an,{default:()=>se});module.exports=Xe(an);var Pt=require("obsidian");var Pe=require("obsidian");var Rt=require("obsidian");var Ce=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function it(s,e){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,o)=>n*33+o.charCodeAt(0)>>>0,0);return Ce[t%Ce.length]}function wt(s,e){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,e&&(n.style.background=e);let o="http://www.w3.org/2000/svg",r=document.createElementNS(o,"svg");r.setAttribute("width","100%"),r.setAttribute("height",String(300)),r.style.display="block",n.appendChild(r);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let m=s.createDiv({cls:"chart-notes-details"});return m.style.display="none",{scroll:t,inner:n,svg:r,tooltip:i,details:m}}function gt(s,e,t,n,o,r){let i=s.getBoundingClientRect(),m=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);e.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${m}</div>
    <div class="chart-notes-tooltip-notes">${o} nota${o===1?"":"s"}</div>
  `,e.style.display="block";let a=e.getBoundingClientRect(),u=r.clientX-i.left+6,g=r.clientY-i.top+6;u+a.width>i.width-4&&(u=i.width-a.width-4),u<4&&(u=4),g+a.height>i.height-4&&(g=i.height-a.height-4),g<4&&(g=4),e.style.left=u+"px",e.style.top=g+"px"}function mt(s){s.style.display="none"}function yt(s,e,t,n,o,r){if(!r)return;if(e.empty(),!o||o.length===0){e.style.display="none";return}e.style.display="block";let i=e.createEl("div",{cls:"chart-notes-details-header"}),m=i.createEl("div",{cls:"chart-notes-details-title"});m.textContent=`Notas em "${t}" (${o.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{e.style.display="none"});let u=e.createEl("ul",{cls:"chart-notes-details-list"});for(let g of o){let D=u.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:g});D.href="#",D.addEventListener("click",w=>{w.preventDefault(),app.workspace.openLinkText(g,"",!1)})}}function Gt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let e=s.getDate().toString().padStart(2,"0"),t=(s.getMonth()+1).toString().padStart(2,"0");return`${e}/${t}`}function Te(s){if(!s)return!1;let e=s.trim().toLowerCase();if(e==="#fff"||e==="#ffffff"||e==="white")return!0;if(!e.startsWith("#"))return!1;let t,n,o;if(e.length===4)t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),o=parseInt(e[3]+e[3],16);else if(e.length===7)t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*o)/255>.7}var ce=class extends Rt.Modal{constructor(t,n,o,r){var m;super(app);this.notePath=t,this.spec=n,this.refresh=o,this.reindexFile=r;let i=(m=n.encoding)!=null?m:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var h,v;let{contentEl:t}=this;t.empty();let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Rt.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let o=await this.app.vault.read(n),r={},i=o,m=/^---\n([\s\S]*?)\n---\n?/m.exec(o);if(m){try{r=(h=(0,Rt.parseYaml)(m[1]))!=null?h:{}}catch(c){r={}}i=o.slice(m[0].length)}(typeof r!="object"||r==null)&&(r={});let a=(v=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?v:this.notePath,u=t.createDiv({cls:"gantt-edit-header"}),g=u.createEl("a",{text:a,cls:"gantt-edit-title"});g.href="#",g.addEventListener("click",c=>{c.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let b=u.createDiv({cls:"gantt-edit-subtitle"});b.textContent=this.notePath;let D=t.createDiv({cls:"gantt-edit-form"}),w=c=>{let A=D.createDiv({cls:"gantt-edit-row"}),E=A.createDiv({cls:"gantt-edit-label"});E.textContent=c;let y=A.createDiv({cls:"gantt-edit-field"});return{row:A,field:y}},x=c=>{if(!c)return"";let E=String(c).match(/^(\d{4}-\d{2}-\d{2})/);return E?E[1]:""},f=c=>{if(c=c.trim(),!!c&&/^\d{4}-\d{2}-\d{2}$/.test(c))return c},S=null;if(this.startKey){let{field:c}=w(this.startKey+" (in\xEDcio)");S=c.createEl("input",{type:"date"}),S.value=x(r[this.startKey])}let R=null;if(this.endKey){let{field:c}=w(this.endKey+" (fim)");R=c.createEl("input",{type:"date"}),R.value=x(r[this.endKey])}let M=null;if(this.durationKey){let{field:c}=w(this.durationKey+" (minutos)");M=c.createEl("input",{type:"number"});let A=r[this.durationKey];M.value=A!=null?String(A):"",M.min="0",M.step="5"}let _=null;if(this.dueKey){let{field:c}=w(this.dueKey+" (due)");_=c.createEl("input",{type:"date"}),_.value=x(r[this.dueKey])}let k=t.createDiv({cls:"gantt-edit-buttons"}),H=k.createEl("button",{text:"Salvar",cls:"mod-cta"});k.createEl("button",{text:"Cancelar"}).addEventListener("click",c=>{c.preventDefault(),this.close()}),H.addEventListener("click",async c=>{if(c.preventDefault(),this.startKey&&S){let y=f(S.value);y?r[this.startKey]=y:delete r[this.startKey]}if(this.endKey&&R){let y=f(R.value);y?r[this.endKey]=y:delete r[this.endKey]}if(this.durationKey&&M){let y=M.value.trim();if(y==="")delete r[this.durationKey];else{let N=Number(y);Number.isNaN(N)||(r[this.durationKey]=N)}}if(this.dueKey&&_){let y=f(_.value);y?r[this.dueKey]=y:delete r[this.dueKey]}let E=`---
${(0,Rt.stringifyYaml)(r).trim()}
---
`+i;if(await this.app.vault.modify(n,E),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(y){}if(this.refresh)try{this.refresh()}catch(y){}new Rt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function qt(s,e,t,n){var me,ye,be,xe,ve,Se,we,Ae;let o=(me=e.options)!=null?me:{},r=o.background,i=(ye=o.drilldown)!=null?ye:!0,m=!0,a=l=>{if(l==null)return"";let L=String(l).trim();if(!L)return"";let z=L.match(/^\[\[(.+?)\]\]$/);z&&(L=z[1]);let X=L.lastIndexOf("/");return X>=0&&X<L.length-1&&(L=L.slice(X+1)),L};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(l=>l.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let u=t.rows.filter(l=>l.start&&l.end);if(u.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let g=e.encoding,b=g.group,D=g.duration,w=(l,L)=>{if(!l||!L)return;let z=l[L];return Array.isArray(z)?z[0]:z},f=u.map(l=>{var xt,lt;let L=l.start,z=l.end,X=l.props,It=typeof l.x=="string"?l.x:l.x instanceof Date?Gt(L):String(l.x),At=a(It),bt,_t=b?w(X,b):void 0;_t!=null?bt=String(_t):l.series!=null?bt=String(l.series):bt=At;let ht=(xt=l.notes)==null?void 0:xt[0],Et=ht?(lt=ht.replace(/\.md$/i,"").split("/").pop())!=null?lt:ht:At,Ct=l.due,Ft,Nt=w(X,D);if(Nt!=null){let vt=Number(Nt);Number.isNaN(vt)||(Ft=vt)}return{row:l,start:L,end:z,props:X,fullName:At,groupKey:bt,notePath:ht,noteTitle:Et,due:Ct,estMinutes:Ft}}).filter(l=>l.start instanceof Date&&!isNaN(l.start.getTime())&&l.end instanceof Date&&!isNaN(l.end.getTime()));if(f.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}f.sort((l,L)=>{if(l.groupKey<L.groupKey)return-1;if(l.groupKey>L.groupKey)return 1;let z=l.start.getTime(),X=L.start.getTime();return z!==X?z-X:l.fullName.localeCompare(L.fullName)});let S=26,R=0,M=null;for(let l of f)l.groupKey!==M&&(M=l.groupKey,R+=1),R+=1;let _=Math.min(...f.map(l=>l.start.getTime())),k=Math.max(...f.map(l=>l.end.getTime()));if(!isFinite(_)||!isFinite(k)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let H=24*60*60*1e3,$=l=>{let L=new Date(l);return L.setHours(0,0,0,0),L.getTime()},h=$(_),v=$(k),c=s.querySelector(".prop-charts-title-row");c||(c=s.createDiv({cls:"prop-charts-title-row"}));let A=s.dataset.ganttZoomMode||String((be=o.zoomMode)!=null?be:"100");s.dataset.ganttZoomMode=A;let E=s.dataset.ganttLabelMode||String((xe=o.labelMode)!=null?xe:"compact");s.dataset.ganttLabelMode=E;let y=c.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(l=>{let L=y.createEl("button",{cls:"gantt-zoom-btn",text:l.label});l.id===A&&L.addClass("is-active"),L.addEventListener("click",z=>{z.preventDefault(),s.dataset.ganttZoomMode=l.id,qt(s,e,t,n)})}),y.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",l=>{l.preventDefault();let L=s.querySelector(".chart-notes-zoom-button");L&&L.click()});let Y=Number(o.labelWidth),G=!Number.isNaN(Y)&&Y>120?Y:260,Q=E==="wide"?G+160:G,O=s.getBoundingClientRect().width||600,j=Math.max(O,820),F;if(A==="fit")F=O;else{let l=Number(A)/100||1;F=j*l}let{inner:d,svg:p,tooltip:C,details:T}=wt(s,r);d.style.width=F+"px";let I=(l,L,z,X,It,At,bt,_t,ht)=>{if(!l)return;let Et=Math.max(40,X-8),Ft=Math.max(8,Math.floor(Et/6)),Nt=l.split(/\s+/),xt=[],lt="";for(let Tt of Nt){if(!lt){lt=Tt;continue}(lt+" "+Tt).length<=Ft?lt+=" "+Tt:(xt.push(lt),lt=Tt)}lt&&xt.push(lt);let vt=It+2,zt=xt.length*vt,Bt=z-zt/2+It;xt.forEach((Tt,Ot)=>{let ot=document.createElementNS(p.namespaceURI,"text");ot.setAttribute("x",String(L)),ot.setAttribute("y",String(Bt+Ot*vt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(It)),ot.setAttribute("fill","#111111"),At&&ot.setAttribute("font-weight",At),ot.textContent=Tt,bt&&ot.addEventListener("mouseenter",st=>bt(st)),_t&&ot.addEventListener("mouseleave",()=>_t()),ht&&(ot.style.cursor="pointer",ot.addEventListener("click",st=>ht(st))),p.appendChild(ot)})},tt=28,K=28,rt=10,q=Math.max(300,tt+K+R*S+24);p.setAttribute("height",String(q));let V=F-Q-rt,B=tt+6;p.style.color="#111111";let et=v+H-h||1,at=h-et*.02,ft=v+H+et*.08,ct=l=>Q+(l-at)/(ft-at)*V,W=(ft-at)/H,Mt=Math.max(4,Math.min(12,Math.floor(V/90)||4)),dt=W/Mt,J=[1,2,3,5,7,10,14,21,30,60,90,180,365],pt=J[J.length-1];for(let l of J)if(l>=dt){pt=l;break}let Vt=[],Ge=$(at);for(let l=Ge;l<=ft+.5*H;l+=pt*H)Vt.push(l);let Ht=document.createElementNS(p.namespaceURI,"line");Ht.setAttribute("x1",String(Q)),Ht.setAttribute("y1",String(B)),Ht.setAttribute("x2",String(F-rt)),Ht.setAttribute("y2",String(B)),Ht.setAttribute("stroke","#111111"),p.appendChild(Ht);for(let l of Vt){let L=ct(l),z=document.createElementNS(p.namespaceURI,"line");z.setAttribute("x1",String(L)),z.setAttribute("y1",String(B)),z.setAttribute("x2",String(L)),z.setAttribute("y2",String(q-K)),z.setAttribute("stroke","#111111"),z.setAttribute("stroke-opacity","0.20"),z.setAttribute("stroke-dasharray","2,4"),p.appendChild(z);let X=document.createElementNS(p.namespaceURI,"text");X.setAttribute("x",String(L)),X.setAttribute("y",String(B-4)),X.setAttribute("text-anchor","middle"),X.setAttribute("font-size","10"),X.setAttribute("fill","#111111"),X.textContent=Gt(new Date(l)),p.appendChild(X)}let ge=new Date;ge.setHours(0,0,0,0);let re=ge.getTime();if(re>=at&&re<=ft){let l=ct(re),L=document.createElementNS(p.namespaceURI,"line");L.setAttribute("x1",String(l)),L.setAttribute("y1",String(B)),L.setAttribute("x2",String(l)),L.setAttribute("y2",String(q-K)),L.setAttribute("stroke","#4caf50"),L.setAttribute("stroke-width","2"),L.setAttribute("stroke-dasharray","4,2"),p.appendChild(L);let z=document.createElementNS(p.namespaceURI,"text");z.setAttribute("x",String(l+4)),z.setAttribute("y",String(B+12)),z.setAttribute("font-size","10"),z.setAttribute("fill","#4caf50"),z.textContent="hoje",p.appendChild(z)}let Yt=d.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Yt.setAttr("title",E==="wide"?"Compactar nomes":"Expandir nomes"),Yt.style.left=`${Q}px`,Yt.style.top="4px",Yt.addEventListener("click",l=>{l.preventDefault();let z=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=z,qt(s,e,t,n)});let We=["status","priority"],oe=Array.isArray(o.tooltipFields)?o.tooltipFields.map(l=>String(l)):null,Ke=oe&&oe.length?oe:We,Qt=0,ie=null;for(let l of f){let L=l.start,z=l.end,X=(z.getTime()-L.getTime())/6e4,It=l.props,At=l.notePath,bt=l.noteTitle,_t=(Se=(ve=l.row.notes)==null?void 0:ve.length)!=null?Se:0,ht=l.due,Et=l.estMinutes,Ct=[];Ct.push(`${Gt(L)} \u2192 ${Gt(z)}`),typeof Et=="number"&&!Number.isNaN(Et)?Ct.push(`est: ${Math.round(Et)} min`):X>0&&Ct.push(`dura\xE7\xE3o: ${Math.round(X)} min`),ht instanceof Date&&Ct.push(`due: ${Gt(ht)}`);for(let nt of Ke){let U=w(It,nt);U!=null&&String(U).trim()!==""&&Ct.push(`${nt}: ${String(U)}`)}let Ft=Ct.join("<br>"),Nt=nt=>{var U;nt.preventDefault(),m&&At?new ce(At,e,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():yt(s,T,bt,Et!=null?Et:X,(U=l.row.notes)!=null?U:[],i)},xt=nt=>{bt&&Ft&&gt(s,C,bt,Ft,_t,nt)},lt=()=>mt(C);if(l.groupKey!==ie){ie=l.groupKey;let nt=B+8+Qt*S+S/2,U=a(ie);I(U,4,nt,Q-12,11,"600"),Qt+=1}let vt=B+8+Qt*S,zt=S-10,Bt=ct(L.getTime()),Tt=ct(z.getTime()),Ot=Math.max(4,Tt-Bt),ot=l.fullName,st=document.createElementNS(p.namespaceURI,"rect");st.setAttribute("x",String(Bt)),st.setAttribute("y",String(vt)),st.setAttribute("width",String(Ot)),st.setAttribute("height",String(zt)),st.setAttribute("rx","3"),st.setAttribute("ry","3"),st.setAttribute("fill",it((we=l.row.series)!=null?we:ot,Qt)),st.setAttribute("stroke","rgba(0,0,0,0.25)"),st.setAttribute("stroke-width","0.5"),st.style.cursor=m&&At?"pointer":"default",st.addEventListener("mouseenter",xt),st.addEventListener("mouseleave",lt),st.addEventListener("click",Nt),p.appendChild(st);let Ee=vt+zt/2;if(Ot>=6){let nt=it((Ae=l.row.series)!=null?Ae:ot,Qt),U=document.createElementNS(p.namespaceURI,"circle");U.setAttribute("cx",String(Bt)),U.setAttribute("cy",String(Ee)),U.setAttribute("r","3.5"),U.setAttribute("fill","#ffffff"),U.setAttribute("stroke",nt),U.setAttribute("stroke-width","1.5"),p.appendChild(U);let Lt=document.createElementNS(p.namespaceURI,"circle");Lt.setAttribute("cx",String(Tt)),Lt.setAttribute("cy",String(Ee)),Lt.setAttribute("r","3.5"),Lt.setAttribute("fill","#ffffff"),Lt.setAttribute("stroke",nt),Lt.setAttribute("stroke-width","1.5"),p.appendChild(Lt)}let De=vt+zt/2+2,Xt=b?16:4;if(E==="wide")I(ot,Xt,De,Q-Xt-4,11,null,xt,lt,Nt);else{let nt=ot,U=Math.max(40,Q-Xt-8),Re=Math.max(8,Math.floor(U/6));nt.length>Re&&(nt=nt.slice(0,Re-1)+"\u2026");let St=document.createElementNS(p.namespaceURI,"text");St.setAttribute("x",String(Xt)),St.setAttribute("y",String(De)),St.setAttribute("text-anchor","start"),St.setAttribute("font-size","11"),St.setAttribute("fill","#111111"),St.textContent=nt,St.style.cursor="pointer",St.addEventListener("mouseenter",xt),St.addEventListener("mouseleave",lt),St.addEventListener("click",Nt),p.appendChild(St)}if(ht instanceof Date){let nt=ct(ht.getTime()),U=document.createElementNS(p.namespaceURI,"line");U.setAttribute("x1",String(nt)),U.setAttribute("y1",String(vt)),U.setAttribute("x2",String(nt)),U.setAttribute("y2",String(vt+zt)),U.setAttribute("stroke","#ff6b6b"),U.setAttribute("stroke-width","2"),U.setAttribute("stroke-dasharray","4,2"),p.appendChild(U)}Qt+=1}if(m){let l=s.createDiv({cls:"prop-charts-empty"});l.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function le(s,e,t){var Q,O,j,F;let n=(Q=e.options)!=null?Q:{},o=n.background,r=(O=n.drilldown)!=null?O:!0,i=(j=t.rows)!=null?j:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:m,svg:a,tooltip:u,details:g}=wt(s,o),b=s.getBoundingClientRect().width||600,D=Math.max(b,480);m.style.width=D+"px";let w=40,x=16,f=18,S=28,R=300;a.setAttribute("height",String(R));let M=D-w-x,_=R-f-S,k=new Map;for(let d of i){let p=String(d.x),C=(F=k.get(p))!=null?F:{label:d.x,rows:[]};C.rows.push(d),k.set(p,C)}let $=Array.from(k.keys()).sort((d,p)=>d<p?-1:d>p?1:0).map(d=>k.get(d)),h=$.length,v=new Set;i.forEach(d=>{d.series!=null&&v.add(String(d.series))});let c=Array.from(v),A=c.length>1,E=A?"grouped":"single",y=0;i.forEach(d=>{d.y>y&&(y=d.y)}),(!isFinite(y)||y<=0)&&(y=1);let N=d=>f+_-d/(y||1)*_,P=N(0),Y=4;for(let d=0;d<=Y;d++){let p=y*d/Y,C=N(p),T=document.createElementNS(a.namespaceURI,"line");T.setAttribute("x1",String(w)),T.setAttribute("y1",String(C)),T.setAttribute("x2",String(D-x)),T.setAttribute("y2",String(C)),T.setAttribute("stroke","#cccccc"),T.setAttribute("stroke-opacity","0.25"),a.appendChild(T);let I=document.createElementNS(a.namespaceURI,"text");I.setAttribute("x",String(w-4)),I.setAttribute("y",String(C+3)),I.setAttribute("text-anchor","end"),I.setAttribute("font-size","10"),I.setAttribute("fill","#111111"),I.textContent=String(Math.round(p)),a.appendChild(I)}let G=h>0?M/h:M;if($.forEach((d,p)=>{let C=w+G*(p+.5),T=String(d.label),I=document.createElementNS(a.namespaceURI,"text");I.setAttribute("x",String(C)),I.setAttribute("y",String(R-S+12)),I.setAttribute("text-anchor","middle"),I.setAttribute("font-size","10"),I.setAttribute("fill","#111111"),I.textContent=T,a.appendChild(I)}),A){let d=s.createDiv({cls:"chart-notes-legend"});c.forEach((p,C)=>{let T=d.createDiv({cls:"chart-notes-legend-item"}),I=T.createDiv();I.style.width="10px",I.style.height="10px",I.style.borderRadius="999px",I.style.backgroundColor=it(p,C),T.createSpan({text:p})})}$.forEach((d,p)=>{let C=w+G*(p+.5),T=d.rows;if(E==="single"){let q=T[0],V=q.y,B=G*.6,et=C-B/2,at=N(V),ft=Math.max(2,P-at),ct=it("bar",p),W=document.createElementNS(a.namespaceURI,"rect");W.setAttribute("x",String(et)),W.setAttribute("y",String(at)),W.setAttribute("width",String(B)),W.setAttribute("height",String(ft)),W.setAttribute("fill",ct),W.setAttribute("stroke","rgba(0,0,0,0.25)"),W.setAttribute("stroke-width","0.5"),W.style.cursor="pointer";let Z=String(d.label),Mt=`valor: ${Math.round(V*100)/100}`;W.addEventListener("mouseenter",dt=>{var J,pt;return gt(s,u,Z,Mt,(pt=(J=q.notes)==null?void 0:J.length)!=null?pt:0,dt)}),W.addEventListener("mouseleave",()=>mt(u)),W.addEventListener("click",dt=>{var J;dt.preventDefault(),yt(s,g,Z,V,(J=q.notes)!=null?J:[],r)}),a.appendChild(W);return}let I=c.length,tt=G/Math.max(I+1,2),K=I*tt,rt=C-K/2;c.forEach((q,V)=>{let B=T.find(J=>(J.series!=null?String(J.series):"")===q);if(!B)return;let et=B.y,at=rt+V*tt,ft=N(et),ct=Math.max(2,P-ft),W=it(q,V),Z=document.createElementNS(a.namespaceURI,"rect");Z.setAttribute("x",String(at)),Z.setAttribute("y",String(ft)),Z.setAttribute("width",String(tt)),Z.setAttribute("height",String(ct)),Z.setAttribute("fill",W),Z.setAttribute("stroke","rgba(0,0,0,0.25)"),Z.setAttribute("stroke-width","0.5"),Z.style.cursor="pointer";let Mt=`${q} @ ${String(d.label)}`,dt=`valor: ${Math.round(et*100)/100}`;Z.addEventListener("mouseenter",J=>{var pt,Vt;return gt(s,u,Mt,dt,(Vt=(pt=B.notes)==null?void 0:pt.length)!=null?Vt:0,J)}),Z.addEventListener("mouseleave",()=>mt(u)),Z.addEventListener("click",J=>{var pt;J.preventDefault(),yt(s,g,Mt,et,(pt=B.notes)!=null?pt:[],r)}),a.appendChild(Z)})})}function ke(s,e,t){var G,Q,O,j;let n=(G=e.options)!=null?G:{},o=n.background,r=(Q=n.drilldown)!=null?Q:!0,i=(O=t.rows)!=null?O:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:m,svg:a,tooltip:u,details:g}=wt(s,o),b=s.getBoundingClientRect().width||600,D=Math.max(b,480);m.style.width=D+"px";let w=40,x=16,f=18,S=28,R=300;a.setAttribute("height",String(R));let M=D-w-x,_=R-f-S,k=new Map;for(let F of i){let d=String(F.x),p=(j=k.get(d))!=null?j:{label:F.x,rows:[]};p.rows.push(F),k.set(d,p)}let $=Array.from(k.keys()).sort((F,d)=>F<d?-1:F>d?1:0).map(F=>k.get(F)),h=$.length,v=new Set;i.forEach(F=>{F.series!=null&&v.add(String(F.series))});let c=Array.from(v);if(!c.length){le(s,e,t);return}let A=0;$.forEach(F=>{let d=F.rows.reduce((p,C)=>p+C.y,0);d>A&&(A=d)}),(!isFinite(A)||A<=0)&&(A=1);let E=F=>f+_-F/(A||1)*_,y=E(0),N=4;for(let F=0;F<=N;F++){let d=A*F/N,p=E(d),C=document.createElementNS(a.namespaceURI,"line");C.setAttribute("x1",String(w)),C.setAttribute("y1",String(p)),C.setAttribute("x2",String(D-x)),C.setAttribute("y2",String(p)),C.setAttribute("stroke","#cccccc"),C.setAttribute("stroke-opacity","0.25"),a.appendChild(C);let T=document.createElementNS(a.namespaceURI,"text");T.setAttribute("x",String(w-4)),T.setAttribute("y",String(p+3)),T.setAttribute("text-anchor","end"),T.setAttribute("font-size","10"),T.setAttribute("fill","#111111"),T.textContent=String(Math.round(d)),a.appendChild(T)}let P=h>0?M/h:M;$.forEach((F,d)=>{let p=w+P*(d+.5),C=String(F.label),T=document.createElementNS(a.namespaceURI,"text");T.setAttribute("x",String(p)),T.setAttribute("y",String(R-S+12)),T.setAttribute("text-anchor","middle"),T.setAttribute("font-size","10"),T.setAttribute("fill","#111111"),T.textContent=C,a.appendChild(T)});let Y=s.createDiv({cls:"chart-notes-legend"});c.forEach((F,d)=>{let p=Y.createDiv({cls:"chart-notes-legend-item"}),C=p.createDiv();C.style.width="10px",C.style.height="10px",C.style.borderRadius="999px",C.style.backgroundColor=it(F,d),p.createSpan({text:F})}),$.forEach((F,d)=>{let p=w+P*(d+.5),C=P*.6,T=p-C/2,I=0;c.forEach((tt,K)=>{let rt=F.rows.find(dt=>(dt.series!=null?String(dt.series):"")===tt);if(!rt)return;let q=rt.y,V=I,B=I+q;I=B;let et=E(V),at=E(B),ft=Math.max(2,et-at),ct=it(tt,K),W=document.createElementNS(a.namespaceURI,"rect");W.setAttribute("x",String(T)),W.setAttribute("y",String(at)),W.setAttribute("width",String(C)),W.setAttribute("height",String(ft)),W.setAttribute("fill",ct),W.setAttribute("stroke","rgba(0,0,0,0.25)"),W.setAttribute("stroke-width","0.5"),W.style.cursor="pointer";let Z=`${tt} @ ${String(F.label)}`,Mt=`valor: ${Math.round(q*100)/100}`;W.addEventListener("mouseenter",dt=>{var J,pt;return gt(s,u,Z,Mt,(pt=(J=rt.notes)==null?void 0:J.length)!=null?pt:0,dt)}),W.addEventListener("mouseleave",()=>mt(u)),W.addEventListener("click",dt=>{var J;dt.preventDefault(),yt(s,g,Z,q,(J=rt.notes)!=null?J:[],r)}),a.appendChild(W)})})}function ue(s,e,t,n){var Q,O,j,F;let o=(Q=e.options)!=null?Q:{},r=o.background,i=(O=o.drilldown)!=null?O:!0,m=(j=t.rows)!=null?j:[];if(!m.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:u,tooltip:g,details:b}=wt(s,r),D=s.getBoundingClientRect().width||600,w=Math.max(D,480);a.style.width=w+"px";let x=40,f=16,S=18,R=24,M=300;u.setAttribute("height",String(M));let _=w-x-f,k=M-S-R,H=new Map;for(let d of m){let p=d.series!=null?String(d.series):"__default__",C=(F=H.get(p))!=null?F:[];C.push(d),H.set(p,C)}let $=Array.from(H.keys()),h=[],v=new Set;for(let d of m){let p=String(d.x);v.has(p)||(v.add(p),h.push(d.x))}let c=h.length||1,A=d=>{let p=String(d),C=h.findIndex(T=>String(T)===p);return C<0?x:c===1?x+_/2:x+C/(c-1)*_},E=d=>String(d),y=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let d of m)d.y<y&&(y=d.y),d.y>N&&(N=d.y);(!isFinite(y)||!isFinite(N))&&(y=0,N=1),y===N&&(y===0?N=1:y=0);let P=d=>S+k-(d-y)/(N-y||1)*k,Y=4;for(let d=0;d<=Y;d++){let p=y+(N-y)*d/Y,C=P(p),T=document.createElementNS(u.namespaceURI,"line");T.setAttribute("x1",String(x)),T.setAttribute("y1",String(C)),T.setAttribute("x2",String(w-f)),T.setAttribute("y2",String(C)),T.setAttribute("stroke","#cccccc"),T.setAttribute("stroke-opacity","0.25"),u.appendChild(T);let I=document.createElementNS(u.namespaceURI,"text");I.setAttribute("x",String(x-4)),I.setAttribute("y",String(C+3)),I.setAttribute("text-anchor","end"),I.setAttribute("font-size","10"),I.setAttribute("fill","#111111"),I.textContent=Math.abs(p)>=100?String(Math.round(p)):String(Math.round(p*10)/10),u.appendChild(I)}let G=$.filter(d=>d!=="__default__");if(G.length>1){let d=s.createDiv({cls:"chart-notes-legend"});G.forEach((p,C)=>{let T=p,I=d.createDiv({cls:"chart-notes-legend-item"}),tt=I.createDiv();tt.style.width="10px",tt.style.height="10px",tt.style.borderRadius="999px",tt.style.backgroundColor=it(T,C),I.createSpan({text:T})})}$.forEach((d,p)=>{let C=H.get(d);if(!(C!=null&&C.length))return;let T=d==="__default__"?it("line",p):it(d,p),I=[...C].sort((K,rt)=>{let q=h.findIndex(B=>String(B)===String(K.x)),V=h.findIndex(B=>String(B)===String(rt.x));return q-V}),tt="";if(I.forEach((K,rt)=>{let q=A(K.x),V=P(K.y);tt+=(rt===0?"M ":" L ")+q+" "+V}),n){let K=I[0],rt=I[I.length-1],q=A(K.x),V=A(rt.x),B=P(y);tt+=` L ${V} ${B} L ${q} ${B} Z`;let et=document.createElementNS(u.namespaceURI,"path");et.setAttribute("d",tt),et.setAttribute("fill",T),et.setAttribute("fill-opacity","0.18"),et.setAttribute("stroke",T),et.setAttribute("stroke-width","1.5"),u.appendChild(et)}else{let K=document.createElementNS(u.namespaceURI,"path");K.setAttribute("d",tt),K.setAttribute("fill","none"),K.setAttribute("stroke",T),K.setAttribute("stroke-width","2"),u.appendChild(K)}I.forEach(K=>{let rt=A(K.x),q=P(K.y),V=document.createElementNS(u.namespaceURI,"circle");V.setAttribute("cx",String(rt)),V.setAttribute("cy",String(q)),V.setAttribute("r","3"),V.setAttribute("fill","#ffffff"),V.setAttribute("stroke",T),V.setAttribute("stroke-width","1.5"),V.style.cursor="pointer";let B=E(K.x),et=d==="__default__"?"":String(K.series),at=et?`${et} @ ${B}`:B,ft=`valor: ${Math.round(K.y*100)/100}`;V.addEventListener("mouseenter",ct=>{var W,Z;return gt(s,g,at,ft,(Z=(W=K.notes)==null?void 0:W.length)!=null?Z:0,ct)}),V.addEventListener("mouseleave",()=>mt(g)),V.addEventListener("click",ct=>{var W;ct.preventDefault(),yt(s,b,at,K.y,(W=K.notes)!=null?W:[],i)}),u.appendChild(V)})})}function Me(s,e,t){var _;let{background:n,drilldown:o=!0}=(_=e.options)!=null?_:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=Te(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:m,svg:a,tooltip:u,details:g}=wt(s,n),b=Math.max(i,420);m.style.width=b+"px",r&&(a.style.color=r);let D=300,w=b/2,x=(D-28+28)/2,f=Math.min(b/2-20,D/2-20),R=t.rows.map(k=>Math.max(0,k.y)).reduce((k,H)=>k+H,0)||1,M=-Math.PI/2;t.rows.forEach((k,H)=>{var G;let $=k.x instanceof Date?k.x.toISOString().slice(0,10):String(k.x),h=k.y,v=h/R*Math.PI*2,c=w+f*Math.cos(M),A=x+f*Math.sin(M),E=w+f*Math.cos(M+v),y=x+f*Math.sin(M+v),N=v>Math.PI?1:0,P=document.createElementNS(a.namespaceURI,"path"),Y=[`M ${w} ${x}`,`L ${c} ${A}`,`A ${f} ${f} 0 ${N} 1 ${E} ${y}`,"Z"].join(" ");P.setAttribute("d",Y),P.setAttribute("fill",it((G=k.series)!=null?G:$,H)),P.style.cursor="pointer",P.addEventListener("mouseenter",Q=>{var O,j;return gt(s,u,$,h,(j=(O=k.notes)==null?void 0:O.length)!=null?j:0,Q)}),P.addEventListener("mouseleave",()=>mt(u)),P.addEventListener("click",()=>{var Q;return yt(s,g,$,h,(Q=k.notes)!=null?Q:[],o)}),a.appendChild(P),M+=v})}function Ne(s,e,t){var A;let{background:n,drilldown:o=!0}=(A=e.options)!=null?A:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:m,svg:a,tooltip:u,details:g}=wt(s,n),b=Math.max(i,700);m.style.width=b+"px",r&&(a.style.color=r);let D=300,w=b-48-10,x=D-28-28,f=t.rows.map(E=>{let y=E.x;if(y instanceof Date)return y.getTime();if(typeof y=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(y)){let P=new Date(y);if(!isNaN(P.getTime()))return P.getTime()}let N=Number(y);return isNaN(N)?null:N}return typeof y=="number"?y:null}),S=t.rows.map(E=>E.y),R=f.filter(E=>E!==null);if(R.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let M=Math.min(...R),_=Math.max(...R),k=Math.min(...S),H=Math.max(...S),$=E=>48+(E-M)/(_-M||1)*w,h=E=>D-28-(E-k)/(H-k||1)*x,v=document.createElementNS(a.namespaceURI,"line");v.setAttribute("x1",String(48)),v.setAttribute("y1",String(28)),v.setAttribute("x2",String(48)),v.setAttribute("y2",String(D-28)),v.setAttribute("stroke","currentColor"),a.appendChild(v);let c=document.createElementNS(a.namespaceURI,"line");c.setAttribute("x1",String(48)),c.setAttribute("y1",String(D-28)),c.setAttribute("x2",String(b-10)),c.setAttribute("y2",String(D-28)),c.setAttribute("stroke","currentColor"),a.appendChild(c),t.rows.forEach((E,y)=>{let N=f[y];if(N==null)return;let P=$(N),Y=h(S[y]),G=document.createElementNS(a.namespaceURI,"circle");G.setAttribute("cx",String(P)),G.setAttribute("cy",String(Y)),G.setAttribute("r","4"),G.setAttribute("fill",it(E.series,y)),G.style.cursor="pointer";let Q=E.x instanceof Date?E.x.toISOString().slice(0,10):typeof E.x=="string"?E.x:String(E.x);G.addEventListener("mouseenter",O=>{var j,F;return gt(s,u,Q,E.y,(F=(j=E.notes)==null?void 0:j.length)!=null?F:0,O)}),G.addEventListener("mouseleave",()=>mt(u)),G.addEventListener("click",O=>{var j;O.preventDefault(),yt(s,g,Q,E.y,(j=E.notes)!=null?j:[],o)}),a.appendChild(G)})}var Le=require("obsidian"),Kt=class{render(e,t,n,o,r=!1){var u;let{title:i}=(u=t.options)!=null?u:{};e.empty(),e.addClass("prop-charts-container");let a=e.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(a.textContent=i),t.type){case"bar":le(e,t,n);break;case"stacked-bar":ke(e,t,n);break;case"line":ue(e,t,n,!1);break;case"area":ue(e,t,n,!0);break;case"pie":Me(e,t,n);break;case"scatter":Ne(e,t,n);break;case"gantt":qt(e,t,n,o);break;default:e.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}if(!r){let g=e.createEl("button",{cls:"chart-notes-zoom-button"});g.setAttr("type","button"),g.setAttr("aria-label","Expandir gr\xE1fico"),g.textContent="\u2922",g.addEventListener("click",b=>{b.preventDefault(),new de(t,n,this,o).open()})}}},de=class extends Le.Modal{constructor(t,n,o,r){super(app);this.size="large";this.spec=t,this.data=n,this.renderer=o,this.ctx=r}onOpen(){var a;let{contentEl:t}=this;t.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),t.addClass("chart-notes-zoom-modal"),this.applySize();let n=t.createDiv({cls:"chart-notes-zoom-header"}),o=(a=this.spec.options)!=null&&a.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";n.createEl("div",{text:o,cls:"chart-notes-zoom-title"});let r=n.createDiv({cls:"chart-notes-zoom-sizes"}),i=(u,g)=>{let b=r.createEl("button",{cls:"chart-notes-zoom-size-btn",text:u});(()=>{b.toggleClass("is-active",this.size===g)})(),b.addEventListener("click",w=>{w.preventDefault(),this.size=g,this.applySize(),r.querySelectorAll(".chart-notes-zoom-size-btn").forEach(f=>f.classList.remove("is-active")),b.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let m=t.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(m,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let t=this.modalEl;if(!t)return;let n="95vw",o="85vh";switch(this.size){case"small":n="60vw",o="55vh";break;case"medium":n="80vw",o="70vh";break;case"large":default:n="95vw",o="85vh";break}t.style.maxWidth=n,t.style.width=n,t.style.height=o,t.style.maxHeight=o}};var pe="chartnotes-view",Zt=class extends Pe.BasesView{constructor(t,n){super(t);this.type=pe;this.containerEl=n.createDiv({cls:"chart-notes-bases-view"}),this.renderer=new Kt}onDataUpdated(){var _,k,H,$,h,v,c,A,E,y,N,P,Y,G,Q,O,j,F;let t=this.containerEl;t.empty();let n=this.data,o=(_=n==null?void 0:n.groupedData)!=null?_:[];if(!o.length){t.createDiv({cls:"prop-charts-empty",text:"Chart Notes (Bases): nenhum arquivo corresponde ao filtro atual."});return}let i=(((k=this.config.get("chartType"))!=null?k:"bar")||"bar").trim()||"bar",m=($=(H=this.config.get("xProperty"))==null?void 0:H.trim())!=null?$:"",a=(v=(h=this.config.get("yProperty"))==null?void 0:h.trim())!=null?v:"",u=(A=(c=this.config.get("seriesProperty"))==null?void 0:c.trim())!=null?A:"",g=(y=(E=this.config.get("startProperty"))==null?void 0:E.trim())!=null?y:"",b=(P=(N=this.config.get("endProperty"))==null?void 0:N.trim())!=null?P:"",D=(G=(Y=this.config.get("dueProperty"))==null?void 0:Y.trim())!=null?G:"",w=(O=(Q=this.config.get("durationProperty"))==null?void 0:Q.trim())!=null?O:"",x=(F=(j=this.config.get("groupProperty"))==null?void 0:j.trim())!=null?F:"",f=[];for(let d of o)for(let p of d.entries)f.push(p);let S=[];if(i==="gantt"?S=this.buildGanttRows(f,g,b,D,w,x):i==="scatter"?S=this.buildScatterRows(f,m,a,u):S=this.buildStandardRows(f,m,a,u),!S.length){t.createDiv({cls:"prop-charts-empty",text:"Chart Notes: n\xE3o h\xE1 dados para esse tipo de gr\xE1fico / propriedades escolhidas."});return}let R={type:i,source:{},encoding:{},options:{title:this.config.name||"Chart Notes (Bases)",...i==="gantt"?{editable:!1}:{}},aggregate:{}};!a&&i!=="gantt"&&i!=="scatter"&&(R.aggregate.y="count"),i==="gantt"&&(R.encoding={start:this.stripPrefix(g),end:this.stripPrefix(b),due:this.stripPrefix(D),duration:this.stripPrefix(w),group:this.stripPrefix(x),label:this.stripPrefix(m),series:this.stripPrefix(x)});let M={rows:S};this.renderer.render(t,R,M)}stripPrefix(t){if(!t)return;let n=t.indexOf(".");return n>=0?t.slice(n+1):t}buildStandardRows(t,n,o,r){var a,u,g,b,D,w;let i=new Map;for(let x of t){let f=x.file,S=(a=f==null?void 0:f.name)!=null?a:"",R=(u=f==null?void 0:f.path)!=null?u:"",M;if(n){let h=x.getValue(n),v=(g=h==null?void 0:h.toString)==null?void 0:g.call(h);if(!v)continue;M=v}else M=S;let _;if(r){let h=x.getValue(r),v=(b=h==null?void 0:h.toString)==null?void 0:b.call(h);v&&(_=v)}let k=1;if(o){let h=x.getValue(o),v=(w=h==null?void 0:h.value)!=null?w:(D=h==null?void 0:h.toString)==null?void 0:D.call(h),c=Number(v);if(!Number.isFinite(c))continue;k=c}let H=`${M}||${_!=null?_:""}`,$=i.get(H);$||($={x:M,series:_,sumY:0,count:0,notes:[]},i.set(H,$)),$.sumY+=k,$.count+=1,R&&$.notes.push(R)}let m=[];for(let x of i.values()){let f=o?x.sumY:x.count;m.push({x:x.x,y:f,series:x.series,notes:x.notes})}return m.sort((x,f)=>String(x.x).localeCompare(String(f.x))),m}buildScatterRows(t,n,o,r){var m,a,u,g,b;if(!n||!o)return[];let i=[];for(let D of t){let w=D.file,x=(m=w==null?void 0:w.path)!=null?m:"",f=D.getValue(n),S=D.getValue(o),R=(a=f==null?void 0:f.toString)==null?void 0:a.call(f),M=(g=S==null?void 0:S.value)!=null?g:(u=S==null?void 0:S.toString)==null?void 0:u.call(S),_=Number(M);if(!R||!Number.isFinite(_))continue;let k;if(r){let H=D.getValue(r),$=(b=H==null?void 0:H.toString)==null?void 0:b.call(H);$&&(k=$)}i.push({x:R,y:_,series:k,notes:x?[x]:[]})}return i}buildGanttRows(t,n,o,r,i,m){var u,g,b,D,w,x,f;if(!n&&!o)return[];let a=[];for(let S of t){let R=S.file,M=(u=R==null?void 0:R.name)!=null?u:"",_=(g=R==null?void 0:R.path)!=null?g:"",k=n?S.getValue(n):null,H=o?S.getValue(o):null,$=r?S.getValue(r):null,h=this.toDate(k),v=(b=this.toDate(H))!=null?b:h,c=this.toDate($);if(!h||!v)continue;let A;if(m){let P=S.getValue(m),Y=(D=P==null?void 0:P.toString)==null?void 0:D.call(P);Y&&(A=Y)}let E;if(i){let P=S.getValue(i),Y=(x=P==null?void 0:P.value)!=null?x:(w=P==null?void 0:P.toString)==null?void 0:w.call(P),G=Number(Y);Number.isFinite(G)&&(E=G)}let y={x:M,y:1,start:h,end:v,series:A,notes:_?[_]:[]},N={};if(E!=null&&i){let P=(f=this.stripPrefix(i))!=null?f:"duration";N[P]=E}Object.keys(N).length&&(y.props=N),c&&(y.due=c),a.push(y)}return a.sort((S,R)=>{let M=S.start.getTime(),_=R.start.getTime();return M-_}),a}toDate(t){var r;if(!t)return null;let n=(r=t.toString)==null?void 0:r.call(t);if(!n)return null;let o=new Date(n);return isNaN(o.getTime())?null:o}};var Ie=require("obsidian"),Jt=class{constructor(e){this.index=new Map;this.app=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(e){if(e.extension!=="md")return;let t={};try{let o=(await this.app.vault.read(e)).match(/^---\n([\s\S]*?)\n---\n?/);if(o){let i=(0,Ie.parseYaml)(o[1])||{};if(i&&typeof i=="object")for(let[m,a]of Object.entries(i))m!=="position"&&(t[m]=a)}let r=this.app.metadataCache.getFileCache(e);r!=null&&r.tags&&!t.tags&&(t.tags=r.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",e.path,n)}this.index.set(e.path,{path:e.path,props:t})}removeFile(e){this.index.delete(e.path)}};function $e(s,e){if(!e||e.length===0)return!0;for(let t of e){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function He(s,e){if(!e||e.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let o of e)if(t.includes(o)||t.includes("#"+o))return!0;return!1}let n=String(t);for(let o of e)if(n===o||n==="#"+o)return!0;return!1}function ee(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function $t(s){if(s instanceof Date)return s;if(typeof s!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(s)){let[t,n,o]=s.split("-");return new Date(Number(t),Number(n)-1,Number(o),0,0,0,0)}let e=new Date(s);return isNaN(e.getTime())?null:e}function ut(s){let e=new Date(s);return e.setHours(0,0,0,0),e}function te(s,e){let t=new Date(s);return t.setDate(t.getDate()-e),t}function qe(s,e){return te(s,e*7)}function je(s,e){let t=new Date(s);return t.setMonth(t.getMonth()-e),t}function he(s,e){let t=new Date(s);return t.setDate(t.getDate()+e),t}function Ze(s,e){return he(s,e*7)}function Je(s,e){let t=new Date(s);return t.setMonth(t.getMonth()+e),t}function _e(s){let e=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(e)||e.endsWith("date")||e.endsWith("at")||e.endsWith("on"))}function Fe(s,e){let t=e?new Date(e):new Date,n=ut(t),o=s.trim().toLowerCase();if(o==="today")return n;if(o==="yesterday")return ut(te(n,1));if(/^-\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(te(n,r))}if(/^-\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(te(n,r))}if(/^-\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(qe(n,r))}if(/^-\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(je(n,r))}if(/^\+\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(he(n,r))}if(/^\+\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(he(n,r))}if(/^\+\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Ze(n,r))}if(/^\+\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Je(n,r))}return null}function Qe(s){let e=s.trim(),t=e.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let g=t[1].trim(),b=t[2].trim(),D=t[3].trim(),w=_e(g),x=fe(b,w),f=fe(D,w),S=x.valueType==="date"||f.valueType==="date"?"date":x.valueType;return{field:g,op:"between",value:x.value,value2:f.value,valueType:S}}let n=/(==|!=|>=|<=|>|<)/,o=e.split(n);if(o.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+s);let r=o[0].trim(),i=o[1].trim(),m=o[2].trim(),a=_e(r),u=fe(m,a);return{field:r,op:i,value:u.value,valueType:u.valueType}}function fe(s,e){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),o=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(e){if(t==="0"||n==="today")return{value:ut(new Date),valueType:"date"};let i=Fe(t);if(i)return{value:i,valueType:"date"}}else if(o){let i=Fe(t);if(i)return{value:i,valueType:"date"}}if(ee(t)){let i=$t(t);if(i)return{value:i,valueType:"date"}}let r=Number(t);return Number.isNaN(r)?{value:t,valueType:"string"}:{value:r,valueType:"number"}}function ze(s,e){let t=s[e.field];if(t==null)return!1;if(e.valueType==="date"){let r=t instanceof Date?ut(t):ee(t)?ut($t(t)):null;if(!r)return!1;let i=e.value instanceof Date?e.value:null,m=e.value2 instanceof Date?e.value2:null;if(!i)return!1;let a=r.getTime(),u=ut(i).getTime();switch(e.op){case"==":return a===u;case"!=":return a!==u;case">":return a>u;case">=":return a>=u;case"<":return a<u;case"<=":return a<=u;case"between":if(!m)return!1;let g=ut(m).getTime();return a>=u&&a<=g}}if(e.valueType==="number"){let r=Number(t);if(isNaN(r))return!1;let i=Number(e.value);switch(e.op){case"==":return r===i;case"!=":return r!==i;case">":return r>i;case">=":return r>=i;case"<":return r<i;case"<=":return r<=i;case"between":return typeof e.value2!="number"?!1:r>=i&&r<=e.value2}}let n=String(t),o=String(e.value);switch(e.op){case"==":return n===o;case"!=":return n!==o;case">":return n>o;case">=":return n>=o;case"<":return n<o;case"<=":return n<=o;case"between":return!1}}function tn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(ee(s)){let e=$t(s);if(e)return{key:e,isDate:!0}}return{key:s,isDate:!1}}function en(s,e){let t=s.x,n=e.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let o=String(t),r=String(n);return o<r?-1:o>r?1:0}function nn(s,e){var r,i;let t=en(s,e);if(t!==0)return t;let n=(r=s.series)!=null?r:"",o=(i=e.series)!=null?i:"";return n<o?-1:n>o?1:0}function sn(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let e=s.trim().match(/^(\d+)/);if(e){let t=Number(e[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(s)}`)}function rn(s){var n,o;let e=new Map,t=[];for(let r of s){let i=(n=r.series)!=null?n:"__no_series__",a=((o=e.get(i))!=null?o:0)+r.y;e.set(i,a),t.push({...r,y:a})}return t}function on(s,e){var i,m;let t=sn(e);if(!t||t<=1)return[...s];let n=new Map,o=new Map,r=[];for(let a of s){let u=(i=a.series)!=null?i:"__no_series__",g=n.get(u);g||(g=[],n.set(u,g));let b=(m=o.get(u))!=null?m:0;if(g.push(a.y),b+=a.y,g.length>t){let x=g.shift();b-=x}o.set(u,b);let D=g.length||1,w=b/D;r.push({...a,y:w})}return r}var ne=class{constructor(e,t){this.getIndex=e,this.defaultPaths=t}run(e){var i,m,a;let t=this.getIndex(),n=(i=e.source)!=null&&i.paths&&e.source.paths.length?e.source.paths:this.defaultPaths,o=(m=e.source)!=null&&m.tags&&e.source.tags.length?e.source.tags:[],r=[];for(let u of t){let g=n&&n.length?$e(u.path,n):!0,b=o&&o.length?He(u.props,o):!0;if(!g||!b)continue;let D=!0;if((a=e.source)!=null&&a.where&&e.source.where.length>0)for(let w of e.source.where){let x;try{x=Qe(w)}catch(f){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${w} (${f.message})`)}if(!ze(u.props,x)){D=!1;break}}D&&r.push(u)}return e.type==="gantt"?this.runGantt(e,r):e.type==="table"?this.runTable(e,r):this.runStandard(e,r)}runTable(e,t){var o,r;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(o=e.encoding)==null?void 0:o.x,yField:(r=e.encoding)==null?void 0:r.y}}runGantt(e,t){var b,D,w;let n=(b=e.encoding)!=null?b:{},o=n.start,r=n.end,i=(D=n.label)!=null?D:n.x,m=n.series,a=n.duration,u=n.due,g=[];for(let x of t){let f=(w=x.props)!=null?w:{},S=h=>Array.isArray(h)?h[0]:h,R=null;if(r){let h=S(f[r]),v=$t(h);v&&(R=v)}if(!R)continue;let M=null;if(o){let h=S(f[o]),v=$t(h);v&&(M=v)}if(!M&&a){let h=S(f[a]),v=Number(h);Number.isNaN(v)||(M=new Date(R.getTime()-v*6e4))}M||(M=new Date(R.getTime()));let _;if(u){let h=S(f[u]),v=$t(h);v&&(_=v)}let k;if(i){let h=S(f[i]);(h==null||h==="")&&(h=x.path),k=h}else k=x.path;let H;if(m){let h=S(f[m]);h!=null&&(H=String(h))}let $={x:k,y:0,notes:[x.path],series:H,start:M,end:R,props:f};_&&($.due=_),g.push($)}return g.sort((x,f)=>{let S=x.start?x.start.getTime():0,R=f.start?f.start.getTime():0;return S-R}),{rows:g,xField:i,yField:r}}runStandard(e,t){var x,f,S,R,M,_,k,H,$,h;let n=(x=e.encoding)==null?void 0:x.x,o=(f=e.encoding)==null?void 0:f.y,r=(S=e.encoding)==null?void 0:S.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(R=e.aggregate)!=null?R:{},m=(M=i.y)!=null?M:null,a=!!i.cumulative,u=i.rolling;if(!o&&m!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let g=[];for(let v of t){let c=(_=v.props)!=null?_:{},A=Q=>Array.isArray(Q)?Q[0]:Q,E=A(c[n]);if(E==null)continue;let y=tn(E),N=y.key,P=y.isDate,Y;if(r){let Q=A(c[r]);Q!=null&&String(Q).trim()!==""&&(Y=String(Q))}let G;if(m==="count")G=1;else{let Q=A(c[o]);if(Q==null)continue;let O=Number(Q);if(Number.isNaN(O))continue;G=O}g.push({x:N,y:G,notes:[v.path],series:Y,props:c,_isDate:P,_origX:E})}if(g.length===0)return{rows:[],xField:n,yField:o};let b=[];if(m){let v=new Map;for(let c of g){let A=(k=c.series)!=null?k:"",E=c.x instanceof Date?c.x.toISOString().slice(0,10):String(c.x),y=A+"||"+E,N=(H=v.get(y))!=null?H:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:c.x,isDate:c._isDate,series:c.series,props:c.props};N.sum+=c.y,N.count+=1,c.y<N.min&&(N.min=c.y),c.y>N.max&&(N.max=c.y),N.notes.push(...c.notes),N.props=($=c.props)!=null?$:N.props,v.set(y,N)}for(let[,c]of v){let A=c.sum;switch(m){case"sum":A=c.sum;break;case"avg":A=c.sum/c.count;break;case"min":A=c.min;break;case"max":A=c.max;break;case"count":A=c.count;break}b.push({x:c.xRep,y:A,notes:c.notes,series:c.series,props:c.props})}}else b=g.map(v=>({x:v.x,y:v.y,notes:v.notes,series:v.series,props:v.props}));if(b.length===0)return{rows:[],xField:n,yField:o};let D=((h=e.sort)==null?void 0:h.x)==="desc"?"desc":"asc";if(b.sort((v,c)=>{let A=nn(v,c);return D==="asc"?A:-A}),(a||u)&&!(e.type==="line"||e.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(a&&u)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let w=b;return u?w=on(b,u):a&&(w=rn(b)),{rows:w,xField:n,yField:o}}};var se=class extends Pt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new Jt(this.app),await this.indexer.buildIndex(),this.query=new ne(()=>this.indexer.getAll(),[]),this.renderer=new Kt,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Pt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Pt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Pt.TFile&&this.indexer.removeFile(t)})),this.registerMarkdownCodeBlockProcessor("chart",async(t,n,o)=>{var g;let r;try{let b=(0,Pt.parseYaml)(t);if(!b||typeof b!="object"){n.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}r=b}catch(b){n.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+b.message});return}if(!r.type){n.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=r.type==="gantt",m=r.type==="table";if(!i&&!m){if(!r.encoding||!r.encoding.x){n.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let D=((g=r.aggregate)==null?void 0:g.y)==="count";if(!r.encoding.y&&!D){n.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}r.encoding||(r.encoding={}),r.source||(r.source={});let u;try{u=this.query.run(r)}catch(b){n.createEl("div",{text:"Chart Notes: erro na query: "+b.message});return}this.renderer.render(n,r,u)}),this.registerBasesView(pe,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new Zt(t,n),options:()=>[{type:"text",key:"chartType",displayName:"Tipo do gr\xE1fico (bar, line, area, pie, scatter, gantt, stacked-bar)",default:"bar"},{type:"text",key:"xProperty",displayName:"Propriedade X / label (ex: file.name, note.status)",default:"file.name"},{type:"text",key:"yProperty",displayName:"Propriedade Y / valor num\xE9rico (vazio = conta linhas)",default:""},{type:"text",key:"seriesProperty",displayName:"S\xE9rie / legenda (opcional, ex: note.priority)",default:""},{type:"text",key:"startProperty",displayName:"In\xEDcio (Gantt, ex: note.startDate)",default:""},{type:"text",key:"endProperty",displayName:"Fim (Gantt, ex: note.scheduled)",default:""},{type:"text",key:"dueProperty",displayName:"Due date (Gantt, opcional)",default:""},{type:"text",key:"durationProperty",displayName:"Dura\xE7\xE3o em minutos (Gantt, opcional, ex: note.timeEstimate)",default:""},{type:"text",key:"groupProperty",displayName:"Grupo (Gantt / s\xE9ries, opcional, ex: note.projects)",default:""}]})}onunload(){console.log("unloading Chart Notes plugin")}};
