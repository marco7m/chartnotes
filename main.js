/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ie=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Ve=Object.prototype.hasOwnProperty;var Ye=(r,e)=>{for(var t in e)ie(r,t,{get:e[t],enumerable:!0})},Xe=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Oe(e))!Ve.call(r,s)&&s!==t&&ie(r,s,{get:()=>e[s],enumerable:!(n=Ge(e,s))||n.enumerable});return r};var qe=r=>Xe(ie({},"__esModule",{value:!0}),r);var cn={};Ye(cn,{default:()=>ne});module.exports=qe(cn);var Pt=require("obsidian");var Ce=require("obsidian"),qt=class{constructor(e){this.index=new Map;this.app=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(e){if(e.extension!=="md")return;let t={};try{let s=(await this.app.vault.read(e)).match(/^---\n([\s\S]*?)\n---\n?/);if(s){let i=(0,Ce.parseYaml)(s[1])||{};if(i&&typeof i=="object")for(let[p,a]of Object.entries(i))p!=="position"&&(t[p]=a)}let o=this.app.metadataCache.getFileCache(e);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",e.path,n)}this.index.set(e.path,{path:e.path,props:t})}removeFile(e){this.index.delete(e.path)}};function Te(r,e){if(!e||e.length===0)return!0;for(let t of e){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(r===t||r.startsWith(n))return!0}return!1}function Me(r,e){if(!e||e.length===0)return!0;let t=r.tags;if(!t)return!1;if(Array.isArray(t)){for(let s of e)if(t.includes(s)||t.includes("#"+s))return!0;return!1}let n=String(t);for(let s of e)if(n===s||n==="#"+s)return!0;return!1}function Zt(r){return typeof r!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(r)}function $t(r){if(r instanceof Date)return r;if(typeof r!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(r)){let[t,n,s]=r.split("-");return new Date(Number(t),Number(n)-1,Number(s),0,0,0,0)}let e=new Date(r);return isNaN(e.getTime())?null:e}function ut(r){let e=new Date(r);return e.setHours(0,0,0,0),e}function jt(r,e){let t=new Date(r);return t.setDate(t.getDate()-e),t}function je(r,e){return jt(r,e*7)}function Ze(r,e){let t=new Date(r);return t.setMonth(t.getMonth()-e),t}function ce(r,e){let t=new Date(r);return t.setDate(t.getDate()+e),t}function Je(r,e){return ce(r,e*7)}function tn(r,e){let t=new Date(r);return t.setMonth(t.getMonth()+e),t}function Re(r){let e=r.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(e)||e.endsWith("date")||e.endsWith("at")||e.endsWith("on"))}function ke(r,e){let t=e?new Date(e):new Date,n=ut(t),s=r.trim().toLowerCase();if(s==="today")return n;if(s==="yesterday")return ut(jt(n,1));if(/^-\d+$/.test(s)){let o=parseInt(s.slice(1),10);return ut(jt(n,o))}if(/^-\d+d$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(jt(n,o))}if(/^-\d+w$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(je(n,o))}if(/^-\d+m$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(Ze(n,o))}if(/^\+\d+$/.test(s)){let o=parseInt(s.slice(1),10);return ut(ce(n,o))}if(/^\+\d+d$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(ce(n,o))}if(/^\+\d+w$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(Je(n,o))}if(/^\+\d+m$/.test(s)){let o=parseInt(s.slice(1,-1),10);return ut(tn(n,o))}return null}function Ne(r){let e=r.trim(),t=e.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let h=t[1].trim(),g=t[2].trim(),R=t[3].trim(),S=Re(h),v=ae(g,S),y=ae(R,S),L=v.valueType==="date"||y.valueType==="date"?"date":v.valueType;return{field:h,op:"between",value:v.value,value2:y.value,valueType:L}}let n=/(==|!=|>=|<=|>|<)/,s=e.split(n);if(s.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+r);let o=s[0].trim(),i=s[1].trim(),p=s[2].trim(),a=Re(o),l=ae(p,a);return{field:o,op:i,value:l.value,valueType:l.valueType}}function ae(r,e){let t=r.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),s=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(e){if(t==="0"||n==="today")return{value:ut(new Date),valueType:"date"};let i=ke(t);if(i)return{value:i,valueType:"date"}}else if(s){let i=ke(t);if(i)return{value:i,valueType:"date"}}if(Zt(t)){let i=$t(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Le(r,e){let t=r[e.field];if(t==null)return!1;if(e.valueType==="date"){let o=t instanceof Date?ut(t):Zt(t)?ut($t(t)):null;if(!o)return!1;let i=e.value instanceof Date?e.value:null,p=e.value2 instanceof Date?e.value2:null;if(!i)return!1;let a=o.getTime(),l=ut(i).getTime();switch(e.op){case"==":return a===l;case"!=":return a!==l;case">":return a>l;case">=":return a>=l;case"<":return a<l;case"<=":return a<=l;case"between":if(!p)return!1;let h=ut(p).getTime();return a>=l&&a<=h}}if(e.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(e.value);switch(e.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof e.value2!="number"?!1:o>=i&&o<=e.value2}}let n=String(t),s=String(e.value);switch(e.op){case"==":return n===s;case"!=":return n!==s;case">":return n>s;case">=":return n>=s;case"<":return n<s;case"<=":return n<=s;case"between":return!1}}function en(r){if(typeof r=="string"&&/^\d{4}-\d{2}-\d{2}/.test(r))return{key:r.slice(0,10),isDate:!0};if(Zt(r)){let e=$t(r);if(e)return{key:e,isDate:!0}}return{key:r,isDate:!1}}function nn(r,e){let t=r.x,n=e.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let s=String(t),o=String(n);return s<o?-1:s>o?1:0}function rn(r,e){var o,i;let t=nn(r,e);if(t!==0)return t;let n=(o=r.series)!=null?o:"",s=(i=e.series)!=null?i:"";return n<s?-1:n>s?1:0}function sn(r){if(r==null)return 0;if(typeof r=="number")return r>0?Math.floor(r):0;if(typeof r=="string"){let e=r.trim().match(/^(\d+)/);if(e){let t=Number(e[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(r)}`)}function on(r){var n,s;let e=new Map,t=[];for(let o of r){let i=(n=o.series)!=null?n:"__no_series__",a=((s=e.get(i))!=null?s:0)+o.y;e.set(i,a),t.push({...o,y:a})}return t}function an(r,e){var i,p;let t=sn(e);if(!t||t<=1)return[...r];let n=new Map,s=new Map,o=[];for(let a of r){let l=(i=a.series)!=null?i:"__no_series__",h=n.get(l);h||(h=[],n.set(l,h));let g=(p=s.get(l))!=null?p:0;if(h.push(a.y),g+=a.y,h.length>t){let v=h.shift();g-=v}s.set(l,g);let R=h.length||1,S=g/R;o.push({...a,y:S})}return o}var Jt=class{constructor(e,t){this.getIndex=e,this.defaultPaths=t}run(e){var i,p,a;let t=this.getIndex(),n=(i=e.source)!=null&&i.paths&&e.source.paths.length?e.source.paths:this.defaultPaths,s=(p=e.source)!=null&&p.tags&&e.source.tags.length?e.source.tags:[],o=[];for(let l of t){let h=n&&n.length?Te(l.path,n):!0,g=s&&s.length?Me(l.props,s):!0;if(!h||!g)continue;let R=!0;if((a=e.source)!=null&&a.where&&e.source.where.length>0)for(let S of e.source.where){let v;try{v=Ne(S)}catch(y){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${S} (${y.message})`)}if(!Le(l.props,v)){R=!1;break}}R&&o.push(l)}return e.type==="gantt"?this.runGantt(e,o):e.type==="table"?this.runTable(e,o):this.runStandard(e,o)}runTable(e,t){var s,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(s=e.encoding)==null?void 0:s.x,yField:(o=e.encoding)==null?void 0:o.y}}runGantt(e,t){var g,R,S;let n=(g=e.encoding)!=null?g:{},s=n.start,o=n.end,i=(R=n.label)!=null?R:n.x,p=n.series,a=n.duration,l=n.due,h=[];for(let v of t){let y=(S=v.props)!=null?S:{},L=b=>Array.isArray(b)?b[0]:b,I=null;if(o){let b=L(y[o]),x=$t(b);x&&(I=x)}if(!I)continue;let P=null;if(s){let b=L(y[s]),x=$t(b);x&&(P=x)}if(!P&&a){let b=L(y[a]),x=Number(b);Number.isNaN(x)||(P=new Date(I.getTime()-x*6e4))}P||(P=new Date(I.getTime()));let _;if(l){let b=L(y[l]),x=$t(b);x&&(_=x)}let T;if(i){let b=L(y[i]);(b==null||b==="")&&(b=v.path),T=b}else T=v.path;let U;if(p){let b=L(y[p]);b!=null&&(U=String(b))}let Q={x:T,y:0,notes:[v.path],series:U,start:P,end:I,props:y};_&&(Q.due=_),h.push(Q)}return h.sort((v,y)=>{let L=v.start?v.start.getTime():0,I=y.start?y.start.getTime():0;return L-I}),{rows:h,xField:i,yField:o}}runStandard(e,t){var v,y,L,I,P,_,T,U,Q,b;let n=(v=e.encoding)==null?void 0:v.x,s=(y=e.encoding)==null?void 0:y.y,o=(L=e.encoding)==null?void 0:L.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(I=e.aggregate)!=null?I:{},p=(P=i.y)!=null?P:null,a=!!i.cumulative,l=i.rolling;if(!s&&p!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let h=[];for(let x of t){let u=(_=x.props)!=null?_:{},E=$=>Array.isArray($)?$[0]:$,D=E(u[n]);if(D==null)continue;let m=en(D),N=m.key,G=m.isDate,nt;if(o){let $=E(u[o]);$!=null&&String($).trim()!==""&&(nt=String($))}let B;if(p==="count")B=1;else{let $=E(u[s]);if($==null)continue;let j=Number($);if(Number.isNaN(j))continue;B=j}h.push({x:N,y:B,notes:[x.path],series:nt,props:u,_isDate:G,_origX:D})}if(h.length===0)return{rows:[],xField:n,yField:s};let g=[];if(p){let x=new Map;for(let u of h){let E=(T=u.series)!=null?T:"",D=u.x instanceof Date?u.x.toISOString().slice(0,10):String(u.x),m=E+"||"+D,N=(U=x.get(m))!=null?U:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:u.x,isDate:u._isDate,series:u.series,props:u.props};N.sum+=u.y,N.count+=1,u.y<N.min&&(N.min=u.y),u.y>N.max&&(N.max=u.y),N.notes.push(...u.notes),N.props=(Q=u.props)!=null?Q:N.props,x.set(m,N)}for(let[,u]of x){let E=u.sum;switch(p){case"sum":E=u.sum;break;case"avg":E=u.sum/u.count;break;case"min":E=u.min;break;case"max":E=u.max;break;case"count":E=u.count;break}g.push({x:u.xRep,y:E,notes:u.notes,series:u.series,props:u.props})}}else g=h.map(x=>({x:x.x,y:x.y,notes:x.notes,series:x.series,props:x.props}));if(g.length===0)return{rows:[],xField:n,yField:s};let R=((b=e.sort)==null?void 0:b.x)==="desc"?"desc":"asc";if(g.sort((x,u)=>{let E=rn(x,u);return R==="asc"?E:-E}),(a||l)&&!(e.type==="line"||e.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(a&&l)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let S=g;return l?S=an(g,l):a&&(S=on(g)),{rows:S,xField:n,yField:s}}};var Ct=require("obsidian");var Pe=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function it(r,e){if(!r)return"var(--text-accent, #5b6cff)";let t=Array.from(r).reduce((n,s)=>n*33+s.charCodeAt(0)>>>0,0);return Pe[t%Pe.length]}function wt(r,e){r.addClass("prop-charts-container"),r.style.width="100%",r.style.maxWidth="100%",r.style.position="relative";let t=r.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,e&&(n.style.background=e);let s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=r.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let p=r.createDiv({cls:"chart-notes-details"});return p.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:p}}function gt(r,e,t,n,s,o){let i=r.getBoundingClientRect(),p=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);e.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${p}</div>
    <div class="chart-notes-tooltip-notes">${s} nota${s===1?"":"s"}</div>
  `,e.style.display="block";let a=e.getBoundingClientRect(),l=o.clientX-i.left+6,h=o.clientY-i.top+6;l+a.width>i.width-4&&(l=i.width-a.width-4),l<4&&(l=4),h+a.height>i.height-4&&(h=i.height-a.height-4),h<4&&(h=4),e.style.left=l+"px",e.style.top=h+"px"}function mt(r){r.style.display="none"}function yt(r,e,t,n,s,o){if(!o)return;if(e.empty(),!s||s.length===0){e.style.display="none";return}e.style.display="block";let i=e.createEl("div",{cls:"chart-notes-details-header"}),p=i.createEl("div",{cls:"chart-notes-details-title"});p.textContent=`Notas em "${t}" (${s.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{e.style.display="none"});let l=e.createEl("ul",{cls:"chart-notes-details-list"});for(let h of s){let R=l.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:h});R.href="#",R.addEventListener("click",S=>{S.preventDefault(),app.workspace.openLinkText(h,"",!1)})}}function zt(r){if(!(r instanceof Date)||isNaN(r.getTime()))return"";let e=r.getDate().toString().padStart(2,"0"),t=(r.getMonth()+1).toString().padStart(2,"0");return`${e}/${t}`}function Ie(r){if(!r)return!1;let e=r.trim().toLowerCase();if(e==="#fff"||e==="#ffffff"||e==="white")return!0;if(!e.startsWith("#"))return!1;let t,n,s;if(e.length===4)t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),s=parseInt(e[3]+e[3],16);else if(e.length===7)t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*s)/255>.7}var le=class extends Ct.Modal{constructor(t,n,s,o){var p;super(app);this.notePath=t,this.spec=n,this.refresh=s,this.reindexFile=o;let i=(p=n.encoding)!=null?p:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var b,x;let{contentEl:t}=this;t.empty();let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Ct.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let s=await this.app.vault.read(n),o={},i=s,p=/^---\n([\s\S]*?)\n---\n?/m.exec(s);if(p){try{o=(b=(0,Ct.parseYaml)(p[1]))!=null?b:{}}catch(u){o={}}i=s.slice(p[0].length)}(typeof o!="object"||o==null)&&(o={});let a=(x=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?x:this.notePath,l=t.createDiv({cls:"gantt-edit-header"}),h=l.createEl("a",{text:a,cls:"gantt-edit-title"});h.href="#",h.addEventListener("click",u=>{u.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let g=l.createDiv({cls:"gantt-edit-subtitle"});g.textContent=this.notePath;let R=t.createDiv({cls:"gantt-edit-form"}),S=u=>{let E=R.createDiv({cls:"gantt-edit-row"}),D=E.createDiv({cls:"gantt-edit-label"});D.textContent=u;let m=E.createDiv({cls:"gantt-edit-field"});return{row:E,field:m}},v=u=>{if(!u)return"";let D=String(u).match(/^(\d{4}-\d{2}-\d{2})/);return D?D[1]:""},y=u=>{if(u=u.trim(),!!u&&/^\d{4}-\d{2}-\d{2}$/.test(u))return u},L=null;if(this.startKey){let{field:u}=S(this.startKey+" (in\xEDcio)");L=u.createEl("input",{type:"date"}),L.value=v(o[this.startKey])}let I=null;if(this.endKey){let{field:u}=S(this.endKey+" (fim)");I=u.createEl("input",{type:"date"}),I.value=v(o[this.endKey])}let P=null;if(this.durationKey){let{field:u}=S(this.durationKey+" (minutos)");P=u.createEl("input",{type:"number"});let E=o[this.durationKey];P.value=E!=null?String(E):"",P.min="0",P.step="5"}let _=null;if(this.dueKey){let{field:u}=S(this.dueKey+" (due)");_=u.createEl("input",{type:"date"}),_.value=v(o[this.dueKey])}let T=t.createDiv({cls:"gantt-edit-buttons"}),U=T.createEl("button",{text:"Salvar",cls:"mod-cta"});T.createEl("button",{text:"Cancelar"}).addEventListener("click",u=>{u.preventDefault(),this.close()}),U.addEventListener("click",async u=>{if(u.preventDefault(),this.startKey&&L){let m=y(L.value);m?o[this.startKey]=m:delete o[this.startKey]}if(this.endKey&&I){let m=y(I.value);m?o[this.endKey]=m:delete o[this.endKey]}if(this.durationKey&&P){let m=P.value.trim();if(m==="")delete o[this.durationKey];else{let N=Number(m);Number.isNaN(N)||(o[this.durationKey]=N)}}if(this.dueKey&&_){let m=y(_.value);m?o[this.dueKey]=m:delete o[this.dueKey]}let D=`---
${(0,Ct.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,D),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(m){}if(this.refresh)try{this.refresh()}catch(m){}new Ct.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function te(r,e,t,n){var ge,me,ye,be,xe,ve,Se,we;let s=(ge=e.options)!=null?ge:{},o=s.background,i=(me=s.drilldown)!=null?me:!0,p=!0,a=c=>{if(c==null)return"";let C=String(c).trim();if(!C)return"";let F=C.match(/^\[\[(.+?)\]\]$/);F&&(C=F[1]);let V=C.lastIndexOf("/");return V>=0&&V<C.length-1&&(C=C.slice(V+1)),C};if(Array.from(r.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(c=>c.remove()),t.rows.length===0){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let l=t.rows.filter(c=>c.start&&c.end);if(l.length===0){r.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let h=e.encoding,g=h.group,R=h.duration,S=(c,C)=>{if(!c||!C)return;let F=c[C];return Array.isArray(F)?F[0]:F},y=l.map(c=>{var xt,lt;let C=c.start,F=c.end,V=c.props,It=typeof c.x=="string"?c.x:c.x instanceof Date?zt(C):String(c.x),At=a(It),bt,Ft=g?S(V,g):void 0;Ft!=null?bt=String(Ft):c.series!=null?bt=String(c.series):bt=At;let ht=(xt=c.notes)==null?void 0:xt[0],Et=ht?(lt=ht.replace(/\.md$/i,"").split("/").pop())!=null?lt:ht:At,Rt=c.due,_t,Nt=S(V,R);if(Nt!=null){let vt=Number(Nt);Number.isNaN(vt)||(_t=vt)}return{row:c,start:C,end:F,props:V,fullName:At,groupKey:bt,notePath:ht,noteTitle:Et,due:Rt,estMinutes:_t}}).filter(c=>c.start instanceof Date&&!isNaN(c.start.getTime())&&c.end instanceof Date&&!isNaN(c.end.getTime()));if(y.length===0){r.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}y.sort((c,C)=>{if(c.groupKey<C.groupKey)return-1;if(c.groupKey>C.groupKey)return 1;let F=c.start.getTime(),V=C.start.getTime();return F!==V?F-V:c.fullName.localeCompare(C.fullName)});let L=26,I=0,P=null;for(let c of y)c.groupKey!==P&&(P=c.groupKey,I+=1),I+=1;let _=Math.min(...y.map(c=>c.start.getTime())),T=Math.max(...y.map(c=>c.end.getTime()));if(!isFinite(_)||!isFinite(T)){r.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let U=24*60*60*1e3,Q=c=>{let C=new Date(c);return C.setHours(0,0,0,0),C.getTime()},b=Q(_),x=Q(T),u=r.querySelector(".prop-charts-title-row");u||(u=r.createDiv({cls:"prop-charts-title-row"}));let E=r.dataset.ganttZoomMode||String((ye=s.zoomMode)!=null?ye:"100");r.dataset.ganttZoomMode=E;let D=r.dataset.ganttLabelMode||String((be=s.labelMode)!=null?be:"compact");r.dataset.ganttLabelMode=D;let m=u.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(c=>{let C=m.createEl("button",{cls:"gantt-zoom-btn",text:c.label});c.id===E&&C.addClass("is-active"),C.addEventListener("click",F=>{F.preventDefault(),r.dataset.ganttZoomMode=c.id,te(r,e,t,n)})}),m.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",c=>{c.preventDefault();let C=r.querySelector(".chart-notes-zoom-button");C&&C.click()});let nt=Number(s.labelWidth),B=!Number.isNaN(nt)&&nt>120?nt:260,$=D==="wide"?B+160:B,j=r.getBoundingClientRect().width||600,tt=Math.max(j,820),M;if(E==="fit")M=j;else{let c=Number(E)/100||1;M=tt*c}let{inner:d,svg:f,tooltip:w,details:A}=wt(r,o);d.style.width=M+"px";let k=(c,C,F,V,It,At,bt,Ft,ht)=>{if(!c)return;let Et=Math.max(40,V-8),_t=Math.max(8,Math.floor(Et/6)),Nt=c.split(/\s+/),xt=[],lt="";for(let kt of Nt){if(!lt){lt=kt;continue}(lt+" "+kt).length<=_t?lt+=" "+kt:(xt.push(lt),lt=kt)}lt&&xt.push(lt);let vt=It+2,Bt=xt.length*vt,Gt=F-Bt/2+It;xt.forEach((kt,Yt)=>{let ot=document.createElementNS(f.namespaceURI,"text");ot.setAttribute("x",String(C)),ot.setAttribute("y",String(Gt+Yt*vt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(It)),ot.setAttribute("fill","#111111"),At&&ot.setAttribute("font-weight",At),ot.textContent=kt,bt&&ot.addEventListener("mouseenter",rt=>bt(rt)),Ft&&ot.addEventListener("mouseleave",()=>Ft()),ht&&(ot.style.cursor="pointer",ot.addEventListener("click",rt=>ht(rt))),f.appendChild(ot)})},Z=28,z=28,st=10,Y=Math.max(300,Z+z+I*L+24);f.setAttribute("height",String(Y));let K=M-$-st,W=Z+6;f.style.color="#111111";let J=x+U-b||1,at=b-J*.02,ft=x+U+J*.08,ct=c=>$+(c-at)/(ft-at)*K,H=(ft-at)/U,Mt=Math.max(4,Math.min(12,Math.floor(K/90)||4)),dt=H/Mt,q=[1,2,3,5,7,10,14,21,30,60,90,180,365],pt=q[q.length-1];for(let c of q)if(c>=dt){pt=c;break}let Ut=[],Ke=Q(at);for(let c=Ke;c<=ft+.5*U;c+=pt*U)Ut.push(c);let Ht=document.createElementNS(f.namespaceURI,"line");Ht.setAttribute("x1",String($)),Ht.setAttribute("y1",String(W)),Ht.setAttribute("x2",String(M-st)),Ht.setAttribute("y2",String(W)),Ht.setAttribute("stroke","#111111"),f.appendChild(Ht);for(let c of Ut){let C=ct(c),F=document.createElementNS(f.namespaceURI,"line");F.setAttribute("x1",String(C)),F.setAttribute("y1",String(W)),F.setAttribute("x2",String(C)),F.setAttribute("y2",String(Y-z)),F.setAttribute("stroke","#111111"),F.setAttribute("stroke-opacity","0.20"),F.setAttribute("stroke-dasharray","2,4"),f.appendChild(F);let V=document.createElementNS(f.namespaceURI,"text");V.setAttribute("x",String(C)),V.setAttribute("y",String(W-4)),V.setAttribute("text-anchor","middle"),V.setAttribute("font-size","10"),V.setAttribute("fill","#111111"),V.textContent=zt(new Date(c)),f.appendChild(V)}let he=new Date;he.setHours(0,0,0,0);let re=he.getTime();if(re>=at&&re<=ft){let c=ct(re),C=document.createElementNS(f.namespaceURI,"line");C.setAttribute("x1",String(c)),C.setAttribute("y1",String(W)),C.setAttribute("x2",String(c)),C.setAttribute("y2",String(Y-z)),C.setAttribute("stroke","#4caf50"),C.setAttribute("stroke-width","2"),C.setAttribute("stroke-dasharray","4,2"),f.appendChild(C);let F=document.createElementNS(f.namespaceURI,"text");F.setAttribute("x",String(c+4)),F.setAttribute("y",String(W+12)),F.setAttribute("font-size","10"),F.setAttribute("fill","#4caf50"),F.textContent="hoje",f.appendChild(F)}let Vt=d.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Vt.setAttr("title",D==="wide"?"Compactar nomes":"Expandir nomes"),Vt.style.left=`${$}px`,Vt.style.top="4px",Vt.addEventListener("click",c=>{c.preventDefault();let F=(r.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";r.dataset.ganttLabelMode=F,te(r,e,t,n)});let We=["status","priority"],se=Array.isArray(s.tooltipFields)?s.tooltipFields.map(c=>String(c)):null,Ue=se&&se.length?se:We,Qt=0,oe=null;for(let c of y){let C=c.start,F=c.end,V=(F.getTime()-C.getTime())/6e4,It=c.props,At=c.notePath,bt=c.noteTitle,Ft=(ve=(xe=c.row.notes)==null?void 0:xe.length)!=null?ve:0,ht=c.due,Et=c.estMinutes,Rt=[];Rt.push(`${zt(C)} \u2192 ${zt(F)}`),typeof Et=="number"&&!Number.isNaN(Et)?Rt.push(`est: ${Math.round(Et)} min`):V>0&&Rt.push(`dura\xE7\xE3o: ${Math.round(V)} min`),ht instanceof Date&&Rt.push(`due: ${zt(ht)}`);for(let et of Ue){let O=S(It,et);O!=null&&String(O).trim()!==""&&Rt.push(`${et}: ${String(O)}`)}let _t=Rt.join("<br>"),Nt=et=>{var O;et.preventDefault(),p&&At?new le(At,e,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():yt(r,A,bt,Et!=null?Et:V,(O=c.row.notes)!=null?O:[],i)},xt=et=>{bt&&_t&&gt(r,w,bt,_t,Ft,et)},lt=()=>mt(w);if(c.groupKey!==oe){oe=c.groupKey;let et=W+8+Qt*L+L/2,O=a(oe);k(O,4,et,$-12,11,"600"),Qt+=1}let vt=W+8+Qt*L,Bt=L-10,Gt=ct(C.getTime()),kt=ct(F.getTime()),Yt=Math.max(4,kt-Gt),ot=c.fullName,rt=document.createElementNS(f.namespaceURI,"rect");rt.setAttribute("x",String(Gt)),rt.setAttribute("y",String(vt)),rt.setAttribute("width",String(Yt)),rt.setAttribute("height",String(Bt)),rt.setAttribute("rx","3"),rt.setAttribute("ry","3"),rt.setAttribute("fill",it((Se=c.row.series)!=null?Se:ot,Qt)),rt.setAttribute("stroke","rgba(0,0,0,0.25)"),rt.setAttribute("stroke-width","0.5"),rt.style.cursor=p&&At?"pointer":"default",rt.addEventListener("mouseenter",xt),rt.addEventListener("mouseleave",lt),rt.addEventListener("click",Nt),f.appendChild(rt);let Ae=vt+Bt/2;if(Yt>=6){let et=it((we=c.row.series)!=null?we:ot,Qt),O=document.createElementNS(f.namespaceURI,"circle");O.setAttribute("cx",String(Gt)),O.setAttribute("cy",String(Ae)),O.setAttribute("r","3.5"),O.setAttribute("fill","#ffffff"),O.setAttribute("stroke",et),O.setAttribute("stroke-width","1.5"),f.appendChild(O);let Lt=document.createElementNS(f.namespaceURI,"circle");Lt.setAttribute("cx",String(kt)),Lt.setAttribute("cy",String(Ae)),Lt.setAttribute("r","3.5"),Lt.setAttribute("fill","#ffffff"),Lt.setAttribute("stroke",et),Lt.setAttribute("stroke-width","1.5"),f.appendChild(Lt)}let Ee=vt+Bt/2+2,Xt=g?16:4;if(D==="wide")k(ot,Xt,Ee,$-Xt-4,11,null,xt,lt,Nt);else{let et=ot,O=Math.max(40,$-Xt-8),De=Math.max(8,Math.floor(O/6));et.length>De&&(et=et.slice(0,De-1)+"\u2026");let St=document.createElementNS(f.namespaceURI,"text");St.setAttribute("x",String(Xt)),St.setAttribute("y",String(Ee)),St.setAttribute("text-anchor","start"),St.setAttribute("font-size","11"),St.setAttribute("fill","#111111"),St.textContent=et,St.style.cursor="pointer",St.addEventListener("mouseenter",xt),St.addEventListener("mouseleave",lt),St.addEventListener("click",Nt),f.appendChild(St)}if(ht instanceof Date){let et=ct(ht.getTime()),O=document.createElementNS(f.namespaceURI,"line");O.setAttribute("x1",String(et)),O.setAttribute("y1",String(vt)),O.setAttribute("x2",String(et)),O.setAttribute("y2",String(vt+Bt)),O.setAttribute("stroke","#ff6b6b"),O.setAttribute("stroke-width","2"),O.setAttribute("stroke-dasharray","4,2"),f.appendChild(O)}Qt+=1}if(p){let c=r.createDiv({cls:"prop-charts-empty"});c.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function ue(r,e,t){var $,j,tt,M;let n=($=e.options)!=null?$:{},s=n.background,o=(j=n.drilldown)!=null?j:!0,i=(tt=t.rows)!=null?tt:[];if(!i.length){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:p,svg:a,tooltip:l,details:h}=wt(r,s),g=r.getBoundingClientRect().width||600,R=Math.max(g,480);p.style.width=R+"px";let S=40,v=16,y=18,L=28,I=300;a.setAttribute("height",String(I));let P=R-S-v,_=I-y-L,T=new Map;for(let d of i){let f=String(d.x),w=(M=T.get(f))!=null?M:{label:d.x,rows:[]};w.rows.push(d),T.set(f,w)}let Q=Array.from(T.keys()).sort((d,f)=>d<f?-1:d>f?1:0).map(d=>T.get(d)),b=Q.length,x=new Set;i.forEach(d=>{d.series!=null&&x.add(String(d.series))});let u=Array.from(x),E=u.length>1,D=E?"grouped":"single",m=0;i.forEach(d=>{d.y>m&&(m=d.y)}),(!isFinite(m)||m<=0)&&(m=1);let N=d=>y+_-d/(m||1)*_,G=N(0),nt=4;for(let d=0;d<=nt;d++){let f=m*d/nt,w=N(f),A=document.createElementNS(a.namespaceURI,"line");A.setAttribute("x1",String(S)),A.setAttribute("y1",String(w)),A.setAttribute("x2",String(R-v)),A.setAttribute("y2",String(w)),A.setAttribute("stroke","#cccccc"),A.setAttribute("stroke-opacity","0.25"),a.appendChild(A);let k=document.createElementNS(a.namespaceURI,"text");k.setAttribute("x",String(S-4)),k.setAttribute("y",String(w+3)),k.setAttribute("text-anchor","end"),k.setAttribute("font-size","10"),k.setAttribute("fill","#111111"),k.textContent=String(Math.round(f)),a.appendChild(k)}let B=b>0?P/b:P;if(Q.forEach((d,f)=>{let w=S+B*(f+.5),A=String(d.label),k=document.createElementNS(a.namespaceURI,"text");k.setAttribute("x",String(w)),k.setAttribute("y",String(I-L+12)),k.setAttribute("text-anchor","middle"),k.setAttribute("font-size","10"),k.setAttribute("fill","#111111"),k.textContent=A,a.appendChild(k)}),E){let d=r.createDiv({cls:"chart-notes-legend"});u.forEach((f,w)=>{let A=d.createDiv({cls:"chart-notes-legend-item"}),k=A.createDiv();k.style.width="10px",k.style.height="10px",k.style.borderRadius="999px",k.style.backgroundColor=it(f,w),A.createSpan({text:f})})}Q.forEach((d,f)=>{let w=S+B*(f+.5),A=d.rows;if(D==="single"){let Y=A[0],K=Y.y,W=B*.6,J=w-W/2,at=N(K),ft=Math.max(2,G-at),ct=it("bar",f),H=document.createElementNS(a.namespaceURI,"rect");H.setAttribute("x",String(J)),H.setAttribute("y",String(at)),H.setAttribute("width",String(W)),H.setAttribute("height",String(ft)),H.setAttribute("fill",ct),H.setAttribute("stroke","rgba(0,0,0,0.25)"),H.setAttribute("stroke-width","0.5"),H.style.cursor="pointer";let X=String(d.label),Mt=`valor: ${Math.round(K*100)/100}`;H.addEventListener("mouseenter",dt=>{var q,pt;return gt(r,l,X,Mt,(pt=(q=Y.notes)==null?void 0:q.length)!=null?pt:0,dt)}),H.addEventListener("mouseleave",()=>mt(l)),H.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(r,h,X,K,(q=Y.notes)!=null?q:[],o)}),a.appendChild(H);return}let k=u.length,Z=B/Math.max(k+1,2),z=k*Z,st=w-z/2;u.forEach((Y,K)=>{let W=A.find(q=>(q.series!=null?String(q.series):"")===Y);if(!W)return;let J=W.y,at=st+K*Z,ft=N(J),ct=Math.max(2,G-ft),H=it(Y,K),X=document.createElementNS(a.namespaceURI,"rect");X.setAttribute("x",String(at)),X.setAttribute("y",String(ft)),X.setAttribute("width",String(Z)),X.setAttribute("height",String(ct)),X.setAttribute("fill",H),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let Mt=`${Y} @ ${String(d.label)}`,dt=`valor: ${Math.round(J*100)/100}`;X.addEventListener("mouseenter",q=>{var pt,Ut;return gt(r,l,Mt,dt,(Ut=(pt=W.notes)==null?void 0:pt.length)!=null?Ut:0,q)}),X.addEventListener("mouseleave",()=>mt(l)),X.addEventListener("click",q=>{var pt;q.preventDefault(),yt(r,h,Mt,J,(pt=W.notes)!=null?pt:[],o)}),a.appendChild(X)})})}function Fe(r,e,t){var B,$,j,tt;let n=(B=e.options)!=null?B:{},s=n.background,o=($=n.drilldown)!=null?$:!0,i=(j=t.rows)!=null?j:[];if(!i.length){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:p,svg:a,tooltip:l,details:h}=wt(r,s),g=r.getBoundingClientRect().width||600,R=Math.max(g,480);p.style.width=R+"px";let S=40,v=16,y=18,L=28,I=300;a.setAttribute("height",String(I));let P=R-S-v,_=I-y-L,T=new Map;for(let M of i){let d=String(M.x),f=(tt=T.get(d))!=null?tt:{label:M.x,rows:[]};f.rows.push(M),T.set(d,f)}let Q=Array.from(T.keys()).sort((M,d)=>M<d?-1:M>d?1:0).map(M=>T.get(M)),b=Q.length,x=new Set;i.forEach(M=>{M.series!=null&&x.add(String(M.series))});let u=Array.from(x);if(!u.length){ue(r,e,t);return}let E=0;Q.forEach(M=>{let d=M.rows.reduce((f,w)=>f+w.y,0);d>E&&(E=d)}),(!isFinite(E)||E<=0)&&(E=1);let D=M=>y+_-M/(E||1)*_,m=D(0),N=4;for(let M=0;M<=N;M++){let d=E*M/N,f=D(d),w=document.createElementNS(a.namespaceURI,"line");w.setAttribute("x1",String(S)),w.setAttribute("y1",String(f)),w.setAttribute("x2",String(R-v)),w.setAttribute("y2",String(f)),w.setAttribute("stroke","#cccccc"),w.setAttribute("stroke-opacity","0.25"),a.appendChild(w);let A=document.createElementNS(a.namespaceURI,"text");A.setAttribute("x",String(S-4)),A.setAttribute("y",String(f+3)),A.setAttribute("text-anchor","end"),A.setAttribute("font-size","10"),A.setAttribute("fill","#111111"),A.textContent=String(Math.round(d)),a.appendChild(A)}let G=b>0?P/b:P;Q.forEach((M,d)=>{let f=S+G*(d+.5),w=String(M.label),A=document.createElementNS(a.namespaceURI,"text");A.setAttribute("x",String(f)),A.setAttribute("y",String(I-L+12)),A.setAttribute("text-anchor","middle"),A.setAttribute("font-size","10"),A.setAttribute("fill","#111111"),A.textContent=w,a.appendChild(A)});let nt=r.createDiv({cls:"chart-notes-legend"});u.forEach((M,d)=>{let f=nt.createDiv({cls:"chart-notes-legend-item"}),w=f.createDiv();w.style.width="10px",w.style.height="10px",w.style.borderRadius="999px",w.style.backgroundColor=it(M,d),f.createSpan({text:M})}),Q.forEach((M,d)=>{let f=S+G*(d+.5),w=G*.6,A=f-w/2,k=0;u.forEach((Z,z)=>{let st=M.rows.find(dt=>(dt.series!=null?String(dt.series):"")===Z);if(!st)return;let Y=st.y,K=k,W=k+Y;k=W;let J=D(K),at=D(W),ft=Math.max(2,J-at),ct=it(Z,z),H=document.createElementNS(a.namespaceURI,"rect");H.setAttribute("x",String(A)),H.setAttribute("y",String(at)),H.setAttribute("width",String(w)),H.setAttribute("height",String(ft)),H.setAttribute("fill",ct),H.setAttribute("stroke","rgba(0,0,0,0.25)"),H.setAttribute("stroke-width","0.5"),H.style.cursor="pointer";let X=`${Z} @ ${String(M.label)}`,Mt=`valor: ${Math.round(Y*100)/100}`;H.addEventListener("mouseenter",dt=>{var q,pt;return gt(r,l,X,Mt,(pt=(q=st.notes)==null?void 0:q.length)!=null?pt:0,dt)}),H.addEventListener("mouseleave",()=>mt(l)),H.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(r,h,X,Y,(q=st.notes)!=null?q:[],o)}),a.appendChild(H)})})}function de(r,e,t,n){var $,j,tt,M;let s=($=e.options)!=null?$:{},o=s.background,i=(j=s.drilldown)!=null?j:!0,p=(tt=t.rows)!=null?tt:[];if(!p.length){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:l,tooltip:h,details:g}=wt(r,o),R=r.getBoundingClientRect().width||600,S=Math.max(R,480);a.style.width=S+"px";let v=40,y=16,L=18,I=24,P=300;l.setAttribute("height",String(P));let _=S-v-y,T=P-L-I,U=new Map;for(let d of p){let f=d.series!=null?String(d.series):"__default__",w=(M=U.get(f))!=null?M:[];w.push(d),U.set(f,w)}let Q=Array.from(U.keys()),b=[],x=new Set;for(let d of p){let f=String(d.x);x.has(f)||(x.add(f),b.push(d.x))}let u=b.length||1,E=d=>{let f=String(d),w=b.findIndex(A=>String(A)===f);return w<0?v:u===1?v+_/2:v+w/(u-1)*_},D=d=>String(d),m=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let d of p)d.y<m&&(m=d.y),d.y>N&&(N=d.y);(!isFinite(m)||!isFinite(N))&&(m=0,N=1),m===N&&(m===0?N=1:m=0);let G=d=>L+T-(d-m)/(N-m||1)*T,nt=4;for(let d=0;d<=nt;d++){let f=m+(N-m)*d/nt,w=G(f),A=document.createElementNS(l.namespaceURI,"line");A.setAttribute("x1",String(v)),A.setAttribute("y1",String(w)),A.setAttribute("x2",String(S-y)),A.setAttribute("y2",String(w)),A.setAttribute("stroke","#cccccc"),A.setAttribute("stroke-opacity","0.25"),l.appendChild(A);let k=document.createElementNS(l.namespaceURI,"text");k.setAttribute("x",String(v-4)),k.setAttribute("y",String(w+3)),k.setAttribute("text-anchor","end"),k.setAttribute("font-size","10"),k.setAttribute("fill","#111111"),k.textContent=Math.abs(f)>=100?String(Math.round(f)):String(Math.round(f*10)/10),l.appendChild(k)}let B=Q.filter(d=>d!=="__default__");if(B.length>1){let d=r.createDiv({cls:"chart-notes-legend"});B.forEach((f,w)=>{let A=f,k=d.createDiv({cls:"chart-notes-legend-item"}),Z=k.createDiv();Z.style.width="10px",Z.style.height="10px",Z.style.borderRadius="999px",Z.style.backgroundColor=it(A,w),k.createSpan({text:A})})}Q.forEach((d,f)=>{let w=U.get(d);if(!(w!=null&&w.length))return;let A=d==="__default__"?it("line",f):it(d,f),k=[...w].sort((z,st)=>{let Y=b.findIndex(W=>String(W)===String(z.x)),K=b.findIndex(W=>String(W)===String(st.x));return Y-K}),Z="";if(k.forEach((z,st)=>{let Y=E(z.x),K=G(z.y);Z+=(st===0?"M ":" L ")+Y+" "+K}),n){let z=k[0],st=k[k.length-1],Y=E(z.x),K=E(st.x),W=G(m);Z+=` L ${K} ${W} L ${Y} ${W} Z`;let J=document.createElementNS(l.namespaceURI,"path");J.setAttribute("d",Z),J.setAttribute("fill",A),J.setAttribute("fill-opacity","0.18"),J.setAttribute("stroke",A),J.setAttribute("stroke-width","1.5"),l.appendChild(J)}else{let z=document.createElementNS(l.namespaceURI,"path");z.setAttribute("d",Z),z.setAttribute("fill","none"),z.setAttribute("stroke",A),z.setAttribute("stroke-width","2"),l.appendChild(z)}k.forEach(z=>{let st=E(z.x),Y=G(z.y),K=document.createElementNS(l.namespaceURI,"circle");K.setAttribute("cx",String(st)),K.setAttribute("cy",String(Y)),K.setAttribute("r","3"),K.setAttribute("fill","#ffffff"),K.setAttribute("stroke",A),K.setAttribute("stroke-width","1.5"),K.style.cursor="pointer";let W=D(z.x),J=d==="__default__"?"":String(z.series),at=J?`${J} @ ${W}`:W,ft=`valor: ${Math.round(z.y*100)/100}`;K.addEventListener("mouseenter",ct=>{var H,X;return gt(r,h,at,ft,(X=(H=z.notes)==null?void 0:H.length)!=null?X:0,ct)}),K.addEventListener("mouseleave",()=>mt(h)),K.addEventListener("click",ct=>{var H;ct.preventDefault(),yt(r,g,at,z.y,(H=z.notes)!=null?H:[],i)}),l.appendChild(K)})})}function _e(r,e,t){var _;let{background:n,drilldown:s=!0}=(_=e.options)!=null?_:{};if(t.rows.length===0){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=Ie(n)?"#000000":void 0,i=r.getBoundingClientRect().width||600,{inner:p,svg:a,tooltip:l,details:h}=wt(r,n),g=Math.max(i,420);p.style.width=g+"px",o&&(a.style.color=o);let R=300,S=g/2,v=(R-28+28)/2,y=Math.min(g/2-20,R/2-20),I=t.rows.map(T=>Math.max(0,T.y)).reduce((T,U)=>T+U,0)||1,P=-Math.PI/2;t.rows.forEach((T,U)=>{var B;let Q=T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x),b=T.y,x=b/I*Math.PI*2,u=S+y*Math.cos(P),E=v+y*Math.sin(P),D=S+y*Math.cos(P+x),m=v+y*Math.sin(P+x),N=x>Math.PI?1:0,G=document.createElementNS(a.namespaceURI,"path"),nt=[`M ${S} ${v}`,`L ${u} ${E}`,`A ${y} ${y} 0 ${N} 1 ${D} ${m}`,"Z"].join(" ");G.setAttribute("d",nt),G.setAttribute("fill",it((B=T.series)!=null?B:Q,U)),G.style.cursor="pointer",G.addEventListener("mouseenter",$=>{var j,tt;return gt(r,l,Q,b,(tt=(j=T.notes)==null?void 0:j.length)!=null?tt:0,$)}),G.addEventListener("mouseleave",()=>mt(l)),G.addEventListener("click",()=>{var $;return yt(r,h,Q,b,($=T.notes)!=null?$:[],s)}),a.appendChild(G),P+=x})}function $e(r,e,t){var E;let{background:n,drilldown:s=!0}=(E=e.options)!=null?E:{};if(t.rows.length===0){r.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=n?"#111111":void 0,i=r.getBoundingClientRect().width||600,{inner:p,svg:a,tooltip:l,details:h}=wt(r,n),g=Math.max(i,700);p.style.width=g+"px",o&&(a.style.color=o);let R=300,S=g-48-10,v=R-28-28,y=t.rows.map(D=>{let m=D.x;if(m instanceof Date)return m.getTime();if(typeof m=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(m)){let G=new Date(m);if(!isNaN(G.getTime()))return G.getTime()}let N=Number(m);return isNaN(N)?null:N}return typeof m=="number"?m:null}),L=t.rows.map(D=>D.y),I=y.filter(D=>D!==null);if(I.length===0){r.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let P=Math.min(...I),_=Math.max(...I),T=Math.min(...L),U=Math.max(...L),Q=D=>48+(D-P)/(_-P||1)*S,b=D=>R-28-(D-T)/(U-T||1)*v,x=document.createElementNS(a.namespaceURI,"line");x.setAttribute("x1",String(48)),x.setAttribute("y1",String(28)),x.setAttribute("x2",String(48)),x.setAttribute("y2",String(R-28)),x.setAttribute("stroke","currentColor"),a.appendChild(x);let u=document.createElementNS(a.namespaceURI,"line");u.setAttribute("x1",String(48)),u.setAttribute("y1",String(R-28)),u.setAttribute("x2",String(g-10)),u.setAttribute("y2",String(R-28)),u.setAttribute("stroke","currentColor"),a.appendChild(u),t.rows.forEach((D,m)=>{let N=y[m];if(N==null)return;let G=Q(N),nt=b(L[m]),B=document.createElementNS(a.namespaceURI,"circle");B.setAttribute("cx",String(G)),B.setAttribute("cy",String(nt)),B.setAttribute("r","4"),B.setAttribute("fill",it(D.series,m)),B.style.cursor="pointer";let $=D.x instanceof Date?D.x.toISOString().slice(0,10):typeof D.x=="string"?D.x:String(D.x);B.addEventListener("mouseenter",j=>{var tt,M;return gt(r,l,$,D.y,(M=(tt=D.notes)==null?void 0:tt.length)!=null?M:0,j)}),B.addEventListener("mouseleave",()=>mt(l)),B.addEventListener("click",j=>{var tt;j.preventDefault(),yt(r,h,$,D.y,(tt=D.notes)!=null?tt:[],s)}),a.appendChild(B)})}var He=require("obsidian"),Wt=class{render(e,t,n,s,o=!1){var l;let{title:i}=(l=t.options)!=null?l:{};e.empty(),e.addClass("prop-charts-container");let a=e.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(a.textContent=i),t.type){case"bar":ue(e,t,n);break;case"stacked-bar":Fe(e,t,n);break;case"line":de(e,t,n,!1);break;case"area":de(e,t,n,!0);break;case"pie":_e(e,t,n);break;case"scatter":$e(e,t,n);break;case"gantt":te(e,t,n,s);break;default:e.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}if(!o){let h=e.createEl("button",{cls:"chart-notes-zoom-button"});h.setAttr("type","button"),h.setAttr("aria-label","Expandir gr\xE1fico"),h.textContent="\u2922",h.addEventListener("click",g=>{g.preventDefault(),new pe(t,n,this,s).open()})}}},pe=class extends He.Modal{constructor(t,n,s,o){super(app);this.size="large";this.spec=t,this.data=n,this.renderer=s,this.ctx=o}onOpen(){var a;let{contentEl:t}=this;t.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),t.addClass("chart-notes-zoom-modal"),this.applySize();let n=t.createDiv({cls:"chart-notes-zoom-header"}),s=(a=this.spec.options)!=null&&a.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";n.createEl("div",{text:s,cls:"chart-notes-zoom-title"});let o=n.createDiv({cls:"chart-notes-zoom-sizes"}),i=(l,h)=>{let g=o.createEl("button",{cls:"chart-notes-zoom-size-btn",text:l});(()=>{g.toggleClass("is-active",this.size===h)})(),g.addEventListener("click",S=>{S.preventDefault(),this.size=h,this.applySize(),o.querySelectorAll(".chart-notes-zoom-size-btn").forEach(y=>y.classList.remove("is-active")),g.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let p=t.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(p,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let t=this.modalEl;if(!t)return;let n="95vw",s="85vh";switch(this.size){case"small":n="60vw",s="55vh";break;case"medium":n="80vw",s="70vh";break;case"large":default:n="95vw",s="85vh";break}t.style.maxWidth=n,t.style.width=n,t.style.height=s,t.style.maxHeight=s}};var Qe=require("obsidian");var Be="chartnotes-view",fe=class extends Qe.BasesView{constructor(t,n){super(t);this.type=Be;this.hoverPopover=null;this.containerEl=n.createDiv("chartnotes-bases-view-container"),this.renderer=new Wt}getConfigString(t){let n=this.config.get(t);return n==null?"":String(n).trim()}getConfigBool(t){let n=this.config.get(t);if(n==null)return!1;if(typeof n=="boolean")return n;let s=String(n).toLowerCase();return s==="true"||s==="1"||s==="yes"||s==="on"}onDataUpdated(){var S;this.containerEl.empty();let t=this.data;if(!t||!((S=t.groupedData)!=null&&S.length)){this.containerEl.createDiv({text:"Chart Notes (Bases): nenhuma nota neste Base.",cls:"prop-charts-empty"});return}let n=this.getConfigString("chartType")||"bar",s=this.getConfigString("xProp"),o=this.getConfigString("yProp"),i=this.getConfigString("seriesProp"),p=this.getConfigString("title")||this.config.name||"Chart Notes (Bases)",a=this.getConfigString("background")||"var(--background-primary)",l=this.getConfigBool("cumulative"),h=this.getConfigString("rolling");if(!s){let v=this.containerEl.createDiv({cls:"prop-charts-empty"});v.createDiv({text:"Chart Notes (Bases): configure a view nas op\xE7\xF5es:"});let y=v.createEl("ul");y.createEl("li",{text:'Escolha "Chart type" (ex: bar, line, area, pie, scatter, stacked-bar).'}),y.createEl("li",{text:'Defina "X property" (ex: file.name, note.status, note.scheduled).'}),y.createEl("li",{text:'Opcional: "Y property" (num\xE9rico) e "Series property" (cores/legenda).'});return}let g=this.buildQueryResultFromBases(t,s,o,i);if(!g.rows.length){this.containerEl.createDiv({cls:"prop-charts-empty",text:"Chart Notes (Bases): nenhum dado v\xE1lido para o gr\xE1fico."});return}let R={type:n,source:{paths:[]},encoding:{},aggregate:{},sort:{},options:{title:p,background:a}};(n==="line"||n==="area")&&(l||h)&&this.applyPostAggregations(g,{cumulative:l,rolling:h}),this.renderer.render(this.containerEl,R,g)}buildQueryResultFromBases(t,n,s,o){var p,a,l,h,g;let i=[];for(let R of t.groupedData)for(let S of R.entries){let v=S,y=v.getValue?v.getValue(n):null;if(!y||(p=y.isEmpty)!=null&&p.call(y))continue;let L=this.toPrimitive(y),I=1;if(s){let b=v.getValue?v.getValue(s):null;if(!b||(a=b.isEmpty)!=null&&a.call(b))continue;let x=this.toNumber(b);if(x==null)continue;I=x}let P;if(o){let b=v.getValue?v.getValue(o):null;b&&!((l=b.isEmpty)!=null&&l.call(b))&&(P=String(this.toPrimitive(b)))}let _=v.file,T=(h=_==null?void 0:_.path)!=null?h:"",U=(g=_==null?void 0:_.name)!=null?g:T,Q={x:L,y:I,series:P,notes:T?[T]:[],props:{__fromBases:!0,noteName:U}};i.push(Q)}return{rows:i}}toPrimitive(t){let n=t;if(n!=null&&n.valueOf){let s=n.valueOf();if(s instanceof Date||typeof s=="number"||typeof s=="string")return s}return t instanceof Date||typeof t=="number"||typeof t=="string"?t:String(t)}toNumber(t){var i;let n=t;if((i=n==null?void 0:n.isEmpty)!=null&&i.call(n))return null;let s=t;if(n!=null&&n.valueOf&&(s=n.valueOf()),typeof s=="number"&&Number.isFinite(s))return s;let o=Number(s);return Number.isFinite(o)?o:null}applyPostAggregations(t,n){var i;let s=[...(i=t.rows)!=null?i:[]];if(!s.length)return;if(s.sort((p,a)=>{let l=p.x instanceof Date?p.x.getTime():typeof p.x=="number"?p.x:String(p.x),h=a.x instanceof Date?a.x.getTime():typeof a.x=="number"?a.x:String(a.x),g=String(l),R=String(h);return g<R?-1:g>R?1:0}),n.cumulative){let p=0;for(let a of s)p+=a.y,a.y=p}let o=parseInt(n.rolling,10);if(!Number.isNaN(o)&&o>1){let p=[];for(let a of s){p.push(a.y),p.length>o&&p.shift();let l=p.reduce((h,g)=>h+g,0);a.y=l/p.length}}t.rows=s}};function ze(r){r.registerBasesView(Be,{name:"Chart Notes",icon:"lucide-line-chart",factory:(e,t)=>new fe(e,t),options:()=>[{type:"text",displayName:"Chart type (bar, line, area, pie, scatter, stacked-bar)",key:"chartType",default:"bar"},{type:"text",displayName:"X property (ex: file.name, note.status, note.scheduled)",key:"xProp",default:"file.name"},{type:"text",displayName:"Y property (num\xE9rico, ex: note.timeEstimate). vazio = conta linhas",key:"yProp",default:""},{type:"text",displayName:"Series property (cores/legenda, ex: note.status ou note.priority)",key:"seriesProp",default:""},{type:"text",displayName:"T\xEDtulo do gr\xE1fico",key:"title",default:""},{type:"text",displayName:"Cor de fundo (hex ou CSS var)",key:"background",default:"var(--background-primary)"},{type:"toggle",displayName:"Linha cumulativa (apenas line/area)",key:"cumulative",default:!1},{type:"text",displayName:"Rolling window (apenas line/area, em n\xFAmero de pontos. ex: 7)",key:"rolling",default:""}]})}var ne=class extends Pt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new qt(this.app),await this.indexer.buildIndex(),this.query=new Jt(()=>this.indexer.getAll(),[]),this.renderer=new Wt,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Pt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Pt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Pt.TFile&&this.indexer.removeFile(t)})),this.registerMarkdownCodeBlockProcessor("chart",async(t,n,s)=>{var h;let o;try{let g=(0,Pt.parseYaml)(t);if(!g||typeof g!="object"){n.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}o=g}catch(g){n.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+g.message});return}if(!o.type){n.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=o.type==="gantt",p=o.type==="table";if(!i&&!p){if(!o.encoding||!o.encoding.x){n.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let R=((h=o.aggregate)==null?void 0:h.y)==="count";if(!o.encoding.y&&!R){n.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}o.encoding||(o.encoding={}),o.source||(o.source={});let l;try{l=this.query.run(o)}catch(g){n.createEl("div",{text:"Chart Notes: erro na query: "+g.message});return}this.renderer.render(n,o,l)}),ze(this)}onunload(){console.log("unloading Chart Notes plugin")}};
