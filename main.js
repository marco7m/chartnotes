/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var re=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var $e=Object.prototype.hasOwnProperty;var Ge=(o,t)=>{for(var e in t)re(o,e,{get:t[e],enumerable:!0})},He=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of _e(t))!$e.call(o,s)&&s!==e&&re(o,s,{get:()=>t[s],enumerable:!(n=Fe(t,s))||n.enumerable});return o};var ze=o=>He(re({},"__esModule",{value:!0}),o);var je={};Ge(je,{default:()=>te});module.exports=ze(je);var Lt=require("obsidian");var Se=require("obsidian"),Ot=class{constructor(t){this.index=new Map;this.app=t}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)await this.updateFile(e)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(t){if(t.extension!=="md")return;let e={};try{let s=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/);if(s){let i=(0,Se.parseYaml)(s[1])||{};if(i&&typeof i=="object")for(let[f,h]of Object.entries(i))f!=="position"&&(e[f]=h)}let r=this.app.metadataCache.getFileCache(t);r!=null&&r.tags&&!e.tags&&(e.tags=r.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",t.path,n)}this.index.set(t.path,{path:t.path,props:e})}removeFile(t){this.index.delete(t.path)}};function Ae(o,t){if(!t||t.length===0)return!0;for(let e of t){if(e===".")return!0;let n=e.endsWith("/")?e:e+"/";if(o===e||o.startsWith(n))return!0}return!1}function De(o,t){if(!t||t.length===0)return!0;let e=o.tags;if(!e)return!1;if(Array.isArray(e)){for(let s of t)if(e.includes(s)||e.includes("#"+s))return!0;return!1}let n=String(e);for(let s of t)if(n===s||n==="#"+s)return!0;return!1}function qt(o){return typeof o!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(o)}function _t(o){if(o instanceof Date)return o;if(typeof o!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(o)){let[e,n,s]=o.split("-");return new Date(Number(e),Number(n)-1,Number(s),0,0,0,0)}let t=new Date(o);return isNaN(t.getTime())?null:t}function ut(o){let t=new Date(o);return t.setHours(0,0,0,0),t}function Xt(o,t){let e=new Date(o);return e.setDate(e.getDate()-t),e}function Ve(o,t){return Xt(o,t*7)}function Ke(o,t){let e=new Date(o);return e.setMonth(e.getMonth()-t),e}function ie(o,t){let e=new Date(o);return e.setDate(e.getDate()+t),e}function We(o,t){return ie(o,t*7)}function Qe(o,t){let e=new Date(o);return e.setMonth(e.getMonth()+t),e}function we(o){let t=o.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(t)||t.endsWith("date")||t.endsWith("at")||t.endsWith("on"))}function Ee(o,t){let e=t?new Date(t):new Date,n=ut(e),s=o.trim().toLowerCase();if(s==="today")return n;if(s==="yesterday")return ut(Xt(n,1));if(/^-\d+$/.test(s)){let r=parseInt(s.slice(1),10);return ut(Xt(n,r))}if(/^-\d+d$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(Xt(n,r))}if(/^-\d+w$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(Ve(n,r))}if(/^-\d+m$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(Ke(n,r))}if(/^\+\d+$/.test(s)){let r=parseInt(s.slice(1),10);return ut(ie(n,r))}if(/^\+\d+d$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(ie(n,r))}if(/^\+\d+w$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(We(n,r))}if(/^\+\d+m$/.test(s)){let r=parseInt(s.slice(1,-1),10);return ut(Qe(n,r))}return null}function Ce(o){let t=o.trim(),e=t.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(e){let d=e[1].trim(),m=e[2].trim(),T=e[3].trim(),v=we(d),S=oe(m,v),b=oe(T,v),k=S.valueType==="date"||b.valueType==="date"?"date":S.valueType;return{field:d,op:"between",value:S.value,value2:b.value,valueType:k}}let n=/(==|!=|>=|<=|>|<)/,s=t.split(n);if(s.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+o);let r=s[0].trim(),i=s[1].trim(),f=s[2].trim(),h=we(r),c=oe(f,h);return{field:r,op:i,value:c.value,valueType:c.valueType}}function oe(o,t){let e=o.trim();if(e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"'))return{value:e.slice(1,-1),valueType:"string"};let n=e.toLowerCase(),s=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(t){if(e==="0"||n==="today")return{value:ut(new Date),valueType:"date"};let i=Ee(e);if(i)return{value:i,valueType:"date"}}else if(s){let i=Ee(e);if(i)return{value:i,valueType:"date"}}if(qt(e)){let i=_t(e);if(i)return{value:i,valueType:"date"}}let r=Number(e);return Number.isNaN(r)?{value:e,valueType:"string"}:{value:r,valueType:"number"}}function ke(o,t){let e=o[t.field];if(e==null)return!1;if(t.valueType==="date"){let r=e instanceof Date?ut(e):qt(e)?ut(_t(e)):null;if(!r)return!1;let i=t.value instanceof Date?t.value:null,f=t.value2 instanceof Date?t.value2:null;if(!i)return!1;let h=r.getTime(),c=ut(i).getTime();switch(t.op){case"==":return h===c;case"!=":return h!==c;case">":return h>c;case">=":return h>=c;case"<":return h<c;case"<=":return h<=c;case"between":if(!f)return!1;let d=ut(f).getTime();return h>=c&&h<=d}}if(t.valueType==="number"){let r=Number(e);if(isNaN(r))return!1;let i=Number(t.value);switch(t.op){case"==":return r===i;case"!=":return r!==i;case">":return r>i;case">=":return r>=i;case"<":return r<i;case"<=":return r<=i;case"between":return typeof t.value2!="number"?!1:r>=i&&r<=t.value2}}let n=String(e),s=String(t.value);switch(t.op){case"==":return n===s;case"!=":return n!==s;case">":return n>s;case">=":return n>=s;case"<":return n<s;case"<=":return n<=s;case"between":return!1}}function Ue(o){if(typeof o=="string"&&/^\d{4}-\d{2}-\d{2}/.test(o))return{key:o.slice(0,10),isDate:!0};if(qt(o)){let t=_t(o);if(t)return{key:t,isDate:!0}}return{key:o,isDate:!1}}function Be(o,t){let e=o.x,n=t.x;if(e instanceof Date&&n instanceof Date)return e.getTime()-n.getTime();let s=String(e),r=String(n);return s<r?-1:s>r?1:0}function Ye(o,t){var r,i;let e=Be(o,t);if(e!==0)return e;let n=(r=o.series)!=null?r:"",s=(i=t.series)!=null?i:"";return n<s?-1:n>s?1:0}function Oe(o){if(o==null)return 0;if(typeof o=="number")return o>0?Math.floor(o):0;if(typeof o=="string"){let t=o.trim().match(/^(\d+)/);if(t){let e=Number(t[1]);return Number.isFinite(e)&&e>0?Math.floor(e):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(o)}`)}function Xe(o){var n,s;let t=new Map,e=[];for(let r of o){let i=(n=r.series)!=null?n:"__no_series__",h=((s=t.get(i))!=null?s:0)+r.y;t.set(i,h),e.push({...r,y:h})}return e}function qe(o,t){var i,f;let e=Oe(t);if(!e||e<=1)return[...o];let n=new Map,s=new Map,r=[];for(let h of o){let c=(i=h.series)!=null?i:"__no_series__",d=n.get(c);d||(d=[],n.set(c,d));let m=(f=s.get(c))!=null?f:0;if(d.push(h.y),m+=h.y,d.length>e){let S=d.shift();m-=S}s.set(c,m);let T=d.length||1,v=m/T;r.push({...h,y:v})}return r}var jt=class{constructor(t,e){this.getIndex=t,this.defaultPaths=e}run(t){var i,f,h;let e=this.getIndex(),n=(i=t.source)!=null&&i.paths&&t.source.paths.length?t.source.paths:this.defaultPaths,s=(f=t.source)!=null&&f.tags&&t.source.tags.length?t.source.tags:[],r=[];for(let c of e){let d=n&&n.length?Ae(c.path,n):!0,m=s&&s.length?De(c.props,s):!0;if(!d||!m)continue;let T=!0;if((h=t.source)!=null&&h.where&&t.source.where.length>0)for(let v of t.source.where){let S;try{S=Ce(v)}catch(b){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${v} (${b.message})`)}if(!ke(c.props,S)){T=!1;break}}T&&r.push(c)}return t.type==="gantt"?this.runGantt(t,r):t.type==="table"?this.runTable(t,r):this.runStandard(t,r)}runTable(t,e){var s,r;return{rows:e.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(s=t.encoding)==null?void 0:s.x,yField:(r=t.encoding)==null?void 0:r.y}}runGantt(t,e){var m,T,v;let n=(m=t.encoding)!=null?m:{},s=n.start,r=n.end,i=(T=n.label)!=null?T:n.x,f=n.series,h=n.duration,c=n.due,d=[];for(let S of e){let b=(v=S.props)!=null?v:{},k=C=>Array.isArray(C)?C[0]:C,P=null;if(r){let C=k(b[r]),w=_t(C);w&&(P=w)}if(!P)continue;let F=null;if(s){let C=k(b[s]),w=_t(C);w&&(F=w)}if(!F&&h){let C=k(b[h]),w=Number(C);Number.isNaN(w)||(F=new Date(P.getTime()-w*6e4))}F||(F=new Date(P.getTime()));let G;if(c){let C=k(b[c]),w=_t(C);w&&(G=w)}let Q;if(i){let C=k(b[i]);(C==null||C==="")&&(C=S.path),Q=C}else Q=S.path;let R;if(f){let C=k(b[f]);C!=null&&(R=String(C))}let j={x:Q,y:0,notes:[S.path],series:R,start:F,end:P,props:b};G&&(j.due=G),d.push(j)}return d.sort((S,b)=>{let k=S.start?S.start.getTime():0,P=b.start?b.start.getTime():0;return k-P}),{rows:d,xField:i,yField:r}}runStandard(t,e){var S,b,k,P,F,G,Q,R,j,C;let n=(S=t.encoding)==null?void 0:S.x,s=(b=t.encoding)==null?void 0:b.y,r=(k=t.encoding)==null?void 0:k.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(P=t.aggregate)!=null?P:{},f=(F=i.y)!=null?F:null,h=!!i.cumulative,c=i.rolling;if(!s&&f!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let d=[];for(let w of e){let l=(G=w.props)!=null?G:{},E=L=>Array.isArray(L)?L[0]:L,_=E(l[n]);if(_==null)continue;let g=Ue(_),y=g.key,K=g.isDate,V;if(r){let L=E(l[r]);L!=null&&String(L).trim()!==""&&(V=String(L))}let nt;if(f==="count")nt=1;else{let L=E(l[s]);if(L==null)continue;let U=Number(L);if(Number.isNaN(U))continue;nt=U}d.push({x:y,y:nt,notes:[w.path],series:V,props:l,_isDate:K,_origX:_})}if(d.length===0)return{rows:[],xField:n,yField:s};let m=[];if(f){let w=new Map;for(let l of d){let E=(Q=l.series)!=null?Q:"",_=l.x instanceof Date?l.x.toISOString().slice(0,10):String(l.x),g=E+"||"+_,y=(R=w.get(g))!=null?R:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:l.x,isDate:l._isDate,series:l.series,props:l.props};y.sum+=l.y,y.count+=1,l.y<y.min&&(y.min=l.y),l.y>y.max&&(y.max=l.y),y.notes.push(...l.notes),y.props=(j=l.props)!=null?j:y.props,w.set(g,y)}for(let[,l]of w){let E=l.sum;switch(f){case"sum":E=l.sum;break;case"avg":E=l.sum/l.count;break;case"min":E=l.min;break;case"max":E=l.max;break;case"count":E=l.count;break}m.push({x:l.xRep,y:E,notes:l.notes,series:l.series,props:l.props})}}else m=d.map(w=>({x:w.x,y:w.y,notes:w.notes,series:w.series,props:w.props}));if(m.length===0)return{rows:[],xField:n,yField:s};let T=((C=t.sort)==null?void 0:C.x)==="desc"?"desc":"asc";if(m.sort((w,l)=>{let E=Ye(w,l);return T==="asc"?E:-E}),(h||c)&&!(t.type==="line"||t.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(h&&c)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let v=m;return c?v=qe(m,c):h&&(v=Xe(m)),{rows:v,xField:n,yField:s}}};var Me=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ht(o,t){if(!o)return"var(--text-accent, #5b6cff)";let e=Array.from(o).reduce((n,s)=>n*33+s.charCodeAt(0)>>>0,0);return Me[e%Me.length]}function Ct(o,t){o.addClass("prop-charts-container"),o.style.width="100%",o.style.maxWidth="100%",o.style.position="relative";let e=o.createDiv({cls:"chart-notes-scroll"});e.style.overflowX="auto",e.style.overflowY="hidden",e.style.width="100%",e.style.maxWidth="100%";let n=e.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,t&&(n.style.background=t);let s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("width","100%"),r.setAttribute("height",String(300)),r.style.display="block",n.appendChild(r);let i=o.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let f=o.createDiv({cls:"chart-notes-details"});return f.style.display="none",{scroll:e,inner:n,svg:r,tooltip:i,details:f}}function kt(o,t,e,n,s,r){let i=o.getBoundingClientRect(),f=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);t.innerHTML=`
    <div class="chart-notes-tooltip-title">${e}</div>
    <div class="chart-notes-tooltip-value">${f}</div>
    <div class="chart-notes-tooltip-notes">${s} nota${s===1?"":"s"}</div>
  `,t.style.display="block";let h=t.getBoundingClientRect(),c=r.clientX-i.left+6,d=r.clientY-i.top+6;c+h.width>i.width-4&&(c=i.width-h.width-4),c<4&&(c=4),d+h.height>i.height-4&&(d=i.height-h.height-4),d<4&&(d=4),t.style.left=c+"px",t.style.top=d+"px"}function Mt(o){o.style.display="none"}function Tt(o,t,e,n,s,r){if(!r)return;if(t.empty(),!s||s.length===0){t.style.display="none";return}t.style.display="block";let i=t.createEl("div",{cls:"chart-notes-details-header"}),f=i.createEl("div",{cls:"chart-notes-details-title"});f.textContent=`Notas em "${e}" (${s.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let h=i.createEl("button",{cls:"chart-notes-details-close"});h.textContent="\xD7",h.addEventListener("click",()=>{t.style.display="none"});let c=t.createEl("ul",{cls:"chart-notes-details-list"});for(let d of s){let T=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:d});T.href="#",T.addEventListener("click",v=>{v.preventDefault(),app.workspace.openLinkText(d,"",!1)})}}function zt(o){if(!(o instanceof Date)||isNaN(o.getTime()))return"";let t=o.getDate().toString().padStart(2,"0"),e=(o.getMonth()+1).toString().padStart(2,"0");return`${t}/${e}`}function ae(o){if(!o)return!1;let t=o.trim().toLowerCase();if(t==="#fff"||t==="#ffffff"||t==="white")return!0;if(!t.startsWith("#"))return!1;let e,n,s;if(t.length===4)e=parseInt(t[1]+t[1],16),n=parseInt(t[2]+t[2],16),s=parseInt(t[3]+t[3],16);else if(t.length===7)e=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16);else return!1;return(.2126*e+.7152*n+.0722*s)/255>.7}var wt=require("obsidian"),Te=28,ce=28,Re=10;function Zt(o,t,e,n){var pe,he,fe,me,ge,ye;let s=(pe=t.options)!=null?pe:{},r=s.background,i=(he=s.drilldown)!=null?he:!0,f=!0,h=a=>{if(a==null)return"";let A=String(a).trim();if(!A)return"";let I=A.match(/^\[\[(.+?)\]\]$/);I&&(A=I[1]);let q=A.lastIndexOf("/");return q>=0&&q<A.length-1&&(A=A.slice(q+1)),A};if(Array.from(o.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(a=>a.remove()),e.rows.length===0){o.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let c=e.rows.filter(a=>a.start&&a.end);if(c.length===0){o.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let d=t.encoding,m=d.group,T=d.duration,v=(a,A)=>{if(!a||!A)return;let I=a[A];return Array.isArray(I)?I[0]:I},b=c.map(a=>{var yt,lt;let A=a.start,I=a.end,q=a.props,It=typeof a.x=="string"?a.x:a.x instanceof Date?zt(A):String(a.x),vt=h(It),gt,Pt=m?v(q,m):void 0;Pt!=null?gt=String(Pt):a.series!=null?gt=String(a.series):gt=vt;let ft=(yt=a.notes)==null?void 0:yt[0],St=ft?(lt=ft.replace(/\.md$/i,"").split("/").pop())!=null?lt:ft:vt,At=a.due,Ft,Rt=v(q,T);if(Rt!=null){let bt=Number(Rt);Number.isNaN(bt)||(Ft=bt)}return{row:a,start:A,end:I,props:q,fullName:vt,groupKey:gt,notePath:ft,noteTitle:St,due:At,estMinutes:Ft}}).filter(a=>a.start instanceof Date&&!isNaN(a.start.getTime())&&a.end instanceof Date&&!isNaN(a.end.getTime()));if(b.length===0){o.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}b.sort((a,A)=>{if(a.groupKey<A.groupKey)return-1;if(a.groupKey>A.groupKey)return 1;let I=a.start.getTime(),q=A.start.getTime();return I!==q?I-q:a.fullName.localeCompare(A.fullName)});let k=26,P=0,F=null;for(let a of b)a.groupKey!==F&&(F=a.groupKey,P+=1),P+=1;let G=Math.min(...b.map(a=>a.start.getTime())),Q=Math.max(...b.map(a=>a.end.getTime()));if(!isFinite(G)||!isFinite(Q)){o.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let R=24*60*60*1e3,j=a=>{let A=new Date(a);return A.setHours(0,0,0,0),A.getTime()},C=j(G),w=j(Q),l=o.querySelector(".prop-charts-title-row");l||(l=o.createDiv({cls:"prop-charts-title-row"}));let E=o.dataset.ganttZoomMode||s.zoomMode||"100";o.dataset.ganttZoomMode=E;let _=o.dataset.ganttLabelMode||s.labelMode||"compact";o.dataset.ganttLabelMode=_;let g=l.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(a=>{let A=g.createEl("button",{cls:"gantt-zoom-btn",text:a.label});a.id===E&&A.addClass("is-active"),A.addEventListener("click",I=>{I.preventDefault(),o.dataset.ganttZoomMode=a.id,Zt(o,t,e,n)})}),g.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",a=>{a.preventDefault();let A=o.querySelector(".chart-notes-zoom-button");A&&A.click()});let V=Number(s.labelWidth),nt=!Number.isNaN(V)&&V>120?V:260,L=o.dataset.ganttLabelMode||"compact",U=L==="wide"?nt+160:nt,tt=o.getBoundingClientRect().width||600,M=Math.max(tt,820),H;if(E==="fit")H=tt;else{let a=Number(E)/100||1;H=M*a}let{inner:p,svg:u,tooltip:x,details:N}=Ct(o,r);p.style.width=H+"px";let D=(a,A,I,q,It,vt,gt,Pt,ft)=>{if(!a)return;let St=Math.max(40,q-8),Ft=Math.max(8,Math.floor(St/6)),Rt=a.split(/\s+/),yt=[],lt="";for(let Dt of Rt){if(!lt){lt=Dt;continue}(lt+" "+Dt).length<=Ft?lt+=" "+Dt:(yt.push(lt),lt=Dt)}lt&&yt.push(lt);let bt=It+2,Ht=yt.length*bt,Wt=I-Ht/2+It;yt.forEach((Dt,Bt)=>{let at=document.createElementNS(u.namespaceURI,"text");at.setAttribute("x",String(A)),at.setAttribute("y",String(Wt+Bt*bt)),at.setAttribute("text-anchor","start"),at.setAttribute("font-size",String(It)),at.setAttribute("fill","#111111"),vt&&at.setAttribute("font-weight",vt),at.textContent=Dt,gt&&at.addEventListener("mouseenter",ot=>gt(ot)),Pt&&at.addEventListener("mouseleave",()=>Pt()),ft&&(at.style.cursor="pointer",at.addEventListener("click",ot=>ft(ot))),u.appendChild(at)})},st=Math.max(300,Te+ce+P*k+24);u.setAttribute("height",String(st));let z=H-U-Re,Z=Te+6;u.style.color="#111111";let et=w+R-C||1,$=C-et*.02,Y=w+R+et*.08,O=a=>U+(a-$)/(Y-$)*z,mt=(Y-$)/R,J=Math.max(4,Math.min(12,Math.floor(z/90)||4)),B=mt/J,X=[1,2,3,5,7,10,14,21,30,60,90,180,365],dt=X[X.length-1];for(let a of X)if(a>=B){dt=a;break}let pt=[],it=j($);for(let a=it;a<=Y+.5*R;a+=dt*R)pt.push(a);let ct=document.createElementNS(u.namespaceURI,"line");ct.setAttribute("x1",String(U)),ct.setAttribute("y1",String(Z)),ct.setAttribute("x2",String(H-Re)),ct.setAttribute("y2",String(Z)),ct.setAttribute("stroke","#111111"),u.appendChild(ct);for(let a of pt){let A=O(a),I=document.createElementNS(u.namespaceURI,"line");I.setAttribute("x1",String(A)),I.setAttribute("y1",String(Z)),I.setAttribute("x2",String(A)),I.setAttribute("y2",String(st-ce)),I.setAttribute("stroke","#111111"),I.setAttribute("stroke-opacity","0.20"),I.setAttribute("stroke-dasharray","2,4"),u.appendChild(I);let q=document.createElementNS(u.namespaceURI,"text");q.setAttribute("x",String(A)),q.setAttribute("y",String(Z-4)),q.setAttribute("text-anchor","middle"),q.setAttribute("font-size","10"),q.setAttribute("fill","#111111"),q.textContent=zt(new Date(a)),u.appendChild(q)}let Kt=new Date;Kt.setHours(0,0,0,0);let ee=Kt.getTime();if(ee>=$&&ee<=Y){let a=O(ee),A=document.createElementNS(u.namespaceURI,"line");A.setAttribute("x1",String(a)),A.setAttribute("y1",String(Z)),A.setAttribute("x2",String(a)),A.setAttribute("y2",String(st-ce)),A.setAttribute("stroke","#4caf50"),A.setAttribute("stroke-width","2"),A.setAttribute("stroke-dasharray","4,2"),u.appendChild(A);let I=document.createElementNS(u.namespaceURI,"text");I.setAttribute("x",String(a+4)),I.setAttribute("y",String(Z+12)),I.setAttribute("font-size","10"),I.setAttribute("fill","#4caf50"),I.textContent="hoje",u.appendChild(I)}let Ut=p.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Ut.setAttr("title",L==="wide"?"Compactar nomes":"Expandir nomes"),Ut.style.left=`${U}px`,Ut.style.top="4px",Ut.addEventListener("click",a=>{a.preventDefault();let I=(o.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";o.dataset.ganttLabelMode=I,Zt(o,t,e,n)});let Ie=["status","priority"],ne=Array.isArray(s.tooltipFields)?s.tooltipFields.map(a=>String(a)):null,Pe=ne&&ne.length?ne:Ie,Gt=0,se=null;for(let a of b){let A=a.start,I=a.end,q=(I.getTime()-A.getTime())/6e4,It=a.props,vt=a.notePath,gt=a.noteTitle,Pt=(me=(fe=a.row.notes)==null?void 0:fe.length)!=null?me:0,ft=a.due,St=a.estMinutes,At=[];At.push(`${zt(A)} \u2192 ${zt(I)}`),typeof St=="number"&&!Number.isNaN(St)?At.push(`est: ${Math.round(St)} min`):q>0&&At.push(`dura\xE7\xE3o: ${Math.round(q)} min`),ft instanceof Date&&At.push(`due: ${zt(ft)}`);for(let rt of Pe){let W=v(It,rt);W!=null&&String(W).trim()!==""&&At.push(`${rt}: ${String(W)}`)}let Ft=At.join("<br>"),Rt=rt=>{var W;rt.preventDefault(),f&&vt?new le(vt,t,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():Tt(o,N,gt,St!=null?St:q,(W=a.row.notes)!=null?W:[],i)},yt=rt=>{gt&&Ft&&kt(o,x,gt,Ft,Pt,rt)},lt=()=>Mt(x);if(a.groupKey!==se){se=a.groupKey;let rt=Z+8+Gt*k+k/2,W=h(se);D(W,4,rt,U-12,11,"600"),Gt+=1}let bt=Z+8+Gt*k,Ht=k-10,Wt=O(A.getTime()),Dt=O(I.getTime()),Bt=Math.max(4,Dt-Wt),at=a.fullName,ot=document.createElementNS(u.namespaceURI,"rect");ot.setAttribute("x",String(Wt)),ot.setAttribute("y",String(bt)),ot.setAttribute("width",String(Bt)),ot.setAttribute("height",String(Ht)),ot.setAttribute("rx","3"),ot.setAttribute("ry","3"),ot.setAttribute("fill",ht((ge=a.row.series)!=null?ge:at,Gt)),ot.setAttribute("stroke","rgba(0,0,0,0.25)"),ot.setAttribute("stroke-width","0.5"),ot.style.cursor=f&&vt?"pointer":"default",ot.addEventListener("mouseenter",yt),ot.addEventListener("mouseleave",lt),ot.addEventListener("click",Rt),u.appendChild(ot);let be=bt+Ht/2;if(Bt>=6){let rt=ht((ye=a.row.series)!=null?ye:at,Gt),W=document.createElementNS(u.namespaceURI,"circle");W.setAttribute("cx",String(Wt)),W.setAttribute("cy",String(be)),W.setAttribute("r","3.5"),W.setAttribute("fill","#ffffff"),W.setAttribute("stroke",rt),W.setAttribute("stroke-width","1.5"),u.appendChild(W);let Nt=document.createElementNS(u.namespaceURI,"circle");Nt.setAttribute("cx",String(Dt)),Nt.setAttribute("cy",String(be)),Nt.setAttribute("r","3.5"),Nt.setAttribute("fill","#ffffff"),Nt.setAttribute("stroke",rt),Nt.setAttribute("stroke-width","1.5"),u.appendChild(Nt)}let xe=bt+Ht/2+2,Yt=m?16:4;if(L==="wide")D(at,Yt,xe,U-Yt-4,11,null,yt,lt,Rt);else{let rt=at,W=Math.max(40,U-Yt-8),ve=Math.max(8,Math.floor(W/6));rt.length>ve&&(rt=rt.slice(0,ve-1)+"\u2026");let xt=document.createElementNS(u.namespaceURI,"text");xt.setAttribute("x",String(Yt)),xt.setAttribute("y",String(xe)),xt.setAttribute("text-anchor","start"),xt.setAttribute("font-size","11"),xt.setAttribute("fill","#111111"),xt.textContent=rt,xt.style.cursor="pointer",xt.addEventListener("mouseenter",yt),xt.addEventListener("mouseleave",lt),xt.addEventListener("click",Rt),u.appendChild(xt)}if(ft instanceof Date){let rt=O(ft.getTime()),W=document.createElementNS(u.namespaceURI,"line");W.setAttribute("x1",String(rt)),W.setAttribute("y1",String(bt)),W.setAttribute("x2",String(rt)),W.setAttribute("y2",String(bt+Ht)),W.setAttribute("stroke","#ff6b6b"),W.setAttribute("stroke-width","2"),W.setAttribute("stroke-dasharray","4,2"),u.appendChild(W)}Gt+=1}if(f){let a=o.createDiv({cls:"prop-charts-empty"});a.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}var le=class extends wt.Modal{constructor(e,n,s,r){var f;super(app);this.notePath=e,this.spec=n,this.refresh=s,this.reindexFile=r;let i=(f=n.encoding)!=null?f:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var C,w;let{contentEl:e}=this;e.empty();let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof wt.TFile)){e.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let s=await this.app.vault.read(n),r={},i=s,f=/^---\n([\s\S]*?)\n---\n?/m.exec(s);if(f){try{r=(C=(0,wt.parseYaml)(f[1]))!=null?C:{}}catch(l){r={}}i=s.slice(f[0].length)}(typeof r!="object"||r==null)&&(r={});let h=(w=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?w:this.notePath,c=e.createDiv({cls:"gantt-edit-header"}),d=c.createEl("a",{text:h,cls:"gantt-edit-title"});d.href="#",d.addEventListener("click",l=>{l.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let m=c.createDiv({cls:"gantt-edit-subtitle"});m.textContent=this.notePath;let T=e.createDiv({cls:"gantt-edit-form"}),v=l=>{let E=T.createDiv({cls:"gantt-edit-row"}),_=E.createDiv({cls:"gantt-edit-label"});_.textContent=l;let g=E.createDiv({cls:"gantt-edit-field"});return{row:E,field:g}},S=l=>{if(!l)return"";let _=String(l).match(/^(\d{4}-\d{2}-\d{2})/);return _?_[1]:""},b=l=>{if(l=l.trim(),!!l&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l},k=null;if(this.startKey){let{field:l}=v(this.startKey+" (in\xEDcio)");k=l.createEl("input",{type:"date"}),k.value=S(r[this.startKey])}let P=null;if(this.endKey){let{field:l}=v(this.endKey+" (fim)");P=l.createEl("input",{type:"date"}),P.value=S(r[this.endKey])}let F=null;if(this.durationKey){let{field:l}=v(this.durationKey+" (minutos)");F=l.createEl("input",{type:"number"});let E=r[this.durationKey];F.value=E!=null?String(E):"",F.min="0",F.step="5"}let G=null;if(this.dueKey){let{field:l}=v(this.dueKey+" (due)");G=l.createEl("input",{type:"date"}),G.value=S(r[this.dueKey])}let Q=e.createDiv({cls:"gantt-edit-buttons"}),R=Q.createEl("button",{text:"Salvar",cls:"mod-cta"});Q.createEl("button",{text:"Cancelar"}).addEventListener("click",l=>{l.preventDefault(),this.close()}),R.addEventListener("click",async l=>{if(l.preventDefault(),this.startKey&&k){let g=b(k.value);g?r[this.startKey]=g:delete r[this.startKey]}if(this.endKey&&P){let g=b(P.value);g?r[this.endKey]=g:delete r[this.endKey]}if(this.durationKey&&F){let g=F.value.trim();if(g==="")delete r[this.durationKey];else{let y=Number(g);Number.isNaN(y)||(r[this.durationKey]=y)}}if(this.dueKey&&G){let g=b(G.value);g?r[this.dueKey]=g:delete r[this.dueKey]}let _=`---
${(0,wt.stringifyYaml)(r).trim()}
---
`+i;if(await this.app.vault.modify(n,_),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(g){}if(this.refresh)try{this.refresh()}catch(g){}new wt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};var Le=require("obsidian"),Qt=48,Ne=10,ue=28,Vt=28,Jt=class{render(t,e,n,s,r=!1){var c;let{title:i}=(c=e.options)!=null?c:{};t.empty(),t.addClass("prop-charts-container");let h=t.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(h.textContent=i),e.type){case"bar":this.renderBar(t,e,n);break;case"line":this.renderLine(t,e,n,!1);break;case"area":this.renderLine(t,e,n,!0);break;case"pie":this.renderPie(t,e,n);break;case"scatter":this.renderScatter(t,e,n);break;case"table":this.renderTable(t,e,n);break;case"gantt":Zt(t,e,n,s);break;case"stacked-bar":this.renderStackedBar(t,e,n);break;default:t.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+e.type})}if(!r){let d=t.createEl("button",{cls:"chart-notes-zoom-button"});d.setAttr("type","button"),d.setAttr("aria-label","Expandir gr\xE1fico"),d.textContent="\u2922",d.addEventListener("click",m=>{m.preventDefault(),new de(e,n,this,s).open()})}}renderBar(t,e,n){var U,tt,M,H;let s=(U=e.options)!=null?U:{},r=s.background,i=(tt=s.drilldown)!=null?tt:!0,f=(M=n.rows)!=null?M:[];if(!f.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:c,tooltip:d,details:m}=Ct(t,r),T=t.getBoundingClientRect().width||600,v=Math.max(T,480);h.style.width=v+"px";let S=40,b=16,k=18,P=28,F=300;c.setAttribute("height",String(F));let G=v-S-b,Q=F-k-P,R=new Map;for(let p of f){let u=String(p.x),x=(H=R.get(u))!=null?H:{label:p.x,rows:[]};x.rows.push(p),R.set(u,x)}let C=Array.from(R.keys()).sort((p,u)=>p<u?-1:p>u?1:0).map(p=>R.get(p)),w=C.length,l=new Set;f.forEach(p=>{p.series!=null&&l.add(String(p.series))});let E=Array.from(l),_=E.length>1,g=_?"grouped":"single",y=0;f.forEach(p=>{p.y>y&&(y=p.y)}),(!isFinite(y)||y<=0)&&(y=1);let K=p=>k+Q-p/(y||1)*Q,V=K(0),nt=4;for(let p=0;p<=nt;p++){let u=y*p/nt,x=K(u),N=document.createElementNS(c.namespaceURI,"line");N.setAttribute("x1",String(S)),N.setAttribute("y1",String(x)),N.setAttribute("x2",String(v-b)),N.setAttribute("y2",String(x)),N.setAttribute("stroke","#cccccc"),N.setAttribute("stroke-opacity","0.25"),c.appendChild(N);let D=document.createElementNS(c.namespaceURI,"text");D.setAttribute("x",String(S-4)),D.setAttribute("y",String(x+3)),D.setAttribute("text-anchor","end"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=String(Math.round(u)),c.appendChild(D)}let L=w>0?G/w:G;if(C.forEach((p,u)=>{let x=S+L*(u+.5),N=String(p.label),D=document.createElementNS(c.namespaceURI,"text");D.setAttribute("x",String(x)),D.setAttribute("y",String(F-P+12)),D.setAttribute("text-anchor","middle"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=N,c.appendChild(D)}),_){let p=t.createDiv({cls:"chart-notes-legend"});E.forEach((u,x)=>{let N=p.createDiv({cls:"chart-notes-legend-item"}),D=N.createDiv();D.style.width="10px",D.style.height="10px",D.style.borderRadius="999px",D.style.backgroundColor=ht(u,x),N.createSpan({text:u})})}C.forEach((p,u)=>{let x=S+L*(u+.5),N=p.rows;if(g==="single"){let et=N[0],$=et.y,Y=L*.6,O=x-Y/2,mt=K($),Et=Math.max(2,V-mt),J=ht("bar",u),B=document.createElementNS(c.namespaceURI,"rect");B.setAttribute("x",String(O)),B.setAttribute("y",String(mt)),B.setAttribute("width",String(Y)),B.setAttribute("height",String(Et)),B.setAttribute("fill",J),B.setAttribute("stroke","rgba(0,0,0,0.25)"),B.setAttribute("stroke-width","0.5"),B.style.cursor="pointer";let X=String(p.label),dt=`valor: ${Math.round($*100)/100}`;B.addEventListener("mouseenter",pt=>{var it,ct;return kt(t,d,X,dt,(ct=(it=et.notes)==null?void 0:it.length)!=null?ct:0,pt)}),B.addEventListener("mouseleave",()=>Mt(d)),B.addEventListener("click",pt=>{var it;pt.preventDefault(),Tt(t,m,X,$,(it=et.notes)!=null?it:[],i)}),c.appendChild(B);return}let D=E.length,st=L/Math.max(D+1,2),z=D*st,Z=x-z/2;E.forEach((et,$)=>{let Y=N.find(it=>(it.series!=null?String(it.series):"")===et);if(!Y)return;let O=Y.y,mt=Z+$*st,Et=K(O),J=Math.max(2,V-Et),B=ht(et,$),X=document.createElementNS(c.namespaceURI,"rect");X.setAttribute("x",String(mt)),X.setAttribute("y",String(Et)),X.setAttribute("width",String(st)),X.setAttribute("height",String(J)),X.setAttribute("fill",B),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let dt=`${et} @ ${String(p.label)}`,pt=`valor: ${Math.round(O*100)/100}`;X.addEventListener("mouseenter",it=>{var ct,Kt;return kt(t,d,dt,pt,(Kt=(ct=Y.notes)==null?void 0:ct.length)!=null?Kt:0,it)}),X.addEventListener("mouseleave",()=>Mt(d)),X.addEventListener("click",it=>{var ct;it.preventDefault(),Tt(t,m,dt,O,(ct=Y.notes)!=null?ct:[],i)}),c.appendChild(X)})})}renderStackedBar(t,e,n){var nt,L,U,tt;let s=(nt=e.options)!=null?nt:{},r=s.background,i=(L=s.drilldown)!=null?L:!0,f=(U=n.rows)!=null?U:[];if(!f.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:c,tooltip:d,details:m}=Ct(t,r),T=t.getBoundingClientRect().width||600,v=Math.max(T,480);h.style.width=v+"px";let S=40,b=16,k=18,P=28,F=300;c.setAttribute("height",String(F));let G=v-S-b,Q=F-k-P,R=new Map;for(let M of f){let H=String(M.x),p=(tt=R.get(H))!=null?tt:{label:M.x,rows:[]};p.rows.push(M),R.set(H,p)}let C=Array.from(R.keys()).sort((M,H)=>M<H?-1:M>H?1:0).map(M=>R.get(M)),w=C.length,l=new Set;f.forEach(M=>{M.series!=null&&l.add(String(M.series))});let E=Array.from(l);if(!E.length){this.renderBar(t,e,n);return}let _=0;C.forEach(M=>{let H=M.rows.reduce((p,u)=>p+u.y,0);H>_&&(_=H)}),(!isFinite(_)||_<=0)&&(_=1);let g=M=>k+Q-M/(_||1)*Q,y=4;for(let M=0;M<=y;M++){let H=_*M/y,p=g(H),u=document.createElementNS(c.namespaceURI,"line");u.setAttribute("x1",String(S)),u.setAttribute("y1",String(p)),u.setAttribute("x2",String(v-b)),u.setAttribute("y2",String(p)),u.setAttribute("stroke","#cccccc"),u.setAttribute("stroke-opacity","0.25"),c.appendChild(u);let x=document.createElementNS(c.namespaceURI,"text");x.setAttribute("x",String(S-4)),x.setAttribute("y",String(p+3)),x.setAttribute("text-anchor","end"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=String(Math.round(H)),c.appendChild(x)}let K=w>0?G/w:G;C.forEach((M,H)=>{let p=S+K*(H+.5),u=String(M.label),x=document.createElementNS(c.namespaceURI,"text");x.setAttribute("x",String(p)),x.setAttribute("y",String(F-P+12)),x.setAttribute("text-anchor","middle"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=u,c.appendChild(x)});let V=t.createDiv({cls:"chart-notes-legend"});E.forEach((M,H)=>{let p=V.createDiv({cls:"chart-notes-legend-item"}),u=p.createDiv();u.style.width="10px",u.style.height="10px",u.style.borderRadius="999px",u.style.backgroundColor=ht(M,H),p.createSpan({text:M})}),C.forEach((M,H)=>{let p=S+K*(H+.5),u=K*.6,x=p-u/2,N=0;E.forEach((D,st)=>{let z=M.rows.find(dt=>(dt.series!=null?String(dt.series):"")===D);if(!z)return;let Z=z.y,et=N,$=N+Z;N=$;let Y=g(et),O=g($),mt=Math.max(2,Y-O),Et=ht(D,st),J=document.createElementNS(c.namespaceURI,"rect");J.setAttribute("x",String(x)),J.setAttribute("y",String(O)),J.setAttribute("width",String(u)),J.setAttribute("height",String(mt)),J.setAttribute("fill",Et),J.setAttribute("stroke","rgba(0,0,0,0.25)"),J.setAttribute("stroke-width","0.5"),J.style.cursor="pointer";let B=`${D} @ ${String(M.label)}`,X=`valor: ${Math.round(Z*100)/100}`;J.addEventListener("mouseenter",dt=>{var pt,it;return kt(t,d,B,X,(it=(pt=z.notes)==null?void 0:pt.length)!=null?it:0,dt)}),J.addEventListener("mouseleave",()=>Mt(d)),J.addEventListener("click",dt=>{var pt;dt.preventDefault(),Tt(t,m,B,Z,(pt=z.notes)!=null?pt:[],i)}),c.appendChild(J)})})}renderLine(t,e,n,s){var U,tt,M,H;let r=(U=e.options)!=null?U:{},i=r.background,f=(tt=r.drilldown)!=null?tt:!0,h=(M=n.rows)!=null?M:[];if(!h.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:c,svg:d,tooltip:m,details:T}=Ct(t,i),v=t.getBoundingClientRect().width||600,S=Math.max(v,480);c.style.width=S+"px";let b=40,k=16,P=18,F=24,G=300;d.setAttribute("height",String(G));let Q=S-b-k,R=G-P-F,j=new Map;for(let p of h){let u=p.series!=null?String(p.series):"__default__",x=(H=j.get(u))!=null?H:[];x.push(p),j.set(u,x)}let C=Array.from(j.keys()),w=[],l=new Set;for(let p of h){let u=String(p.x);l.has(u)||(l.add(u),w.push(p.x))}let E=w.length||1,_=p=>{let u=String(p),x=w.findIndex(N=>String(N)===u);return x<0?b:E===1?b+Q/2:b+x/(E-1)*Q},g=p=>String(p),y=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY;for(let p of h)p.y<y&&(y=p.y),p.y>K&&(K=p.y);(!isFinite(y)||!isFinite(K))&&(y=0,K=1),y===K&&(y===0?K=1:y=0);let V=p=>P+R-(p-y)/(K-y||1)*R,nt=4;for(let p=0;p<=nt;p++){let u=y+(K-y)*p/nt,x=V(u),N=document.createElementNS(d.namespaceURI,"line");N.setAttribute("x1",String(b)),N.setAttribute("y1",String(x)),N.setAttribute("x2",String(S-k)),N.setAttribute("y2",String(x)),N.setAttribute("stroke","#cccccc"),N.setAttribute("stroke-opacity","0.25"),d.appendChild(N);let D=document.createElementNS(d.namespaceURI,"text");D.setAttribute("x",String(b-4)),D.setAttribute("y",String(x+3)),D.setAttribute("text-anchor","end"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=Math.abs(u)>=100?String(Math.round(u)):String(Math.round(u*10)/10),d.appendChild(D)}let L=C.filter(p=>p!=="__default__");if(L.length>1){let p=t.createDiv({cls:"chart-notes-legend"});L.forEach((u,x)=>{let N=u,D=p.createDiv({cls:"chart-notes-legend-item"}),st=D.createDiv();st.style.width="10px",st.style.height="10px",st.style.borderRadius="999px",st.style.backgroundColor=ht(N,x),D.createSpan({text:N})})}C.forEach((p,u)=>{let x=j.get(p);if(!(x!=null&&x.length))return;let N=p==="__default__"?ht("line",u):ht(p,u),D=[...x].sort((z,Z)=>{let et=w.findIndex(Y=>String(Y)===String(z.x)),$=w.findIndex(Y=>String(Y)===String(Z.x));return et-$}),st="";if(D.forEach((z,Z)=>{let et=_(z.x),$=V(z.y);st+=(Z===0?"M ":" L ")+et+" "+$}),s){let z=D[0],Z=D[D.length-1],et=_(z.x),$=_(Z.x),Y=V(y);st+=` L ${$} ${Y} L ${et} ${Y} Z`;let O=document.createElementNS(d.namespaceURI,"path");O.setAttribute("d",st),O.setAttribute("fill",N),O.setAttribute("fill-opacity","0.18"),O.setAttribute("stroke",N),O.setAttribute("stroke-width","1.5"),d.appendChild(O)}else{let z=document.createElementNS(d.namespaceURI,"path");z.setAttribute("d",st),z.setAttribute("fill","none"),z.setAttribute("stroke",N),z.setAttribute("stroke-width","2"),d.appendChild(z)}D.forEach(z=>{let Z=_(z.x),et=V(z.y),$=document.createElementNS(d.namespaceURI,"circle");$.setAttribute("cx",String(Z)),$.setAttribute("cy",String(et)),$.setAttribute("r","3"),$.setAttribute("fill","#ffffff"),$.setAttribute("stroke",N),$.setAttribute("stroke-width","1.5"),$.style.cursor="pointer";let Y=g(z.x),O=p==="__default__"?"":String(z.series),mt=O?`${O} @ ${Y}`:Y,Et=`valor: ${Math.round(z.y*100)/100}`;$.addEventListener("mouseenter",J=>{var B,X;return kt(t,m,mt,Et,(X=(B=z.notes)==null?void 0:B.length)!=null?X:0,J)}),$.addEventListener("mouseleave",()=>Mt(m)),$.addEventListener("click",J=>{var B;J.preventDefault(),Tt(t,T,mt,z.y,(B=z.notes)!=null?B:[],f)}),d.appendChild($)})})}renderPie(t,e,n){var Q;let{background:s,drilldown:r=!0}=(Q=e.options)!=null?Q:{};if(n.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let i=ae(s)?"#000000":void 0,f=t.getBoundingClientRect().width||600,{inner:h,svg:c,tooltip:d,details:m}=Ct(t,s),T=Math.max(f,420);h.style.width=T+"px",i&&(c.style.color=i);let v=300,S=T/2,b=(v-Vt+ue)/2,k=Math.min(T/2-20,v/2-20),F=n.rows.map(R=>Math.max(0,R.y)).reduce((R,j)=>R+j,0)||1,G=-Math.PI/2;n.rows.forEach((R,j)=>{var L;let C=R.x instanceof Date?R.x.toISOString().slice(0,10):String(R.x),w=R.y,l=w/F*Math.PI*2,E=S+k*Math.cos(G),_=b+k*Math.sin(G),g=S+k*Math.cos(G+l),y=b+k*Math.sin(G+l),K=l>Math.PI?1:0,V=document.createElementNS(c.namespaceURI,"path"),nt=[`M ${S} ${b}`,`L ${E} ${_}`,`A ${k} ${k} 0 ${K} 1 ${g} ${y}`,"Z"].join(" ");V.setAttribute("d",nt),V.setAttribute("fill",ht((L=R.series)!=null?L:C,j)),V.style.cursor="pointer",V.addEventListener("mouseenter",U=>{var tt,M;return kt(t,d,C,w,(M=(tt=R.notes)==null?void 0:tt.length)!=null?M:0,U)}),V.addEventListener("mouseleave",()=>Mt(d)),V.addEventListener("click",U=>{var tt;U.preventDefault(),Tt(t,m,C,w,(tt=R.notes)!=null?tt:[],r)}),c.appendChild(V),G+=l})}renderScatter(t,e,n){var _;let{background:s,drilldown:r=!0}=(_=e.options)!=null?_:{};if(n.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let i=ae(s)?"#000000":void 0,f=t.getBoundingClientRect().width||600,{inner:h,svg:c,tooltip:d,details:m}=Ct(t,s),T=Math.max(f,700);h.style.width=T+"px",i&&(c.style.color=i);let v=300,S=T-Qt-Ne,b=v-ue-Vt,k=n.rows.map(g=>{let y=g.x;if(y instanceof Date)return y.getTime();if(typeof y=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(y)){let V=new Date(y);if(!isNaN(V.getTime()))return V.getTime()}let K=Number(y);return isNaN(K)?null:K}return typeof y=="number"?y:null}),P=n.rows.map(g=>g.y),F=k.filter(g=>g!==null);if(F.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let G=Math.min(...F),Q=Math.max(...F),R=Math.min(...P),j=Math.max(...P),C=g=>Qt+(g-G)/(Q-G||1)*S,w=g=>v-Vt-(g-R)/(j-R||1)*b,l=document.createElementNS(c.namespaceURI,"line");l.setAttribute("x1",String(Qt)),l.setAttribute("y1",String(ue)),l.setAttribute("x2",String(Qt)),l.setAttribute("y2",String(v-Vt)),l.setAttribute("stroke","currentColor"),c.appendChild(l);let E=document.createElementNS(c.namespaceURI,"line");E.setAttribute("x1",String(Qt)),E.setAttribute("y1",String(v-Vt)),E.setAttribute("x2",String(T-Ne)),E.setAttribute("y2",String(v-Vt)),E.setAttribute("stroke","currentColor"),c.appendChild(E),n.rows.forEach((g,y)=>{let K=k[y];if(K==null)return;let V=C(K),nt=w(P[y]),L=document.createElementNS(c.namespaceURI,"circle");L.setAttribute("cx",String(V)),L.setAttribute("cy",String(nt)),L.setAttribute("r","4"),L.setAttribute("fill",ht(g.series,y)),L.style.cursor="pointer";let U=g.x instanceof Date?g.x.toISOString().slice(0,10):typeof g.x=="string"?g.x:String(g.x);L.addEventListener("mouseenter",tt=>{var M,H;return kt(t,d,U,g.y,(H=(M=g.notes)==null?void 0:M.length)!=null?H:0,tt)}),L.addEventListener("mouseleave",()=>Mt(d)),L.addEventListener("click",tt=>{var M;tt.preventDefault(),Tt(t,m,U,g.y,(M=g.notes)!=null?M:[],r)}),c.appendChild(L)})}renderTable(t,e,n){var d,m;let{background:s}=(d=e.options)!=null?d:{},{inner:r}=Ct(t,s),i=r.createEl("table",{cls:"chart-notes-table"}),h=i.createEl("thead").createEl("tr");h.createEl("th",{text:"X"}),h.createEl("th",{text:"Y"}),h.createEl("th",{text:"Notas"});let c=i.createEl("tbody");for(let T of n.rows){let v=c.createEl("tr");v.createEl("td",{text:T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x)}),v.createEl("td",{text:String(T.y)});let S=v.createEl("td");for(let b of(m=T.notes)!=null?m:[])S.createEl("a",{text:b,href:"#"}).addEventListener("click",P=>{P.preventDefault(),app.workspace.openLinkText(b,"",!1)}),S.createSpan({text:" "})}}},de=class extends Le.Modal{constructor(e,n,s,r){super(app);this.size="large";this.spec=e,this.data=n,this.renderer=s,this.ctx=r}onOpen(){var h;let{contentEl:e}=this;e.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),e.addClass("chart-notes-zoom-modal"),this.applySize();let n=e.createDiv({cls:"chart-notes-zoom-header"}),s=(h=this.spec.options)!=null&&h.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";n.createEl("div",{text:s,cls:"chart-notes-zoom-title"});let r=n.createDiv({cls:"chart-notes-zoom-sizes"}),i=(c,d)=>{let m=r.createEl("button",{cls:"chart-notes-zoom-size-btn",text:c});(()=>{m.toggleClass("is-active",this.size===d)})(),m.addEventListener("click",v=>{v.preventDefault(),this.size=d,this.applySize(),r.querySelectorAll(".chart-notes-zoom-size-btn").forEach(b=>b.classList.remove("is-active")),m.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let f=e.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(f,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let e=this.modalEl;if(!e)return;let n="95vw",s="85vh";switch(this.size){case"small":n="60vw",s="55vh";break;case"medium":n="80vw",s="70vh";break;case"large":default:n="95vw",s="85vh";break}e.style.maxWidth=n,e.style.width=n,e.style.height=s,e.style.maxHeight=s}};var te=class extends Lt.Plugin{constructor(e,n){super(e,n)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new Ot(this.app),await this.indexer.buildIndex(),this.query=new jt(()=>this.indexer.getAll(),[]),this.renderer=new Jt,this.registerEvent(this.app.vault.on("modify",async e=>{e instanceof Lt.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("create",async e=>{e instanceof Lt.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("delete",async e=>{e instanceof Lt.TFile&&this.indexer.removeFile(e)})),this.registerMarkdownCodeBlockProcessor("chart",async(e,n,s)=>{var d;let r;try{let m=(0,Lt.parseYaml)(e);if(!m||typeof m!="object"){n.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}r=m}catch(m){n.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+m.message});return}if(!r.type){n.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=r.type==="gantt",f=r.type==="table";if(!i&&!f){if(!r.encoding||!r.encoding.x){n.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let T=((d=r.aggregate)==null?void 0:d.y)==="count";if(!r.encoding.y&&!T){n.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}r.encoding||(r.encoding={}),r.source||(r.source={});let c;try{c=this.query.run(r)}catch(m){n.createEl("div",{text:"Chart Notes: erro na query: "+m.message});return}this.renderer.render(n,r,c)})}onunload(){console.log("unloading Chart Notes plugin")}};
