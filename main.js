/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var le=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Ye=Object.prototype.hasOwnProperty;var Xe=(s,n)=>{for(var t in n)le(s,t,{get:n[t],enumerable:!0})},qe=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of Oe(n))!Ye.call(s,o)&&o!==t&&le(s,o,{get:()=>n[o],enumerable:!(e=Ge(n,o))||e.enumerable});return s};var je=s=>qe(le({},"__esModule",{value:!0}),s);var cn={};Xe(cn,{default:()=>se});module.exports=je(cn);var Lt=require("obsidian");var Ut=require("obsidian"),ue="chartnotes-view",Te=["bar","stacked-bar","line","area","pie","scatter","gantt"];function ce(s){let n=String(s!=null?s:"bar").trim().toLowerCase();return Te.includes(n)?n:"bar"}var qt=class extends Ut.BasesView{constructor(t,e,o){super(t);this.type=ue;this.settings={chartType:"bar",xProperty:null,yProperty:null,seriesProperty:null,startProperty:null,endProperty:null,dueProperty:null,durationProperty:null,groupProperty:null};this.groupedData=[];this.renderer=o,this.containerEl=e,this.containerEl.empty(),this.containerEl.addClass("chartnotes-bases-root"),this.controlsEl=this.containerEl.createDiv("chartnotes-bases-controls"),this.chartEl=this.containerEl.createDiv("chartnotes-bases-chart");let r=this.controlsEl.style;r.display="flex",r.flexWrap="wrap",r.alignItems="flex-end",r.gap="8px",r.margin="8px 0",r.padding="6px 8px",r.borderBottom="1px solid var(--background-modifier-border)",r.backgroundColor="var(--background-secondary)";let i=this.controlsEl.createDiv();i.textContent="Chart Notes \u2013 controles",i.style.fontWeight="bold",i.style.marginRight="12px"}onDataUpdated(){var e;let t=this.data;this.groupedData=(e=t==null?void 0:t.groupedData)!=null?e:[],this.ensureDefaultsFromOrder(),this.buildControlsUI(),this.renderChart()}ensureDefaultsFromOrder(){var a,l,h;let t=this.config,e=(l=(a=t==null?void 0:t.getOrder)==null?void 0:a.call(t))!=null?l:[],o=(h=this.allProperties)!=null?h:[],r=[],i=new Set;for(let c of e)!c||i.has(c)||(i.add(c),r.push(c));for(let c of o)!c||i.has(c)||(i.add(c),r.push(c));let g=c=>c>=0&&c<r.length?r[c]:null;this.settings.xProperty||(this.settings.xProperty=g(0)),this.settings.yProperty||(this.settings.yProperty=g(1)),this.settings.seriesProperty||(this.settings.seriesProperty=g(2))}buildControlsUI(){var R,A,u;let t=Array.from(this.controlsEl.children);for(let y=1;y<t.length;y++)t[y].remove();let e=this.config,o=(A=(R=e==null?void 0:e.getOrder)==null?void 0:R.call(e))!=null?A:[],r=(u=this.allProperties)!=null?u:[],i=[],g=new Set;for(let y of o)!y||g.has(y)||(g.add(y),i.push(y));for(let y of r)!y||g.has(y)||(g.add(y),i.push(y));let a={},l=ce(this.settings.chartType),h=this.controlsEl.createDiv("chartnotes-control");a.type=h;let c=h.createEl("label");c.textContent="Tipo:",c.style.marginRight="4px";let E=h.createEl("select");for(let y of Te){let S=E.createEl("option");S.value=y,S.text=y}E.value=l;let b=(y,S,x)=>{var Y,Z,L;let T=this.controlsEl.createDiv("chartnotes-control");a[x]=T;let V=T.createEl("label");V.textContent=S,V.style.marginRight="4px";let O=T.createEl("select"),Q=O.createEl("option");Q.value="",Q.text="(auto)";for(let p of i){let f=p;try{if(e!=null&&e.getDisplayName){let w=e.getDisplayName(p);w&&typeof w=="string"&&(f=w)}else{let w=(0,Ut.parsePropertyId)(p),N=(Y=w.type)!=null?Y:"",q=(Z=w.name)!=null?Z:p;f=N?`${q} (${N})`:q}}catch(w){}let D=O.createEl("option");D.value=p,D.text=f}let _=(L=this.settings[y])!=null?L:"";return _&&(O.value=_),O.onchange=()=>{let p=O.value||null;this.settings[y]=p,this.renderChart()},T},v=b("xProperty","X:","x"),m=b("yProperty","Y:","y"),P=b("seriesProperty","S\xE9rie:","series"),k=b("startProperty","In\xEDcio:","start"),C=b("endProperty","Fim:","end"),$=b("dueProperty","Due:","due"),I=b("durationProperty","Dura\xE7\xE3o:","duration"),z=b("groupProperty","Grupo:","group"),H=y=>{let S=y==="gantt";v.style.display="",m.style.display="",P.style.display="",k.style.display=S?"":"none",C.style.display=S?"":"none",$.style.display=S?"":"none",I.style.display=S?"":"none",z.style.display=S?"":"none"};H(l),E.onchange=()=>{let y=ce(E.value);this.settings.chartType=y,H(y),this.renderChart()}}renderChart(){var h;if(this.chartEl.empty(),!this.groupedData||this.groupedData.length===0){this.chartEl.createDiv({cls:"prop-charts-empty",text:"Sem dados (Base vazia ou sem resultados)."});return}let t=ce(this.settings.chartType),e;if(t==="gantt"?e=this.buildRowsForGantt(this.groupedData):t==="scatter"?e=this.buildRowsForScatter(this.groupedData):e=this.buildRowsForAggregatedCharts(this.groupedData),!e.length){this.chartEl.createDiv({cls:"prop-charts-empty",text:"Sem linhas para exibir (verifique as propriedades X/Y)."});return}let o={rows:e},r=this.buildEncoding(),i=this.config,g=(h=i==null?void 0:i.name)!=null?h:"Chart Notes (Bases)",a={type:t,source:{type:"properties",query:""},encoding:r,options:{title:g,drilldown:!0}},l={refresh:()=>this.onDataUpdated()};this.renderer.render(this.chartEl,a,o,l)}getSelectedProp(t){var o;let e=this.settings[t];if(!e)return{id:null,name:null};try{let r=(0,Ut.parsePropertyId)(e);return{id:e,name:(o=r.name)!=null?o:e}}catch(r){return{id:e,name:e}}}readValue(t,e){if(!e.id)return null;let o;try{o=t.getValue(e.id)}catch(r){return null}if(!o)return null;try{if(typeof o.isEmpty=="function"&&o.isEmpty())return null}catch(r){}try{let r=o.toString();if(r==null)return null;let i=String(r).trim();return i.length?i:null}catch(r){return null}}parseDate(t){if(!t)return null;let e=t.trim();if(!e)return null;let o=new Date(e);return Number.isNaN(o.getTime())?null:o}buildRowsForAggregatedCharts(t){var g,a;let e=this.getSelectedProp("xProperty"),o=this.getSelectedProp("yProperty"),r=this.getSelectedProp("seriesProperty"),i=new Map;for(let l of t)for(let h of l.entries){let c=h.file,E=(a=this.readValue(h,e))!=null?a:c!=null&&c.name?String(c.name):String((g=c==null?void 0:c.path)!=null?g:""),b=this.readValue(h,o),v=1;if(o.id){if(b==null)continue;let $=Number(b);if(Number.isNaN($))continue;v=$}let m=this.readValue(h,r),P=m!=null?String(m):void 0,k=`${E}@@${P!=null?P:""}`,C=i.get(k);C||(C={x:E,y:0,series:P,notes:[],props:{}},i.set(k,C)),C.y+=v,c!=null&&c.path&&C.notes.push(c.path),C.props&&e.name&&(C.props[e.name]=E),C.props&&o.name&&b!=null&&(C.props[o.name]=v),C.props&&r.name&&m!=null&&(C.props[r.name]=m)}return Array.from(i.values())}buildRowsForScatter(t){let e=this.getSelectedProp("xProperty"),o=this.getSelectedProp("yProperty"),r=this.getSelectedProp("seriesProperty"),i=[];for(let g of t)for(let a of g.entries){let l=a.file,h=this.readValue(a,e),c=this.readValue(a,o);if(h==null||c==null)continue;let E=Number(h),b=Number(c);if(Number.isNaN(E)||Number.isNaN(b))continue;let v=this.readValue(a,r),m=v!=null?String(v):void 0,P={x:E,y:b,series:m,notes:l!=null&&l.path?[l.path]:[],props:{}};i.push(P)}return i}buildRowsForGantt(t){var c,E;let e=this.getSelectedProp("xProperty"),o=this.getSelectedProp("seriesProperty"),r=this.getSelectedProp("startProperty"),i=this.getSelectedProp("endProperty"),g=this.getSelectedProp("dueProperty"),a=this.getSelectedProp("durationProperty"),l=this.getSelectedProp("groupProperty"),h=[];for(let b of t)for(let v of b.entries){let m=v.file,P=this.readValue(v,r),k=this.readValue(v,i);if(!P||!k)continue;let C=this.parseDate(P),$=this.parseDate(k);if(!C||!$)continue;let I=(E=this.readValue(v,e))!=null?E:m!=null&&m.name?String(m.name).replace(/\.md$/i,""):String((c=m==null?void 0:m.path)!=null?c:""),z=this.readValue(v,g),H=this.parseDate(z!=null?z:null),R=this.readValue(v,a),A=R!=null?Number(R):void 0,u=typeof A=="number"&&!Number.isNaN(A),y=this.readValue(v,o),S=y!=null?String(y):void 0,x=this.readValue(v,l),T={};a.name&&u&&(T[a.name]=A),l.name&&x!=null&&(T[l.name]=x);let V={x:I,y:0,series:S,start:C,end:$,due:H!=null?H:void 0,notes:m!=null&&m.path?[m.path]:[],props:T};h.push(V)}return h}buildEncoding(){var h,c,E,b,v,m,P,k;let t=this.getSelectedProp("xProperty"),e=this.getSelectedProp("yProperty"),o=this.getSelectedProp("seriesProperty"),r=this.getSelectedProp("startProperty"),i=this.getSelectedProp("endProperty"),g=this.getSelectedProp("dueProperty"),a=this.getSelectedProp("durationProperty"),l=this.getSelectedProp("groupProperty");return{x:(h=t.name)!=null?h:"x",y:(c=e.name)!=null?c:"y",series:(E=o.name)!=null?E:"series",start:(b=r.name)!=null?b:"start",end:(v=i.name)!=null?v:"end",due:(m=g.name)!=null?m:"due",duration:(P=a.name)!=null?P:"duration",group:(k=l.name)!=null?k:"group"}}};var Ne=require("obsidian"),jt=class{constructor(n){this.index=new Map;this.app=n}async buildIndex(){this.index.clear();let n=this.app.vault.getMarkdownFiles();for(let t of n)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(n){if(n.extension!=="md")return;let t={};try{let o=(await this.app.vault.read(n)).match(/^---\n([\s\S]*?)\n---\n?/);if(o){let i=(0,Ne.parseYaml)(o[1])||{};if(i&&typeof i=="object")for(let[g,a]of Object.entries(i))g!=="position"&&(t[g]=a)}let r=this.app.metadataCache.getFileCache(n);r!=null&&r.tags&&!t.tags&&(t.tags=r.tags.map(i=>i.tag.replace(/^#/,"")))}catch(e){console.error("Chart Notes: erro ao indexar",n.path,e)}this.index.set(n.path,{path:n.path,props:t})}removeFile(n){this.index.delete(n.path)}};function Le(s,n){if(!n||n.length===0)return!0;for(let t of n){if(t===".")return!0;let e=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(e))return!0}return!1}function Ie(s,n){if(!n||n.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let o of n)if(t.includes(o)||t.includes("#"+o))return!0;return!1}let e=String(t);for(let o of n)if(e===o||e==="#"+o)return!0;return!1}function Jt(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function $t(s){if(s instanceof Date)return s;if(typeof s!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(s)){let[t,e,o]=s.split("-");return new Date(Number(t),Number(e)-1,Number(o),0,0,0,0)}let n=new Date(s);return isNaN(n.getTime())?null:n}function ut(s){let n=new Date(s);return n.setHours(0,0,0,0),n}function Zt(s,n){let t=new Date(s);return t.setDate(t.getDate()-n),t}function Ze(s,n){return Zt(s,n*7)}function Je(s,n){let t=new Date(s);return t.setMonth(t.getMonth()-n),t}function pe(s,n){let t=new Date(s);return t.setDate(t.getDate()+n),t}function tn(s,n){return pe(s,n*7)}function en(s,n){let t=new Date(s);return t.setMonth(t.getMonth()+n),t}function Me(s){let n=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(n)||n.endsWith("date")||n.endsWith("at")||n.endsWith("on"))}function ke(s,n){let t=n?new Date(n):new Date,e=ut(t),o=s.trim().toLowerCase();if(o==="today")return e;if(o==="yesterday")return ut(Zt(e,1));if(/^-\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(Zt(e,r))}if(/^-\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Zt(e,r))}if(/^-\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Ze(e,r))}if(/^-\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Je(e,r))}if(/^\+\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(pe(e,r))}if(/^\+\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(pe(e,r))}if(/^\+\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(tn(e,r))}if(/^\+\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(en(e,r))}return null}function _e(s){let n=s.trim(),t=n.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let h=t[1].trim(),c=t[2].trim(),E=t[3].trim(),b=Me(h),v=de(c,b),m=de(E,b),P=v.valueType==="date"||m.valueType==="date"?"date":v.valueType;return{field:h,op:"between",value:v.value,value2:m.value,valueType:P}}let e=/(==|!=|>=|<=|>|<)/,o=n.split(e);if(o.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+s);let r=o[0].trim(),i=o[1].trim(),g=o[2].trim(),a=Me(r),l=de(g,a);return{field:r,op:i,value:l.value,valueType:l.valueType}}function de(s,n){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let e=t.toLowerCase(),o=e==="today"||e==="yesterday"||e.startsWith("-")||e.startsWith("+");if(n){if(t==="0"||e==="today")return{value:ut(new Date),valueType:"date"};let i=ke(t);if(i)return{value:i,valueType:"date"}}else if(o){let i=ke(t);if(i)return{value:i,valueType:"date"}}if(Jt(t)){let i=$t(t);if(i)return{value:i,valueType:"date"}}let r=Number(t);return Number.isNaN(r)?{value:t,valueType:"string"}:{value:r,valueType:"number"}}function Fe(s,n){let t=s[n.field];if(t==null)return!1;if(n.valueType==="date"){let r=t instanceof Date?ut(t):Jt(t)?ut($t(t)):null;if(!r)return!1;let i=n.value instanceof Date?n.value:null,g=n.value2 instanceof Date?n.value2:null;if(!i)return!1;let a=r.getTime(),l=ut(i).getTime();switch(n.op){case"==":return a===l;case"!=":return a!==l;case">":return a>l;case">=":return a>=l;case"<":return a<l;case"<=":return a<=l;case"between":if(!g)return!1;let h=ut(g).getTime();return a>=l&&a<=h}}if(n.valueType==="number"){let r=Number(t);if(isNaN(r))return!1;let i=Number(n.value);switch(n.op){case"==":return r===i;case"!=":return r!==i;case">":return r>i;case">=":return r>=i;case"<":return r<i;case"<=":return r<=i;case"between":return typeof n.value2!="number"?!1:r>=i&&r<=n.value2}}let e=String(t),o=String(n.value);switch(n.op){case"==":return e===o;case"!=":return e!==o;case">":return e>o;case">=":return e>=o;case"<":return e<o;case"<=":return e<=o;case"between":return!1}}function nn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(Jt(s)){let n=$t(s);if(n)return{key:n,isDate:!0}}return{key:s,isDate:!1}}function rn(s,n){let t=s.x,e=n.x;if(t instanceof Date&&e instanceof Date)return t.getTime()-e.getTime();let o=String(t),r=String(e);return o<r?-1:o>r?1:0}function sn(s,n){var r,i;let t=rn(s,n);if(t!==0)return t;let e=(r=s.series)!=null?r:"",o=(i=n.series)!=null?i:"";return e<o?-1:e>o?1:0}function on(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let n=s.trim().match(/^(\d+)/);if(n){let t=Number(n[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(s)}`)}function an(s){var e,o;let n=new Map,t=[];for(let r of s){let i=(e=r.series)!=null?e:"__no_series__",a=((o=n.get(i))!=null?o:0)+r.y;n.set(i,a),t.push({...r,y:a})}return t}function ln(s,n){var i,g;let t=on(n);if(!t||t<=1)return[...s];let e=new Map,o=new Map,r=[];for(let a of s){let l=(i=a.series)!=null?i:"__no_series__",h=e.get(l);h||(h=[],e.set(l,h));let c=(g=o.get(l))!=null?g:0;if(h.push(a.y),c+=a.y,h.length>t){let v=h.shift();c-=v}o.set(l,c);let E=h.length||1,b=c/E;r.push({...a,y:b})}return r}var te=class{constructor(n,t){this.getIndex=n,this.defaultPaths=t}run(n){var i,g,a;let t=this.getIndex(),e=(i=n.source)!=null&&i.paths&&n.source.paths.length?n.source.paths:this.defaultPaths,o=(g=n.source)!=null&&g.tags&&n.source.tags.length?n.source.tags:[],r=[];for(let l of t){let h=e&&e.length?Le(l.path,e):!0,c=o&&o.length?Ie(l.props,o):!0;if(!h||!c)continue;let E=!0;if((a=n.source)!=null&&a.where&&n.source.where.length>0)for(let b of n.source.where){let v;try{v=_e(b)}catch(m){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${b} (${m.message})`)}if(!Fe(l.props,v)){E=!1;break}}E&&r.push(l)}return n.type==="gantt"?this.runGantt(n,r):n.type==="table"?this.runTable(n,r):this.runStandard(n,r)}runTable(n,t){var o,r;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(o=n.encoding)==null?void 0:o.x,yField:(r=n.encoding)==null?void 0:r.y}}runGantt(n,t){var c,E,b;let e=(c=n.encoding)!=null?c:{},o=e.start,r=e.end,i=(E=e.label)!=null?E:e.x,g=e.series,a=e.duration,l=e.due,h=[];for(let v of t){let m=(b=v.props)!=null?b:{},P=R=>Array.isArray(R)?R[0]:R,k=null;if(r){let R=P(m[r]),A=$t(R);A&&(k=A)}if(!k)continue;let C=null;if(o){let R=P(m[o]),A=$t(R);A&&(C=A)}if(!C&&a){let R=P(m[a]),A=Number(R);Number.isNaN(A)||(C=new Date(k.getTime()-A*6e4))}C||(C=new Date(k.getTime()));let $;if(l){let R=P(m[l]),A=$t(R);A&&($=A)}let I;if(i){let R=P(m[i]);(R==null||R==="")&&(R=v.path),I=R}else I=v.path;let z;if(g){let R=P(m[g]);R!=null&&(z=String(R))}let H={x:I,y:0,notes:[v.path],series:z,start:C,end:k,props:m};$&&(H.due=$),h.push(H)}return h.sort((v,m)=>{let P=v.start?v.start.getTime():0,k=m.start?m.start.getTime():0;return P-k}),{rows:h,xField:i,yField:r}}runStandard(n,t){var v,m,P,k,C,$,I,z,H,R;let e=(v=n.encoding)==null?void 0:v.x,o=(m=n.encoding)==null?void 0:m.y,r=(P=n.encoding)==null?void 0:P.series;if(!e)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(k=n.aggregate)!=null?k:{},g=(C=i.y)!=null?C:null,a=!!i.cumulative,l=i.rolling;if(!o&&g!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let h=[];for(let A of t){let u=($=A.props)!=null?$:{},y=_=>Array.isArray(_)?_[0]:_,S=y(u[e]);if(S==null)continue;let x=nn(S),T=x.key,V=x.isDate,O;if(r){let _=y(u[r]);_!=null&&String(_).trim()!==""&&(O=String(_))}let Q;if(g==="count")Q=1;else{let _=y(u[o]);if(_==null)continue;let Y=Number(_);if(Number.isNaN(Y))continue;Q=Y}h.push({x:T,y:Q,notes:[A.path],series:O,props:u,_isDate:V,_origX:S})}if(h.length===0)return{rows:[],xField:e,yField:o};let c=[];if(g){let A=new Map;for(let u of h){let y=(I=u.series)!=null?I:"",S=u.x instanceof Date?u.x.toISOString().slice(0,10):String(u.x),x=y+"||"+S,T=(z=A.get(x))!=null?z:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:u.x,isDate:u._isDate,series:u.series,props:u.props};T.sum+=u.y,T.count+=1,u.y<T.min&&(T.min=u.y),u.y>T.max&&(T.max=u.y),T.notes.push(...u.notes),T.props=(H=u.props)!=null?H:T.props,A.set(x,T)}for(let[,u]of A){let y=u.sum;switch(g){case"sum":y=u.sum;break;case"avg":y=u.sum/u.count;break;case"min":y=u.min;break;case"max":y=u.max;break;case"count":y=u.count;break}c.push({x:u.xRep,y,notes:u.notes,series:u.series,props:u.props})}}else c=h.map(A=>({x:A.x,y:A.y,notes:A.notes,series:A.series,props:A.props}));if(c.length===0)return{rows:[],xField:e,yField:o};let E=((R=n.sort)==null?void 0:R.x)==="desc"?"desc":"asc";if(c.sort((A,u)=>{let y=sn(A,u);return E==="asc"?y:-y}),(a||l)&&!(n.type==="line"||n.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(a&&l)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let b=c;return l?b=ln(c,l):a&&(b=an(c)),{rows:b,xField:e,yField:o}}};var Ct=require("obsidian");var $e=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function it(s,n){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((e,o)=>e*33+o.charCodeAt(0)>>>0,0);return $e[t%$e.length]}function wt(s,n){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let e=t.createDiv({cls:"chart-notes-inner"});e.style.display="block",e.style.minHeight=`${300}px`,n&&(e.style.background=n);let o="http://www.w3.org/2000/svg",r=document.createElementNS(o,"svg");r.setAttribute("width","100%"),r.setAttribute("height",String(300)),r.style.display="block",e.appendChild(r);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let g=s.createDiv({cls:"chart-notes-details"});return g.style.display="none",{scroll:t,inner:e,svg:r,tooltip:i,details:g}}function gt(s,n,t,e,o,r){let i=s.getBoundingClientRect(),g=typeof e=="number"?Number.isInteger(e)?String(e):e.toFixed(2):String(e);n.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${g}</div>
    <div class="chart-notes-tooltip-notes">${o} nota${o===1?"":"s"}</div>
  `,n.style.display="block";let a=n.getBoundingClientRect(),l=r.clientX-i.left+6,h=r.clientY-i.top+6;l+a.width>i.width-4&&(l=i.width-a.width-4),l<4&&(l=4),h+a.height>i.height-4&&(h=i.height-a.height-4),h<4&&(h=4),n.style.left=l+"px",n.style.top=h+"px"}function yt(s){s.style.display="none"}function mt(s,n,t,e,o,r){if(!r)return;if(n.empty(),!o||o.length===0){n.style.display="none";return}n.style.display="block";let i=n.createEl("div",{cls:"chart-notes-details-header"}),g=i.createEl("div",{cls:"chart-notes-details-title"});g.textContent=`Notas em "${t}" (${o.length})`+(Number.isFinite(e)&&e!==0?` \u2013 valor ${Number.isInteger(e)?e:e.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{n.style.display="none"});let l=n.createEl("ul",{cls:"chart-notes-details-list"});for(let h of o){let E=l.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:h});E.href="#",E.addEventListener("click",b=>{b.preventDefault(),app.workspace.openLinkText(h,"",!1)})}}function zt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let n=s.getDate().toString().padStart(2,"0"),t=(s.getMonth()+1).toString().padStart(2,"0");return`${n}/${t}`}function He(s){if(!s)return!1;let n=s.trim().toLowerCase();if(n==="#fff"||n==="#ffffff"||n==="white")return!0;if(!n.startsWith("#"))return!1;let t,e,o;if(n.length===4)t=parseInt(n[1]+n[1],16),e=parseInt(n[2]+n[2],16),o=parseInt(n[3]+n[3],16);else if(n.length===7)t=parseInt(n.slice(1,3),16),e=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);else return!1;return(.2126*t+.7152*e+.0722*o)/255>.7}var he=class extends Ct.Modal{constructor(t,e,o,r){var g;super(app);this.notePath=t,this.spec=e,this.refresh=o,this.reindexFile=r;let i=(g=e.encoding)!=null?g:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var R,A;let{contentEl:t}=this;t.empty();let e=this.app.vault.getAbstractFileByPath(this.notePath);if(!(e instanceof Ct.TFile)){t.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let o=await this.app.vault.read(e),r={},i=o,g=/^---\n([\s\S]*?)\n---\n?/m.exec(o);if(g){try{r=(R=(0,Ct.parseYaml)(g[1]))!=null?R:{}}catch(u){r={}}i=o.slice(g[0].length)}(typeof r!="object"||r==null)&&(r={});let a=(A=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?A:this.notePath,l=t.createDiv({cls:"gantt-edit-header"}),h=l.createEl("a",{text:a,cls:"gantt-edit-title"});h.href="#",h.addEventListener("click",u=>{u.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let c=l.createDiv({cls:"gantt-edit-subtitle"});c.textContent=this.notePath;let E=t.createDiv({cls:"gantt-edit-form"}),b=u=>{let y=E.createDiv({cls:"gantt-edit-row"}),S=y.createDiv({cls:"gantt-edit-label"});S.textContent=u;let x=y.createDiv({cls:"gantt-edit-field"});return{row:y,field:x}},v=u=>{if(!u)return"";let S=String(u).match(/^(\d{4}-\d{2}-\d{2})/);return S?S[1]:""},m=u=>{if(u=u.trim(),!!u&&/^\d{4}-\d{2}-\d{2}$/.test(u))return u},P=null;if(this.startKey){let{field:u}=b(this.startKey+" (in\xEDcio)");P=u.createEl("input",{type:"date"}),P.value=v(r[this.startKey])}let k=null;if(this.endKey){let{field:u}=b(this.endKey+" (fim)");k=u.createEl("input",{type:"date"}),k.value=v(r[this.endKey])}let C=null;if(this.durationKey){let{field:u}=b(this.durationKey+" (minutos)");C=u.createEl("input",{type:"number"});let y=r[this.durationKey];C.value=y!=null?String(y):"",C.min="0",C.step="5"}let $=null;if(this.dueKey){let{field:u}=b(this.dueKey+" (due)");$=u.createEl("input",{type:"date"}),$.value=v(r[this.dueKey])}let I=t.createDiv({cls:"gantt-edit-buttons"}),z=I.createEl("button",{text:"Salvar",cls:"mod-cta"});I.createEl("button",{text:"Cancelar"}).addEventListener("click",u=>{u.preventDefault(),this.close()}),z.addEventListener("click",async u=>{if(u.preventDefault(),this.startKey&&P){let x=m(P.value);x?r[this.startKey]=x:delete r[this.startKey]}if(this.endKey&&k){let x=m(k.value);x?r[this.endKey]=x:delete r[this.endKey]}if(this.durationKey&&C){let x=C.value.trim();if(x==="")delete r[this.durationKey];else{let T=Number(x);Number.isNaN(T)||(r[this.durationKey]=T)}}if(this.dueKey&&$){let x=m($.value);x?r[this.dueKey]=x:delete r[this.dueKey]}let S=`---
${(0,Ct.stringifyYaml)(r).trim()}
---
`+i;if(await this.app.vault.modify(e,S),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(x){}if(this.refresh)try{this.refresh()}catch(x){}new Ct.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function ee(s,n,t,e){var be,xe,ve,Se,we,Ae,Ee,De;let o=(be=n.options)!=null?be:{},r=o.background,i=(xe=o.drilldown)!=null?xe:!0,g=!0,a=d=>{if(d==null)return"";let M=String(d).trim();if(!M)return"";let F=M.match(/^\[\[(.+?)\]\]$/);F&&(M=F[1]);let X=M.lastIndexOf("/");return X>=0&&X<M.length-1&&(M=M.slice(X+1)),M};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(d=>d.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let l=t.rows.filter(d=>d.start&&d.end);if(l.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let h=n.encoding,c=h.group,E=h.duration,b=(d,M)=>{if(!d||!M)return;let F=d[M];return Array.isArray(F)?F[0]:F},m=l.map(d=>{var xt,ct;let M=d.start,F=d.end,X=d.props,It=typeof d.x=="string"?d.x:d.x instanceof Date?zt(M):String(d.x),At=a(It),bt,_t=c?b(X,c):void 0;_t!=null?bt=String(_t):d.series!=null?bt=String(d.series):bt=At;let ft=(xt=d.notes)==null?void 0:xt[0],Et=ft?(ct=ft.replace(/\.md$/i,"").split("/").pop())!=null?ct:ft:At,Pt=d.due,Ft,Mt=b(X,E);if(Mt!=null){let vt=Number(Mt);Number.isNaN(vt)||(Ft=vt)}return{row:d,start:M,end:F,props:X,fullName:At,groupKey:bt,notePath:ft,noteTitle:Et,due:Pt,estMinutes:Ft}}).filter(d=>d.start instanceof Date&&!isNaN(d.start.getTime())&&d.end instanceof Date&&!isNaN(d.end.getTime()));if(m.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}m.sort((d,M)=>{if(d.groupKey<M.groupKey)return-1;if(d.groupKey>M.groupKey)return 1;let F=d.start.getTime(),X=M.start.getTime();return F!==X?F-X:d.fullName.localeCompare(M.fullName)});let P=26,k=0,C=null;for(let d of m)d.groupKey!==C&&(C=d.groupKey,k+=1),k+=1;let $=Math.min(...m.map(d=>d.start.getTime())),I=Math.max(...m.map(d=>d.end.getTime()));if(!isFinite($)||!isFinite(I)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let z=24*60*60*1e3,H=d=>{let M=new Date(d);return M.setHours(0,0,0,0),M.getTime()},R=H($),A=H(I),u=s.querySelector(".prop-charts-title-row");u||(u=s.createDiv({cls:"prop-charts-title-row"}));let y=s.dataset.ganttZoomMode||String((ve=o.zoomMode)!=null?ve:"100");s.dataset.ganttZoomMode=y;let S=s.dataset.ganttLabelMode||String((Se=o.labelMode)!=null?Se:"compact");s.dataset.ganttLabelMode=S;let x=u.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(d=>{let M=x.createEl("button",{cls:"gantt-zoom-btn",text:d.label});d.id===y&&M.addClass("is-active"),M.addEventListener("click",F=>{F.preventDefault(),s.dataset.ganttZoomMode=d.id,ee(s,n,t,e)})}),x.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",d=>{d.preventDefault();let M=s.querySelector(".chart-notes-zoom-button");M&&M.click()});let O=Number(o.labelWidth),Q=!Number.isNaN(O)&&O>120?O:260,_=S==="wide"?Q+160:Q,Y=s.getBoundingClientRect().width||600,Z=Math.max(Y,820),L;if(y==="fit")L=Y;else{let d=Number(y)/100||1;L=Z*d}let{inner:p,svg:f,tooltip:D,details:w}=wt(s,r);p.style.width=L+"px";let N=(d,M,F,X,It,At,bt,_t,ft)=>{if(!d)return;let Et=Math.max(40,X-8),Ft=Math.max(8,Math.floor(Et/6)),Mt=d.split(/\s+/),xt=[],ct="";for(let Rt of Mt){if(!ct){ct=Rt;continue}(ct+" "+Rt).length<=Ft?ct+=" "+Rt:(xt.push(ct),ct=Rt)}ct&&xt.push(ct);let vt=It+2,Qt=xt.length*vt,Kt=F-Qt/2+It;xt.forEach((Rt,Yt)=>{let ot=document.createElementNS(f.namespaceURI,"text");ot.setAttribute("x",String(M)),ot.setAttribute("y",String(Kt+Yt*vt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(It)),ot.setAttribute("fill","#111111"),At&&ot.setAttribute("font-weight",At),ot.textContent=Rt,bt&&ot.addEventListener("mouseenter",rt=>bt(rt)),_t&&ot.addEventListener("mouseleave",()=>_t()),ft&&(ot.style.cursor="pointer",ot.addEventListener("click",rt=>ft(rt))),f.appendChild(ot)})},q=28,B=28,st=10,j=Math.max(300,q+B+k*P+24);f.setAttribute("height",String(j));let K=L-_-st,U=q+6;f.style.color="#111111";let et=A+z-R||1,at=R-et*.02,ht=A+z+et*.08,lt=d=>_+(d-at)/(ht-at)*K,W=(ht-at)/z,Nt=Math.max(4,Math.min(12,Math.floor(K/90)||4)),dt=W/Nt,tt=[1,2,3,5,7,10,14,21,30,60,90,180,365],pt=tt[tt.length-1];for(let d of tt)if(d>=dt){pt=d;break}let Bt=[],Be=H(at);for(let d=Be;d<=ht+.5*z;d+=pt*z)Bt.push(d);let Ht=document.createElementNS(f.namespaceURI,"line");Ht.setAttribute("x1",String(_)),Ht.setAttribute("y1",String(U)),Ht.setAttribute("x2",String(L-st)),Ht.setAttribute("y2",String(U)),Ht.setAttribute("stroke","#111111"),f.appendChild(Ht);for(let d of Bt){let M=lt(d),F=document.createElementNS(f.namespaceURI,"line");F.setAttribute("x1",String(M)),F.setAttribute("y1",String(U)),F.setAttribute("x2",String(M)),F.setAttribute("y2",String(j-B)),F.setAttribute("stroke","#111111"),F.setAttribute("stroke-opacity","0.20"),F.setAttribute("stroke-dasharray","2,4"),f.appendChild(F);let X=document.createElementNS(f.namespaceURI,"text");X.setAttribute("x",String(M)),X.setAttribute("y",String(U-4)),X.setAttribute("text-anchor","middle"),X.setAttribute("font-size","10"),X.setAttribute("fill","#111111"),X.textContent=zt(new Date(d)),f.appendChild(X)}let me=new Date;me.setHours(0,0,0,0);let oe=me.getTime();if(oe>=at&&oe<=ht){let d=lt(oe),M=document.createElementNS(f.namespaceURI,"line");M.setAttribute("x1",String(d)),M.setAttribute("y1",String(U)),M.setAttribute("x2",String(d)),M.setAttribute("y2",String(j-B)),M.setAttribute("stroke","#4caf50"),M.setAttribute("stroke-width","2"),M.setAttribute("stroke-dasharray","4,2"),f.appendChild(M);let F=document.createElementNS(f.namespaceURI,"text");F.setAttribute("x",String(d+4)),F.setAttribute("y",String(U+12)),F.setAttribute("font-size","10"),F.setAttribute("fill","#4caf50"),F.textContent="hoje",f.appendChild(F)}let Ot=p.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Ot.setAttr("title",S==="wide"?"Compactar nomes":"Expandir nomes"),Ot.style.left=`${_}px`,Ot.style.top="4px",Ot.addEventListener("click",d=>{d.preventDefault();let F=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=F,ee(s,n,t,e)});let Ke=["status","priority"],ie=Array.isArray(o.tooltipFields)?o.tooltipFields.map(d=>String(d)):null,Ue=ie&&ie.length?ie:Ke,Wt=0,ae=null;for(let d of m){let M=d.start,F=d.end,X=(F.getTime()-M.getTime())/6e4,It=d.props,At=d.notePath,bt=d.noteTitle,_t=(Ae=(we=d.row.notes)==null?void 0:we.length)!=null?Ae:0,ft=d.due,Et=d.estMinutes,Pt=[];Pt.push(`${zt(M)} \u2192 ${zt(F)}`),typeof Et=="number"&&!Number.isNaN(Et)?Pt.push(`est: ${Math.round(Et)} min`):X>0&&Pt.push(`dura\xE7\xE3o: ${Math.round(X)} min`),ft instanceof Date&&Pt.push(`due: ${zt(ft)}`);for(let nt of Ue){let G=b(It,nt);G!=null&&String(G).trim()!==""&&Pt.push(`${nt}: ${String(G)}`)}let Ft=Pt.join("<br>"),Mt=nt=>{var G;nt.preventDefault(),g&&At?new he(At,n,e==null?void 0:e.refresh,e==null?void 0:e.reindexFile).open():mt(s,w,bt,Et!=null?Et:X,(G=d.row.notes)!=null?G:[],i)},xt=nt=>{bt&&Ft&&gt(s,D,bt,Ft,_t,nt)},ct=()=>yt(D);if(d.groupKey!==ae){ae=d.groupKey;let nt=U+8+Wt*P+P/2,G=a(ae);N(G,4,nt,_-12,11,"600"),Wt+=1}let vt=U+8+Wt*P,Qt=P-10,Kt=lt(M.getTime()),Rt=lt(F.getTime()),Yt=Math.max(4,Rt-Kt),ot=d.fullName,rt=document.createElementNS(f.namespaceURI,"rect");rt.setAttribute("x",String(Kt)),rt.setAttribute("y",String(vt)),rt.setAttribute("width",String(Yt)),rt.setAttribute("height",String(Qt)),rt.setAttribute("rx","3"),rt.setAttribute("ry","3"),rt.setAttribute("fill",it((Ee=d.row.series)!=null?Ee:ot,Wt)),rt.setAttribute("stroke","rgba(0,0,0,0.25)"),rt.setAttribute("stroke-width","0.5"),rt.style.cursor=g&&At?"pointer":"default",rt.addEventListener("mouseenter",xt),rt.addEventListener("mouseleave",ct),rt.addEventListener("click",Mt),f.appendChild(rt);let Ce=vt+Qt/2;if(Yt>=6){let nt=it((De=d.row.series)!=null?De:ot,Wt),G=document.createElementNS(f.namespaceURI,"circle");G.setAttribute("cx",String(Kt)),G.setAttribute("cy",String(Ce)),G.setAttribute("r","3.5"),G.setAttribute("fill","#ffffff"),G.setAttribute("stroke",nt),G.setAttribute("stroke-width","1.5"),f.appendChild(G);let kt=document.createElementNS(f.namespaceURI,"circle");kt.setAttribute("cx",String(Rt)),kt.setAttribute("cy",String(Ce)),kt.setAttribute("r","3.5"),kt.setAttribute("fill","#ffffff"),kt.setAttribute("stroke",nt),kt.setAttribute("stroke-width","1.5"),f.appendChild(kt)}let Pe=vt+Qt/2+2,Xt=c?16:4;if(S==="wide")N(ot,Xt,Pe,_-Xt-4,11,null,xt,ct,Mt);else{let nt=ot,G=Math.max(40,_-Xt-8),Re=Math.max(8,Math.floor(G/6));nt.length>Re&&(nt=nt.slice(0,Re-1)+"\u2026");let St=document.createElementNS(f.namespaceURI,"text");St.setAttribute("x",String(Xt)),St.setAttribute("y",String(Pe)),St.setAttribute("text-anchor","start"),St.setAttribute("font-size","11"),St.setAttribute("fill","#111111"),St.textContent=nt,St.style.cursor="pointer",St.addEventListener("mouseenter",xt),St.addEventListener("mouseleave",ct),St.addEventListener("click",Mt),f.appendChild(St)}if(ft instanceof Date){let nt=lt(ft.getTime()),G=document.createElementNS(f.namespaceURI,"line");G.setAttribute("x1",String(nt)),G.setAttribute("y1",String(vt)),G.setAttribute("x2",String(nt)),G.setAttribute("y2",String(vt+Qt)),G.setAttribute("stroke","#ff6b6b"),G.setAttribute("stroke-width","2"),G.setAttribute("stroke-dasharray","4,2"),f.appendChild(G)}Wt+=1}if(g){let d=s.createDiv({cls:"prop-charts-empty"});d.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function fe(s,n,t){var _,Y,Z,L;let e=(_=n.options)!=null?_:{},o=e.background,r=(Y=e.drilldown)!=null?Y:!0,i=(Z=t.rows)!=null?Z:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:g,svg:a,tooltip:l,details:h}=wt(s,o),c=s.getBoundingClientRect().width||600,E=Math.max(c,480);g.style.width=E+"px";let b=40,v=16,m=18,P=28,k=300;a.setAttribute("height",String(k));let C=E-b-v,$=k-m-P,I=new Map;for(let p of i){let f=String(p.x),D=(L=I.get(f))!=null?L:{label:p.x,rows:[]};D.rows.push(p),I.set(f,D)}let H=Array.from(I.keys()).sort((p,f)=>p<f?-1:p>f?1:0).map(p=>I.get(p)),R=H.length,A=new Set;i.forEach(p=>{p.series!=null&&A.add(String(p.series))});let u=Array.from(A),y=u.length>1,S=y?"grouped":"single",x=0;i.forEach(p=>{p.y>x&&(x=p.y)}),(!isFinite(x)||x<=0)&&(x=1);let T=p=>m+$-p/(x||1)*$,V=T(0),O=4;for(let p=0;p<=O;p++){let f=x*p/O,D=T(f),w=document.createElementNS(a.namespaceURI,"line");w.setAttribute("x1",String(b)),w.setAttribute("y1",String(D)),w.setAttribute("x2",String(E-v)),w.setAttribute("y2",String(D)),w.setAttribute("stroke","#cccccc"),w.setAttribute("stroke-opacity","0.25"),a.appendChild(w);let N=document.createElementNS(a.namespaceURI,"text");N.setAttribute("x",String(b-4)),N.setAttribute("y",String(D+3)),N.setAttribute("text-anchor","end"),N.setAttribute("font-size","10"),N.setAttribute("fill","#111111"),N.textContent=String(Math.round(f)),a.appendChild(N)}let Q=R>0?C/R:C;if(H.forEach((p,f)=>{let D=b+Q*(f+.5),w=String(p.label),N=document.createElementNS(a.namespaceURI,"text");N.setAttribute("x",String(D)),N.setAttribute("y",String(k-P+12)),N.setAttribute("text-anchor","middle"),N.setAttribute("font-size","10"),N.setAttribute("fill","#111111"),N.textContent=w,a.appendChild(N)}),y){let p=s.createDiv({cls:"chart-notes-legend"});u.forEach((f,D)=>{let w=p.createDiv({cls:"chart-notes-legend-item"}),N=w.createDiv();N.style.width="10px",N.style.height="10px",N.style.borderRadius="999px",N.style.backgroundColor=it(f,D),w.createSpan({text:f})})}H.forEach((p,f)=>{let D=b+Q*(f+.5),w=p.rows;if(S==="single"){let j=w[0],K=j.y,U=Q*.6,et=D-U/2,at=T(K),ht=Math.max(2,V-at),lt=it("bar",f),W=document.createElementNS(a.namespaceURI,"rect");W.setAttribute("x",String(et)),W.setAttribute("y",String(at)),W.setAttribute("width",String(U)),W.setAttribute("height",String(ht)),W.setAttribute("fill",lt),W.setAttribute("stroke","rgba(0,0,0,0.25)"),W.setAttribute("stroke-width","0.5"),W.style.cursor="pointer";let J=String(p.label),Nt=`valor: ${Math.round(K*100)/100}`;W.addEventListener("mouseenter",dt=>{var tt,pt;return gt(s,l,J,Nt,(pt=(tt=j.notes)==null?void 0:tt.length)!=null?pt:0,dt)}),W.addEventListener("mouseleave",()=>yt(l)),W.addEventListener("click",dt=>{var tt;dt.preventDefault(),mt(s,h,J,K,(tt=j.notes)!=null?tt:[],r)}),a.appendChild(W);return}let N=u.length,q=Q/Math.max(N+1,2),B=N*q,st=D-B/2;u.forEach((j,K)=>{let U=w.find(tt=>(tt.series!=null?String(tt.series):"")===j);if(!U)return;let et=U.y,at=st+K*q,ht=T(et),lt=Math.max(2,V-ht),W=it(j,K),J=document.createElementNS(a.namespaceURI,"rect");J.setAttribute("x",String(at)),J.setAttribute("y",String(ht)),J.setAttribute("width",String(q)),J.setAttribute("height",String(lt)),J.setAttribute("fill",W),J.setAttribute("stroke","rgba(0,0,0,0.25)"),J.setAttribute("stroke-width","0.5"),J.style.cursor="pointer";let Nt=`${j} @ ${String(p.label)}`,dt=`valor: ${Math.round(et*100)/100}`;J.addEventListener("mouseenter",tt=>{var pt,Bt;return gt(s,l,Nt,dt,(Bt=(pt=U.notes)==null?void 0:pt.length)!=null?Bt:0,tt)}),J.addEventListener("mouseleave",()=>yt(l)),J.addEventListener("click",tt=>{var pt;tt.preventDefault(),mt(s,h,Nt,et,(pt=U.notes)!=null?pt:[],r)}),a.appendChild(J)})})}function We(s,n,t){var Q,_,Y,Z;let e=(Q=n.options)!=null?Q:{},o=e.background,r=(_=e.drilldown)!=null?_:!0,i=(Y=t.rows)!=null?Y:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:g,svg:a,tooltip:l,details:h}=wt(s,o),c=s.getBoundingClientRect().width||600,E=Math.max(c,480);g.style.width=E+"px";let b=40,v=16,m=18,P=28,k=300;a.setAttribute("height",String(k));let C=E-b-v,$=k-m-P,I=new Map;for(let L of i){let p=String(L.x),f=(Z=I.get(p))!=null?Z:{label:L.x,rows:[]};f.rows.push(L),I.set(p,f)}let H=Array.from(I.keys()).sort((L,p)=>L<p?-1:L>p?1:0).map(L=>I.get(L)),R=H.length,A=new Set;i.forEach(L=>{L.series!=null&&A.add(String(L.series))});let u=Array.from(A);if(!u.length){fe(s,n,t);return}let y=0;H.forEach(L=>{let p=L.rows.reduce((f,D)=>f+D.y,0);p>y&&(y=p)}),(!isFinite(y)||y<=0)&&(y=1);let S=L=>m+$-L/(y||1)*$,x=S(0),T=4;for(let L=0;L<=T;L++){let p=y*L/T,f=S(p),D=document.createElementNS(a.namespaceURI,"line");D.setAttribute("x1",String(b)),D.setAttribute("y1",String(f)),D.setAttribute("x2",String(E-v)),D.setAttribute("y2",String(f)),D.setAttribute("stroke","#cccccc"),D.setAttribute("stroke-opacity","0.25"),a.appendChild(D);let w=document.createElementNS(a.namespaceURI,"text");w.setAttribute("x",String(b-4)),w.setAttribute("y",String(f+3)),w.setAttribute("text-anchor","end"),w.setAttribute("font-size","10"),w.setAttribute("fill","#111111"),w.textContent=String(Math.round(p)),a.appendChild(w)}let V=R>0?C/R:C;H.forEach((L,p)=>{let f=b+V*(p+.5),D=String(L.label),w=document.createElementNS(a.namespaceURI,"text");w.setAttribute("x",String(f)),w.setAttribute("y",String(k-P+12)),w.setAttribute("text-anchor","middle"),w.setAttribute("font-size","10"),w.setAttribute("fill","#111111"),w.textContent=D,a.appendChild(w)});let O=s.createDiv({cls:"chart-notes-legend"});u.forEach((L,p)=>{let f=O.createDiv({cls:"chart-notes-legend-item"}),D=f.createDiv();D.style.width="10px",D.style.height="10px",D.style.borderRadius="999px",D.style.backgroundColor=it(L,p),f.createSpan({text:L})}),H.forEach((L,p)=>{let f=b+V*(p+.5),D=V*.6,w=f-D/2,N=0;u.forEach((q,B)=>{let st=L.rows.find(dt=>(dt.series!=null?String(dt.series):"")===q);if(!st)return;let j=st.y,K=N,U=N+j;N=U;let et=S(K),at=S(U),ht=Math.max(2,et-at),lt=it(q,B),W=document.createElementNS(a.namespaceURI,"rect");W.setAttribute("x",String(w)),W.setAttribute("y",String(at)),W.setAttribute("width",String(D)),W.setAttribute("height",String(ht)),W.setAttribute("fill",lt),W.setAttribute("stroke","rgba(0,0,0,0.25)"),W.setAttribute("stroke-width","0.5"),W.style.cursor="pointer";let J=`${q} @ ${String(L.label)}`,Nt=`valor: ${Math.round(j*100)/100}`;W.addEventListener("mouseenter",dt=>{var tt,pt;return gt(s,l,J,Nt,(pt=(tt=st.notes)==null?void 0:tt.length)!=null?pt:0,dt)}),W.addEventListener("mouseleave",()=>yt(l)),W.addEventListener("click",dt=>{var tt;dt.preventDefault(),mt(s,h,J,j,(tt=st.notes)!=null?tt:[],r)}),a.appendChild(W)})})}function ge(s,n,t,e){var _,Y,Z,L;let o=(_=n.options)!=null?_:{},r=o.background,i=(Y=o.drilldown)!=null?Y:!0,g=(Z=t.rows)!=null?Z:[];if(!g.length){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:a,svg:l,tooltip:h,details:c}=wt(s,r),E=s.getBoundingClientRect().width||600,b=Math.max(E,480);a.style.width=b+"px";let v=40,m=16,P=18,k=24,C=300;l.setAttribute("height",String(C));let $=b-v-m,I=C-P-k,z=new Map;for(let p of g){let f=p.series!=null?String(p.series):"__default__",D=(L=z.get(f))!=null?L:[];D.push(p),z.set(f,D)}let H=Array.from(z.keys()),R=[],A=new Set;for(let p of g){let f=String(p.x);A.has(f)||(A.add(f),R.push(p.x))}let u=R.length||1,y=p=>{let f=String(p),D=R.findIndex(w=>String(w)===f);return D<0?v:u===1?v+$/2:v+D/(u-1)*$},S=p=>String(p),x=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY;for(let p of g)p.y<x&&(x=p.y),p.y>T&&(T=p.y);(!isFinite(x)||!isFinite(T))&&(x=0,T=1),x===T&&(x===0?T=1:x=0);let V=p=>P+I-(p-x)/(T-x||1)*I,O=4;for(let p=0;p<=O;p++){let f=x+(T-x)*p/O,D=V(f),w=document.createElementNS(l.namespaceURI,"line");w.setAttribute("x1",String(v)),w.setAttribute("y1",String(D)),w.setAttribute("x2",String(b-m)),w.setAttribute("y2",String(D)),w.setAttribute("stroke","#cccccc"),w.setAttribute("stroke-opacity","0.25"),l.appendChild(w);let N=document.createElementNS(l.namespaceURI,"text");N.setAttribute("x",String(v-4)),N.setAttribute("y",String(D+3)),N.setAttribute("text-anchor","end"),N.setAttribute("font-size","10"),N.setAttribute("fill","#111111"),N.textContent=Math.abs(f)>=100?String(Math.round(f)):String(Math.round(f*10)/10),l.appendChild(N)}let Q=H.filter(p=>p!=="__default__");if(Q.length>1){let p=s.createDiv({cls:"chart-notes-legend"});Q.forEach((f,D)=>{let w=f,N=p.createDiv({cls:"chart-notes-legend-item"}),q=N.createDiv();q.style.width="10px",q.style.height="10px",q.style.borderRadius="999px",q.style.backgroundColor=it(w,D),N.createSpan({text:w})})}H.forEach((p,f)=>{let D=z.get(p);if(!(D!=null&&D.length))return;let w=p==="__default__"?it("line",f):it(p,f),N=[...D].sort((B,st)=>{let j=R.findIndex(U=>String(U)===String(B.x)),K=R.findIndex(U=>String(U)===String(st.x));return j-K}),q="";if(N.forEach((B,st)=>{let j=y(B.x),K=V(B.y);q+=(st===0?"M ":" L ")+j+" "+K}),e){let B=N[0],st=N[N.length-1],j=y(B.x),K=y(st.x),U=V(x);q+=` L ${K} ${U} L ${j} ${U} Z`;let et=document.createElementNS(l.namespaceURI,"path");et.setAttribute("d",q),et.setAttribute("fill",w),et.setAttribute("fill-opacity","0.18"),et.setAttribute("stroke",w),et.setAttribute("stroke-width","1.5"),l.appendChild(et)}else{let B=document.createElementNS(l.namespaceURI,"path");B.setAttribute("d",q),B.setAttribute("fill","none"),B.setAttribute("stroke",w),B.setAttribute("stroke-width","2"),l.appendChild(B)}N.forEach(B=>{let st=y(B.x),j=V(B.y),K=document.createElementNS(l.namespaceURI,"circle");K.setAttribute("cx",String(st)),K.setAttribute("cy",String(j)),K.setAttribute("r","3"),K.setAttribute("fill","#ffffff"),K.setAttribute("stroke",w),K.setAttribute("stroke-width","1.5"),K.style.cursor="pointer";let U=S(B.x),et=p==="__default__"?"":String(B.series),at=et?`${et} @ ${U}`:U,ht=`valor: ${Math.round(B.y*100)/100}`;K.addEventListener("mouseenter",lt=>{var W,J;return gt(s,h,at,ht,(J=(W=B.notes)==null?void 0:W.length)!=null?J:0,lt)}),K.addEventListener("mouseleave",()=>yt(h)),K.addEventListener("click",lt=>{var W;lt.preventDefault(),mt(s,c,at,B.y,(W=B.notes)!=null?W:[],i)}),l.appendChild(K)})})}function Qe(s,n,t){var $;let{background:e,drilldown:o=!0}=($=n.options)!=null?$:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=He(e)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:g,svg:a,tooltip:l,details:h}=wt(s,e),c=Math.max(i,420);g.style.width=c+"px",r&&(a.style.color=r);let E=300,b=c/2,v=(E-28+28)/2,m=Math.min(c/2-20,E/2-20),k=t.rows.map(I=>Math.max(0,I.y)).reduce((I,z)=>I+z,0)||1,C=-Math.PI/2;t.rows.forEach((I,z)=>{var Q;let H=I.x instanceof Date?I.x.toISOString().slice(0,10):String(I.x),R=I.y,A=R/k*Math.PI*2,u=b+m*Math.cos(C),y=v+m*Math.sin(C),S=b+m*Math.cos(C+A),x=v+m*Math.sin(C+A),T=A>Math.PI?1:0,V=document.createElementNS(a.namespaceURI,"path"),O=[`M ${b} ${v}`,`L ${u} ${y}`,`A ${m} ${m} 0 ${T} 1 ${S} ${x}`,"Z"].join(" ");V.setAttribute("d",O),V.setAttribute("fill",it((Q=I.series)!=null?Q:H,z)),V.style.cursor="pointer",V.addEventListener("mouseenter",_=>{var Y,Z;return gt(s,l,H,R,(Z=(Y=I.notes)==null?void 0:Y.length)!=null?Z:0,_)}),V.addEventListener("mouseleave",()=>yt(l)),V.addEventListener("click",()=>{var _;return mt(s,h,H,R,(_=I.notes)!=null?_:[],o)}),a.appendChild(V),C+=A})}function ze(s,n,t){var y;let{background:e,drilldown:o=!0}=(y=n.options)!=null?y:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=e?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:g,svg:a,tooltip:l,details:h}=wt(s,e),c=Math.max(i,700);g.style.width=c+"px",r&&(a.style.color=r);let E=300,b=c-48-10,v=E-28-28,m=t.rows.map(S=>{let x=S.x;if(x instanceof Date)return x.getTime();if(typeof x=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(x)){let V=new Date(x);if(!isNaN(V.getTime()))return V.getTime()}let T=Number(x);return isNaN(T)?null:T}return typeof x=="number"?x:null}),P=t.rows.map(S=>S.y),k=m.filter(S=>S!==null);if(k.length===0){s.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let C=Math.min(...k),$=Math.max(...k),I=Math.min(...P),z=Math.max(...P),H=S=>48+(S-C)/($-C||1)*b,R=S=>E-28-(S-I)/(z-I||1)*v,A=document.createElementNS(a.namespaceURI,"line");A.setAttribute("x1",String(48)),A.setAttribute("y1",String(28)),A.setAttribute("x2",String(48)),A.setAttribute("y2",String(E-28)),A.setAttribute("stroke","currentColor"),a.appendChild(A);let u=document.createElementNS(a.namespaceURI,"line");u.setAttribute("x1",String(48)),u.setAttribute("y1",String(E-28)),u.setAttribute("x2",String(c-10)),u.setAttribute("y2",String(E-28)),u.setAttribute("stroke","currentColor"),a.appendChild(u),t.rows.forEach((S,x)=>{let T=m[x];if(T==null)return;let V=H(T),O=R(P[x]),Q=document.createElementNS(a.namespaceURI,"circle");Q.setAttribute("cx",String(V)),Q.setAttribute("cy",String(O)),Q.setAttribute("r","4"),Q.setAttribute("fill",it(S.series,x)),Q.style.cursor="pointer";let _=S.x instanceof Date?S.x.toISOString().slice(0,10):typeof S.x=="string"?S.x:String(S.x);Q.addEventListener("mouseenter",Y=>{var Z,L;return gt(s,l,_,S.y,(L=(Z=S.notes)==null?void 0:Z.length)!=null?L:0,Y)}),Q.addEventListener("mouseleave",()=>yt(l)),Q.addEventListener("click",Y=>{var Z;Y.preventDefault(),mt(s,h,_,S.y,(Z=S.notes)!=null?Z:[],o)}),a.appendChild(Q)})}var Ve=require("obsidian"),re=class{render(n,t,e,o,r=!1){var l;let{title:i}=(l=t.options)!=null?l:{};n.empty(),n.addClass("prop-charts-container");let a=n.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(a.textContent=i),t.type){case"bar":fe(n,t,e);break;case"stacked-bar":We(n,t,e);break;case"line":ge(n,t,e,!1);break;case"area":ge(n,t,e,!0);break;case"pie":Qe(n,t,e);break;case"scatter":ze(n,t,e);break;case"gantt":ee(n,t,e,o);break;default:n.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+t.type})}if(!r){let h=n.createEl("button",{cls:"chart-notes-zoom-button"});h.setAttr("type","button"),h.setAttr("aria-label","Expandir gr\xE1fico"),h.textContent="\u2922",h.addEventListener("click",c=>{c.preventDefault(),new ye(t,e,this,o).open()})}}},ye=class extends Ve.Modal{constructor(t,e,o,r){super(app);this.size="large";this.spec=t,this.data=e,this.renderer=o,this.ctx=r}onOpen(){var a;let{contentEl:t}=this;t.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),t.addClass("chart-notes-zoom-modal"),this.applySize();let e=t.createDiv({cls:"chart-notes-zoom-header"}),o=(a=this.spec.options)!=null&&a.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";e.createEl("div",{text:o,cls:"chart-notes-zoom-title"});let r=e.createDiv({cls:"chart-notes-zoom-sizes"}),i=(l,h)=>{let c=r.createEl("button",{cls:"chart-notes-zoom-size-btn",text:l});(()=>{c.toggleClass("is-active",this.size===h)})(),c.addEventListener("click",b=>{b.preventDefault(),this.size=h,this.applySize(),r.querySelectorAll(".chart-notes-zoom-size-btn").forEach(m=>m.classList.remove("is-active")),c.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let g=t.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(g,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let t=this.modalEl;if(!t)return;let e="95vw",o="85vh";switch(this.size){case"small":e="60vw",o="55vh";break;case"medium":e="80vw",o="70vh";break;case"large":default:e="95vw",o="85vh";break}t.style.maxWidth=e,t.style.width=e,t.style.height=o,t.style.maxHeight=o}};var se=class extends Lt.Plugin{constructor(t,e){super(t,e)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new jt(this.app),await this.indexer.buildIndex(),this.query=new te(()=>this.indexer.getAll(),[]),this.renderer=new re,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Lt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Lt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Lt.TFile&&this.indexer.removeFile(t)})),this.registerMarkdownCodeBlockProcessor("chart",async(t,e,o)=>{var h;let r;try{let c=(0,Lt.parseYaml)(t);if(!c||typeof c!="object"){e.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}r=c}catch(c){e.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+c.message});return}if(!r.type){e.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=r.type==="gantt",g=r.type==="table";if(!i&&!g){if(!r.encoding||!r.encoding.x){e.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let E=((h=r.aggregate)==null?void 0:h.y)==="count";if(!r.encoding.y&&!E){e.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}r.encoding||(r.encoding={}),r.source||(r.source={});let l;try{l=this.query.run(r)}catch(c){e.createEl("div",{text:"Chart Notes: erro na query: "+c.message});return}this.renderer.render(e,r,l)}),this.registerBasesView(ue,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,e)=>new qt(t,e,this.renderer)})}onunload(){console.log("unloading Chart Notes plugin")}};
