/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var be=Object.defineProperty;var pn=Object.getOwnPropertyDescriptor;var mn=Object.getOwnPropertyNames;var fn=Object.prototype.hasOwnProperty;var hn=(s,e)=>{for(var t in e)be(s,t,{get:e[t],enumerable:!0})},gn=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of mn(e))!fn.call(s,r)&&r!==t&&be(s,r,{get:()=>e[r],enumerable:!(n=pn(e,r))||n.enumerable});return s};var yn=s=>gn(be({},"__esModule",{value:!0}),s);var Wn={};hn(Wn,{default:()=>ye});module.exports=yn(Wn);var Zt=require("obsidian");var le=require("obsidian"),Se="chartnotes-view",bn=["bar","stacked-bar","line","stacked-area","pie","scatter","gantt"],Sn=["sum","count","cumulative-sum"],xn=["auto","none","day","week","month","quarter","year"],ae="(missing)",An="__no_series__",wn=60,$e=6e4;function vn(s){let e=String(s!=null?s:"bar").trim().toLowerCase();return bn.includes(e)?e:"bar"}function Dn(s){let e=String(s!=null?s:"sum").trim().toLowerCase();return Sn.includes(e)?e:"sum"}function En(s){let e=String(s!=null?s:"auto").trim().toLowerCase();return xn.includes(e)?e:"auto"}var ce=class extends le.BasesView{constructor(t,n,r){super(t);this.type=Se;this.renderer=r,this.rootEl=n.createDiv("chartnotes-bases-view")}onDataUpdated(){var L,W,B;this.rootEl.empty();let t=this.data,n=(L=t==null?void 0:t.groupedData)!=null?L:[];if(!n.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let r=this.config,o=vn((W=r==null?void 0:r.get("chartType"))!=null?W:"bar"),i=o==="pie",l=o==="scatter",a=o==="gantt",c=Dn(r==null?void 0:r.get("aggregateMode")),m=c==="cumulative-sum"&&!(o==="line"||o==="stacked-area")?"sum":c,S=En(r==null?void 0:r.get("xBucket")),p=i||l||a?"none":S,f=this.getPropFromConfig("xProperty"),x=this.getPropFromConfig("ganttLabelProperty"),y=this.getPropFromConfig("yProperty"),N=this.getPropFromConfig("seriesProperty");i&&(N={id:null,name:null});let A=this.getPropFromConfig("startProperty"),v=this.getPropFromConfig("endProperty"),T=this.getPropFromConfig("dueProperty"),V=this.getPropFromConfig("durationProperty"),H=this.getPropFromConfig("groupProperty");if(!a&&!f.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / category' property in view options."});return}if(l&&(!f.id||!y.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(a&&!(A.id||v.id||T.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt needs Start/End or Due with Duration."});return}let D=a&&x.id?x:a?f:{id:null,name:null},E;if(a)E=this.buildRowsForGantt(n,D,N,A,v,T,V,H);else if(l)E=this.buildRowsForScatter(n,f,y,N);else{let P=i;E=this.buildRowsForAggregatedCharts(n,f,y,N,m,p,P)}if(!E.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let g={rows:E},h=((B=r==null?void 0:r.get("title"))!=null?B:"").trim()||(r==null?void 0:r.name)||"Chart Notes (Bases)",M=r==null?void 0:r.get("drilldown"),R=typeof M=="boolean"?M:!0,I=this.buildEncoding({x:f,y,series:N,start:A,end:v,due:T,duration:V,group:H,label:D,aggMode:m,xBucket:p,chartType:o}),F={type:o,source:{type:"properties",query:""},encoding:I,options:{title:h,drilldown:R}},_={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,F,g,_)}getPropFromConfig(t){var l,a;let n=this.config,r=(l=n==null?void 0:n.get)==null?void 0:l.call(n,t);if(!r)return{id:null,name:null};let o=r.trim();if(!o||o==="undefined"||o==="null")return{id:null,name:null};let i=o;try{let c=(0,le.parsePropertyId)(i);return{id:i,name:(a=c.name)!=null?a:i}}catch(c){return{id:i,name:i}}}readValue(t,n){if(!n.id)return null;let r;try{r=t.getValue(n.id)}catch(o){return null}if(!r)return null;try{if(typeof r.isEmpty=="function"&&r.isEmpty())return null}catch(o){}try{let o=r.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let n=new Date(t.trim());return Number.isNaN(n.getTime())?null:n}compareX(t,n){let r=this.parseDate(t!=null?String(t):null),o=this.parseDate(n!=null?String(n):null);if(r&&o)return r.getTime()-o.getTime();let i=Number(t),l=Number(n);return!Number.isNaN(i)&&!Number.isNaN(l)?i-l:String(t!=null?t:"").localeCompare(String(n!=null?n:""))}fmtDate(t){let n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${n}-${r}-${o}`}startOfWeek(t){let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=(n.getDay()+6)%7;return n.setDate(n.getDate()-r),n.setHours(0,0,0,0),n}bucketX(t,n){let r=this.parseDate(t);if(!r)return t;switch(n){case"none":return t;case"auto":case"day":return this.fmtDate(new Date(r.getFullYear(),r.getMonth(),r.getDate()));case"week":{let o=this.startOfWeek(r);return`${this.fmtDate(o)} (W)`}case"month":{let o=String(r.getMonth()+1).padStart(2,"0");return`${r.getFullYear()}-${o}`}case"quarter":{let o=Math.floor(r.getMonth()/3)+1;return`${r.getFullYear()}-Q${o}`}case"year":return`${r.getFullYear()}`;default:return t}}getXValuesForEntry(t,n,r,o){var d,m;let i=[],l=S=>this.bucketX(S,r);if(!n.id){let S=t.file,p=S!=null&&S.name?String(S.name):String((d=S==null?void 0:S.path)!=null?d:ae);return i.push(l(p)),i}if(!o){let S=(m=this.readValue(t,n))!=null?m:ae;return i.push(l(S)),i}let a=null;try{a=t.getValue(n.id)}catch(S){a=null}let c=S=>{if(!S)return;let p=String(S).trim();p&&i.push(l(p))};if(a==null)c(ae);else if(typeof a=="string"){let S=a.trim();if(S){let p=S.split(/\s+/);for(let f of p)c(f)}}else if(Array.isArray(a))for(let S of a){if(S==null)continue;let p;try{p=S.toString()}catch(f){continue}c(p)}else if(typeof a.toArray=="function"){let S=a.toArray();if(Array.isArray(S))for(let p of S){if(p==null)continue;let f;try{f=p.toString()}catch(x){continue}c(f)}else{let p;try{p=a.toString()}catch(f){p=""}c(p)}}else{let S;try{S=a.toString()}catch(p){S=""}c(S)}return i.length||c(ae),i}buildRowsForAggregatedCharts(t,n,r,o,i,l,a){let c=new Map,d=a||i==="count"||!r.id&&i!=="sum",m=r.name||"y";for(let p of t)for(let f of p.entries){let x=f.file,y=this.getXValuesForEntry(f,n,l,a),N=1,A=null;if(!d&&r.id){if(A=this.readValue(f,r),A==null)continue;let V=Number(A);if(Number.isNaN(V))continue;N=V}else N=1;let v=this.readValue(f,o),T=v!=null?String(v):void 0;for(let V of y){let H=`${V}@@${T!=null?T:""}`,D=c.get(H);D||(D={x:V,y:0,series:T,notes:[],props:{}},c.set(H,D)),D.y+=N,x!=null&&x.path&&D.notes.push(x.path),D.props&&n.name&&(D.props[n.name]=V),!d&&D.props&&m&&A!=null&&(D.props[m]=D.y),d&&D.props&&(D.props[m]=D.y),D.props&&o.name&&v!=null&&(D.props[o.name]=v)}}let S=Array.from(c.values());return i==="cumulative-sum"?this.toCumulative(S):S}toCumulative(t){var o,i;let n=new Map;for(let l of t){let a=(o=l.series)!=null?o:An,c=n.get(a);c||(c=[],n.set(a,c)),c.push(l)}let r=[];for(let[,l]of n){let a=[...l].sort((d,m)=>this.compareX(d.x,m.x)),c=0;for(let d of a){let m=Number((i=d.y)!=null?i:0);Number.isNaN(m)||(c+=m,r.push({...d,y:c}))}}return r.sort((l,a)=>this.compareX(l.x,a.x)),r}buildRowsForScatter(t,n,r,o){let i=[];for(let l of t)for(let a of l.entries){let c=a.file,d=this.readValue(a,n),m=this.readValue(a,r);if(d==null||m==null)continue;let S=Number(d),p=Number(m);if(Number.isNaN(S)||Number.isNaN(p))continue;let f=this.readValue(a,o),x=f!=null?String(f):void 0;i.push({x:S,y:p,series:x,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,n,r,o,i,l,a,c){var x;let d=[],m=wn*$e,S=y=>{let N=[y==null?void 0:y.label,y==null?void 0:y.name,y==null?void 0:y.value,y==null?void 0:y.key,y==null?void 0:y.group,y==null?void 0:y.groupLabel];for(let A of N)if(A!=null&&String(A).trim()!=="")return String(A);return""},p=n;try{let y=this.getPropFromConfig("ganttLabelProperty");y&&y.id&&(p=y)}catch(y){}let f=!!c.id;for(let y of t){let N=S(y);for(let A of(x=y.entries)!=null?x:[]){let v=A.file,T=this.readValue(A,o),V=this.readValue(A,i),H=this.readValue(A,l),D=this.readValue(A,a),E=D!=null?Number(D):NaN,g=Number.isFinite(E)&&E>0,w=g?E*$e:m,h=this.parseDate(T),M=this.parseDate(V),R=this.parseDate(H),I=h,F=M;if(I&&!F&&(F=new Date(I.getTime()+w)),!I&&F&&(I=new Date(F.getTime()-w)),!I&&!F&&R&&(g?(F=R,I=new Date(R.getTime()-w)):(I=R,F=new Date(R.getTime()+m))),!I||!F)continue;if(I.getTime()>F.getTime()){let Q=I;I=F,F=Q}let _=this.readValue(A,p);(_==null||String(_).trim()==="")&&(v!=null&&v.name?_=String(v.name).replace(/\.md$/i,""):v!=null&&v.path?_=String(v.path):_="(no title)");let L=this.readValue(A,r),W=L!=null?String(L):void 0,B={};if(N&&(B.__basesGroup=N),f){let Q=this.readValue(A,c);Q!=null&&c.name&&(B[c.name]=Q)}p.name&&(B[p.name]=_),B.label=_,o.name&&T!=null&&(B[o.name]=T),i.name&&V!=null&&(B[i.name]=V),l.name&&H!=null&&(B[l.name]=H),g&&a.name&&(B[a.name]=E);let P=v==null?void 0:v.path;d.push({x:_,y:0,series:W,start:I,end:F,due:R!=null?R:void 0,notes:P?[P]:[],props:B})}}return d.sort((y,N)=>!y.start||!N.start?0:y.start.getTime()-N.start.getTime()),d}buildEncoding(t){var l,a,c,d,m,S,p,f,x,y,N;let n=(l=t.x.name)!=null?l:"x",r=(a=t.y.name)!=null?a:"y",o=(m=(d=(c=t.label.name)!=null?c:t.x.name)!=null?d:t.group.name)!=null?m:"label",i=t.chartType==="gantt"?"__basesGroup":(S=t.group.name)!=null?S:"group";return{x:n,y:r,series:(p=t.series.name)!=null?p:"series",start:(f=t.start.name)!=null?f:"start",end:(x=t.end.name)!=null?x:"end",due:(y=t.due.name)!=null?y:"due",duration:(N=t.duration.name)!=null?N:"duration",group:i,label:o}}};var Ve=require("obsidian"),ue=class{constructor(e){this.index=new Map;this.app=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(e){if(e.extension!=="md")return;let t={};try{let r=(await this.app.vault.read(e)).match(/^---\n([\s\S]*?)\n---\n?/);if(r){let i=(0,Ve.parseYaml)(r[1])||{};if(i&&typeof i=="object")for(let[l,a]of Object.entries(i))l!=="position"&&(t[l]=a)}let o=this.app.metadataCache.getFileCache(e);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",e.path,n)}this.index.set(e.path,{path:e.path,props:t})}removeFile(e){this.index.delete(e.path)}};function Be(s,e){if(!e||e.length===0)return!0;for(let t of e){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function Ke(s,e){if(!e||e.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let r of e)if(t.includes(r)||t.includes("#"+r))return!0;return!1}let n=String(t);for(let r of e)if(n===r||n==="#"+r)return!0;return!1}function pe(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function Qt(s){if(s instanceof Date&&!isNaN(s.getTime()))return s;if(typeof s!="string")return null;let e=s.trim(),t=e.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(t){let r=Number(t[1]),o=Number(t[2])-1,i=Number(t[3]),l=t[4]?Number(t[4]):0,a=t[5]?Number(t[5]):0,c=t[6]?Number(t[6]):0;return Number.isNaN(r)||Number.isNaN(o)||Number.isNaN(i)||Number.isNaN(l)||Number.isNaN(a)||Number.isNaN(c)?null:new Date(r,o,i,l,a,c,0)}let n=new Date(e);return isNaN(n.getTime())?null:n}function mt(s){let e=new Date(s);return e.setHours(0,0,0,0),e}function de(s,e){let t=new Date(s);return t.setDate(t.getDate()-e),t}function Nn(s,e){return de(s,e*7)}function Tn(s,e){let t=new Date(s);return t.setMonth(t.getMonth()-e),t}function Ae(s,e){let t=new Date(s);return t.setDate(t.getDate()+e),t}function Rn(s,e){return Ae(s,e*7)}function kn(s,e){let t=new Date(s);return t.setMonth(t.getMonth()+e),t}function Ge(s){let e=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(e)||e.endsWith("date")||e.endsWith("at")||e.endsWith("on"))}function He(s,e){let t=e?new Date(e):new Date,n=mt(t),r=s.trim().toLowerCase();if(r==="today")return n;if(r==="yesterday")return mt(de(n,1));if(/^-\d+$/.test(r)){let o=parseInt(r.slice(1),10);return mt(de(n,o))}if(/^-\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(de(n,o))}if(/^-\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Nn(n,o))}if(/^-\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Tn(n,o))}if(/^\+\d+$/.test(r)){let o=parseInt(r.slice(1),10);return mt(Ae(n,o))}if(/^\+\d+d$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Ae(n,o))}if(/^\+\d+w$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(Rn(n,o))}if(/^\+\d+m$/.test(r)){let o=parseInt(r.slice(1,-1),10);return mt(kn(n,o))}return null}function Qe(s){let e=s.trim(),t=e.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let d=t[1].trim(),m=t[2].trim(),S=t[3].trim(),p=Ge(d),f=xe(m,p),x=xe(S,p),y=f.valueType==="date"||x.valueType==="date"?"date":f.valueType;return{field:d,op:"between",value:f.value,value2:x.value,valueType:y}}let n=/(==|!=|>=|<=|>|<)/,r=e.split(n);if(r.length!==3)throw new Error(`Invalid WHERE expression: ${s}`);let o=r[0].trim(),i=r[1].trim(),l=r[2].trim(),a=Ge(o),c=xe(l,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function xe(s,e){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),r=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(e){if(t==="0"||n==="today")return{value:mt(new Date),valueType:"date"};let i=He(t);if(i)return{value:i,valueType:"date"}}else if(r){let i=He(t);if(i)return{value:i,valueType:"date"}}if(pe(t)){let i=Qt(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Ye(s,e){let t=s[e.field];if(t==null)return!1;if(e.valueType==="date"){let o=t instanceof Date?mt(t):pe(t)?mt(Qt(t)):null;if(!o)return!1;let i=e.value instanceof Date?e.value:null,l=e.value2 instanceof Date?e.value2:null;if(!i)return!1;let a=o.getTime(),c=mt(i).getTime();switch(e.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!l)return!1;let d=mt(l).getTime();return a>=c&&a<=d}}if(e.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(e.value);switch(e.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof e.value2!="number"?!1:o>=i&&o<=e.value2}}let n=String(t),r=String(e.value);switch(e.op){case"==":return n===r;case"!=":return n!==r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r;case"between":return!1}return!1}var Oe="__no_series__",Cn="||",Mn=6e4;function Ln(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(pe(s)){let e=Qt(s);if(e)return{key:e,isDate:!0}}return{key:s,isDate:!1}}function Pn(s,e){let t=s.x,n=e.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let r=String(t),o=String(n);return r<o?-1:r>o?1:0}function In(s,e){var o,i;let t=Pn(s,e);if(t!==0)return t;let n=(o=s.series)!=null?o:"",r=(i=e.series)!=null?i:"";return n<r?-1:n>r?1:0}function _n(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let e=s.trim().match(/^(\d+)/);if(e){let t=Number(e[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`Invalid aggregate.rolling: ${String(s)}`)}function Fn(s){var n,r;let e=new Map,t=[];for(let o of s){let i=(n=o.series)!=null?n:Oe,a=((r=e.get(i))!=null?r:0)+o.y;e.set(i,a),t.push({...o,y:a})}return t}function $n(s,e){var i,l;let t=_n(e);if(!t||t<=1)return[...s];let n=new Map,r=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:Oe,d=n.get(c);d||(d=[],n.set(c,d));let m=(l=r.get(c))!=null?l:0;if(d.push(a.y),m+=a.y,d.length>t){let f=d.shift();m-=f}r.set(c,m);let S=d.length||1,p=m/S;o.push({...a,y:p})}return o}var me=class{constructor(e,t){this.getIndex=e,this.defaultPaths=t}run(e){var i,l,a;let t=this.getIndex(),n=(i=e.source)!=null&&i.paths&&e.source.paths.length?e.source.paths:this.defaultPaths,r=(l=e.source)!=null&&l.tags&&e.source.tags.length?e.source.tags:[],o=[];for(let c of t){let d=n&&n.length?Be(c.path,n):!0,m=r&&r.length?Ke(c.props,r):!0;if(!d||!m)continue;let S=!0;if((a=e.source)!=null&&a.where&&e.source.where.length>0)for(let p of e.source.where){let f;try{f=Qe(p)}catch(x){throw new Error(`Invalid condition: ${p} (${x.message})`)}if(!Ye(c.props,f)){S=!1;break}}S&&o.push(c)}return e.type==="gantt"?this.runGantt(e,o):e.type==="table"?this.runTable(e,o):this.runStandard(e,o)}runTable(e,t){var r,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(r=e.encoding)==null?void 0:r.x,yField:(o=e.encoding)==null?void 0:o.y}}runGantt(e,t){var m,S,p;let n=(m=e.encoding)!=null?m:{},r=n.start,o=n.end,i=(S=n.label)!=null?S:n.x,l=n.series,a=n.duration,c=n.due,d=[];for(let f of t){let x=(p=f.props)!=null?p:{},y=D=>Array.isArray(D)?D[0]:D,N=null;if(o){let D=y(x[o]),E=Qt(D);E&&(N=E)}if(!N)continue;let A=null;if(r){let D=y(x[r]),E=Qt(D);E&&(A=E)}if(!A&&a){let D=y(x[a]),E=Number(D);Number.isNaN(E)||(A=new Date(N.getTime()-E*Mn))}A||(A=new Date(N.getTime()));let v;if(c){let D=y(x[c]),E=Qt(D);E&&(v=E)}let T;if(i){let D=y(x[i]);(D==null||D==="")&&(D=f.path),T=D}else T=f.path;let V;if(l){let D=y(x[l]);D!=null&&(V=String(D))}let H={x:T,y:0,notes:[f.path],series:V,start:A,end:N,props:x};v&&(H.due=v),d.push(H)}return d.sort((f,x)=>{let y=f.start?f.start.getTime():0,N=x.start?x.start.getTime():0;return y-N}),{rows:d,xField:i,yField:o}}runStandard(e,t){var f,x,y,N,A,v,T,V,H,D;let n=(f=e.encoding)==null?void 0:f.x,r=(x=e.encoding)==null?void 0:x.y,o=(y=e.encoding)==null?void 0:y.series;if(!n)throw new Error("encoding.x is required.");let i=(N=e.aggregate)!=null?N:{},l=(A=i.y)!=null?A:null,a=!!i.cumulative,c=i.rolling;if(!r&&l!=="count")throw new Error("encoding.y is required (except when aggregate.y = 'count').");let d=[];for(let E of t){let g=(v=E.props)!=null?v:{},w=L=>Array.isArray(L)?L[0]:L,h=w(g[n]);if(h==null)continue;let M=Ln(h),R=M.key,I=M.isDate,F;if(o){let L=w(g[o]);L!=null&&String(L).trim()!==""&&(F=String(L))}let _;if(l==="count")_=1;else{let L=w(g[r]);if(L==null)continue;let W=Number(L);if(Number.isNaN(W))continue;_=W}d.push({x:R,y:_,notes:[E.path],series:F,props:g,_isDate:I,_origX:h})}if(d.length===0)return{rows:[],xField:n,yField:r};let m=[];if(l){let E=new Map;for(let g of d){let w=(T=g.series)!=null?T:"",h=g.x instanceof Date?g.x.toISOString().slice(0,10):String(g.x),M=w+Cn+h,R=(V=E.get(M))!=null?V:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:g.x,isDate:g._isDate,series:g.series,props:g.props};R.sum+=g.y,R.count+=1,g.y<R.min&&(R.min=g.y),g.y>R.max&&(R.max=g.y),R.notes.push(...g.notes),R.props=(H=g.props)!=null?H:R.props,E.set(M,R)}for(let[,g]of E){let w=g.sum;switch(l){case"sum":w=g.sum;break;case"avg":w=g.sum/g.count;break;case"min":w=g.min;break;case"max":w=g.max;break;case"count":w=g.count;break}m.push({x:g.xRep,y:w,notes:g.notes,series:g.series,props:g.props})}}else m=d.map(E=>({x:E.x,y:E.y,notes:E.notes,series:E.series,props:E.props}));if(m.length===0)return{rows:[],xField:n,yField:r};let S=((D=e.sort)==null?void 0:D.x)==="desc"?"desc":"asc";if(m.sort((E,g)=>{let w=In(E,g);return S==="asc"?w:-w}),(a||c)&&!(e.type==="line"||e.type==="stacked-area"))throw new Error("aggregate.cumulative / aggregate.rolling are only supported for type: 'line' or 'stacked-area'.");if(a&&c)throw new Error("It is not yet possible to use 'cumulative' and 'rolling' together in the same chart.");let p=m;return c?p=$n(m,c):a&&(p=Fn(m)),{rows:p,xField:n,yField:r}}};var Rt=require("obsidian");var Ue=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ut(s,e){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,r)=>n*33+r.charCodeAt(0)>>>0,0);return Ue[t%Ue.length]}function xt(s,e){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,e&&(n.style.background=e);let r="http://www.w3.org/2000/svg",o=document.createElementNS(r,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let l=s.createDiv({cls:"chart-notes-details"});return l.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:l}}function gt(s,e,t,n,r,o){let i=s.getBoundingClientRect(),l=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);e.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${l}</div>
    <div class="chart-notes-tooltip-notes">${r} nota${r===1?"":"s"}</div>
  `,e.style.display="block";let a=e.getBoundingClientRect(),c=o.clientX-i.left+6,d=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),d+a.height>i.height-4&&(d=i.height-a.height-4),d<4&&(d=4),e.style.left=c+"px",e.style.top=d+"px"}function yt(s){s.style.display="none"}function bt(s,e,t,n,r,o){if(!o)return;if(e.empty(),!r||r.length===0){e.style.display="none";return}e.style.display="block";let i=e.createEl("div",{cls:"chart-notes-details-header"}),l=i.createEl("div",{cls:"chart-notes-details-title"});l.textContent=`Notas em "${t}" (${r.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{e.style.display="none"});let c=e.createEl("ul",{cls:"chart-notes-details-list"});for(let d of r){let S=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:d});S.href="#",S.addEventListener("click",p=>{p.preventDefault(),app.workspace.openLinkText(d,"",!1)})}}function $t(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let e=s.getUTCDate().toString().padStart(2,"0"),t=(s.getUTCMonth()+1).toString().padStart(2,"0");return`${e}/${t}`}function We(s){if(!s)return!1;let e=s.trim().toLowerCase();if(e==="#fff"||e==="#ffffff"||e==="white")return!0;if(!e.startsWith("#"))return!1;let t,n,r;if(e.length===4)t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),r=parseInt(e[3]+e[3],16);else if(e.length===7)t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*r)/255>.7}var we=class extends Rt.Modal{constructor(t,n,r,o){var l;super(app);this.notePath=t,this.spec=n,this.refresh=r,this.reindexFile=o;let i=(l=n.encoding)!=null?l:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var D,E;let{contentEl:t}=this;t.empty(),this.titleEl.setText("Edit task");let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Rt.TFile)){t.createEl("p",{text:"File not found: "+this.notePath});return}this.titleEl.setText(`Edit task \u2013 ${n.basename}`);let r=await this.app.vault.read(n),o={},i=r,l=r.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);if(l){try{o=(D=(0,Rt.parseYaml)(l[1]))!=null?D:{}}catch(g){o={}}i=(E=l[2])!=null?E:""}let a=t.createDiv({cls:"gantt-edit-form"}),c=g=>{let w=a.createDiv({cls:"gantt-edit-row"}),h=w.createDiv({cls:"gantt-edit-label"});h.textContent=g;let M=w.createDiv({cls:"gantt-edit-field"});return{row:w,field:M}},d=g=>{if(!g)return null;if(g instanceof Date&&!isNaN(g.getTime()))return g;let h=String(g).trim().match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!h)return null;let M=Number(h[1]),R=Number(h[2])-1,I=Number(h[3]),F=h[4]?Number(h[4]):0,_=h[5]?Number(h[5]):0,L=h[6]?Number(h[6]):0;return Number.isNaN(M)||Number.isNaN(R)||Number.isNaN(I)||Number.isNaN(F)||Number.isNaN(_)||Number.isNaN(L)?null:new Date(M,R,I,F,_,L,0)},m=g=>{let w=d(g);if(!w)return"";let h=L=>L.toString().padStart(2,"0"),M=w.getFullYear(),R=h(w.getMonth()+1),I=h(w.getDate()),F=h(w.getHours()),_=h(w.getMinutes());return`${M}-${R}-${I}T${F}:${_}`},S=g=>{if(g=g.trim(),!g)return;let w=g.match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2}))?$/);if(!w)return;let h=`${w[1]}-${w[2]}-${w[3]}`;if(w[4]){let M=w[4],R=w[5];return`${h}T${M}:${R}`}return h},p=null,f=null,x=null,y=null;if(this.startKey){let{field:g}=c(`In\xEDcio (${this.startKey})`);p=g.createEl("input"),p.type="datetime-local",p.value=m(o[this.startKey])}if(this.endKey){let{field:g}=c(`Fim (${this.endKey})`);f=g.createEl("input"),f.type="datetime-local",f.value=m(o[this.endKey])}if(this.durationKey){let{field:g}=c(`Dura\xE7\xE3o (min) (${this.durationKey})`);x=g.createEl("input"),x.type="number";let w=o[this.durationKey];x.value=typeof w=="number"&&!Number.isNaN(w)?String(w):""}if(this.dueKey){let{field:g}=c(`Due (${this.dueKey})`);y=g.createEl("input"),y.type="datetime-local",y.value=m(o[this.dueKey])}let N=a.createDiv({cls:"gantt-edit-actions-row"});N.style.marginTop="0.75rem",N.style.display="flex",N.style.justifyContent="space-between",N.style.alignItems="center";let A=N.createDiv({cls:"gantt-edit-actions-left"});A.style.display="flex";let v=N.createDiv({cls:"gantt-edit-actions-right"});v.style.display="flex",v.style.gap="0.5rem";let T=A.createEl("button",{text:"Open note"}),V=v.createEl("button",{text:"Save"}),H=v.createEl("button",{text:"Cancel"});T.addEventListener("click",()=>{this.app.workspace.openLinkText(this.notePath,"",!1),this.close()}),H.addEventListener("click",()=>this.close()),V.addEventListener("click",async()=>{if(this.startKey&&p){let h=S(p.value);h?o[this.startKey]=h:delete o[this.startKey]}if(this.endKey&&f){let h=S(f.value);h?o[this.endKey]=h:delete o[this.endKey]}if(this.durationKey&&x){let h=x.value.trim();if(h==="")delete o[this.durationKey];else{let M=Number(h);Number.isNaN(M)||(o[this.durationKey]=M)}}if(this.dueKey&&y){let h=S(y.value);h?o[this.dueKey]=h:delete o[this.dueKey]}let w=`---
${(0,Rt.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,w),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(h){}if(this.refresh)try{this.refresh()}catch(h){}new Rt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function fe(s,e,t,n){var Ne,Te,Re,ke,Ce,Me,Le,Pe;let r=(Ne=e.options)!=null?Ne:{},o=r.background,i=(Te=r.drilldown)!=null?Te:!0,l=!0,a=b=>{if(b==null)return"";let G=String(b).trim();if(!G)return"";let Y=G.match(/^\[\[(.+?)\]\]$/);Y&&(G=Y[1]);let j=G.lastIndexOf("/");return j>=0&&j<G.length-1&&(G=G.slice(j+1)),G};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(b=>b.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let c=t.rows.filter(b=>b.start&&b.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: missing date fields."});return}let d=e.encoding,m=d.group,S=d.duration,p=(b,G)=>{if(!b||!G)return;let Y=b[G];return Array.isArray(Y)?Y[0]:Y},f="__chartnotes_no_group__",y=c.map(b=>{var pt,vt;let G=b.start,Y=b.end,j=b.props,Kt=typeof b.x=="string"?b.x:b.x instanceof Date?$t(G):String(b.x),Lt=a(Kt),Tt=m!=null&&m!==""?p(j,m):void 0,Pt=Tt!=null&&String(Tt).trim().length>0?String(Tt):f,ht=(pt=b.notes)==null?void 0:pt[0],It=ht?(vt=ht.replace(/\.md$/i,"").split("/").pop())!=null?vt:ht:Lt,Wt=b.due,Gt,wt=p(j,S);if(wt!=null){let _t=Number(wt);Number.isNaN(_t)||(Gt=_t)}return{row:b,start:G,end:Y,props:j,fullName:Lt,groupKey:Pt,notePath:ht,noteTitle:It,due:Wt,estMinutes:Gt}}).filter(b=>b.start instanceof Date&&!isNaN(b.start.getTime())&&b.end instanceof Date&&!isNaN(b.end.getTime()));if(y.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid dates."});return}y.sort((b,G)=>{if(b.groupKey<G.groupKey)return-1;if(b.groupKey>G.groupKey)return 1;let Y=b.start.getTime(),j=G.start.getTime();return Y!==j?Y-j:b.fullName.localeCompare(G.fullName)});let N=26,A=0,v=null;for(let b of y)b.groupKey!==v&&(v=b.groupKey,b.groupKey!==f&&(A+=1)),A+=1;let T=Math.min(...y.map(b=>b.start.getTime())),V=Math.max(...y.map(b=>b.end.getTime()));if(!isFinite(T)||!isFinite(V)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid date range."});return}let H=24*60*60*1e3,D=b=>{let G=new Date(b);return G.setHours(0,0,0,0),G.getTime()},E=D(T),g=D(V),w=s.querySelector(".prop-charts-title-row");w||(w=s.createDiv({cls:"prop-charts-title-row"}));let h=s.dataset.ganttZoomMode||String((Re=r.zoomMode)!=null?Re:"100");s.dataset.ganttZoomMode=h;let M=s.dataset.ganttLabelMode||String((ke=r.labelMode)!=null?ke:"compact");s.dataset.ganttLabelMode=M;let R=w.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(b=>{let G=R.createEl("button",{cls:"gantt-zoom-btn",text:b.label});b.id===h&&G.addClass("is-active"),G.addEventListener("click",Y=>{Y.preventDefault(),s.dataset.ganttZoomMode=b.id,fe(s,e,t,n)})});let F=Number(r.labelWidth),_=!Number.isNaN(F)&&F>120?F:260,L=M==="wide"?_+160:_,W=s.getBoundingClientRect().width||600,B=Math.max(W,820),P;if(h==="fit")P=W;else{let b=Number(h)/100||1;P=B*b}let{inner:Q,svg:u,tooltip:k,details:C}=xt(s,o);Q.style.width=P+"px";let K=(b,G,Y,j,Kt,Lt,Tt,te,Pt)=>{if(!b)return;let ht=Math.max(40,j-8),Wt=Math.max(8,Math.floor(ht/6)),Gt=b.split(/\s+/),wt=[],pt="";for(let Ft of Gt){if(!pt){pt=Ft;continue}(pt+" "+Ft).length<=Wt?pt+=" "+Ft:(wt.push(pt),pt=Ft)}pt&&wt.push(pt);let vt=Kt+2,_t=wt.length*vt,ee=Y-_t/2+Kt;wt.forEach((Ft,oe)=>{let dt=document.createElementNS(u.namespaceURI,"text");dt.setAttribute("x",String(G)),dt.setAttribute("y",String(ee+oe*vt)),dt.setAttribute("text-anchor","start"),dt.setAttribute("font-size",String(Kt)),dt.setAttribute("fill","#111111"),Lt&&dt.setAttribute("font-weight",Lt),dt.textContent=Ft,Tt&&dt.addEventListener("mouseenter",lt=>Tt(lt)),te&&dt.addEventListener("mouseleave",()=>te()),Pt&&(dt.style.cursor="pointer",dt.addEventListener("click",lt=>Pt(lt))),u.appendChild(dt)})},$=28,tt=28,X=10,rt=Math.max(300,$+tt+A*N+24);u.setAttribute("height",String(rt));let O=P-L-X,q=$+6;u.style.color="#111111";let ot=g+H-E||1,et=E-ot*.02,it=g+H+ot*.08,at=b=>L+(b-et)/(it-et)*O,Z=(it-et)/H,U=Math.max(4,Math.min(12,Math.floor(O/90)||4)),ft=Z/U,ct=[1,2,3,5,7,10,14,21,30,60,90,180,365],nt=ct[ct.length-1];for(let b of ct)if(b>=ft){nt=b;break}let St=[],At=D(et);for(let b=At;b<=it+.5*H;b+=nt*H)St.push(b);let Mt=document.createElementNS(u.namespaceURI,"line");Mt.setAttribute("x1",String(L)),Mt.setAttribute("y1",String(q)),Mt.setAttribute("x2",String(P-X)),Mt.setAttribute("y2",String(q)),Mt.setAttribute("stroke","#111111"),u.appendChild(Mt);for(let b of St){let G=at(b),Y=document.createElementNS(u.namespaceURI,"line");Y.setAttribute("x1",String(G)),Y.setAttribute("y1",String(q)),Y.setAttribute("x2",String(G)),Y.setAttribute("y2",String(rt-tt)),Y.setAttribute("stroke","#111111"),Y.setAttribute("stroke-opacity","0.20"),Y.setAttribute("stroke-dasharray","2,4"),u.appendChild(Y);let j=document.createElementNS(u.namespaceURI,"text");j.setAttribute("x",String(G)),j.setAttribute("y",String(q-4)),j.setAttribute("text-anchor","middle"),j.setAttribute("font-size","10"),j.setAttribute("fill","#111111"),j.textContent=$t(new Date(b)),u.appendChild(j)}let Jt=new Date;Jt.setHours(0,0,0,0);let Yt=Jt.getTime();if(Yt>=et&&Yt<=it){let b=at(Yt),G=document.createElementNS(u.namespaceURI,"line");G.setAttribute("x1",String(b)),G.setAttribute("y1",String(q)),G.setAttribute("x2",String(b)),G.setAttribute("y2",String(rt-tt)),G.setAttribute("stroke","#4caf50"),G.setAttribute("stroke-width","2"),G.setAttribute("stroke-dasharray","4,2"),u.appendChild(G);let Y=document.createElementNS(u.namespaceURI,"text");Y.setAttribute("x",String(b+4)),Y.setAttribute("y",String(q+12)),Y.setAttribute("font-size","10"),Y.setAttribute("fill","#4caf50"),Y.textContent="today",u.appendChild(Y)}let Nt=Q.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Nt.setAttr("title",M==="wide"?"Compact names":"Expand names"),Nt.style.left=`${L}px`,Nt.style.top="4px",Nt.addEventListener("click",b=>{b.preventDefault();let Y=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=Y,fe(s,e,t,n)});let Bt=["status","priority"],Ot=Array.isArray(r.tooltipFields)?r.tooltipFields.map(b=>String(b)):null,dn=Ot&&Ot.length?Ot:Bt,Ut=0,se=null;for(let b of y){let G=b.start,Y=b.end,j=(Y.getTime()-G.getTime())/6e4,Kt=b.props,Lt=b.notePath,Tt=b.noteTitle,te=(Me=(Ce=b.row.notes)==null?void 0:Ce.length)!=null?Me:0,Pt=b.due,ht=b.estMinutes,It=[];It.push(`${$t(G)} \u2192 ${$t(Y)}`),typeof ht=="number"&&!Number.isNaN(ht)?It.push(`est: ${Math.round(ht)} min`):j>0&&It.push(`dura\xE7\xE3o: ${Math.round(j)} min`),Pt instanceof Date&&It.push(`due: ${$t(Pt)}`);for(let st of dn){let z=p(Kt,st);z!=null&&String(z).trim()!==""&&It.push(`${st}: ${String(z)}`)}let Wt=It.join("<br>"),Gt=st=>{var z;st.preventDefault(),l&&Lt?new we(Lt,e,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():bt(s,C,Tt,ht!=null?ht:j,(z=b.row.notes)!=null?z:[],i)},wt=st=>{Tt&&Wt&&gt(s,k,Tt,Wt,te,st)},pt=()=>yt(k);if(b.groupKey!==se&&(se=b.groupKey,se!==f)){let st=q+8+Ut*N+N/2,z=a(se);K(z,4,st,L-12,11,"600"),Ut+=1}let vt=q+8+Ut*N,_t=N-10,ee=at(G.getTime()),Ft=at(Y.getTime()),oe=Math.max(4,Ft-ee),dt=b.fullName,lt=document.createElementNS(u.namespaceURI,"rect");lt.setAttribute("x",String(ee)),lt.setAttribute("y",String(vt)),lt.setAttribute("width",String(oe)),lt.setAttribute("height",String(_t)),lt.setAttribute("rx","3"),lt.setAttribute("ry","3"),lt.setAttribute("fill",ut((Le=b.row.series)!=null?Le:dt,Ut)),lt.setAttribute("stroke","rgba(0,0,0,0.25)"),lt.setAttribute("stroke-width","0.5"),lt.style.cursor=l&&Lt?"pointer":"default",lt.addEventListener("mouseenter",wt),lt.addEventListener("mouseleave",pt),lt.addEventListener("click",Gt),u.appendChild(lt);let Ie=vt+_t/2;if(oe>=6){let st=ut((Pe=b.row.series)!=null?Pe:dt,Ut),z=document.createElementNS(u.namespaceURI,"circle");z.setAttribute("cx",String(ee)),z.setAttribute("cy",String(Ie)),z.setAttribute("r","3.5"),z.setAttribute("fill","#ffffff"),z.setAttribute("stroke",st),z.setAttribute("stroke-width","1.5"),u.appendChild(z);let Ht=document.createElementNS(u.namespaceURI,"circle");Ht.setAttribute("cx",String(Ft)),Ht.setAttribute("cy",String(Ie)),Ht.setAttribute("r","3.5"),Ht.setAttribute("fill","#ffffff"),Ht.setAttribute("stroke",st),Ht.setAttribute("stroke-width","1.5"),u.appendChild(Ht)}let _e=vt+_t/2+2,ie=4;if(M==="wide")K(dt,ie,_e,L-ie-4,11,null,wt,pt,Gt);else{let st=dt,z=Math.max(40,L-ie-8),Fe=Math.max(8,Math.floor(z/6));st.length>Fe&&(st=st.slice(0,Fe-1)+"\u2026");let Dt=document.createElementNS(u.namespaceURI,"text");Dt.setAttribute("x",String(ie)),Dt.setAttribute("y",String(_e)),Dt.setAttribute("text-anchor","start"),Dt.setAttribute("font-size","11"),Dt.setAttribute("fill","#111111"),Dt.textContent=st,Dt.style.cursor="pointer",Dt.addEventListener("mouseenter",wt),Dt.addEventListener("mouseleave",pt),Dt.addEventListener("click",Gt),u.appendChild(Dt)}if(Pt instanceof Date){let st=at(Pt.getTime()),z=document.createElementNS(u.namespaceURI,"line");z.setAttribute("x1",String(st)),z.setAttribute("y1",String(vt)),z.setAttribute("x2",String(st)),z.setAttribute("y2",String(vt+_t)),z.setAttribute("stroke","#ff6b6b"),z.setAttribute("stroke-width","2"),z.setAttribute("stroke-dasharray","4,2"),u.appendChild(z)}Ut+=1}if(l){let b=s.createDiv({cls:"prop-charts-empty"});b.textContent="Click on a bar or name to adjust dates and task estimate."}}function ve(s,e,t){var W,B,P,Q;let n=(W=e.options)!=null?W:{},r=n.background,o=(B=n.drilldown)!=null?B:!0,i=(P=t.rows)!=null?P:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let{inner:l,svg:a,tooltip:c,details:d}=xt(s,r),m=s.getBoundingClientRect().width||600,S=Math.max(m,480);l.style.width=S+"px";let p=40,f=16,x=18,y=28,N=300;a.setAttribute("height",String(N));let A=S-p-f,v=N-x-y,T=new Map;for(let u of i){let k=String(u.x),C=(Q=T.get(k))!=null?Q:{label:u.x,rows:[]};C.rows.push(u),T.set(k,C)}let H=Array.from(T.keys()).sort((u,k)=>u<k?-1:u>k?1:0).map(u=>T.get(u)),D=H.length,E=u=>String(u!=null?u:""),g=new Set;i.forEach(u=>{u.series!=null&&g.add(E(u.series))});let w=Array.from(g),h=w.length>1,M=h?"grouped":"single",R=0;i.forEach(u=>{u.y>R&&(R=u.y)}),(!isFinite(R)||R<=0)&&(R=1);let I=u=>x+v-u/(R||1)*v,F=I(0),_=4;for(let u=0;u<=_;u++){let k=R*u/_,C=I(k),K=document.createElementNS(a.namespaceURI,"line");K.setAttribute("x1",String(p)),K.setAttribute("y1",String(C)),K.setAttribute("x2",String(S-f)),K.setAttribute("y2",String(C)),K.setAttribute("stroke","#cccccc"),K.setAttribute("stroke-opacity","0.25"),a.appendChild(K);let $=document.createElementNS(a.namespaceURI,"text");$.setAttribute("x",String(p-4)),$.setAttribute("y",String(C+3)),$.setAttribute("text-anchor","end"),$.setAttribute("font-size","10"),$.setAttribute("fill","#111111"),$.textContent=String(Math.round(k)),a.appendChild($)}let L=D>0?A/D:A;if(H.forEach((u,k)=>{let C=p+L*(k+.5),K=String(u.label),$=document.createElementNS(a.namespaceURI,"text");$.setAttribute("x",String(C)),$.setAttribute("y",String(N-y+12)),$.setAttribute("text-anchor","middle"),$.setAttribute("font-size","10"),$.setAttribute("fill","#111111"),$.textContent=K,a.appendChild($)}),h){let u=s.createDiv({cls:"chart-notes-legend"});w.forEach((k,C)=>{let K=u.createDiv({cls:"chart-notes-legend-item"}),$=K.createDiv();$.style.width="10px",$.style.height="10px",$.style.borderRadius="999px",$.style.backgroundColor=ut(k,C),K.createSpan({text:k})})}H.forEach((u,k)=>{let C=p+L*(k+.5),K=u.rows;if(M==="single"){let O=K[0],q=O.y,ot=L*.6,et=C-ot/2,it=I(q),at=Math.max(2,F-it),Z=ut("bar",k),J=document.createElementNS(a.namespaceURI,"rect");J.setAttribute("x",String(et)),J.setAttribute("y",String(it)),J.setAttribute("width",String(ot)),J.setAttribute("height",String(at)),J.setAttribute("fill",Z),J.setAttribute("stroke","rgba(0,0,0,0.25)"),J.setAttribute("stroke-width","0.5"),J.style.cursor="pointer";let U=String(u.label),ft=`valor: ${Math.round(q*100)/100}`;J.addEventListener("mouseenter",ct=>{var nt,St;return gt(s,c,U,ft,(St=(nt=O.notes)==null?void 0:nt.length)!=null?St:0,ct)}),J.addEventListener("mouseleave",()=>yt(c)),J.addEventListener("click",ct=>{var nt;ct.preventDefault(),bt(s,d,U,q,(nt=O.notes)!=null?nt:[],o)}),a.appendChild(J);return}let $=w.length,tt=L/Math.max($+1,2),X=$*tt,rt=C-X/2;w.forEach((O,q)=>{let ot=K.find(nt=>nt.series!=null&&E(nt.series)===O);if(!ot)return;let et=ot.y,it=rt+q*tt,at=I(et),Z=Math.max(2,F-at),J=ut(O,q),U=document.createElementNS(a.namespaceURI,"rect");U.setAttribute("x",String(it)),U.setAttribute("y",String(at)),U.setAttribute("width",String(tt)),U.setAttribute("height",String(Z)),U.setAttribute("fill",J),U.setAttribute("stroke","rgba(0,0,0,0.25)"),U.setAttribute("stroke-width","0.5"),U.style.cursor="pointer";let ft=`${O} @ ${String(u.label)}`,ct=`valor: ${Math.round(et*100)/100}`;U.addEventListener("mouseenter",nt=>{var St,At;return gt(s,c,ft,ct,(At=(St=ot.notes)==null?void 0:St.length)!=null?At:0,nt)}),U.addEventListener("mouseleave",()=>yt(c)),U.addEventListener("click",nt=>{var St;nt.preventDefault(),bt(s,d,ft,et,(St=ot.notes)!=null?St:[],o)}),a.appendChild(U)})})}function Xe(s,e,t){var _,L,W,B;let n=(_=e.options)!=null?_:{},r=n.background,o=(L=n.drilldown)!=null?L:!0,i=(W=t.rows)!=null?W:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let l=new Map;for(let P of i){let Q=String(P.x),u=(B=l.get(Q))!=null?B:{label:P.x,rows:[]};u.rows.push(P),l.set(Q,u)}let c=Array.from(l.keys()).sort((P,Q)=>P<Q?-1:P>Q?1:0).map(P=>l.get(P)),d=c.length,m=P=>String(P!=null?P:""),S=new Set(i.map(P=>m(P.series))),p=Array.from(S);if(p.length===1&&p[0]===""){ve(s,e,t);return}let{inner:f,svg:x,tooltip:y,details:N}=xt(s,r),A=s.getBoundingClientRect().width||600,v=Math.max(A,480);f.style.width=v+"px",x.setAttribute("width",String(v));let T=40,V=16,H=18,D=28,E=300;x.setAttribute("height",String(E));let g=v-T-V,w=E-H-D,h=0;c.forEach(P=>{let Q=P.rows.reduce((u,k)=>u+(k.y||0),0);Q>h&&(h=Q)}),(!isFinite(h)||h<=0)&&(h=1);let M=P=>H+w-P/(h||1)*w,R=4;for(let P=0;P<=R;P++){let Q=h*P/R,u=M(Q),k=document.createElementNS(x.namespaceURI,"line");k.setAttribute("x1",String(T)),k.setAttribute("y1",String(u)),k.setAttribute("x2",String(v-V)),k.setAttribute("y2",String(u)),k.setAttribute("stroke","#cccccc"),k.setAttribute("stroke-opacity","0.25"),x.appendChild(k);let C=document.createElementNS(x.namespaceURI,"text");C.setAttribute("x",String(T-4)),C.setAttribute("y",String(u+3)),C.setAttribute("text-anchor","end"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=String(Math.round(Q)),x.appendChild(C)}let I=d>0?g/d:g;c.forEach((P,Q)=>{let u=T+I*(Q+.5),k=String(P.label),C=document.createElementNS(x.namespaceURI,"text");C.setAttribute("x",String(u)),C.setAttribute("y",String(E-D+12)),C.setAttribute("text-anchor","middle"),C.setAttribute("font-size","10"),C.setAttribute("fill","#111111"),C.textContent=k,x.appendChild(C)});let F=f.createDiv({cls:"chart-notes-legend"});p.forEach((P,Q)=>{if(P==="")return;let u=F.createDiv({cls:"chart-notes-legend-item"}),k=u.createDiv();k.style.width="10px",k.style.height="10px",k.style.borderRadius="999px",k.style.backgroundColor=ut(P,Q),u.createSpan({text:P})}),c.forEach((P,Q)=>{let u=T+I*(Q+.5),k=I*.6,C=u-k/2,K=0;p.forEach(($,tt)=>{if($==="")return;let X=P.rows.find(ft=>m(ft.series)===$);if(!X)return;let rt=X.y||0,O=K,q=K+rt;K=q;let ot=M(O),et=M(q),it=Math.max(2,ot-et),at=ut($,tt),Z=document.createElementNS(x.namespaceURI,"rect");Z.setAttribute("x",String(C)),Z.setAttribute("y",String(et)),Z.setAttribute("width",String(k)),Z.setAttribute("height",String(it)),Z.setAttribute("fill",at),Z.setAttribute("stroke","rgba(0,0,0,0.25)"),Z.setAttribute("stroke-width","0.5"),Z.style.cursor="pointer";let J=`${$} @ ${String(P.label)}`,U=`valor: ${Math.round(rt*100)/100}`;Z.addEventListener("mouseenter",ft=>{var ct,nt;return gt(s,y,J,U,(nt=(ct=X.notes)==null?void 0:ct.length)!=null?nt:0,ft)}),Z.addEventListener("mouseleave",()=>yt(y)),Z.addEventListener("click",ft=>{var ct;ft.preventDefault(),bt(s,N,J,rt,(ct=X.notes)!=null?ct:[],o)}),x.appendChild(Z)})})}var kt=40,zt=16,qt=18,je=28,Vn=.6,Gn=2,ne="__default__";var De=[1,2,3,5,7,10,14,21,30,60,90,180,365],Hn=90,ze=3,Bn=10,jt=.02,qe=4,Kn=100,Ze="No data available.";function Ct(s){if(!s)return null;if(s instanceof Date){let e=s.getTime();return Number.isNaN(e)?null:s}if(typeof s=="string"){let e=s.trim();if(!e||/^\d+$/.test(e))return null;let t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return null}function Je(s){var t;let e=new Map;for(let n of s){let r=n.series!=null&&n.series!==""?String(n.series):ne,o=(t=e.get(r))!=null?t:[];o.push(n),e.set(r,o)}return e}function tn(s){let e=s.map(t=>Ct(t.x)).filter(t=>!!t);return e.length>=Gn&&e.length>=s.length*Vn}function en(s,e,t){let o=s.map(p=>Ct(p.x)).filter(p=>!!p).map(p=>p.getTime()).sort((p,f)=>p-f),i=o[0],l=o[o.length-1];i===l&&(i-=864e5,l+=864e5);let a=l-i||864e5,c=i-a*jt,d=l+a*jt;return{xScale:p=>{let f=Ct(p);if(!f)return t;let x=f.getTime();return t+(x-c)/(d-c||1)*e},xLabelOf:p=>{let f=Ct(p);return f?$t(f):String(p)}}}function nn(s,e,t){let n=[],r=new Set;for(let a of s){let c=String(a.x);r.has(c)||(r.add(c),n.push(a.x))}let o=n.length||1;return{xScale:a=>{let c=String(a),d=n.findIndex(m=>String(m)===c);return d<0?t:o===1?t+e/2:t+d/(o-1)*e},xLabelOf:a=>String(a)}}function rn(s,e,t,n,r,o,i,l,a){let d=i+r,m=document.createElementNS(s.namespaceURI,"line");m.setAttribute("x1",String(o)),m.setAttribute("y1",String(d)),m.setAttribute("x2",String(a-l)),m.setAttribute("y2",String(d)),m.setAttribute("stroke","#111111"),m.setAttribute("stroke-width","1"),s.appendChild(m);let S=(t-e)/864e5,p=Math.max(ze,Math.min(Bn,Math.floor(n/Hn)||ze)),f=S/p,x=De[De.length-1];for(let A of De)if(A>=f){x=A;break}let N=(A=>{let v=new Date(A);return v.setHours(0,0,0,0),v.getTime()})(e);for(let A=N;A<=t+.5*864e5;A+=x*864e5){let v=o+(A-e)/(t-e)*n,T=document.createElementNS(s.namespaceURI,"line");T.setAttribute("x1",String(v)),T.setAttribute("y1",String(i)),T.setAttribute("x2",String(v)),T.setAttribute("y2",String(d)),T.setAttribute("stroke","#111111"),T.setAttribute("stroke-opacity","0.18"),T.setAttribute("stroke-dasharray","2,4"),s.appendChild(T);let V=document.createElementNS(s.namespaceURI,"text");V.setAttribute("x",String(v)),V.setAttribute("y",String(d+12)),V.setAttribute("text-anchor","middle"),V.setAttribute("font-size","10"),V.setAttribute("fill","#111111"),V.textContent=$t(new Date(A)),s.appendChild(V)}}function Qn(s){let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(let n of s)n.y<e&&(e=n.y),n.y>t&&(t=n.y);return!isFinite(e)||!isFinite(t)?{min:0,max:1}:e===t?e===0?{min:0,max:1}:{min:0,max:t}:{min:e,max:t}}function sn(s,e,t,n){return r=>n+t-(r-s)/(e-s||1)*t}function on(s,e,t,n,r,o,i){for(let l=0;l<=qe;l++){let a=e+(t-e)*l/qe,c=n(a),d=document.createElementNS(s.namespaceURI,"line");d.setAttribute("x1",String(o)),d.setAttribute("y1",String(c)),d.setAttribute("x2",String(r+o+i)),d.setAttribute("y2",String(c)),d.setAttribute("stroke","#cccccc"),d.setAttribute("stroke-opacity","0.25"),s.appendChild(d);let m=document.createElementNS(s.namespaceURI,"text");m.setAttribute("x",String(o-4)),m.setAttribute("y",String(c+3)),m.setAttribute("text-anchor","end"),m.setAttribute("font-size","10"),m.setAttribute("fill","#111111"),m.textContent=Math.abs(a)>=Kn?String(Math.round(a)):String(Math.round(a*10)/10),s.appendChild(m)}}function an(s,e,t=!0){let n=t?e.filter(o=>o!==ne):e;if(n.length<=1)return;let r=s.createDiv({cls:"chart-notes-legend"});n.forEach((o,i)=>{let l=r.createDiv({cls:"chart-notes-legend-item"}),a=l.createDiv();a.style.width="10px",a.style.height="10px",a.style.borderRadius="999px",a.style.backgroundColor=ut(o,i),l.createSpan({text:o})})}function Yn(s,e){let t=[...s];return e&&t.sort((n,r)=>{let o=Ct(n.x),i=Ct(r.x),l=o?o.getTime():0,a=i?i.getTime():0;return l-a}),t}function On(s,e,t,n,r){let o="";if(s.forEach((i,l)=>{let a=e(i.x),c=t(i.y);o+=l===0?`M ${a} ${c}`:` L ${a} ${c}`}),n&&s.length>0){let i=s[0],l=s[s.length-1],a=e(i.x),c=e(l.x),d=t(r);o+=` L ${c} ${d} L ${a} ${d} Z`}return o}function Un(s,e,t,n,r,o,i,l,a,c,d){e.forEach(m=>{let S=t(m.x),p=n(m.y),f=document.createElementNS(s.namespaceURI,"circle");f.setAttribute("cx",String(S)),f.setAttribute("cy",String(p)),f.setAttribute("r","3"),f.setAttribute("fill","#ffffff"),f.setAttribute("stroke",o),f.setAttribute("stroke-width","1.5"),f.style.cursor="pointer";let x=r(m.x),y=i?`${i} @ ${x}`:x,N=`value: ${Math.round(m.y*100)/100}`;f.addEventListener("mouseenter",A=>{var v,T;return gt(l,a,y,N,(T=(v=m.notes)==null?void 0:v.length)!=null?T:0,A)}),f.addEventListener("mouseleave",()=>yt(a)),f.addEventListener("click",A=>{var v;A.preventDefault(),bt(l,c,y,m.y,(v=m.notes)!=null?v:[],d)}),s.appendChild(f)})}function Ee(s,e,t,n){var w,h,M;let r=(w=e.options)!=null?w:{},o=r.background,i=(h=r.drilldown)!=null?h:!0,l=(M=t.rows)!=null?M:[];if(!l.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let{inner:a,svg:c,tooltip:d,details:m}=xt(s,o),S=s.getBoundingClientRect().width||600,p=Math.max(S,480);a.style.width=p+"px";let f=300;c.setAttribute("height",String(f));let x=p-kt-zt,y=f-qt-je,N=tn(l),A=Je(l),v=Array.from(A.keys()),T=N?en(l,x,kt):nn(l,x,kt),{xScale:V,xLabelOf:H}=T;if(N){let I=l.map(Q=>Ct(Q.x)).filter(Q=>!!Q).map(Q=>Q.getTime()).sort((Q,u)=>Q-u),F=I[0],_=I[I.length-1],L=24*60*60*1e3;F===_&&(F-=L,_+=L);let W=_-F||L,B=F-W*jt,P=_+W*jt;rn(c,B,P,x,y,kt,qt,zt,p)}let{min:D,max:E}=Qn(l),g=sn(D,E,y,qt);on(c,D,E,g,x,kt,zt),an(s,v),v.forEach((R,I)=>{let F=A.get(R);if(!(F!=null&&F.length))return;let _=R===ne?ut("line",I):ut(R,I),L=Yn(F,N),W=On(L,V,g,n,D),B=document.createElementNS(c.namespaceURI,"path");B.setAttribute("d",W),B.setAttribute("fill",n?_:"none"),B.setAttribute("fill-opacity",n?"0.18":"0"),B.setAttribute("stroke",_),B.setAttribute("stroke-width",n?"1.5":"2"),c.appendChild(B);let P=R===ne?"":String(R);Un(c,L,V,g,H,_,P,s,d,m,i)})}function cn(s,e,t){var R,I,F,_,L,W,B,P,Q;let n=(R=e.options)!=null?R:{},r=n.background,o=(I=n.drilldown)!=null?I:!0,i=(F=t.rows)!=null?F:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let l=Je(i),a=Array.from(l.keys()).filter(u=>u!==ne);if(a.length===0){Ee(s,e,t,!0);return}let{inner:c,svg:d,tooltip:m,details:S}=xt(s,r),p=s.getBoundingClientRect().width||600,f=Math.max(p,480);c.style.width=f+"px";let x=300;d.setAttribute("height",String(x));let y=f-kt-zt,N=x-qt-je,A=tn(i),v=[],T=new Set;for(let u of i){let k=String(u.x);T.has(k)||(T.add(k),v.push(u.x))}let V=A?en(i,y,kt):nn(i,y,kt),{xScale:H,xLabelOf:D}=V;if(A&&v.sort((u,k)=>{let C=Ct(u),K=Ct(k),$=C?C.getTime():0,tt=K?K.getTime():0;return $-tt}),A){let k=i.map(O=>Ct(O.x)).filter(O=>!!O).map(O=>O.getTime()).sort((O,q)=>O-q),C=k[0],K=k[k.length-1],$=24*60*60*1e3;C===K&&(C-=$,K+=$);let tt=K-C||$,X=C-tt*jt,rt=K+tt*jt;rn(d,X,rt,y,N,kt,qt,zt,f)}let E=new Map,g=new Map;for(let u of v)E.set(String(u),new Map);for(let u of a){let k=(_=l.get(u))!=null?_:[],C=new Map;for(let K of k){let $=String(K.x);C.set($,(L=K.y)!=null?L:0)}g.set(u,C)}for(let u of a){let k=(W=g.get(u))!=null?W:new Map,C=0;for(let K of v){let $=String(K),tt=k.get($);tt!==void 0&&(C=tt);let X=E.get($);X&&X.set(u,C)}}let w=[];for(let u of v){let k=String(u),C=new Map,K=new Map,$=E.get(k);for(let X of a){let rt=(B=$==null?void 0:$.get(X))!=null?B:0;C.set(X,rt)}let tt=0;for(let X of a){let rt=(P=C.get(X))!=null?P:0;K.set(X,tt),tt+=rt}w.push({x:u,seriesValues:C,stackedValues:K})}let h=0;for(let u of w){let k=0;for(let C of a)k+=(Q=u.seriesValues.get(C))!=null?Q:0;k>h&&(h=k)}(!isFinite(h)||h<=0)&&(h=1);let M=sn(0,h,N,qt);on(d,0,h,M,y,kt,zt),a.length>0&&an(s,a,!1),a.forEach((u,k)=>{let C=ut(u,k),K="";w.forEach((O,q)=>{var J,U;let ot=H(O.x),et=(J=O.stackedValues.get(u))!=null?J:0,it=(U=O.seriesValues.get(u))!=null?U:0,at=et+it,Z=M(at);K+=q===0?`M ${ot} ${Z}`:` L ${ot} ${Z}`});let $=w.slice().reverse().map(O=>{var it;let q=H(O.x),ot=(it=O.stackedValues.get(u))!=null?it:0,et=M(ot);return`${q} ${et}`}).join(" L "),tt=`${K} L ${$} Z`,X=document.createElementNS(d.namespaceURI,"path");X.setAttribute("d",tt),X.setAttribute("fill",C),X.setAttribute("fill-opacity","0.18"),X.setAttribute("stroke",C),X.setAttribute("stroke-width","1.5"),d.appendChild(X);let rt=g.get(u);w.forEach(O=>{var Mt,Jt,Yt;let q=String(O.x);if(!(rt==null?void 0:rt.has(q)))return;let et=H(O.x),it=(Mt=O.stackedValues.get(u))!=null?Mt:0,at=(Jt=O.seriesValues.get(u))!=null?Jt:0,Z=it+at,J=M(Z),U=document.createElementNS(d.namespaceURI,"circle");U.setAttribute("cx",String(et)),U.setAttribute("cy",String(J)),U.setAttribute("r","3"),U.setAttribute("fill","#ffffff"),U.setAttribute("stroke",C),U.setAttribute("stroke-width","1.5"),U.style.cursor="pointer";let ft=D(O.x),ct=`${u} @ ${ft}`,nt=`value: ${Math.round(at*100)/100}`,At=((Yt=l.get(u))!=null?Yt:[]).find(Nt=>String(Nt.x)===String(O.x));U.addEventListener("mouseenter",Nt=>{var Bt,Ot;return gt(s,m,ct,nt,(Ot=(Bt=At==null?void 0:At.notes)==null?void 0:Bt.length)!=null?Ot:0,Nt)}),U.addEventListener("mouseleave",()=>yt(m)),U.addEventListener("click",Nt=>{var Bt;Nt.preventDefault(),bt(s,S,ct,at,(Bt=At==null?void 0:At.notes)!=null?Bt:[],o)}),d.appendChild(U)})})}function ln(s,e,t){var v;let{background:n,drilldown:r=!0}=(v=e.options)!=null?v:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=We(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:l,svg:a,tooltip:c,details:d}=xt(s,n),m=Math.max(i,420);l.style.width=m+"px",o&&(a.style.color=o);let S=300,p=m/2,f=(S-28+28)/2,x=Math.min(m/2-20,S/2-20),N=t.rows.map(T=>Math.max(0,T.y)).reduce((T,V)=>T+V,0)||1,A=-Math.PI/2;t.rows.forEach((T,V)=>{var _;let H=T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x),D=T.y,E=D/N*Math.PI*2,g=p+x*Math.cos(A),w=f+x*Math.sin(A),h=p+x*Math.cos(A+E),M=f+x*Math.sin(A+E),R=E>Math.PI?1:0,I=document.createElementNS(a.namespaceURI,"path"),F=[`M ${p} ${f}`,`L ${g} ${w}`,`A ${x} ${x} 0 ${R} 1 ${h} ${M}`,"Z"].join(" ");I.setAttribute("d",F),I.setAttribute("fill",ut((_=T.series)!=null?_:H,V)),I.style.cursor="pointer",I.addEventListener("mouseenter",L=>{var W,B;return gt(s,c,H,D,(B=(W=T.notes)==null?void 0:W.length)!=null?B:0,L)}),I.addEventListener("mouseleave",()=>yt(c)),I.addEventListener("click",()=>{var L;return bt(s,d,H,D,(L=T.notes)!=null?L:[],r)}),a.appendChild(I),A+=E})}function un(s,e,t){var w;let{background:n,drilldown:r=!0}=(w=e.options)!=null?w:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:l,svg:a,tooltip:c,details:d}=xt(s,n),m=Math.max(i,700);l.style.width=m+"px",o&&(a.style.color=o);let S=300,p=m-48-10,f=S-28-28,x=t.rows.map(h=>{let M=h.x;if(M instanceof Date)return M.getTime();if(typeof M=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(M)){let I=new Date(M);if(!isNaN(I.getTime()))return I.getTime()}let R=Number(M);return isNaN(R)?null:R}return typeof M=="number"?M:null}),y=t.rows.map(h=>h.y),N=x.filter(h=>h!==null);if(N.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data (X is not numeric/date)."});return}let A=Math.min(...N),v=Math.max(...N),T=Math.min(...y),V=Math.max(...y),H=h=>48+(h-A)/(v-A||1)*p,D=h=>S-28-(h-T)/(V-T||1)*f,E=document.createElementNS(a.namespaceURI,"line");E.setAttribute("x1",String(48)),E.setAttribute("y1",String(28)),E.setAttribute("x2",String(48)),E.setAttribute("y2",String(S-28)),E.setAttribute("stroke","currentColor"),a.appendChild(E);let g=document.createElementNS(a.namespaceURI,"line");g.setAttribute("x1",String(48)),g.setAttribute("y1",String(S-28)),g.setAttribute("x2",String(m-10)),g.setAttribute("y2",String(S-28)),g.setAttribute("stroke","currentColor"),a.appendChild(g),t.rows.forEach((h,M)=>{let R=x[M];if(R==null)return;let I=H(R),F=D(y[M]),_=document.createElementNS(a.namespaceURI,"circle");_.setAttribute("cx",String(I)),_.setAttribute("cy",String(F)),_.setAttribute("r","4"),_.setAttribute("fill",ut(h.series,M)),_.style.cursor="pointer";let L=h.x instanceof Date?h.x.toISOString().slice(0,10):typeof h.x=="string"?h.x:String(h.x);_.addEventListener("mouseenter",W=>{var B,P;return gt(s,c,L,h.y,(P=(B=h.notes)==null?void 0:B.length)!=null?P:0,W)}),_.addEventListener("mouseleave",()=>yt(c)),_.addEventListener("click",W=>{var B;W.preventDefault(),bt(s,d,L,h.y,(B=h.notes)!=null?B:[],r)}),a.appendChild(_)})}var ge=class{render(e,t,n,r){var a;let{title:o}=(a=t.options)!=null?a:{};e.empty(),e.addClass("prop-charts-container");let l=e.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(o&&(l.textContent=o),t.type){case"bar":ve(e,t,n);break;case"stacked-bar":Xe(e,t,n);break;case"line":Ee(e,t,n,!1);break;case"stacked-area":cn(e,t,n);break;case"pie":ln(e,t,n);break;case"scatter":un(e,t,n);break;case"gantt":fe(e,t,n,r);break;default:e.createDiv({text:"Chart Notes: unsupported type: "+t.type})}}};var ye=class extends Zt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("Chart Notes: loading plugin (Bases-only)"),this.indexer=new ue(this.app),await this.indexer.buildIndex(),this.query=new me(()=>this.indexer.getAll(),[]),this.renderer=new ge,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Zt.TFile&&this.indexer.removeFile(t)})),this.registerBasesView(Se,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new ce(t,n,this.renderer),options:()=>{let t=[];return t.push({type:"dropdown",key:"chartType",displayName:"Chart type",description:"Type of chart to render",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line","stacked-area":"Stacked area",pie:"Pie",scatter:"Scatter",gantt:"Gantt"}}),t.push({type:"property",key:"xProperty",displayName:"X axis / category (bars & slices)",description:"Property used for the X axis or categories (for pie, this is the slice).",shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")==="gantt"}}),t.push({type:"property",key:"ganttLabelProperty",displayName:"Task label (Gantt)",description:`Label for each task bar.
If empty, uses the note title.`,shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"yProperty",displayName:"Y value (empty = count)",description:`Numeric property summed on the Y axis.
Leave empty to just count notes.`,shouldHide:n=>{var o;let r=String((o=n.get("chartType"))!=null?o:"bar");return r==="pie"||r==="gantt"}}),t.push({type:"property",key:"seriesProperty",displayName:"Series / color (optional)",description:"Property that defines series / color for bars, lines and stacked area.",shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")==="pie"}}),t.push({type:"dropdown",key:"aggregateMode",displayName:"Value aggregation (Y)",description:`How to aggregate Y when multiple notes share the same X/series.
For line/stacked-area, 'Cumulative sum' turns the series into a running total.`,default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:n=>{var o;let r=String((o=n.get("chartType"))!=null?o:"bar");return r==="scatter"||r==="gantt"}}),t.push({type:"dropdown",key:"xBucket",displayName:"X bucket (dates)",description:"How to bucket dates on the X axis for line / stacked area charts (day, week, month...).",default:"auto",options:{auto:"Auto",none:"None",day:"Day",week:"Week",month:"Month",quarter:"Quarter",year:"Year"},shouldHide:n=>{var o;let r=String((o=n.get("chartType"))!=null?o:"bar");return!(r==="line"||r==="stacked-area")}}),t.push({type:"property",key:"startProperty",displayName:"Start (Gantt)",description:"Start date/datetime for the task.",shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"endProperty",displayName:"End (Gantt)",description:"End date/datetime for the task.",shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"dueProperty",displayName:"Due (deadline, optional)",description:"Due date / deadline for the task.",shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"property",key:"durationProperty",displayName:"Duration in minutes (optional)",description:`Duration of the task in minutes.
Used together with start/end/due.`,shouldHide:n=>{var r;return String((r=n.get("chartType"))!=null?r:"bar")!=="gantt"}}),t.push({type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0}),t.push({type:"text",key:"title",displayName:"Title (optional)",description:`Custom chart title.
Falls back to the view name.`}),t}})}onunload(){console.log("Chart Notes: unloading plugin")}};
