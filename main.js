/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ie=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var Fe=Object.getOwnPropertyNames;var $e=Object.prototype.hasOwnProperty;var _e=(i,t)=>{for(var e in t)ie(i,e,{get:t[e],enumerable:!0})},ze=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Fe(t))!$e.call(i,r)&&r!==e&&ie(i,r,{get:()=>t[r],enumerable:!(n=Pe(t,r))||n.enumerable});return i};var We=i=>ze(ie({},"__esModule",{value:!0}),i);var qe={};_e(qe,{default:()=>ee});module.exports=We(qe);var kt=require("obsidian");var we=require("obsidian"),Xt=class{constructor(t){this.index=new Map;this.app=t}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)await this.updateFile(e)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(t){if(t.extension!=="md")return;let e={};try{let r=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/);if(r){let o=(0,we.parseYaml)(r[1])||{};if(o&&typeof o=="object")for(let[f,h]of Object.entries(o))f!=="position"&&(e[f]=h)}let s=this.app.metadataCache.getFileCache(t);s!=null&&s.tags&&!e.tags&&(e.tags=s.tags.map(o=>o.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",t.path,n)}this.index.set(t.path,{path:t.path,props:e})}removeFile(t){this.index.delete(t.path)}};function De(i,t){if(!t||t.length===0)return!0;for(let e of t){if(e===".")return!0;let n=e.endsWith("/")?e:e+"/";if(i===e||i.startsWith(n))return!0}return!1}function Ce(i,t){if(!t||t.length===0)return!0;let e=i.tags;if(!e)return!1;if(Array.isArray(e)){for(let r of t)if(e.includes(r)||e.includes("#"+r))return!0;return!1}let n=String(e);for(let r of t)if(n===r||n==="#"+r)return!0;return!1}function jt(i){return typeof i!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(i)}function It(i){if(i instanceof Date)return i;if(typeof i!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(i)){let[e,n,r]=i.split("-");return new Date(Number(e),Number(n)-1,Number(r),0,0,0,0)}let t=new Date(i);return isNaN(t.getTime())?null:t}function lt(i){let t=new Date(i);return t.setHours(0,0,0,0),t}function qt(i,t){let e=new Date(i);return e.setDate(e.getDate()-t),e}function Ke(i,t){return qt(i,t*7)}function He(i,t){let e=new Date(i);return e.setMonth(e.getMonth()-t),e}function ae(i,t){let e=new Date(i);return e.setDate(e.getDate()+t),e}function Qe(i,t){return ae(i,t*7)}function Ge(i,t){let e=new Date(i);return e.setMonth(e.getMonth()+t),e}function Ae(i){let t=i.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(t)||t.endsWith("date")||t.endsWith("at")||t.endsWith("on"))}function Ee(i,t){let e=t?new Date(t):new Date,n=lt(e),r=i.trim().toLowerCase();if(r==="today")return n;if(r==="yesterday")return lt(qt(n,1));if(/^-\d+$/.test(r)){let s=parseInt(r.slice(1),10);return lt(qt(n,s))}if(/^-\d+d$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(qt(n,s))}if(/^-\d+w$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(Ke(n,s))}if(/^-\d+m$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(He(n,s))}if(/^\+\d+$/.test(r)){let s=parseInt(r.slice(1),10);return lt(ae(n,s))}if(/^\+\d+d$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(ae(n,s))}if(/^\+\d+w$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(Qe(n,s))}if(/^\+\d+m$/.test(r)){let s=parseInt(r.slice(1,-1),10);return lt(Ge(n,s))}return null}function Me(i){let t=i.trim(),e=t.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(e){let d=e[1].trim(),g=e[2].trim(),R=e[3].trim(),A=Ae(d),x=oe(g,A),D=oe(R,A),k=x.valueType==="date"||D.valueType==="date"?"date":x.valueType;return{field:d,op:"between",value:x.value,value2:D.value,valueType:k}}let n=/(==|!=|>=|<=|>|<)/,r=t.split(n);if(r.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+i);let s=r[0].trim(),o=r[1].trim(),f=r[2].trim(),h=Ae(s),c=oe(f,h);return{field:s,op:o,value:c.value,valueType:c.valueType}}function oe(i,t){let e=i.trim();if(e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"'))return{value:e.slice(1,-1),valueType:"string"};let n=e.toLowerCase(),r=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(t){if(e==="0"||n==="today")return{value:lt(new Date),valueType:"date"};let o=Ee(e);if(o)return{value:o,valueType:"date"}}else if(r){let o=Ee(e);if(o)return{value:o,valueType:"date"}}if(jt(e)){let o=It(e);if(o)return{value:o,valueType:"date"}}let s=Number(e);return Number.isNaN(s)?{value:e,valueType:"string"}:{value:s,valueType:"number"}}function ke(i,t){let e=i[t.field];if(e==null)return!1;if(t.valueType==="date"){let s=e instanceof Date?lt(e):jt(e)?lt(It(e)):null;if(!s)return!1;let o=t.value instanceof Date?t.value:null,f=t.value2 instanceof Date?t.value2:null;if(!o)return!1;let h=s.getTime(),c=lt(o).getTime();switch(t.op){case"==":return h===c;case"!=":return h!==c;case">":return h>c;case">=":return h>=c;case"<":return h<c;case"<=":return h<=c;case"between":if(!f)return!1;let d=lt(f).getTime();return h>=c&&h<=d}}if(t.valueType==="number"){let s=Number(e);if(isNaN(s))return!1;let o=Number(t.value);switch(t.op){case"==":return s===o;case"!=":return s!==o;case">":return s>o;case">=":return s>=o;case"<":return s<o;case"<=":return s<=o;case"between":return typeof t.value2!="number"?!1:s>=o&&s<=t.value2}}let n=String(e),r=String(t.value);switch(t.op){case"==":return n===r;case"!=":return n!==r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r;case"between":return!1}}function Be(i){if(typeof i=="string"&&/^\d{4}-\d{2}-\d{2}/.test(i))return{key:i.slice(0,10),isDate:!0};if(jt(i)){let t=It(i);if(t)return{key:t,isDate:!0}}return{key:i,isDate:!1}}function Ue(i,t){let e=i.x,n=t.x;if(e instanceof Date&&n instanceof Date)return e.getTime()-n.getTime();let r=String(e),s=String(n);return r<s?-1:r>s?1:0}function Ye(i,t){var s,o;let e=Ue(i,t);if(e!==0)return e;let n=(s=i.series)!=null?s:"",r=(o=t.series)!=null?o:"";return n<r?-1:n>r?1:0}function Oe(i){if(i==null)return 0;if(typeof i=="number")return i>0?Math.floor(i):0;if(typeof i=="string"){let t=i.trim().match(/^(\d+)/);if(t){let e=Number(t[1]);return Number.isFinite(e)&&e>0?Math.floor(e):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(i)}`)}function Ve(i){var n,r;let t=new Map,e=[];for(let s of i){let o=(n=s.series)!=null?n:"__no_series__",h=((r=t.get(o))!=null?r:0)+s.y;t.set(o,h),e.push({...s,y:h})}return e}function Xe(i,t){var o,f;let e=Oe(t);if(!e||e<=1)return[...i];let n=new Map,r=new Map,s=[];for(let h of i){let c=(o=h.series)!=null?o:"__no_series__",d=n.get(c);d||(d=[],n.set(c,d));let g=(f=r.get(c))!=null?f:0;if(d.push(h.y),g+=h.y,d.length>e){let x=d.shift();g-=x}r.set(c,g);let R=d.length||1,A=g/R;s.push({...h,y:A})}return s}var Zt=class{constructor(t,e){this.getIndex=t,this.defaultPaths=e}run(t){var o,f,h;let e=this.getIndex(),n=(o=t.source)!=null&&o.paths&&t.source.paths.length?t.source.paths:this.defaultPaths,r=(f=t.source)!=null&&f.tags&&t.source.tags.length?t.source.tags:[],s=[];for(let c of e){let d=n&&n.length?De(c.path,n):!0,g=r&&r.length?Ce(c.props,r):!0;if(!d||!g)continue;let R=!0;if((h=t.source)!=null&&h.where&&t.source.where.length>0)for(let A of t.source.where){let x;try{x=Me(A)}catch(D){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${A} (${D.message})`)}if(!ke(c.props,x)){R=!1;break}}R&&s.push(c)}return t.type==="gantt"?this.runGantt(t,s):t.type==="table"?this.runTable(t,s):this.runStandard(t,s)}runTable(t,e){var r,s;return{rows:e.map(o=>({x:o.path,y:0,notes:[o.path],props:o.props})),xField:(r=t.encoding)==null?void 0:r.x,yField:(s=t.encoding)==null?void 0:s.y}}runGantt(t,e){var g,R,A;let n=(g=t.encoding)!=null?g:{},r=n.start,s=n.end,o=(R=n.label)!=null?R:n.x,f=n.series,h=n.duration,c=n.due,d=[];for(let x of e){let D=(A=x.props)!=null?A:{},k=C=>Array.isArray(C)?C[0]:C,P=null;if(s){let C=k(D[s]),S=It(C);S&&(P=S)}if(!P)continue;let _=null;if(r){let C=k(D[r]),S=It(C);S&&(_=S)}if(!_&&h){let C=k(D[h]),S=Number(C);Number.isNaN(S)||(_=new Date(P.getTime()-S*6e4))}_||(_=new Date(P.getTime()));let z;if(c){let C=k(D[c]),S=It(C);S&&(z=S)}let B;if(o){let C=k(D[o]);(C==null||C==="")&&(C=x.path),B=C}else B=x.path;let T;if(f){let C=k(D[f]);C!=null&&(T=String(C))}let Y={x:B,y:0,notes:[x.path],series:T,start:_,end:P,props:D};z&&(Y.due=z),d.push(Y)}return d.sort((x,D)=>{let k=x.start?x.start.getTime():0,P=D.start?D.start.getTime():0;return k-P}),{rows:d,xField:o,yField:s}}runStandard(t,e){var x,D,k,P,_,z,B,T,Y,C;let n=(x=t.encoding)==null?void 0:x.x,r=(D=t.encoding)==null?void 0:D.y,s=(k=t.encoding)==null?void 0:k.series;if(!n)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let o=(P=t.aggregate)!=null?P:{},f=(_=o.y)!=null?_:null,h=!!o.cumulative,c=o.rolling;if(!r&&f!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let d=[];for(let S of e){let l=(z=S.props)!=null?z:{},w=F=>Array.isArray(F)?F[0]:F,L=w(l[n]);if(L==null)continue;let m=Be(L),y=m.key,Q=m.isDate,K;if(s){let F=w(l[s]);F!=null&&String(F).trim()!==""&&(K=String(F))}let nt;if(f==="count")nt=1;else{let F=w(l[r]);if(F==null)continue;let V=Number(F);if(Number.isNaN(V))continue;nt=V}d.push({x:y,y:nt,notes:[S.path],series:K,props:l,_isDate:Q,_origX:L})}if(d.length===0)return{rows:[],xField:n,yField:r};let g=[];if(f){let S=new Map;for(let l of d){let w=(B=l.series)!=null?B:"",L=l.x instanceof Date?l.x.toISOString().slice(0,10):String(l.x),m=w+"||"+L,y=(T=S.get(m))!=null?T:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:l.x,isDate:l._isDate,series:l.series,props:l.props};y.sum+=l.y,y.count+=1,l.y<y.min&&(y.min=l.y),l.y>y.max&&(y.max=l.y),y.notes.push(...l.notes),y.props=(Y=l.props)!=null?Y:y.props,S.set(m,y)}for(let[,l]of S){let w=l.sum;switch(f){case"sum":w=l.sum;break;case"avg":w=l.sum/l.count;break;case"min":w=l.min;break;case"max":w=l.max;break;case"count":w=l.count;break}g.push({x:l.xRep,y:w,notes:l.notes,series:l.series,props:l.props})}}else g=d.map(S=>({x:S.x,y:S.y,notes:S.notes,series:S.series,props:S.props}));if(g.length===0)return{rows:[],xField:n,yField:r};let R=((C=t.sort)==null?void 0:C.x)==="desc"?"desc":"asc";if(g.sort((S,l)=>{let w=Ye(S,l);return R==="asc"?w:-w}),(h||c)&&!(t.type==="line"||t.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(h&&c)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let A=g;return c?A=Xe(g,c):h&&(A=Ve(g)),{rows:A,xField:n,yField:r}}};var vt=require("obsidian"),Bt=48,ce=10,Jt=28,Pt=28;var Mt=300,Re=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function gt(i,t){if(!i)return"var(--text-accent, #5b6cff)";let e=Array.from(i).reduce((n,r)=>n*33+r.charCodeAt(0)>>>0,0);return Re[e%Re.length]}function Ft(i,t){i.addClass("prop-charts-container"),i.style.width="100%",i.style.maxWidth="100%",i.style.position="relative";let e=i.createDiv({cls:"chart-notes-scroll"});e.style.overflowX="auto",e.style.overflowY="hidden",e.style.width="100%",e.style.maxWidth="100%";let n=e.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${Mt}px`,t&&(n.style.background=t);let r="http://www.w3.org/2000/svg",s=document.createElementNS(r,"svg");s.setAttribute("width","100%"),s.setAttribute("height",String(Mt)),s.style.display="block",n.appendChild(s);let o=i.createDiv({cls:"chart-notes-tooltip"});o.style.display="none";let f=i.createDiv({cls:"chart-notes-details"});return f.style.display="none",{scroll:e,inner:n,svg:s,tooltip:o,details:f}}function $t(i,t,e,n,r,s){let o=i.getBoundingClientRect(),f=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);t.innerHTML=`
    <div class="chart-notes-tooltip-title">${e}</div>
    <div class="chart-notes-tooltip-value">${f}</div>
    <div class="chart-notes-tooltip-notes">${r} nota${r===1?"":"s"}</div>
  `,t.style.display="block";let h=t.getBoundingClientRect(),c=s.clientX-o.left+6,d=s.clientY-o.top+6;c+h.width>o.width-4&&(c=o.width-h.width-4),c<4&&(c=4),d+h.height>o.height-4&&(d=o.height-h.height-4),d<4&&(d=4),t.style.left=c+"px",t.style.top=d+"px"}function _t(i){i.style.display="none"}function zt(i,t,e,n,r,s){if(!s)return;if(t.empty(),!r||r.length===0){t.style.display="none";return}t.style.display="block";let o=t.createEl("div",{cls:"chart-notes-details-header"}),f=o.createEl("div",{cls:"chart-notes-details-title"});f.textContent=`Notas em "${e}" (${r.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let h=o.createEl("button",{cls:"chart-notes-details-close"});h.textContent="\xD7",h.addEventListener("click",()=>{t.style.display="none"});let c=t.createEl("ul",{cls:"chart-notes-details-list"});for(let d of r){let R=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:d});R.href="#",R.addEventListener("click",A=>{A.preventDefault(),app.workspace.openLinkText(d,"",!1)})}}function Ut(i){if(!(i instanceof Date)||isNaN(i.getTime()))return"";let t=i.getDate().toString().padStart(2,"0"),e=(i.getMonth()+1).toString().padStart(2,"0");return`${t}/${e}`}function Ne(i){if(!i)return!1;let t=i.trim().toLowerCase();if(t==="#fff"||t==="#ffffff"||t==="white")return!0;if(!t.startsWith("#"))return!1;let e,n,r;if(t.length===4)e=parseInt(t[1]+t[1],16),n=parseInt(t[2]+t[2],16),r=parseInt(t[3]+t[3],16);else if(t.length===7)e=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);else return!1;return(.2126*e+.7152*n+.0722*r)/255>.7}var te=class{render(t,e,n,r,s=!1){var c;let{title:o}=(c=e.options)!=null?c:{};t.empty(),t.addClass("prop-charts-container");let h=t.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(o&&(h.textContent=o),e.type){case"bar":this.renderBar(t,e,n);break;case"line":this.renderLine(t,e,n,!1);break;case"area":this.renderLine(t,e,n,!0);break;case"pie":this.renderPie(t,e,n);break;case"scatter":this.renderScatter(t,e,n);break;case"table":this.renderTable(t,e,n);break;case"gantt":this.renderGantt(t,e,n,r);break;case"stacked-bar":this.renderStackedBar(t,e,n);break;default:t.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+e.type})}if(!s){let d=t.createEl("button",{cls:"chart-notes-zoom-button"});d.setAttr("type","button"),d.setAttr("aria-label","Expandir gr\xE1fico"),d.textContent="\u2922",d.addEventListener("click",g=>{g.preventDefault(),new ue(e,n,this,r).open()})}}renderBar(t,e,n){var V,X,J,I;let r=(V=e.options)!=null?V:{},s=r.background,o=(X=r.drilldown)!=null?X:!0,f=(J=n.rows)!=null?J:[];if(!f.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:c,tooltip:d,details:g}=Ft(t,s),R=t.getBoundingClientRect().width||600,A=Math.max(R,480);h.style.width=A+"px";let x=40,D=16,k=18,P=28,_=Mt;c.setAttribute("height",String(_));let z=A-x-D,B=_-k-P,T=new Map;for(let u of f){let v=String(u.x),p=(I=T.get(v))!=null?I:{label:u.x,rows:[]};p.rows.push(u),T.set(v,p)}let C=Array.from(T.keys()).sort((u,v)=>u<v?-1:u>v?1:0).map(u=>T.get(u)),S=C.length,l=new Set;f.forEach(u=>{u.series!=null&&l.add(String(u.series))});let w=Array.from(l),L=w.length>1,m=L?"grouped":"single",y=0;f.forEach(u=>{u.y>y&&(y=u.y)}),(!isFinite(y)||y<=0)&&(y=1);let Q=u=>k+B-u/(y||1)*B,K=Q(0),nt=4;for(let u=0;u<=nt;u++){let v=y*u/nt,p=Q(v),b=document.createElementNS(c.namespaceURI,"line");b.setAttribute("x1",String(x)),b.setAttribute("y1",String(p)),b.setAttribute("x2",String(A-D)),b.setAttribute("y2",String(p)),b.setAttribute("stroke","#cccccc"),b.setAttribute("stroke-opacity","0.25"),c.appendChild(b);let M=document.createElementNS(c.namespaceURI,"text");M.setAttribute("x",String(x-4)),M.setAttribute("y",String(p+3)),M.setAttribute("text-anchor","end"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=String(Math.round(v)),c.appendChild(M)}let F=S>0?z/S:z;if(C.forEach((u,v)=>{let p=x+F*(v+.5),b=String(u.label),M=document.createElementNS(c.namespaceURI,"text");M.setAttribute("x",String(p)),M.setAttribute("y",String(_-P+12)),M.setAttribute("text-anchor","middle"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=b,c.appendChild(M)}),L){let u=t.createDiv({cls:"chart-notes-legend"});w.forEach((v,p)=>{let b=u.createDiv({cls:"chart-notes-legend-item"}),M=b.createDiv();M.style.width="10px",M.style.height="10px",M.style.borderRadius="999px",M.style.backgroundColor=gt(v,p),b.createSpan({text:v})})}C.forEach((u,v)=>{let p=x+F*(v+.5),b=u.rows;if(m==="single"){let Z=b[0],W=Z.y,q=F*.6,U=p-q/2,ht=Q(W),ut=Math.max(2,K-ht),dt=gt("bar",v),N=document.createElementNS(c.namespaceURI,"rect");N.setAttribute("x",String(U)),N.setAttribute("y",String(ht)),N.setAttribute("width",String(q)),N.setAttribute("height",String(ut)),N.setAttribute("fill",dt),N.setAttribute("stroke","rgba(0,0,0,0.25)"),N.setAttribute("stroke-width","0.5"),N.style.cursor="pointer";let j=String(u.label),Rt=`valor: ${Math.round(W*100)/100}`;N.addEventListener("mouseenter",pt=>{var et,at;return $t(t,d,j,Rt,(at=(et=Z.notes)==null?void 0:et.length)!=null?at:0,pt)}),N.addEventListener("mouseleave",()=>_t(d)),N.addEventListener("click",pt=>{var et;pt.preventDefault(),zt(t,g,j,W,(et=Z.notes)!=null?et:[],o)}),c.appendChild(N);return}let M=w.length,tt=F/Math.max(M+1,2),H=M*tt,rt=p-H/2;w.forEach((Z,W)=>{let q=b.find(et=>(et.series!=null?String(et.series):"")===Z);if(!q)return;let U=q.y,ht=rt+W*tt,ut=Q(U),dt=Math.max(2,K-ut),N=gt(Z,W),j=document.createElementNS(c.namespaceURI,"rect");j.setAttribute("x",String(ht)),j.setAttribute("y",String(ut)),j.setAttribute("width",String(tt)),j.setAttribute("height",String(dt)),j.setAttribute("fill",N),j.setAttribute("stroke","rgba(0,0,0,0.25)"),j.setAttribute("stroke-width","0.5"),j.style.cursor="pointer";let Rt=`${Z} @ ${String(u.label)}`,pt=`valor: ${Math.round(U*100)/100}`;j.addEventListener("mouseenter",et=>{var at,Qt;return $t(t,d,Rt,pt,(Qt=(at=q.notes)==null?void 0:at.length)!=null?Qt:0,et)}),j.addEventListener("mouseleave",()=>_t(d)),j.addEventListener("click",et=>{var at;et.preventDefault(),zt(t,g,Rt,U,(at=q.notes)!=null?at:[],o)}),c.appendChild(j)})})}renderStackedBar(t,e,n){var F,V,X,J;let r=(F=e.options)!=null?F:{},s=r.background,o=(V=r.drilldown)!=null?V:!0,f=(X=n.rows)!=null?X:[];if(!f.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:h,svg:c,tooltip:d,details:g}=Ft(t,s),R=t.getBoundingClientRect().width||600,A=Math.max(R,480);h.style.width=A+"px";let x=40,D=16,k=18,P=28,_=Mt;c.setAttribute("height",String(_));let z=A-x-D,B=_-k-P,T=new Map;for(let I of f){let u=String(I.x),v=(J=T.get(u))!=null?J:{label:I.x,rows:[]};v.rows.push(I),T.set(u,v)}let C=Array.from(T.keys()).sort((I,u)=>I<u?-1:I>u?1:0).map(I=>T.get(I)),S=C.length,l=new Set;f.forEach(I=>{I.series!=null&&l.add(String(I.series))});let w=Array.from(l);if(!w.length){this.renderBar(t,e,n);return}let L=0;C.forEach(I=>{let u=I.rows.reduce((v,p)=>v+p.y,0);u>L&&(L=u)}),(!isFinite(L)||L<=0)&&(L=1);let m=I=>k+B-I/(L||1)*B,y=m(0),Q=4;for(let I=0;I<=Q;I++){let u=L*I/Q,v=m(u),p=document.createElementNS(c.namespaceURI,"line");p.setAttribute("x1",String(x)),p.setAttribute("y1",String(v)),p.setAttribute("x2",String(A-D)),p.setAttribute("y2",String(v)),p.setAttribute("stroke","#cccccc"),p.setAttribute("stroke-opacity","0.25"),c.appendChild(p);let b=document.createElementNS(c.namespaceURI,"text");b.setAttribute("x",String(x-4)),b.setAttribute("y",String(v+3)),b.setAttribute("text-anchor","end"),b.setAttribute("font-size","10"),b.setAttribute("fill","#111111"),b.textContent=String(Math.round(u)),c.appendChild(b)}let K=S>0?z/S:z;C.forEach((I,u)=>{let v=x+K*(u+.5),p=String(I.label),b=document.createElementNS(c.namespaceURI,"text");b.setAttribute("x",String(v)),b.setAttribute("y",String(_-P+12)),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size","10"),b.setAttribute("fill","#111111"),b.textContent=p,c.appendChild(b)});let nt=t.createDiv({cls:"chart-notes-legend"});w.forEach((I,u)=>{let v=nt.createDiv({cls:"chart-notes-legend-item"}),p=v.createDiv();p.style.width="10px",p.style.height="10px",p.style.borderRadius="999px",p.style.backgroundColor=gt(I,u),v.createSpan({text:I})}),C.forEach((I,u)=>{let v=x+K*(u+.5),p=K*.6,b=v-p/2,M=0;w.forEach((tt,H)=>{let rt=I.rows.find(pt=>(pt.series!=null?String(pt.series):"")===tt);if(!rt)return;let Z=rt.y,W=M,q=M+Z;M=q;let U=m(W),ht=m(q),ut=Math.max(2,U-ht),dt=gt(tt,H),N=document.createElementNS(c.namespaceURI,"rect");N.setAttribute("x",String(b)),N.setAttribute("y",String(ht)),N.setAttribute("width",String(p)),N.setAttribute("height",String(ut)),N.setAttribute("fill",dt),N.setAttribute("stroke","rgba(0,0,0,0.25)"),N.setAttribute("stroke-width","0.5"),N.style.cursor="pointer";let j=`${tt} @ ${String(I.label)}`,Rt=`valor: ${Math.round(Z*100)/100}`;N.addEventListener("mouseenter",pt=>{var et,at;return $t(t,d,j,Rt,(at=(et=rt.notes)==null?void 0:et.length)!=null?at:0,pt)}),N.addEventListener("mouseleave",()=>_t(d)),N.addEventListener("click",pt=>{var et;pt.preventDefault(),zt(t,g,j,Z,(et=rt.notes)!=null?et:[],o)}),c.appendChild(N)})})}renderLine(t,e,n,r){var V,X,J,I;let s=(V=e.options)!=null?V:{},o=s.background,f=(X=s.drilldown)!=null?X:!0,h=(J=n.rows)!=null?J:[];if(!h.length){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:c,svg:d,tooltip:g,details:R}=Ft(t,o),A=t.getBoundingClientRect().width||600,x=Math.max(A,480);c.style.width=x+"px";let D=40,k=16,P=18,_=24,z=Mt;d.setAttribute("height",String(z));let B=x-D-k,T=z-P-_,Y=new Map;for(let u of h){let v=u.series!=null?String(u.series):"__default__",p=(I=Y.get(v))!=null?I:[];p.push(u),Y.set(v,p)}let C=Array.from(Y.keys()),S=[],l=new Set;for(let u of h){let v=String(u.x);l.has(v)||(l.add(v),S.push(u.x))}let w=S.length||1,L=u=>{let v=String(u),p=S.findIndex(b=>String(b)===v);return p<0?D:w===1?D+B/2:D+p/(w-1)*B},m=u=>String(u),y=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let u of h)u.y<y&&(y=u.y),u.y>Q&&(Q=u.y);(!isFinite(y)||!isFinite(Q))&&(y=0,Q=1),y===Q&&(y===0?Q=1:y=0);let K=u=>P+T-(u-y)/(Q-y||1)*T,nt=4;for(let u=0;u<=nt;u++){let v=y+(Q-y)*u/nt,p=K(v),b=document.createElementNS(d.namespaceURI,"line");b.setAttribute("x1",String(D)),b.setAttribute("y1",String(p)),b.setAttribute("x2",String(x-k)),b.setAttribute("y2",String(p)),b.setAttribute("stroke","#cccccc"),b.setAttribute("stroke-opacity","0.25"),d.appendChild(b);let M=document.createElementNS(d.namespaceURI,"text");M.setAttribute("x",String(D-4)),M.setAttribute("y",String(p+3)),M.setAttribute("text-anchor","end"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=Math.abs(v)>=100?String(Math.round(v)):String(Math.round(v*10)/10),d.appendChild(M)}let F=C.filter(u=>u!=="__default__");if(F.length>1){let u=t.createDiv({cls:"chart-notes-legend"});F.forEach((v,p)=>{let b=v,M=u.createDiv({cls:"chart-notes-legend-item"}),tt=M.createDiv();tt.style.width="10px",tt.style.height="10px",tt.style.borderRadius="999px",tt.style.backgroundColor=gt(b,p),M.createSpan({text:b})})}C.forEach((u,v)=>{let p=Y.get(u);if(!(p!=null&&p.length))return;let b=gt(u==="__default__"?"line":u,v),M=[...p].sort((H,rt)=>{let Z=S.findIndex(q=>String(q)===String(H.x)),W=S.findIndex(q=>String(q)===String(rt.x));return Z-W}),tt="";if(M.forEach((H,rt)=>{let Z=L(H.x),W=K(H.y);tt+=(rt===0?"M ":" L ")+Z+" "+W}),r){let H=M[0],rt=M[M.length-1],Z=L(H.x),W=L(rt.x),q=K(y);tt+=` L ${W} ${q} L ${Z} ${q} Z`;let U=document.createElementNS(d.namespaceURI,"path");U.setAttribute("d",tt),U.setAttribute("fill",b),U.setAttribute("fill-opacity","0.18"),U.setAttribute("stroke",b),U.setAttribute("stroke-width","1.5"),d.appendChild(U)}else{let H=document.createElementNS(d.namespaceURI,"path");H.setAttribute("d",tt),H.setAttribute("fill","none"),H.setAttribute("stroke",b),H.setAttribute("stroke-width","2"),d.appendChild(H)}M.forEach(H=>{let rt=L(H.x),Z=K(H.y),W=document.createElementNS(d.namespaceURI,"circle");W.setAttribute("cx",String(rt)),W.setAttribute("cy",String(Z)),W.setAttribute("r","3"),W.setAttribute("fill","#ffffff"),W.setAttribute("stroke",b),W.setAttribute("stroke-width","1.5"),W.style.cursor="pointer";let q=m(H.x),U=u==="__default__"?"":String(H.series),ht=U?`${U} @ ${q}`:q,ut=`valor: ${Math.round(H.y*100)/100}`;W.addEventListener("mouseenter",dt=>{var N,j;return $t(t,g,ht,ut,(j=(N=H.notes)==null?void 0:N.length)!=null?j:0,dt)}),W.addEventListener("mouseleave",()=>_t(g)),W.addEventListener("click",dt=>{var N;dt.preventDefault(),zt(t,R,ht,H.y,(N=H.notes)!=null?N:[],f)}),d.appendChild(W)})})}renderPie(t,e,n){var B;let{background:r,drilldown:s=!0}=(B=e.options)!=null?B:{};if(n.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=Ne(r)?"#000000":void 0,f=t.getBoundingClientRect().width||600,{inner:h,svg:c,tooltip:d,details:g}=Ft(t,r),R=Math.max(f,420);h.style.width=R+"px",o&&(c.style.color=o);let A=Mt,x=R/2,D=(A-Pt+Jt)/2,k=Math.min(R/2-20,A/2-20),_=n.rows.map(T=>Math.max(0,T.y)).reduce((T,Y)=>T+Y,0)||1,z=-Math.PI/2;n.rows.forEach((T,Y)=>{var F;let C=T.x instanceof Date?T.x.toISOString().slice(0,10):String(T.x),S=T.y,l=S/_*Math.PI*2,w=x+k*Math.cos(z),L=D+k*Math.sin(z),m=x+k*Math.cos(z+l),y=D+k*Math.sin(z+l),Q=l>Math.PI?1:0,K=document.createElementNS(c.namespaceURI,"path"),nt=[`M ${x} ${D}`,`L ${w} ${L}`,`A ${k} ${k} 0 ${Q} 1 ${m} ${y}`,"Z"].join(" ");K.setAttribute("d",nt),K.setAttribute("fill",gt((F=T.series)!=null?F:C,Y)),K.style.cursor="pointer",K.addEventListener("mouseenter",V=>{var X,J;return $t(t,d,C,S,(J=(X=T.notes)==null?void 0:X.length)!=null?J:0,V)}),K.addEventListener("mouseleave",()=>_t(d)),K.addEventListener("click",()=>{var V;return zt(t,g,C,S,(V=T.notes)!=null?V:[],s)}),c.appendChild(K),z+=l})}renderScatter(t,e,n){var L;let{background:r,drilldown:s=!0}=(L=e.options)!=null?L:{};if(n.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let o=Ne(r)?"#000000":void 0,f=t.getBoundingClientRect().width||600,{inner:h,svg:c,tooltip:d,details:g}=Ft(t,r),R=Math.max(f,700);h.style.width=R+"px",o&&(c.style.color=o);let A=Mt,x=R-Bt-ce,D=A-Jt-Pt,k=n.rows.map(m=>{let y=m.x;if(y instanceof Date)return y.getTime();if(typeof y=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(y)){let K=new Date(y);if(!isNaN(K.getTime()))return K.getTime()}let Q=Number(y);return isNaN(Q)?null:Q}return typeof y=="number"?y:null}),P=n.rows.map(m=>m.y),_=k.filter(m=>m!==null);if(_.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let z=Math.min(..._),B=Math.max(..._),T=Math.min(...P),Y=Math.max(...P),C=m=>Bt+(m-z)/(B-z||1)*x,S=m=>A-Pt-(m-T)/(Y-T||1)*D,l=document.createElementNS(c.namespaceURI,"line");l.setAttribute("x1",String(Bt)),l.setAttribute("y1",String(Jt)),l.setAttribute("x2",String(Bt)),l.setAttribute("y2",String(A-Pt)),l.setAttribute("stroke","currentColor"),c.appendChild(l);let w=document.createElementNS(c.namespaceURI,"line");w.setAttribute("x1",String(Bt)),w.setAttribute("y1",String(A-Pt)),w.setAttribute("x2",String(R-ce)),w.setAttribute("y2",String(A-Pt)),w.setAttribute("stroke","currentColor"),c.appendChild(w),n.rows.forEach((m,y)=>{let Q=k[y];if(Q==null)return;let K=C(Q),nt=S(P[y]),F=document.createElementNS(c.namespaceURI,"circle");F.setAttribute("cx",String(K)),F.setAttribute("cy",String(nt)),F.setAttribute("r","4"),F.setAttribute("fill",gt(m.series,y)),F.style.cursor="pointer";let V=m.x instanceof Date?m.x.toISOString().slice(0,10):typeof m.x=="string"?m.x:String(m.x);F.addEventListener("mouseenter",X=>{var J,I;return $t(t,d,V,m.y,(I=(J=m.notes)==null?void 0:J.length)!=null?I:0,X)}),F.addEventListener("mouseleave",()=>_t(d)),F.addEventListener("click",X=>{var J;X.preventDefault(),zt(t,g,V,m.y,(J=m.notes)!=null?J:[],s)}),c.appendChild(F)})}renderTable(t,e,n){var d,g;let{background:r}=(d=e.options)!=null?d:{},{inner:s}=Ft(t,r),o=s.createEl("table",{cls:"chart-notes-table"}),h=o.createEl("thead").createEl("tr");h.createEl("th",{text:"X"}),h.createEl("th",{text:"Y"}),h.createEl("th",{text:"Notas"});let c=o.createEl("tbody");for(let R of n.rows){let A=c.createEl("tr");A.createEl("td",{text:R.x instanceof Date?R.x.toISOString().slice(0,10):String(R.x)}),A.createEl("td",{text:String(R.y)});let x=A.createEl("td");for(let D of(g=R.notes)!=null?g:[])x.createEl("a",{text:D,href:"#"}).addEventListener("click",P=>{P.preventDefault(),app.workspace.openLinkText(D,"",!1)}),x.createSpan({text:" "})}}renderGantt(t,e,n,r){var he,fe,ge,me,ye,be;let s=(he=e.options)!=null?he:{},o=s.background,f=(fe=s.drilldown)!=null?fe:!0,h=!0,c=a=>{if(a==null)return"";let E=String(a).trim();if(!E)return"";let $=E.match(/^\[\[(.+?)\]\]$/);$&&(E=$[1]);let O=E.lastIndexOf("/");return O>=0&&O<E.length-1&&(E=E.slice(O+1)),E};if(Array.from(t.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(a=>a.remove()),n.rows.length===0){t.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let d=n.rows.filter(a=>a.start&&a.end);if(d.length===0){t.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let g=e.encoding,R=g.group,A=g.duration,x=(a,E)=>{if(!a||!E)return;let $=a[E];return Array.isArray($)?$[0]:$},k=d.map(a=>{var yt,ct;let E=a.start,$=a.end,O=a.props,Nt=typeof a.x=="string"?a.x:a.x instanceof Date?Ut(E):String(a.x),St=c(Nt),mt,Tt=R?x(O,R):void 0;Tt!=null?mt=String(Tt):a.series!=null?mt=String(a.series):mt=St;let ft=(yt=a.notes)==null?void 0:yt[0],wt=ft?(ct=ft.replace(/\.md$/i,"").split("/").pop())!=null?ct:ft:St,At=a.due,Lt,Dt=x(O,A);if(Dt!=null){let bt=Number(Dt);Number.isNaN(bt)||(Lt=bt)}return{row:a,start:E,end:$,props:O,fullName:St,groupKey:mt,notePath:ft,noteTitle:wt,due:At,estMinutes:Lt}}).filter(a=>a.start instanceof Date&&!isNaN(a.start.getTime())&&a.end instanceof Date&&!isNaN(a.end.getTime()));if(k.length===0){t.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}k.sort((a,E)=>{if(a.groupKey<E.groupKey)return-1;if(a.groupKey>E.groupKey)return 1;let $=a.start.getTime(),O=E.start.getTime();return $!==O?$-O:a.fullName.localeCompare(E.fullName)});let P=26,_=0,z=null;for(let a of k)a.groupKey!==z&&(z=a.groupKey,_+=1),_+=1;let B=Math.min(...k.map(a=>a.start.getTime())),T=Math.max(...k.map(a=>a.end.getTime()));if(!isFinite(B)||!isFinite(T)){t.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let Y=24*60*60*1e3,C=a=>{let E=new Date(a);return E.setHours(0,0,0,0),E.getTime()},S=C(B),l=C(T),w=t.querySelector(".prop-charts-title-row");w||(w=t.createDiv({cls:"prop-charts-title-row"}));let L=t.dataset.ganttZoomMode||s.zoomMode||"100";t.dataset.ganttZoomMode=L;let m=t.dataset.ganttLabelMode||s.labelMode||"compact";t.dataset.ganttLabelMode=m;let y=w.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(a=>{let E=y.createEl("button",{cls:"gantt-zoom-btn",text:a.label});a.id===L&&E.addClass("is-active"),E.addEventListener("click",$=>{$.preventDefault(),t.dataset.ganttZoomMode=a.id,this.renderGantt(t,e,n,r)})}),y.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",a=>{a.preventDefault();let E=t.querySelector(".chart-notes-zoom-button");E&&E.click()});let nt=Number(s.labelWidth),F=!Number.isNaN(nt)&&nt>120?nt:260,V=t.dataset.ganttLabelMode||"compact",X=V==="wide"?F+160:F,J=t.getBoundingClientRect().width||600,I=Math.max(J,820),u;if(L==="fit")u=J;else{let a=Number(L)/100||1;u=I*a}let{inner:v,svg:p,tooltip:b,details:M}=Ft(t,o);v.style.width=u+"px";let tt=(a,E,$,O,Nt,St,mt,Tt,ft)=>{if(!a)return;let wt=Math.max(40,O-8),Lt=Math.max(8,Math.floor(wt/6)),Dt=a.split(/\s+/),yt=[],ct="";for(let Et of Dt){if(!ct){ct=Et;continue}(ct+" "+Et).length<=Lt?ct+=" "+Et:(yt.push(ct),ct=Et)}ct&&yt.push(ct);let bt=Nt+2,Ht=yt.length*bt,Gt=$-Ht/2+Nt;yt.forEach((Et,Ot)=>{let ot=document.createElementNS(p.namespaceURI,"text");ot.setAttribute("x",String(E)),ot.setAttribute("y",String(Gt+Ot*bt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(Nt)),ot.setAttribute("fill","#111111"),St&&ot.setAttribute("font-weight",St),ot.textContent=Et,mt&&ot.addEventListener("mouseenter",it=>mt(it)),Tt&&ot.addEventListener("mouseleave",()=>Tt()),ft&&(ot.style.cursor="pointer",ot.addEventListener("click",it=>ft(it))),p.appendChild(ot)})},H=Jt,rt=Pt,Z=ce,W=Math.max(Mt,H+rt+_*P+24);p.setAttribute("height",String(W));let q=u-X-Z,U=H+6;p.style.color="#111111";let ht=l+Y-S||1,ut=S-ht*.02,dt=l+Y+ht*.08,N=a=>X+(a-ut)/(dt-ut)*q,j=(dt-ut)/Y,pt=Math.max(4,Math.min(12,Math.floor(q/90)||4)),et=j/pt,at=[1,2,3,5,7,10,14,21,30,60,90,180,365],Qt=at[at.length-1];for(let a of at)if(a>=et){Qt=a;break}let de=[],Te=C(ut);for(let a=Te;a<=dt+.5*Y;a+=Qt*Y)de.push(a);let Wt=document.createElementNS(p.namespaceURI,"line");Wt.setAttribute("x1",String(X)),Wt.setAttribute("y1",String(U)),Wt.setAttribute("x2",String(u-Z)),Wt.setAttribute("y2",String(U)),Wt.setAttribute("stroke","#111111"),p.appendChild(Wt);for(let a of de){let E=N(a),$=document.createElementNS(p.namespaceURI,"line");$.setAttribute("x1",String(E)),$.setAttribute("y1",String(U)),$.setAttribute("x2",String(E)),$.setAttribute("y2",String(W-rt)),$.setAttribute("stroke","#111111"),$.setAttribute("stroke-opacity","0.20"),$.setAttribute("stroke-dasharray","2,4"),p.appendChild($);let O=document.createElementNS(p.namespaceURI,"text");O.setAttribute("x",String(E)),O.setAttribute("y",String(U-4)),O.setAttribute("text-anchor","middle"),O.setAttribute("font-size","10"),O.setAttribute("fill","#111111"),O.textContent=Ut(new Date(a)),p.appendChild(O)}let pe=new Date;pe.setHours(0,0,0,0);let ne=pe.getTime();if(ne>=ut&&ne<=dt){let a=N(ne),E=document.createElementNS(p.namespaceURI,"line");E.setAttribute("x1",String(a)),E.setAttribute("y1",String(U)),E.setAttribute("x2",String(a)),E.setAttribute("y2",String(W-rt)),E.setAttribute("stroke","#4caf50"),E.setAttribute("stroke-width","2"),E.setAttribute("stroke-dasharray","4,2"),p.appendChild(E);let $=document.createElementNS(p.namespaceURI,"text");$.setAttribute("x",String(a+4)),$.setAttribute("y",String(U+12)),$.setAttribute("font-size","10"),$.setAttribute("fill","#4caf50"),$.textContent="hoje",p.appendChild($)}let Yt=v.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Yt.setAttr("title",V==="wide"?"Compactar nomes":"Expandir nomes"),Yt.style.left=`${X}px`,Yt.style.top="4px",Yt.addEventListener("click",a=>{a.preventDefault();let $=(t.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";t.dataset.ganttLabelMode=$,this.renderGantt(t,e,n,r)});let Le=["status","priority"],se=Array.isArray(s.tooltipFields)?s.tooltipFields.map(a=>String(a)):null,Ie=se&&se.length?se:Le,Kt=0,re=null;for(let a of k){let E=a.start,$=a.end,O=($.getTime()-E.getTime())/6e4,Nt=a.props,St=a.notePath,mt=a.noteTitle,Tt=(me=(ge=a.row.notes)==null?void 0:ge.length)!=null?me:0,ft=a.due,wt=a.estMinutes,At=[];At.push(`${Ut(E)} \u2192 ${Ut($)}`),typeof wt=="number"&&!Number.isNaN(wt)?At.push(`est: ${Math.round(wt)} min`):O>0&&At.push(`dura\xE7\xE3o: ${Math.round(O)} min`),ft instanceof Date&&At.push(`due: ${Ut(ft)}`);for(let st of Ie){let G=x(Nt,st);G!=null&&String(G).trim()!==""&&At.push(`${st}: ${String(G)}`)}let Lt=At.join("<br>"),Dt=st=>{var G;st.preventDefault(),h&&St?new le(St,e,r==null?void 0:r.refresh,r==null?void 0:r.reindexFile).open():zt(t,M,mt,wt!=null?wt:O,(G=a.row.notes)!=null?G:[],f)},yt=st=>{mt&&Lt&&$t(t,b,mt,Lt,Tt,st)},ct=()=>_t(b);if(a.groupKey!==re){re=a.groupKey;let st=U+8+Kt*P+P/2,G=c(re);tt(G,4,st,X-12,11,"600"),Kt+=1}let bt=U+8+Kt*P,Ht=P-10,Gt=N(E.getTime()),Et=N($.getTime()),Ot=Math.max(4,Et-Gt),ot=a.fullName,it=document.createElementNS(p.namespaceURI,"rect");it.setAttribute("x",String(Gt)),it.setAttribute("y",String(bt)),it.setAttribute("width",String(Ot)),it.setAttribute("height",String(Ht)),it.setAttribute("rx","3"),it.setAttribute("ry","3"),it.setAttribute("fill",gt((ye=a.row.series)!=null?ye:ot,Kt)),it.setAttribute("stroke","rgba(0,0,0,0.25)"),it.setAttribute("stroke-width","0.5"),it.style.cursor=h&&St?"pointer":"default",it.addEventListener("mouseenter",yt),it.addEventListener("mouseleave",ct),it.addEventListener("click",Dt),p.appendChild(it);let xe=bt+Ht/2;if(Ot>=6){let st=gt((be=a.row.series)!=null?be:ot,Kt),G=document.createElementNS(p.namespaceURI,"circle");G.setAttribute("cx",String(Gt)),G.setAttribute("cy",String(xe)),G.setAttribute("r","3.5"),G.setAttribute("fill","#ffffff"),G.setAttribute("stroke",st),G.setAttribute("stroke-width","1.5"),p.appendChild(G);let Ct=document.createElementNS(p.namespaceURI,"circle");Ct.setAttribute("cx",String(Et)),Ct.setAttribute("cy",String(xe)),Ct.setAttribute("r","3.5"),Ct.setAttribute("fill","#ffffff"),Ct.setAttribute("stroke",st),Ct.setAttribute("stroke-width","1.5"),p.appendChild(Ct)}let ve=bt+Ht/2+2,Vt=R?16:4;if(V==="wide")tt(ot,Vt,ve,X-Vt-4,11,null,yt,ct,Dt);else{let st=ot,G=Math.max(40,X-Vt-8),Se=Math.max(8,Math.floor(G/6));st.length>Se&&(st=st.slice(0,Se-1)+"\u2026");let xt=document.createElementNS(p.namespaceURI,"text");xt.setAttribute("x",String(Vt)),xt.setAttribute("y",String(ve)),xt.setAttribute("text-anchor","start"),xt.setAttribute("font-size","11"),xt.setAttribute("fill","#111111"),xt.textContent=st,xt.style.cursor="pointer",xt.addEventListener("mouseenter",yt),xt.addEventListener("mouseleave",ct),xt.addEventListener("click",Dt),p.appendChild(xt)}if(ft instanceof Date){let st=N(ft.getTime()),G=document.createElementNS(p.namespaceURI,"line");G.setAttribute("x1",String(st)),G.setAttribute("y1",String(bt)),G.setAttribute("x2",String(st)),G.setAttribute("y2",String(bt+Ht)),G.setAttribute("stroke","#ff6b6b"),G.setAttribute("stroke-width","2"),G.setAttribute("stroke-dasharray","4,2"),p.appendChild(G)}Kt+=1}if(h){let a=t.createDiv({cls:"prop-charts-empty"});a.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}},le=class extends vt.Modal{constructor(e,n,r,s){var f;super(app);this.notePath=e,this.spec=n,this.refresh=r,this.reindexFile=s;let o=(f=n.encoding)!=null?f:{};this.startKey=o.start,this.endKey=o.end,this.durationKey=o.duration,this.dueKey=o.due}async onOpen(){var C,S;let{contentEl:e}=this;e.empty();let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof vt.TFile)){e.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let r=await this.app.vault.read(n),s={},o=r,f=/^---\n([\s\S]*?)\n---\n?/m.exec(r);if(f){try{s=(C=(0,vt.parseYaml)(f[1]))!=null?C:{}}catch(l){s={}}o=r.slice(f[0].length)}(typeof s!="object"||s==null)&&(s={});let h=(S=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?S:this.notePath,c=e.createDiv({cls:"gantt-edit-header"}),d=c.createEl("a",{text:h,cls:"gantt-edit-title"});d.href="#",d.addEventListener("click",l=>{l.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let g=c.createDiv({cls:"gantt-edit-subtitle"});g.textContent=this.notePath;let R=e.createDiv({cls:"gantt-edit-form"}),A=l=>{let w=R.createDiv({cls:"gantt-edit-row"}),L=w.createDiv({cls:"gantt-edit-label"});L.textContent=l;let m=w.createDiv({cls:"gantt-edit-field"});return{row:w,field:m}},x=l=>{if(!l)return"";let L=String(l).match(/^(\d{4}-\d{2}-\d{2})/);return L?L[1]:""},D=l=>{if(l=l.trim(),!!l&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l},k=null;if(this.startKey){let{field:l}=A(this.startKey+" (in\xEDcio)");k=l.createEl("input",{type:"date"}),k.value=x(s[this.startKey])}let P=null;if(this.endKey){let{field:l}=A(this.endKey+" (fim)");P=l.createEl("input",{type:"date"}),P.value=x(s[this.endKey])}let _=null;if(this.durationKey){let{field:l}=A(this.durationKey+" (minutos)");_=l.createEl("input",{type:"number"});let w=s[this.durationKey];_.value=w!=null?String(w):"",_.min="0",_.step="5"}let z=null;if(this.dueKey){let{field:l}=A(this.dueKey+" (due)");z=l.createEl("input",{type:"date"}),z.value=x(s[this.dueKey])}let B=e.createDiv({cls:"gantt-edit-buttons"}),T=B.createEl("button",{text:"Salvar",cls:"mod-cta"});B.createEl("button",{text:"Cancelar"}).addEventListener("click",l=>{l.preventDefault(),this.close()}),T.addEventListener("click",async l=>{if(l.preventDefault(),this.startKey&&k){let m=D(k.value);m?s[this.startKey]=m:delete s[this.startKey]}if(this.endKey&&P){let m=D(P.value);m?s[this.endKey]=m:delete s[this.endKey]}if(this.durationKey&&_){let m=_.value.trim();if(m==="")delete s[this.durationKey];else{let y=Number(m);Number.isNaN(y)||(s[this.durationKey]=y)}}if(this.dueKey&&z){let m=D(z.value);m?s[this.dueKey]=m:delete s[this.dueKey]}let L=`---
${(0,vt.stringifyYaml)(s).trim()}
---
`+o;if(await this.app.vault.modify(n,L),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(m){}if(this.refresh)try{this.refresh()}catch(m){}new vt.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}},ue=class extends vt.Modal{constructor(e,n,r,s){super(app);this.size="large";this.spec=e,this.data=n,this.renderer=r,this.ctx=s}onOpen(){var h;let{contentEl:e}=this;e.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),e.addClass("chart-notes-zoom-modal"),this.applySize();let n=e.createDiv({cls:"chart-notes-zoom-header"}),r=(h=this.spec.options)!=null&&h.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";n.createEl("div",{text:r,cls:"chart-notes-zoom-title"});let s=n.createDiv({cls:"chart-notes-zoom-sizes"}),o=(c,d)=>{let g=s.createEl("button",{cls:"chart-notes-zoom-size-btn",text:c});(()=>{g.toggleClass("is-active",this.size===d)})(),g.addEventListener("click",A=>{A.preventDefault(),this.size=d,this.applySize(),s.querySelectorAll(".chart-notes-zoom-size-btn").forEach(D=>D.classList.remove("is-active")),g.classList.add("is-active")})};o("S","small"),o("M","medium"),o("L","large");let f=e.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(f,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let e=this.modalEl;if(!e)return;let n="95vw",r="85vh";switch(this.size){case"small":n="60vw",r="55vh";break;case"medium":n="80vw",r="70vh";break;case"large":default:n="95vw",r="85vh";break}e.style.maxWidth=n,e.style.width=n,e.style.height=r,e.style.maxHeight=r}};var ee=class extends kt.Plugin{constructor(e,n){super(e,n)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new Xt(this.app),await this.indexer.buildIndex(),this.query=new Zt(()=>this.indexer.getAll(),[]),this.renderer=new te,this.registerEvent(this.app.vault.on("modify",async e=>{e instanceof kt.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("create",async e=>{e instanceof kt.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("delete",async e=>{e instanceof kt.TFile&&this.indexer.removeFile(e)})),this.registerMarkdownCodeBlockProcessor("chart",async(e,n,r)=>{var d;let s;try{let g=(0,kt.parseYaml)(e);if(!g||typeof g!="object"){n.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}s=g}catch(g){n.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+g.message});return}if(!s.type){n.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let o=s.type==="gantt",f=s.type==="table";if(!o&&!f){if(!s.encoding||!s.encoding.x){n.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let R=((d=s.aggregate)==null?void 0:d.y)==="count";if(!s.encoding.y&&!R){n.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}s.encoding||(s.encoding={}),s.source||(s.source={});let c;try{c=this.query.run(s)}catch(g){n.createEl("div",{text:"Chart Notes: erro na query: "+g.message});return}this.renderer.render(n,s,c)})}onunload(){console.log("unloading Chart Notes plugin")}};
