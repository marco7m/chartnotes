/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var be=Object.defineProperty;var fn=Object.getOwnPropertyDescriptor;var hn=Object.getOwnPropertyNames;var gn=Object.prototype.hasOwnProperty;var yn=(s,r)=>{for(var t in r)be(s,t,{get:r[t],enumerable:!0})},bn=(s,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let e of hn(r))!gn.call(s,e)&&e!==t&&be(s,e,{get:()=>r[e],enumerable:!(n=fn(r,e))||n.enumerable});return s};var xn=s=>bn(be({},"__esModule",{value:!0}),s);var qn={};yn(qn,{default:()=>ye});module.exports=xn(qn);var Zt=require("obsidian");var de=require("obsidian");function Oe(s,r){if(!r||r.length===0)return!0;for(let t of r){if(t===".")return!0;let n=t.endsWith("/")?t:t+"/";if(s===t||s.startsWith(n))return!0}return!1}function He(s,r){if(!r||r.length===0)return!0;let t=s.tags;if(!t)return!1;if(Array.isArray(t)){for(let e of r)if(t.includes(e)||t.includes("#"+e))return!0;return!1}let n=String(t);for(let e of r)if(n===e||n==="#"+e)return!0;return!1}function ce(s){return typeof s!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(s)}function Rt(s){if(s instanceof Date&&!isNaN(s.getTime()))return s;if(typeof s!="string")return null;let r=s.trim(),t=r.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(t){let e=Number(t[1]),o=Number(t[2])-1,i=Number(t[3]),u=t[4]?Number(t[4]):0,a=t[5]?Number(t[5]):0,c=t[6]?Number(t[6]):0;return Number.isNaN(e)||Number.isNaN(o)||Number.isNaN(i)||Number.isNaN(u)||Number.isNaN(a)||Number.isNaN(c)?null:new Date(e,o,i,u,a,c,0)}let n=new Date(r);return isNaN(n.getTime())?null:n}function ft(s){let r=new Date(s);return r.setHours(0,0,0,0),r}function ae(s,r){let t=new Date(s);return t.setDate(t.getDate()-r),t}function Sn(s,r){return ae(s,r*7)}function wn(s,r){let t=new Date(s);return t.setMonth(t.getMonth()-r),t}function Se(s,r){let t=new Date(s);return t.setDate(t.getDate()+r),t}function vn(s,r){return Se(s,r*7)}function Dn(s,r){let t=new Date(s);return t.setMonth(t.getMonth()+r),t}function $e(s){let r=s.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(r)||r.endsWith("date")||r.endsWith("at")||r.endsWith("on"))}function Ve(s,r){let t=r?new Date(r):new Date,n=ft(t),e=s.trim().toLowerCase();if(e==="today")return n;if(e==="yesterday")return ft(ae(n,1));if(/^-\d+$/.test(e)){let o=parseInt(e.slice(1),10);return ft(ae(n,o))}if(/^-\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(ae(n,o))}if(/^-\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(Sn(n,o))}if(/^-\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(wn(n,o))}if(/^\+\d+$/.test(e)){let o=parseInt(e.slice(1),10);return ft(Se(n,o))}if(/^\+\d+d$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(Se(n,o))}if(/^\+\d+w$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(vn(n,o))}if(/^\+\d+m$/.test(e)){let o=parseInt(e.slice(1,-1),10);return ft(Dn(n,o))}return null}function Ge(s){let r=s.trim(),t=r.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(t){let p=t[1].trim(),y=t[2].trim(),h=t[3].trim(),l=$e(p),f=xe(y,l),g=xe(h,l),d=f.valueType==="date"||g.valueType==="date"?"date":f.valueType;return{field:p,op:"between",value:f.value,value2:g.value,valueType:d}}let n=/(==|!=|>=|<=|>|<)/,e=r.split(n);if(e.length!==3)throw new Error(`Invalid WHERE expression: ${s}`);let o=e[0].trim(),i=e[1].trim(),u=e[2].trim(),a=$e(o),c=xe(u,a);return{field:o,op:i,value:c.value,valueType:c.valueType}}function xe(s,r){let t=s.trim();if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return{value:t.slice(1,-1),valueType:"string"};let n=t.toLowerCase(),e=n==="today"||n==="yesterday"||n.startsWith("-")||n.startsWith("+");if(r){if(t==="0"||n==="today")return{value:ft(new Date),valueType:"date"};let i=Ve(t);if(i)return{value:i,valueType:"date"}}else if(e){let i=Ve(t);if(i)return{value:i,valueType:"date"}}if(ce(t)){let i=Rt(t);if(i)return{value:i,valueType:"date"}}let o=Number(t);return Number.isNaN(o)?{value:t,valueType:"string"}:{value:o,valueType:"number"}}function Be(s,r){let t=s[r.field];if(t==null)return!1;if(r.valueType==="date"){let o=t instanceof Date?ft(t):ce(t)?ft(Rt(t)):null;if(!o)return!1;let i=r.value instanceof Date?r.value:null,u=r.value2 instanceof Date?r.value2:null;if(!i)return!1;let a=o.getTime(),c=ft(i).getTime();switch(r.op){case"==":return a===c;case"!=":return a!==c;case">":return a>c;case">=":return a>=c;case"<":return a<c;case"<=":return a<=c;case"between":if(!u)return!1;let p=ft(u).getTime();return a>=c&&a<=p}}if(r.valueType==="number"){let o=Number(t);if(isNaN(o))return!1;let i=Number(r.value);switch(r.op){case"==":return o===i;case"!=":return o!==i;case">":return o>i;case">=":return o>=i;case"<":return o<i;case"<=":return o<=i;case"between":return typeof r.value2!="number"?!1:o>=i&&o<=r.value2}}let n=String(t),e=String(r.value);switch(r.op){case"==":return n===e;case"!=":return n!==e;case">":return n>e;case">=":return n>=e;case"<":return n<e;case"<=":return n<=e;case"between":return!1}return!1}var we="chartnotes-view",An=["bar","stacked-bar","line","stacked-area","pie","scatter","gantt","metric"],Nn=["sum","count","cumulative-sum"];var le="(missing)",En="__no_series__",Tn=60,Qe=6e4;function Rn(s){let r=String(s!=null?s:"bar").trim().toLowerCase();return An.includes(r)?r:"bar"}function Cn(s){let r=String(s!=null?s:"sum").trim().toLowerCase();return Nn.includes(r)?r:"sum"}var ue=class extends de.BasesView{constructor(t,n,e){super(t);this.type=we;this.renderer=e,this.rootEl=n.createDiv("chartnotes-bases-view")}onDataUpdated(){var W,Q,P,G,m,R,M,O,I,z,U,j;this.rootEl.empty();let t=this.data,n=(W=t==null?void 0:t.groupedData)!=null?W:[];if(!n.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No data in this view."});return}let e=this.config,o=Rn((Q=e==null?void 0:e.get("chartType"))!=null?Q:"bar"),i=o==="pie",u=o==="scatter",a=o==="gantt",c=o==="metric",p=Cn(e==null?void 0:e.get("aggregateMode")),h=p==="cumulative-sum"&&!(o==="line"||o==="stacked-area")?"sum":p,l=i||u||a?"none":"auto",f=this.getPropFromConfig("xProperty"),g=this.getPropFromConfig("ganttLabelProperty"),d=this.getPropFromConfig("yProperty"),D=this.getPropFromConfig("seriesProperty");i&&(D={id:null,name:null});let S=this.getPropFromConfig("startProperty"),A=this.getPropFromConfig("endProperty"),v=this.getPropFromConfig("dueProperty"),k=this.getPropFromConfig("durationProperty"),H=this.getPropFromConfig("groupProperty");if(!a&&!c&&!f.id){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Configure the 'X axis / category' property in view options."});return}if(u&&(!f.id||!d.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Scatter plots need both X and Y numeric properties."});return}if(a&&!(S.id||A.id||v.id)){this.rootEl.createDiv({cls:"prop-charts-empty",text:"Gantt needs Start/End or Due with Duration."});return}let T=a&&g.id?g:a?f:{id:null,name:null},E;if(c){let K=this.getPropFromConfig("metricProperty"),q=String((P=e==null?void 0:e.get("metricDataType"))!=null?P:"number"),nt;q==="date"?nt=String((G=e==null?void 0:e.get("metricDateOperation"))!=null?G:"countNonEmpty"):nt=String((m=e==null?void 0:e.get("metricOperation"))!=null?m:"countAll"),E=this.buildRowsForMetric(n,K,nt,q,e)}else if(a)E=this.buildRowsForGantt(n,T,D,S,A,v,k,H);else if(u)E=this.buildRowsForScatter(n,f,d,D);else{let K=i;E=this.buildRowsForAggregatedCharts(n,f,d,D,h,l,K)}if(!E.length){this.rootEl.createDiv({cls:"prop-charts-empty",text:"No rows to display (check X/Y/aggregation)."});return}let x={rows:E},b=((R=e==null?void 0:e.get("title"))!=null?R:"").trim()||(e==null?void 0:e.name)||"Chart Notes (Bases)",L=e==null?void 0:e.get("drilldown"),C=typeof L=="boolean"?L:!0,_=this.buildEncoding({x:f,y:d,series:D,start:S,end:A,due:v,duration:k,group:H,label:T,aggMode:h,chartType:o}),F={title:b,drilldown:C};c&&(F.metricLabel=(M=e==null?void 0:e.get("metricLabel"))!=null?M:"",F.metricLabelPosition=(O=e==null?void 0:e.get("metricLabelPosition"))!=null?O:"above",F.metricDecimals=(I=e==null?void 0:e.get("metricDecimals"))!=null?I:"0",F.metricPrefix=(z=e==null?void 0:e.get("metricPrefix"))!=null?z:"",F.metricSuffix=(U=e==null?void 0:e.get("metricSuffix"))!=null?U:"",F.metricColor=(j=e==null?void 0:e.get("metricColor"))!=null?j:"auto");let V={type:o,source:{type:"properties",query:""},encoding:_,options:F},$={refresh:()=>this.onDataUpdated()};this.renderer.render(this.rootEl,V,x,$)}getPropFromConfig(t){var u,a;let n=this.config,e=(u=n==null?void 0:n.get)==null?void 0:u.call(n,t);if(!e)return{id:null,name:null};let o=e.trim();if(!o||o==="undefined"||o==="null")return{id:null,name:null};let i=o;try{let c=(0,de.parsePropertyId)(i);return{id:i,name:(a=c.name)!=null?a:i}}catch(c){return{id:i,name:i}}}readValue(t,n){if(!n.id)return null;let e;try{e=t.getValue(n.id)}catch(o){return null}if(!e)return null;try{if(typeof e.isEmpty=="function"&&e.isEmpty())return null}catch(o){}try{let o=e.toString();if(o==null)return null;let i=String(o).trim();return i.length?i:null}catch(o){return null}}parseDate(t){if(!t)return null;let n=new Date(t.trim());return Number.isNaN(n.getTime())?null:n}compareX(t,n){let e=this.parseDate(t!=null?String(t):null),o=this.parseDate(n!=null?String(n):null);if(e&&o)return e.getTime()-o.getTime();let i=Number(t),u=Number(n);return!Number.isNaN(i)&&!Number.isNaN(u)?i-u:String(t!=null?t:"").localeCompare(String(n!=null?n:""))}fmtDate(t){let n=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${n}-${e}-${o}`}startOfWeek(t){let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e=(n.getDay()+6)%7;return n.setDate(n.getDate()-e),n.setHours(0,0,0,0),n}bucketX(t,n){let e=this.parseDate(t);if(!e)return t;switch(n){case"none":return t;case"auto":case"day":return this.fmtDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()));case"week":{let o=this.startOfWeek(e);return`${this.fmtDate(o)} (W)`}case"month":{let o=String(e.getMonth()+1).padStart(2,"0");return`${e.getFullYear()}-${o}`}case"quarter":{let o=Math.floor(e.getMonth()/3)+1;return`${e.getFullYear()}-Q${o}`}case"year":return`${e.getFullYear()}`;default:return t}}getXValuesForEntry(t,n,e,o){var p,y;let i=[],u=h=>this.bucketX(h,e);if(!n.id){let h=t.file,l=h!=null&&h.name?String(h.name):String((p=h==null?void 0:h.path)!=null?p:le);return i.push(u(l)),i}if(!o){let h=(y=this.readValue(t,n))!=null?y:le;return i.push(u(h)),i}let a=null;try{a=t.getValue(n.id)}catch(h){a=null}let c=h=>{if(!h)return;let l=String(h).trim();l&&i.push(u(l))};if(a==null)c(le);else if(typeof a=="string"){let h=a.trim();if(h){let l=h.split(/\s+/);for(let f of l)c(f)}}else if(Array.isArray(a))for(let h of a){if(h==null)continue;let l;try{l=h.toString()}catch(f){continue}c(l)}else if(typeof a.toArray=="function"){let h=a.toArray();if(Array.isArray(h))for(let l of h){if(l==null)continue;let f;try{f=l.toString()}catch(g){continue}c(f)}else{let l;try{l=a.toString()}catch(f){l=""}c(l)}}else{let h;try{h=a.toString()}catch(l){h=""}c(h)}return i.length||c(le),i}buildRowsForAggregatedCharts(t,n,e,o,i,u,a){let c=new Map,p=a||i==="count"||!e.id&&i!=="sum",y=e.name||"y";for(let l of t)for(let f of l.entries){let g=f.file,d=this.getXValuesForEntry(f,n,u,a),D=1,S=null;if(!p&&e.id){if(S=this.readValue(f,e),S==null)continue;let k=Number(S);if(Number.isNaN(k))continue;D=k}else D=1;let A=this.readValue(f,o),v=A!=null?String(A):void 0;for(let k of d){let H=`${k}@@${v!=null?v:""}`,T=c.get(H);T||(T={x:k,y:0,series:v,notes:[],props:{}},c.set(H,T)),T.y+=D,g!=null&&g.path&&T.notes.push(g.path),T.props&&n.name&&(T.props[n.name]=k),!p&&T.props&&y&&S!=null&&(T.props[y]=T.y),p&&T.props&&(T.props[y]=T.y),T.props&&o.name&&A!=null&&(T.props[o.name]=A)}}let h=Array.from(c.values());return i==="cumulative-sum"?this.toCumulative(h):h}toCumulative(t){var o,i;let n=new Map;for(let u of t){let a=(o=u.series)!=null?o:En,c=n.get(a);c||(c=[],n.set(a,c)),c.push(u)}let e=[];for(let[,u]of n){let a=[...u].sort((p,y)=>this.compareX(p.x,y.x)),c=0;for(let p of a){let y=Number((i=p.y)!=null?i:0);Number.isNaN(y)||(c+=y,e.push({...p,y:c}))}}return e.sort((u,a)=>this.compareX(u.x,a.x)),e}detectMetricPropertyType(t,n){if(!n.id)return"text";let e=[],o=20,i=0;for(let c of t){if(i>=o)break;for(let p of c.entries){if(i>=o)break;let y=this.readValue(p,n);if(y==null)continue;let h=y.trim(),l=/^\d{4}-\d{2}-\d{2}/.test(h),f=!1;l&&(f=Rt(y)!==null);let g=Number(h),d=!Number.isNaN(g)&&Number.isFinite(g)&&(!l||!f);e.push({isNumber:d,isDate:f}),i++}}if(e.length===0)return"text";let u=0,a=0;for(let c of e)c.isNumber&&u++,c.isDate&&a++;return u>a&&u>0?"number":a>u&&a>0?"date":u>0?"number":a>0?"date":"text"}getValidOperationsForType(t,n){if(!n)return["countAll"];switch(t){case"number":return["countAll","countNonEmpty","sum","avg","min","max"];case"date":return["countAll","countNonEmpty","oldest","newest","dateRange"];case"text":return["countAll","countNonEmpty"];default:return["countAll","countNonEmpty"]}}getDefaultOperationForType(t,n){if(!n)return"countAll";switch(t){case"number":case"text":return"countNonEmpty";case"date":return"countNonEmpty";default:return"countAll"}}buildRowsForMetric(t,n,e,o,i){let u=[],a=[],c=!!n.id;for(let g of t)for(let d of g.entries){let D=d.file;if(D!=null&&D.path&&u.push(D.path),!n.id)continue;let S=this.readValue(d,n);if(S==null)continue;let A=S.trim(),v=/^\d{4}-\d{2}-\d{2}/.test(A),k=!1,H=null;v&&(H=Rt(S),k=H!==null);let T=Number(A),E=!Number.isNaN(T)&&Number.isFinite(T)&&(!v||!k);a.push({value:S,isNumber:E,isDate:k,parsedNumber:E?T:null,parsedDate:H})}let p=o,y=this.getValidOperationsForType(p,c),h=e;if(!y.includes(e)&&(h=this.getDefaultOperationForType(p,c),i&&p==="text"&&(e==="sum"||e==="avg"||e==="min"||e==="max")))try{i.set("metricOperation",h)}catch(g){}let l=0,f=null;if(h==="countAll")l=u.length;else if(!c)f="Operation requires a property to be selected",l=0;else if(h==="countNonEmpty")l=a.length;else if(p==="number")if(h==="dateRange"||h==="oldest"||h==="newest")f="Operation incompatible with data type",l=0;else{let g=a.map(d=>d.parsedNumber).filter(d=>d!==null);if(g.length===0)l=0;else switch(h){case"sum":l=g.reduce((d,D)=>d+D,0);break;case"avg":l=g.reduce((d,D)=>d+D,0)/g.length;break;case"min":l=Math.min(...g);break;case"max":l=Math.max(...g);break;default:f="Operation incompatible with data type",l=0}}else if(p==="date"){let g=a.map(d=>d.parsedDate).filter(d=>d!==null);if(g.length===0)l=0;else switch(h){case"oldest":l=new Date(Math.min(...g.map(d=>d.getTime())));break;case"newest":l=new Date(Math.max(...g.map(d=>d.getTime())));break;case"dateRange":{let d=new Date(Math.min(...g.map(v=>v.getTime()))),S=new Date(Math.max(...g.map(v=>v.getTime()))).getTime()-d.getTime();l=Math.round(S/(1e3*60*60*24));break}default:f="Operation incompatible with data type",l=0}}else h==="countNonEmpty"?l=a.length:(f="Operation incompatible with data type",l=0);return[{x:l instanceof Date?l.toISOString().slice(0,10):String(l),y:l instanceof Date?l.getTime():typeof l=="number"?l:0,notes:u,props:{_metricValue:l,_metricError:f,_metricDataType:p,_metricOperation:h,_metricOriginalOperation:e}}]}buildRowsForScatter(t,n,e,o){let i=[];for(let u of t)for(let a of u.entries){let c=a.file,p=this.readValue(a,n),y=this.readValue(a,e);if(p==null||y==null)continue;let h=Number(p),l=Number(y);if(Number.isNaN(h)||Number.isNaN(l))continue;let f=this.readValue(a,o),g=f!=null?String(f):void 0;i.push({x:h,y:l,series:g,notes:c!=null&&c.path?[c.path]:[],props:{}})}return i}buildRowsForGantt(t,n,e,o,i,u,a,c){var g;let p=[],y=Tn*Qe,h=d=>{let D=[d==null?void 0:d.label,d==null?void 0:d.name,d==null?void 0:d.value,d==null?void 0:d.key,d==null?void 0:d.group,d==null?void 0:d.groupLabel];for(let S of D)if(S!=null&&String(S).trim()!=="")return String(S);return""},l=n;try{let d=this.getPropFromConfig("ganttLabelProperty");d&&d.id&&(l=d)}catch(d){}let f=!!c.id;for(let d of t){let D=h(d);for(let S of(g=d.entries)!=null?g:[]){let A=S.file,v=this.readValue(S,o),k=this.readValue(S,i),H=this.readValue(S,u),T=this.readValue(S,a),E=T!=null?Number(T):NaN,x=Number.isFinite(E)&&E>0,N=x?E*Qe:y,b=this.parseDate(v),L=this.parseDate(k),C=this.parseDate(H),_=b,F=L;if(_&&!F&&(F=new Date(_.getTime()+N)),!_&&F&&(_=new Date(F.getTime()-N)),!_&&!F&&C&&(x?(F=C,_=new Date(C.getTime()-N)):(_=C,F=new Date(C.getTime()+y))),!_||!F)continue;if(_.getTime()>F.getTime()){let G=_;_=F,F=G}let V=this.readValue(S,l);(V==null||String(V).trim()==="")&&(A!=null&&A.name?V=String(A.name).replace(/\.md$/i,""):A!=null&&A.path?V=String(A.path):V="(no title)");let $=this.readValue(S,e),W=$!=null?String($):void 0,Q={};if(D&&(Q.__basesGroup=D),f){let G=this.readValue(S,c);G!=null&&c.name&&(Q[c.name]=G)}l.name&&(Q[l.name]=V),Q.label=V,o.name&&v!=null&&(Q[o.name]=v),i.name&&k!=null&&(Q[i.name]=k),u.name&&H!=null&&(Q[u.name]=H),x&&a.name&&(Q[a.name]=E);let P=A==null?void 0:A.path;p.push({x:V,y:0,series:W,start:_,end:F,due:C!=null?C:void 0,notes:P?[P]:[],props:Q})}}return p.sort((d,D)=>!d.start||!D.start?0:d.start.getTime()-D.start.getTime()),p}buildEncoding(t){var u,a,c,p,y,h,l,f,g,d,D;let n=(u=t.x.name)!=null?u:"x",e=(a=t.y.name)!=null?a:"y",o=(y=(p=(c=t.label.name)!=null?c:t.x.name)!=null?p:t.group.name)!=null?y:"label",i=t.chartType==="gantt"?"__basesGroup":(h=t.group.name)!=null?h:"group";return{x:n,y:e,series:(l=t.series.name)!=null?l:"series",start:(f=t.start.name)!=null?f:"start",end:(g=t.end.name)!=null?g:"end",due:(d=t.due.name)!=null?d:"due",duration:(D=t.duration.name)!=null?D:"duration",group:i,label:o}}};var Ke=require("obsidian"),pe=class{constructor(r){this.index=new Map;this.app=r}async buildIndex(){this.index.clear();let r=this.app.vault.getMarkdownFiles();for(let t of r)await this.updateFile(t)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(r){if(r.extension!=="md")return;let t={};try{let e=(await this.app.vault.read(r)).match(/^---\n([\s\S]*?)\n---\n?/);if(e){let i=(0,Ke.parseYaml)(e[1])||{};if(i&&typeof i=="object")for(let[u,a]of Object.entries(i))u!=="position"&&(t[u]=a)}let o=this.app.metadataCache.getFileCache(r);o!=null&&o.tags&&!t.tags&&(t.tags=o.tags.map(i=>i.tag.replace(/^#/,"")))}catch(n){console.error("Chart Notes: erro ao indexar",r.path,n)}this.index.set(r.path,{path:r.path,props:t})}removeFile(r){this.index.delete(r.path)}};var Ye="__no_series__",kn="||",Mn=6e4;function Pn(s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))return{key:s.slice(0,10),isDate:!0};if(ce(s)){let r=Rt(s);if(r)return{key:r,isDate:!0}}return{key:s,isDate:!1}}function Ln(s,r){let t=s.x,n=r.x;if(t instanceof Date&&n instanceof Date)return t.getTime()-n.getTime();let e=String(t),o=String(n);return e<o?-1:e>o?1:0}function In(s,r){var o,i;let t=Ln(s,r);if(t!==0)return t;let n=(o=s.series)!=null?o:"",e=(i=r.series)!=null?i:"";return n<e?-1:n>e?1:0}function _n(s){if(s==null)return 0;if(typeof s=="number")return s>0?Math.floor(s):0;if(typeof s=="string"){let r=s.trim().match(/^(\d+)/);if(r){let t=Number(r[1]);return Number.isFinite(t)&&t>0?Math.floor(t):0}}throw new Error(`Invalid aggregate.rolling: ${String(s)}`)}function Fn(s){var n,e;let r=new Map,t=[];for(let o of s){let i=(n=o.series)!=null?n:Ye,a=((e=r.get(i))!=null?e:0)+o.y;r.set(i,a),t.push({...o,y:a})}return t}function $n(s,r){var i,u;let t=_n(r);if(!t||t<=1)return[...s];let n=new Map,e=new Map,o=[];for(let a of s){let c=(i=a.series)!=null?i:Ye,p=n.get(c);p||(p=[],n.set(c,p));let y=(u=e.get(c))!=null?u:0;if(p.push(a.y),y+=a.y,p.length>t){let f=p.shift();y-=f}e.set(c,y);let h=p.length||1,l=y/h;o.push({...a,y:l})}return o}var me=class{constructor(r,t){this.getIndex=r,this.defaultPaths=t}run(r){var i,u,a;let t=this.getIndex(),n=(i=r.source)!=null&&i.paths&&r.source.paths.length?r.source.paths:this.defaultPaths,e=(u=r.source)!=null&&u.tags&&r.source.tags.length?r.source.tags:[],o=[];for(let c of t){let p=n&&n.length?Oe(c.path,n):!0,y=e&&e.length?He(c.props,e):!0;if(!p||!y)continue;let h=!0;if((a=r.source)!=null&&a.where&&r.source.where.length>0)for(let l of r.source.where){let f;try{f=Ge(l)}catch(g){throw new Error(`Invalid condition: ${l} (${g.message})`)}if(!Be(c.props,f)){h=!1;break}}h&&o.push(c)}return r.type==="gantt"?this.runGantt(r,o):r.type==="table"?this.runTable(r,o):this.runStandard(r,o)}runTable(r,t){var e,o;return{rows:t.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(e=r.encoding)==null?void 0:e.x,yField:(o=r.encoding)==null?void 0:o.y}}runGantt(r,t){var y,h,l;let n=(y=r.encoding)!=null?y:{},e=n.start,o=n.end,i=(h=n.label)!=null?h:n.x,u=n.series,a=n.duration,c=n.due,p=[];for(let f of t){let g=(l=f.props)!=null?l:{},d=T=>Array.isArray(T)?T[0]:T,D=null;if(o){let T=d(g[o]),E=Rt(T);E&&(D=E)}if(!D)continue;let S=null;if(e){let T=d(g[e]),E=Rt(T);E&&(S=E)}if(!S&&a){let T=d(g[a]),E=Number(T);Number.isNaN(E)||(S=new Date(D.getTime()-E*Mn))}S||(S=new Date(D.getTime()));let A;if(c){let T=d(g[c]),E=Rt(T);E&&(A=E)}let v;if(i){let T=d(g[i]);(T==null||T==="")&&(T=f.path),v=T}else v=f.path;let k;if(u){let T=d(g[u]);T!=null&&(k=String(T))}let H={x:v,y:0,notes:[f.path],series:k,start:S,end:D,props:g};A&&(H.due=A),p.push(H)}return p.sort((f,g)=>{let d=f.start?f.start.getTime():0,D=g.start?g.start.getTime():0;return d-D}),{rows:p,xField:i,yField:o}}runStandard(r,t){var f,g,d,D,S,A,v,k,H,T;let n=(f=r.encoding)==null?void 0:f.x,e=(g=r.encoding)==null?void 0:g.y,o=(d=r.encoding)==null?void 0:d.series;if(!n)throw new Error("encoding.x is required.");let i=(D=r.aggregate)!=null?D:{},u=(S=i.y)!=null?S:null,a=!!i.cumulative,c=i.rolling;if(!e&&u!=="count")throw new Error("encoding.y is required (except when aggregate.y = 'count').");let p=[];for(let E of t){let x=(A=E.props)!=null?A:{},N=$=>Array.isArray($)?$[0]:$,b=N(x[n]);if(b==null)continue;let L=Pn(b),C=L.key,_=L.isDate,F;if(o){let $=N(x[o]);$!=null&&String($).trim()!==""&&(F=String($))}let V;if(u==="count")V=1;else{let $=N(x[e]);if($==null)continue;let W=Number($);if(Number.isNaN(W))continue;V=W}p.push({x:C,y:V,notes:[E.path],series:F,props:x,_isDate:_,_origX:b})}if(p.length===0)return{rows:[],xField:n,yField:e};let y=[];if(u){let E=new Map;for(let x of p){let N=(v=x.series)!=null?v:"",b=x.x instanceof Date?x.x.toISOString().slice(0,10):String(x.x),L=N+kn+b,C=(k=E.get(L))!=null?k:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:x.x,isDate:x._isDate,series:x.series,props:x.props};C.sum+=x.y,C.count+=1,x.y<C.min&&(C.min=x.y),x.y>C.max&&(C.max=x.y),C.notes.push(...x.notes),C.props=(H=x.props)!=null?H:C.props,E.set(L,C)}for(let[,x]of E){let N=x.sum;switch(u){case"sum":N=x.sum;break;case"avg":N=x.sum/x.count;break;case"min":N=x.min;break;case"max":N=x.max;break;case"count":N=x.count;break}y.push({x:x.xRep,y:N,notes:x.notes,series:x.series,props:x.props})}}else y=p.map(E=>({x:E.x,y:E.y,notes:E.notes,series:E.series,props:E.props}));if(y.length===0)return{rows:[],xField:n,yField:e};let h=((T=r.sort)==null?void 0:T.x)==="desc"?"desc":"asc";if(y.sort((E,x)=>{let N=In(E,x);return h==="asc"?N:-N}),(a||c)&&!(r.type==="line"||r.type==="stacked-area"))throw new Error("aggregate.cumulative / aggregate.rolling are only supported for type: 'line' or 'stacked-area'.");if(a&&c)throw new Error("It is not yet possible to use 'cumulative' and 'rolling' together in the same chart.");let l=y;return c?l=$n(y,c):a&&(l=Fn(y)),{rows:l,xField:n,yField:e}}};var Ct=require("obsidian");var Ue=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function ut(s,r){if(!s)return"var(--text-accent, #5b6cff)";let t=Array.from(s).reduce((n,e)=>n*33+e.charCodeAt(0)>>>0,0);return Ue[t%Ue.length]}function St(s,r){s.addClass("prop-charts-container"),s.style.width="100%",s.style.maxWidth="100%",s.style.position="relative";let t=s.createDiv({cls:"chart-notes-scroll"});t.style.overflowX="auto",t.style.overflowY="hidden",t.style.width="100%",t.style.maxWidth="100%";let n=t.createDiv({cls:"chart-notes-inner"});n.style.display="block",n.style.minHeight=`${300}px`,r&&(n.style.background=r);let e="http://www.w3.org/2000/svg",o=document.createElementNS(e,"svg");o.setAttribute("width","100%"),o.setAttribute("height",String(300)),o.style.display="block",n.appendChild(o);let i=s.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let u=s.createDiv({cls:"chart-notes-details"});return u.style.display="none",{scroll:t,inner:n,svg:o,tooltip:i,details:u}}function yt(s,r,t,n,e,o){let i=s.getBoundingClientRect(),u=typeof n=="number"?Number.isInteger(n)?String(n):n.toFixed(2):String(n);r.innerHTML=`
    <div class="chart-notes-tooltip-title">${t}</div>
    <div class="chart-notes-tooltip-value">${u}</div>
    <div class="chart-notes-tooltip-notes">${e} nota${e===1?"":"s"}</div>
  `,r.style.display="block";let a=r.getBoundingClientRect(),c=o.clientX-i.left+6,p=o.clientY-i.top+6;c+a.width>i.width-4&&(c=i.width-a.width-4),c<4&&(c=4),p+a.height>i.height-4&&(p=i.height-a.height-4),p<4&&(p=4),r.style.left=c+"px",r.style.top=p+"px"}function bt(s){s.style.display="none"}function pt(s,r,t,n,e,o){if(!o)return;if(r.empty(),!e||e.length===0){r.style.display="none";return}r.style.display="block";let i=r.createEl("div",{cls:"chart-notes-details-header"}),u=i.createEl("div",{cls:"chart-notes-details-title"});u.textContent=`Notas em "${t}" (${e.length})`+(Number.isFinite(n)&&n!==0?` \u2013 valor ${Number.isInteger(n)?n:n.toFixed(2)}`:"");let a=i.createEl("button",{cls:"chart-notes-details-close"});a.textContent="\xD7",a.addEventListener("click",()=>{r.style.display="none"});let c=r.createEl("ul",{cls:"chart-notes-details-list"});for(let p of e){let h=c.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:p});h.href="#",h.addEventListener("click",l=>{l.preventDefault(),app.workspace.openLinkText(p,"",!1)})}}function Vt(s){if(!(s instanceof Date)||isNaN(s.getTime()))return"";let r=s.getUTCDate().toString().padStart(2,"0"),t=(s.getUTCMonth()+1).toString().padStart(2,"0");return`${r}/${t}`}function We(s){if(!s)return!1;let r=s.trim().toLowerCase();if(r==="#fff"||r==="#ffffff"||r==="white")return!0;if(!r.startsWith("#"))return!1;let t,n,e;if(r.length===4)t=parseInt(r[1]+r[1],16),n=parseInt(r[2]+r[2],16),e=parseInt(r[3]+r[3],16);else if(r.length===7)t=parseInt(r.slice(1,3),16),n=parseInt(r.slice(3,5),16),e=parseInt(r.slice(5,7),16);else return!1;return(.2126*t+.7152*n+.0722*e)/255>.7}var ve=class extends Ct.Modal{constructor(t,n,e,o){var u;super(app);this.notePath=t,this.spec=n,this.refresh=e,this.reindexFile=o;let i=(u=n.encoding)!=null?u:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var T,E;let{contentEl:t}=this;t.empty(),this.titleEl.setText("Edit task");let n=this.app.vault.getAbstractFileByPath(this.notePath);if(!(n instanceof Ct.TFile)){t.createEl("p",{text:"File not found: "+this.notePath});return}this.titleEl.setText(`Edit task \u2013 ${n.basename}`);let e=await this.app.vault.read(n),o={},i=e,u=e.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);if(u){try{o=(T=(0,Ct.parseYaml)(u[1]))!=null?T:{}}catch(x){o={}}i=(E=u[2])!=null?E:""}let a=t.createDiv({cls:"gantt-edit-form"}),c=x=>{let N=a.createDiv({cls:"gantt-edit-row"}),b=N.createDiv({cls:"gantt-edit-label"});b.textContent=x;let L=N.createDiv({cls:"gantt-edit-field"});return{row:N,field:L}},p=x=>{if(!x)return null;if(x instanceof Date&&!isNaN(x.getTime()))return x;let b=String(x).trim().match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!b)return null;let L=Number(b[1]),C=Number(b[2])-1,_=Number(b[3]),F=b[4]?Number(b[4]):0,V=b[5]?Number(b[5]):0,$=b[6]?Number(b[6]):0;return Number.isNaN(L)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(F)||Number.isNaN(V)||Number.isNaN($)?null:new Date(L,C,_,F,V,$,0)},y=x=>{let N=p(x);if(!N)return"";let b=$=>$.toString().padStart(2,"0"),L=N.getFullYear(),C=b(N.getMonth()+1),_=b(N.getDate()),F=b(N.getHours()),V=b(N.getMinutes());return`${L}-${C}-${_}T${F}:${V}`},h=x=>{if(x=x.trim(),!x)return;let N=x.match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2}))?$/);if(!N)return;let b=`${N[1]}-${N[2]}-${N[3]}`;if(N[4]){let L=N[4],C=N[5];return`${b}T${L}:${C}`}return b},l=null,f=null,g=null,d=null;if(this.startKey){let{field:x}=c(`In\xEDcio (${this.startKey})`);l=x.createEl("input"),l.type="datetime-local",l.value=y(o[this.startKey])}if(this.endKey){let{field:x}=c(`Fim (${this.endKey})`);f=x.createEl("input"),f.type="datetime-local",f.value=y(o[this.endKey])}if(this.durationKey){let{field:x}=c(`Dura\xE7\xE3o (min) (${this.durationKey})`);g=x.createEl("input"),g.type="number";let N=o[this.durationKey];g.value=typeof N=="number"&&!Number.isNaN(N)?String(N):""}if(this.dueKey){let{field:x}=c(`Due (${this.dueKey})`);d=x.createEl("input"),d.type="datetime-local",d.value=y(o[this.dueKey])}let D=a.createDiv({cls:"gantt-edit-actions-row"});D.style.marginTop="0.75rem",D.style.display="flex",D.style.justifyContent="space-between",D.style.alignItems="center";let S=D.createDiv({cls:"gantt-edit-actions-left"});S.style.display="flex";let A=D.createDiv({cls:"gantt-edit-actions-right"});A.style.display="flex",A.style.gap="0.5rem";let v=S.createEl("button",{text:"Open note"}),k=A.createEl("button",{text:"Save"}),H=A.createEl("button",{text:"Cancel"});v.addEventListener("click",()=>{this.app.workspace.openLinkText(this.notePath,"",!1),this.close()}),H.addEventListener("click",()=>this.close()),k.addEventListener("click",async()=>{if(this.startKey&&l){let b=h(l.value);b?o[this.startKey]=b:delete o[this.startKey]}if(this.endKey&&f){let b=h(f.value);b?o[this.endKey]=b:delete o[this.endKey]}if(this.durationKey&&g){let b=g.value.trim();if(b==="")delete o[this.durationKey];else{let L=Number(b);Number.isNaN(L)||(o[this.durationKey]=L)}}if(this.dueKey&&d){let b=h(d.value);b?o[this.dueKey]=b:delete o[this.dueKey]}let N=`---
${(0,Ct.stringifyYaml)(o).trim()}
---
`+i;if(await this.app.vault.modify(n,N),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(b){}if(this.refresh)try{this.refresh()}catch(b){}new Ct.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function fe(s,r,t,n){var Ee,Te,Re,Ce,ke,Me,Pe,Le;let e=(Ee=r.options)!=null?Ee:{},o=e.background,i=(Te=e.drilldown)!=null?Te:!0,u=!0,a=w=>{if(w==null)return"";let B=String(w).trim();if(!B)return"";let Y=B.match(/^\[\[(.+?)\]\]$/);Y&&(B=Y[1]);let J=B.lastIndexOf("/");return J>=0&&J<B.length-1&&(B=B.slice(J+1)),B};if(Array.from(s.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(w=>w.remove()),t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let c=t.rows.filter(w=>w.start&&w.end);if(c.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: missing date fields."});return}let p=r.encoding,y=p.group,h=p.duration,l=(w,B)=>{if(!w||!B)return;let Y=w[B];return Array.isArray(Y)?Y[0]:Y},f="__chartnotes_no_group__",d=c.map(w=>{var mt,Dt;let B=w.start,Y=w.end,J=w.props,Qt=typeof w.x=="string"?w.x:w.x instanceof Date?Vt(B):String(w.x),Lt=a(Qt),Tt=y!=null&&y!==""?l(J,y):void 0,It=Tt!=null&&String(Tt).trim().length>0?String(Tt):f,gt=(mt=w.notes)==null?void 0:mt[0],_t=gt?(Dt=gt.replace(/\.md$/i,"").split("/").pop())!=null?Dt:gt:Lt,Wt=w.due,Ht,vt=l(J,h);if(vt!=null){let Ft=Number(vt);Number.isNaN(Ft)||(Ht=Ft)}return{row:w,start:B,end:Y,props:J,fullName:Lt,groupKey:It,notePath:gt,noteTitle:_t,due:Wt,estMinutes:Ht}}).filter(w=>w.start instanceof Date&&!isNaN(w.start.getTime())&&w.end instanceof Date&&!isNaN(w.end.getTime()));if(d.length===0){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid dates."});return}d.sort((w,B)=>{if(w.groupKey<B.groupKey)return-1;if(w.groupKey>B.groupKey)return 1;let Y=w.start.getTime(),J=B.start.getTime();return Y!==J?Y-J:w.fullName.localeCompare(B.fullName)});let D=26,S=0,A=null;for(let w of d)w.groupKey!==A&&(A=w.groupKey,w.groupKey!==f&&(S+=1)),S+=1;let v=Math.min(...d.map(w=>w.start.getTime())),k=Math.max(...d.map(w=>w.end.getTime()));if(!isFinite(v)||!isFinite(k)){s.createDiv({cls:"prop-charts-empty",text:"Gantt: invalid date range."});return}let H=24*60*60*1e3,T=w=>{let B=new Date(w);return B.setHours(0,0,0,0),B.getTime()},E=T(v),x=T(k),N=s.querySelector(".prop-charts-title-row");N||(N=s.createDiv({cls:"prop-charts-title-row"}));let b=s.dataset.ganttZoomMode||String((Re=e.zoomMode)!=null?Re:"100");s.dataset.ganttZoomMode=b;let L=s.dataset.ganttLabelMode||String((Ce=e.labelMode)!=null?Ce:"compact");s.dataset.ganttLabelMode=L;let C=N.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(w=>{let B=C.createEl("button",{cls:"gantt-zoom-btn",text:w.label});w.id===b&&B.addClass("is-active"),B.addEventListener("click",Y=>{Y.preventDefault(),s.dataset.ganttZoomMode=w.id,fe(s,r,t,n)})});let F=Number(e.labelWidth),V=!Number.isNaN(F)&&F>120?F:260,$=L==="wide"?V+160:V,W=s.getBoundingClientRect().width||600,Q=Math.max(W,820),P;if(b==="fit")P=W;else{let w=Number(b)/100||1;P=Q*w}let{inner:G,svg:m,tooltip:R,details:M}=St(s,o);G.style.width=P+"px";let O=(w,B,Y,J,Qt,Lt,Tt,te,It)=>{if(!w)return;let gt=Math.max(40,J-8),Wt=Math.max(8,Math.floor(gt/6)),Ht=w.split(/\s+/),vt=[],mt="";for(let $t of Ht){if(!mt){mt=$t;continue}(mt+" "+$t).length<=Wt?mt+=" "+$t:(vt.push(mt),mt=$t)}mt&&vt.push(mt);let Dt=Qt+2,Ft=vt.length*Dt,ee=Y-Ft/2+Qt;vt.forEach(($t,oe)=>{let dt=document.createElementNS(m.namespaceURI,"text");dt.setAttribute("x",String(B)),dt.setAttribute("y",String(ee+oe*Dt)),dt.setAttribute("text-anchor","start"),dt.setAttribute("font-size",String(Qt)),dt.setAttribute("fill","#111111"),Lt&&dt.setAttribute("font-weight",Lt),dt.textContent=$t,Tt&&dt.addEventListener("mouseenter",lt=>Tt(lt)),te&&dt.addEventListener("mouseleave",()=>te()),It&&(dt.style.cursor="pointer",dt.addEventListener("click",lt=>It(lt))),m.appendChild(dt)})},I=28,z=28,U=10,j=Math.max(300,I+z+S*D+24);m.setAttribute("height",String(j));let K=P-$-U,q=I+6;m.style.color="#111111";let nt=x+H-E||1,rt=E-nt*.02,it=x+H+nt*.08,at=w=>$+(w-rt)/(it-rt)*K,tt=(it-rt)/H,X=Math.max(4,Math.min(12,Math.floor(K/90)||4)),ht=tt/X,ct=[1,2,3,5,7,10,14,21,30,60,90,180,365],st=ct[ct.length-1];for(let w of ct)if(w>=ht){st=w;break}let xt=[],wt=T(rt);for(let w=wt;w<=it+.5*H;w+=st*H)xt.push(w);let Pt=document.createElementNS(m.namespaceURI,"line");Pt.setAttribute("x1",String($)),Pt.setAttribute("y1",String(q)),Pt.setAttribute("x2",String(P-U)),Pt.setAttribute("y2",String(q)),Pt.setAttribute("stroke","#111111"),m.appendChild(Pt);for(let w of xt){let B=at(w),Y=document.createElementNS(m.namespaceURI,"line");Y.setAttribute("x1",String(B)),Y.setAttribute("y1",String(q)),Y.setAttribute("x2",String(B)),Y.setAttribute("y2",String(j-z)),Y.setAttribute("stroke","#111111"),Y.setAttribute("stroke-opacity","0.20"),Y.setAttribute("stroke-dasharray","2,4"),m.appendChild(Y);let J=document.createElementNS(m.namespaceURI,"text");J.setAttribute("x",String(B)),J.setAttribute("y",String(q-4)),J.setAttribute("text-anchor","middle"),J.setAttribute("font-size","10"),J.setAttribute("fill","#111111"),J.textContent=Vt(new Date(w)),m.appendChild(J)}let Jt=new Date;Jt.setHours(0,0,0,0);let Kt=Jt.getTime();if(Kt>=rt&&Kt<=it){let w=at(Kt),B=document.createElementNS(m.namespaceURI,"line");B.setAttribute("x1",String(w)),B.setAttribute("y1",String(q)),B.setAttribute("x2",String(w)),B.setAttribute("y2",String(j-z)),B.setAttribute("stroke","#4caf50"),B.setAttribute("stroke-width","2"),B.setAttribute("stroke-dasharray","4,2"),m.appendChild(B);let Y=document.createElementNS(m.namespaceURI,"text");Y.setAttribute("x",String(w+4)),Y.setAttribute("y",String(q+12)),Y.setAttribute("font-size","10"),Y.setAttribute("fill","#4caf50"),Y.textContent="today",m.appendChild(Y)}let Et=G.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Et.setAttr("title",L==="wide"?"Compact names":"Expand names"),Et.style.left=`${$}px`,Et.style.top="4px",Et.addEventListener("click",w=>{w.preventDefault();let Y=(s.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";s.dataset.ganttLabelMode=Y,fe(s,r,t,n)});let Bt=["status","priority"],Yt=Array.isArray(e.tooltipFields)?e.tooltipFields.map(w=>String(w)):null,mn=Yt&&Yt.length?Yt:Bt,Ut=0,se=null;for(let w of d){let B=w.start,Y=w.end,J=(Y.getTime()-B.getTime())/6e4,Qt=w.props,Lt=w.notePath,Tt=w.noteTitle,te=(Me=(ke=w.row.notes)==null?void 0:ke.length)!=null?Me:0,It=w.due,gt=w.estMinutes,_t=[];_t.push(`${Vt(B)} \u2192 ${Vt(Y)}`),typeof gt=="number"&&!Number.isNaN(gt)?_t.push(`est: ${Math.round(gt)} min`):J>0&&_t.push(`dura\xE7\xE3o: ${Math.round(J)} min`),It instanceof Date&&_t.push(`due: ${Vt(It)}`);for(let ot of mn){let Z=l(Qt,ot);Z!=null&&String(Z).trim()!==""&&_t.push(`${ot}: ${String(Z)}`)}let Wt=_t.join("<br>"),Ht=ot=>{var Z;ot.preventDefault(),u&&Lt?new ve(Lt,r,n==null?void 0:n.refresh,n==null?void 0:n.reindexFile).open():pt(s,M,Tt,gt!=null?gt:J,(Z=w.row.notes)!=null?Z:[],i)},vt=ot=>{Tt&&Wt&&yt(s,R,Tt,Wt,te,ot)},mt=()=>bt(R);if(w.groupKey!==se&&(se=w.groupKey,se!==f)){let ot=q+8+Ut*D+D/2,Z=a(se);O(Z,4,ot,$-12,11,"600"),Ut+=1}let Dt=q+8+Ut*D,Ft=D-10,ee=at(B.getTime()),$t=at(Y.getTime()),oe=Math.max(4,$t-ee),dt=w.fullName,lt=document.createElementNS(m.namespaceURI,"rect");lt.setAttribute("x",String(ee)),lt.setAttribute("y",String(Dt)),lt.setAttribute("width",String(oe)),lt.setAttribute("height",String(Ft)),lt.setAttribute("rx","3"),lt.setAttribute("ry","3"),lt.setAttribute("fill",ut((Pe=w.row.series)!=null?Pe:dt,Ut)),lt.setAttribute("stroke","rgba(0,0,0,0.25)"),lt.setAttribute("stroke-width","0.5"),lt.style.cursor=u&&Lt?"pointer":"default",lt.addEventListener("mouseenter",vt),lt.addEventListener("mouseleave",mt),lt.addEventListener("click",Ht),m.appendChild(lt);let Ie=Dt+Ft/2;if(oe>=6){let ot=ut((Le=w.row.series)!=null?Le:dt,Ut),Z=document.createElementNS(m.namespaceURI,"circle");Z.setAttribute("cx",String(ee)),Z.setAttribute("cy",String(Ie)),Z.setAttribute("r","3.5"),Z.setAttribute("fill","#ffffff"),Z.setAttribute("stroke",ot),Z.setAttribute("stroke-width","1.5"),m.appendChild(Z);let Gt=document.createElementNS(m.namespaceURI,"circle");Gt.setAttribute("cx",String($t)),Gt.setAttribute("cy",String(Ie)),Gt.setAttribute("r","3.5"),Gt.setAttribute("fill","#ffffff"),Gt.setAttribute("stroke",ot),Gt.setAttribute("stroke-width","1.5"),m.appendChild(Gt)}let _e=Dt+Ft/2+2,ie=4;if(L==="wide")O(dt,ie,_e,$-ie-4,11,null,vt,mt,Ht);else{let ot=dt,Z=Math.max(40,$-ie-8),Fe=Math.max(8,Math.floor(Z/6));ot.length>Fe&&(ot=ot.slice(0,Fe-1)+"\u2026");let At=document.createElementNS(m.namespaceURI,"text");At.setAttribute("x",String(ie)),At.setAttribute("y",String(_e)),At.setAttribute("text-anchor","start"),At.setAttribute("font-size","11"),At.setAttribute("fill","#111111"),At.textContent=ot,At.style.cursor="pointer",At.addEventListener("mouseenter",vt),At.addEventListener("mouseleave",mt),At.addEventListener("click",Ht),m.appendChild(At)}if(It instanceof Date){let ot=at(It.getTime()),Z=document.createElementNS(m.namespaceURI,"line");Z.setAttribute("x1",String(ot)),Z.setAttribute("y1",String(Dt)),Z.setAttribute("x2",String(ot)),Z.setAttribute("y2",String(Dt+Ft)),Z.setAttribute("stroke","#ff6b6b"),Z.setAttribute("stroke-width","2"),Z.setAttribute("stroke-dasharray","4,2"),m.appendChild(Z)}Ut+=1}if(u){let w=s.createDiv({cls:"prop-charts-empty"});w.textContent="Click on a bar or name to adjust dates and task estimate."}}function De(s,r,t){var W,Q,P,G;let n=(W=r.options)!=null?W:{},e=n.background,o=(Q=n.drilldown)!=null?Q:!0,i=(P=t.rows)!=null?P:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let{inner:u,svg:a,tooltip:c,details:p}=St(s,e),y=s.getBoundingClientRect().width||600,h=Math.max(y,480);u.style.width=h+"px";let l=40,f=16,g=18,d=28,D=300;a.setAttribute("height",String(D));let S=h-l-f,A=D-g-d,v=new Map;for(let m of i){let R=String(m.x),M=(G=v.get(R))!=null?G:{label:m.x,rows:[]};M.rows.push(m),v.set(R,M)}let H=Array.from(v.keys()).sort((m,R)=>m<R?-1:m>R?1:0).map(m=>v.get(m)),T=H.length,E=m=>String(m!=null?m:""),x=new Set;i.forEach(m=>{m.series!=null&&x.add(E(m.series))});let N=Array.from(x),b=N.length>1,L=b?"grouped":"single",C=0;i.forEach(m=>{m.y>C&&(C=m.y)}),(!isFinite(C)||C<=0)&&(C=1);let _=m=>g+A-m/(C||1)*A,F=_(0),V=4;for(let m=0;m<=V;m++){let R=C*m/V,M=_(R),O=document.createElementNS(a.namespaceURI,"line");O.setAttribute("x1",String(l)),O.setAttribute("y1",String(M)),O.setAttribute("x2",String(h-f)),O.setAttribute("y2",String(M)),O.setAttribute("stroke","#cccccc"),O.setAttribute("stroke-opacity","0.25"),a.appendChild(O);let I=document.createElementNS(a.namespaceURI,"text");I.setAttribute("x",String(l-4)),I.setAttribute("y",String(M+3)),I.setAttribute("text-anchor","end"),I.setAttribute("font-size","10"),I.setAttribute("fill","#111111"),I.textContent=String(Math.round(R)),a.appendChild(I)}let $=T>0?S/T:S;if(H.forEach((m,R)=>{let M=l+$*(R+.5),O=String(m.label),I=document.createElementNS(a.namespaceURI,"text");I.setAttribute("x",String(M)),I.setAttribute("y",String(D-d+12)),I.setAttribute("text-anchor","middle"),I.setAttribute("font-size","10"),I.setAttribute("fill","#111111"),I.textContent=O,a.appendChild(I)}),b){let m=s.createDiv({cls:"chart-notes-legend"});N.forEach((R,M)=>{let O=m.createDiv({cls:"chart-notes-legend-item"}),I=O.createDiv();I.style.width="10px",I.style.height="10px",I.style.borderRadius="999px",I.style.backgroundColor=ut(R,M),O.createSpan({text:R})})}H.forEach((m,R)=>{let M=l+$*(R+.5),O=m.rows;if(L==="single"){let K=O[0],q=K.y,nt=$*.6,rt=M-nt/2,it=_(q),at=Math.max(2,F-it),tt=ut("bar",R),et=document.createElementNS(a.namespaceURI,"rect");et.setAttribute("x",String(rt)),et.setAttribute("y",String(it)),et.setAttribute("width",String(nt)),et.setAttribute("height",String(at)),et.setAttribute("fill",tt),et.setAttribute("stroke","rgba(0,0,0,0.25)"),et.setAttribute("stroke-width","0.5"),et.style.cursor="pointer";let X=String(m.label),ht=`valor: ${Math.round(q*100)/100}`;et.addEventListener("mouseenter",ct=>{var st,xt;return yt(s,c,X,ht,(xt=(st=K.notes)==null?void 0:st.length)!=null?xt:0,ct)}),et.addEventListener("mouseleave",()=>bt(c)),et.addEventListener("click",ct=>{var st;ct.preventDefault(),pt(s,p,X,q,(st=K.notes)!=null?st:[],o)}),a.appendChild(et);return}let I=N.length,z=$/Math.max(I+1,2),U=I*z,j=M-U/2;N.forEach((K,q)=>{let nt=O.find(st=>st.series!=null&&E(st.series)===K);if(!nt)return;let rt=nt.y,it=j+q*z,at=_(rt),tt=Math.max(2,F-at),et=ut(K,q),X=document.createElementNS(a.namespaceURI,"rect");X.setAttribute("x",String(it)),X.setAttribute("y",String(at)),X.setAttribute("width",String(z)),X.setAttribute("height",String(tt)),X.setAttribute("fill",et),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let ht=`${K} @ ${String(m.label)}`,ct=`valor: ${Math.round(rt*100)/100}`;X.addEventListener("mouseenter",st=>{var xt,wt;return yt(s,c,ht,ct,(wt=(xt=nt.notes)==null?void 0:xt.length)!=null?wt:0,st)}),X.addEventListener("mouseleave",()=>bt(c)),X.addEventListener("click",st=>{var xt;st.preventDefault(),pt(s,p,ht,rt,(xt=nt.notes)!=null?xt:[],o)}),a.appendChild(X)})})}function Xe(s,r,t){var V,$,W,Q;let n=(V=r.options)!=null?V:{},e=n.background,o=($=n.drilldown)!=null?$:!0,i=(W=t.rows)!=null?W:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let u=new Map;for(let P of i){let G=String(P.x),m=(Q=u.get(G))!=null?Q:{label:P.x,rows:[]};m.rows.push(P),u.set(G,m)}let c=Array.from(u.keys()).sort((P,G)=>P<G?-1:P>G?1:0).map(P=>u.get(P)),p=c.length,y=P=>String(P!=null?P:""),h=new Set(i.map(P=>y(P.series))),l=Array.from(h);if(l.length===1&&l[0]===""){De(s,r,t);return}let{inner:f,svg:g,tooltip:d,details:D}=St(s,e),S=s.getBoundingClientRect().width||600,A=Math.max(S,480);f.style.width=A+"px",g.setAttribute("width",String(A));let v=40,k=16,H=18,T=28,E=300;g.setAttribute("height",String(E));let x=A-v-k,N=E-H-T,b=0;c.forEach(P=>{let G=P.rows.reduce((m,R)=>m+(R.y||0),0);G>b&&(b=G)}),(!isFinite(b)||b<=0)&&(b=1);let L=P=>H+N-P/(b||1)*N,C=4;for(let P=0;P<=C;P++){let G=b*P/C,m=L(G),R=document.createElementNS(g.namespaceURI,"line");R.setAttribute("x1",String(v)),R.setAttribute("y1",String(m)),R.setAttribute("x2",String(A-k)),R.setAttribute("y2",String(m)),R.setAttribute("stroke","#cccccc"),R.setAttribute("stroke-opacity","0.25"),g.appendChild(R);let M=document.createElementNS(g.namespaceURI,"text");M.setAttribute("x",String(v-4)),M.setAttribute("y",String(m+3)),M.setAttribute("text-anchor","end"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=String(Math.round(G)),g.appendChild(M)}let _=p>0?x/p:x;c.forEach((P,G)=>{let m=v+_*(G+.5),R=String(P.label),M=document.createElementNS(g.namespaceURI,"text");M.setAttribute("x",String(m)),M.setAttribute("y",String(E-T+12)),M.setAttribute("text-anchor","middle"),M.setAttribute("font-size","10"),M.setAttribute("fill","#111111"),M.textContent=R,g.appendChild(M)});let F=f.createDiv({cls:"chart-notes-legend"});l.forEach((P,G)=>{if(P==="")return;let m=F.createDiv({cls:"chart-notes-legend-item"}),R=m.createDiv();R.style.width="10px",R.style.height="10px",R.style.borderRadius="999px",R.style.backgroundColor=ut(P,G),m.createSpan({text:P})}),c.forEach((P,G)=>{let m=v+_*(G+.5),R=_*.6,M=m-R/2,O=0;l.forEach((I,z)=>{if(I==="")return;let U=P.rows.find(ht=>y(ht.series)===I);if(!U)return;let j=U.y||0,K=O,q=O+j;O=q;let nt=L(K),rt=L(q),it=Math.max(2,nt-rt),at=ut(I,z),tt=document.createElementNS(g.namespaceURI,"rect");tt.setAttribute("x",String(M)),tt.setAttribute("y",String(rt)),tt.setAttribute("width",String(R)),tt.setAttribute("height",String(it)),tt.setAttribute("fill",at),tt.setAttribute("stroke","rgba(0,0,0,0.25)"),tt.setAttribute("stroke-width","0.5"),tt.style.cursor="pointer";let et=`${I} @ ${String(P.label)}`,X=`valor: ${Math.round(j*100)/100}`;tt.addEventListener("mouseenter",ht=>{var ct,st;return yt(s,d,et,X,(st=(ct=U.notes)==null?void 0:ct.length)!=null?st:0,ht)}),tt.addEventListener("mouseleave",()=>bt(d)),tt.addEventListener("click",ht=>{var ct;ht.preventDefault(),pt(s,D,et,j,(ct=U.notes)!=null?ct:[],o)}),g.appendChild(tt)})})}var kt=40,zt=16,qt=18,je=28,Vn=.6,On=2,ne="__default__";var Ae=[1,2,3,5,7,10,14,21,30,60,90,180,365],Hn=90,ze=3,Gn=10,jt=.02,qe=4,Bn=100,Ze="No data available.";function Mt(s){if(!s)return null;if(s instanceof Date){let r=s.getTime();return Number.isNaN(r)?null:s}if(typeof s=="string"){let r=s.trim();if(!r||/^\d+$/.test(r))return null;let t=new Date(r);if(!Number.isNaN(t.getTime()))return t}return null}function Je(s){var t;let r=new Map;for(let n of s){let e=n.series!=null&&n.series!==""?String(n.series):ne,o=(t=r.get(e))!=null?t:[];o.push(n),r.set(e,o)}return r}function tn(s){let r=s.map(t=>Mt(t.x)).filter(t=>!!t);return r.length>=On&&r.length>=s.length*Vn}function en(s,r,t){let o=s.map(l=>Mt(l.x)).filter(l=>!!l).map(l=>l.getTime()).sort((l,f)=>l-f),i=o[0],u=o[o.length-1];i===u&&(i-=864e5,u+=864e5);let a=u-i||864e5,c=i-a*jt,p=u+a*jt;return{xScale:l=>{let f=Mt(l);if(!f)return t;let g=f.getTime();return t+(g-c)/(p-c||1)*r},xLabelOf:l=>{let f=Mt(l);return f?Vt(f):String(l)}}}function nn(s,r,t){let n=[],e=new Set;for(let a of s){let c=String(a.x);e.has(c)||(e.add(c),n.push(a.x))}let o=n.length||1;return{xScale:a=>{let c=String(a),p=n.findIndex(y=>String(y)===c);return p<0?t:o===1?t+r/2:t+p/(o-1)*r},xLabelOf:a=>String(a)}}function rn(s,r,t,n,e,o,i,u,a){let p=i+e,y=document.createElementNS(s.namespaceURI,"line");y.setAttribute("x1",String(o)),y.setAttribute("y1",String(p)),y.setAttribute("x2",String(a-u)),y.setAttribute("y2",String(p)),y.setAttribute("stroke","#111111"),y.setAttribute("stroke-width","1"),s.appendChild(y);let h=(t-r)/864e5,l=Math.max(ze,Math.min(Gn,Math.floor(n/Hn)||ze)),f=h/l,g=Ae[Ae.length-1];for(let S of Ae)if(S>=f){g=S;break}let D=(S=>{let A=new Date(S);return A.setHours(0,0,0,0),A.getTime()})(r);for(let S=D;S<=t+.5*864e5;S+=g*864e5){let A=o+(S-r)/(t-r)*n,v=document.createElementNS(s.namespaceURI,"line");v.setAttribute("x1",String(A)),v.setAttribute("y1",String(i)),v.setAttribute("x2",String(A)),v.setAttribute("y2",String(p)),v.setAttribute("stroke","#111111"),v.setAttribute("stroke-opacity","0.18"),v.setAttribute("stroke-dasharray","2,4"),s.appendChild(v);let k=document.createElementNS(s.namespaceURI,"text");k.setAttribute("x",String(A)),k.setAttribute("y",String(p+12)),k.setAttribute("text-anchor","middle"),k.setAttribute("font-size","10"),k.setAttribute("fill","#111111"),k.textContent=Vt(new Date(S)),s.appendChild(k)}}function Qn(s){let r=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(let n of s)n.y<r&&(r=n.y),n.y>t&&(t=n.y);return!isFinite(r)||!isFinite(t)?{min:0,max:1}:r===t?r===0?{min:0,max:1}:{min:0,max:t}:{min:r,max:t}}function sn(s,r,t,n){return e=>n+t-(e-s)/(r-s||1)*t}function on(s,r,t,n,e,o,i){for(let u=0;u<=qe;u++){let a=r+(t-r)*u/qe,c=n(a),p=document.createElementNS(s.namespaceURI,"line");p.setAttribute("x1",String(o)),p.setAttribute("y1",String(c)),p.setAttribute("x2",String(e+o+i)),p.setAttribute("y2",String(c)),p.setAttribute("stroke","#cccccc"),p.setAttribute("stroke-opacity","0.25"),s.appendChild(p);let y=document.createElementNS(s.namespaceURI,"text");y.setAttribute("x",String(o-4)),y.setAttribute("y",String(c+3)),y.setAttribute("text-anchor","end"),y.setAttribute("font-size","10"),y.setAttribute("fill","#111111"),y.textContent=Math.abs(a)>=Bn?String(Math.round(a)):String(Math.round(a*10)/10),s.appendChild(y)}}function an(s,r,t=!0){let n=t?r.filter(o=>o!==ne):r;if(n.length<=1)return;let e=s.createDiv({cls:"chart-notes-legend"});n.forEach((o,i)=>{let u=e.createDiv({cls:"chart-notes-legend-item"}),a=u.createDiv();a.style.width="10px",a.style.height="10px",a.style.borderRadius="999px",a.style.backgroundColor=ut(o,i),u.createSpan({text:o})})}function Kn(s,r){let t=[...s];return r&&t.sort((n,e)=>{let o=Mt(n.x),i=Mt(e.x),u=o?o.getTime():0,a=i?i.getTime():0;return u-a}),t}function Yn(s,r,t,n,e){let o="";if(s.forEach((i,u)=>{let a=r(i.x),c=t(i.y);o+=u===0?`M ${a} ${c}`:` L ${a} ${c}`}),n&&s.length>0){let i=s[0],u=s[s.length-1],a=r(i.x),c=r(u.x),p=t(e);o+=` L ${c} ${p} L ${a} ${p} Z`}return o}function Un(s,r,t,n,e,o,i,u,a,c,p){r.forEach(y=>{let h=t(y.x),l=n(y.y),f=document.createElementNS(s.namespaceURI,"circle");f.setAttribute("cx",String(h)),f.setAttribute("cy",String(l)),f.setAttribute("r","3"),f.setAttribute("fill","#ffffff"),f.setAttribute("stroke",o),f.setAttribute("stroke-width","1.5"),f.style.cursor="pointer";let g=e(y.x),d=i?`${i} @ ${g}`:g,D=`value: ${Math.round(y.y*100)/100}`;f.addEventListener("mouseenter",S=>{var A,v;return yt(u,a,d,D,(v=(A=y.notes)==null?void 0:A.length)!=null?v:0,S)}),f.addEventListener("mouseleave",()=>bt(a)),f.addEventListener("click",S=>{var A;S.preventDefault(),pt(u,c,d,y.y,(A=y.notes)!=null?A:[],p)}),s.appendChild(f)})}function Ne(s,r,t,n){var N,b,L;let e=(N=r.options)!=null?N:{},o=e.background,i=(b=e.drilldown)!=null?b:!0,u=(L=t.rows)!=null?L:[];if(!u.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let{inner:a,svg:c,tooltip:p,details:y}=St(s,o),h=s.getBoundingClientRect().width||600,l=Math.max(h,480);a.style.width=l+"px";let f=300;c.setAttribute("height",String(f));let g=l-kt-zt,d=f-qt-je,D=tn(u),S=Je(u),A=Array.from(S.keys()),v=D?en(u,g,kt):nn(u,g,kt),{xScale:k,xLabelOf:H}=v;if(D){let _=u.map(G=>Mt(G.x)).filter(G=>!!G).map(G=>G.getTime()).sort((G,m)=>G-m),F=_[0],V=_[_.length-1],$=24*60*60*1e3;F===V&&(F-=$,V+=$);let W=V-F||$,Q=F-W*jt,P=V+W*jt;rn(c,Q,P,g,d,kt,qt,zt,l)}let{min:T,max:E}=Qn(u),x=sn(T,E,d,qt);on(c,T,E,x,g,kt,zt),an(s,A),A.forEach((C,_)=>{let F=S.get(C);if(!(F!=null&&F.length))return;let V=C===ne?ut("line",_):ut(C,_),$=Kn(F,D),W=Yn($,k,x,n,T),Q=document.createElementNS(c.namespaceURI,"path");Q.setAttribute("d",W),Q.setAttribute("fill",n?V:"none"),Q.setAttribute("fill-opacity",n?"0.18":"0"),Q.setAttribute("stroke",V),Q.setAttribute("stroke-width",n?"1.5":"2"),c.appendChild(Q);let P=C===ne?"":String(C);Un(c,$,k,x,H,V,P,s,p,y,i)})}function cn(s,r,t){var C,_,F,V,$,W,Q,P,G;let n=(C=r.options)!=null?C:{},e=n.background,o=(_=n.drilldown)!=null?_:!0,i=(F=t.rows)!=null?F:[];if(!i.length){s.createDiv({cls:"prop-charts-empty",text:Ze});return}let u=Je(i),a=Array.from(u.keys()).filter(m=>m!==ne);if(a.length===0){Ne(s,r,t,!0);return}let{inner:c,svg:p,tooltip:y,details:h}=St(s,e),l=s.getBoundingClientRect().width||600,f=Math.max(l,480);c.style.width=f+"px";let g=300;p.setAttribute("height",String(g));let d=f-kt-zt,D=g-qt-je,S=tn(i),A=[],v=new Set;for(let m of i){let R=String(m.x);v.has(R)||(v.add(R),A.push(m.x))}let k=S?en(i,d,kt):nn(i,d,kt),{xScale:H,xLabelOf:T}=k;if(S&&A.sort((m,R)=>{let M=Mt(m),O=Mt(R),I=M?M.getTime():0,z=O?O.getTime():0;return I-z}),S){let R=i.map(K=>Mt(K.x)).filter(K=>!!K).map(K=>K.getTime()).sort((K,q)=>K-q),M=R[0],O=R[R.length-1],I=24*60*60*1e3;M===O&&(M-=I,O+=I);let z=O-M||I,U=M-z*jt,j=O+z*jt;rn(p,U,j,d,D,kt,qt,zt,f)}let E=new Map,x=new Map;for(let m of A)E.set(String(m),new Map);for(let m of a){let R=(V=u.get(m))!=null?V:[],M=new Map;for(let O of R){let I=String(O.x);M.set(I,($=O.y)!=null?$:0)}x.set(m,M)}for(let m of a){let R=(W=x.get(m))!=null?W:new Map,M=0;for(let O of A){let I=String(O),z=R.get(I);z!==void 0&&(M=z);let U=E.get(I);U&&U.set(m,M)}}let N=[];for(let m of A){let R=String(m),M=new Map,O=new Map,I=E.get(R);for(let U of a){let j=(Q=I==null?void 0:I.get(U))!=null?Q:0;M.set(U,j)}let z=0;for(let U of a){let j=(P=M.get(U))!=null?P:0;O.set(U,z),z+=j}N.push({x:m,seriesValues:M,stackedValues:O})}let b=0;for(let m of N){let R=0;for(let M of a)R+=(G=m.seriesValues.get(M))!=null?G:0;R>b&&(b=R)}(!isFinite(b)||b<=0)&&(b=1);let L=sn(0,b,D,qt);on(p,0,b,L,d,kt,zt),a.length>0&&an(s,a,!1),a.forEach((m,R)=>{let M=ut(m,R),O="";N.forEach((K,q)=>{var et,X;let nt=H(K.x),rt=(et=K.stackedValues.get(m))!=null?et:0,it=(X=K.seriesValues.get(m))!=null?X:0,at=rt+it,tt=L(at);O+=q===0?`M ${nt} ${tt}`:` L ${nt} ${tt}`});let I=N.slice().reverse().map(K=>{var it;let q=H(K.x),nt=(it=K.stackedValues.get(m))!=null?it:0,rt=L(nt);return`${q} ${rt}`}).join(" L "),z=`${O} L ${I} Z`,U=document.createElementNS(p.namespaceURI,"path");U.setAttribute("d",z),U.setAttribute("fill",M),U.setAttribute("fill-opacity","0.18"),U.setAttribute("stroke",M),U.setAttribute("stroke-width","1.5"),p.appendChild(U);let j=x.get(m);N.forEach(K=>{var Pt,Jt,Kt;let q=String(K.x);if(!(j==null?void 0:j.has(q)))return;let rt=H(K.x),it=(Pt=K.stackedValues.get(m))!=null?Pt:0,at=(Jt=K.seriesValues.get(m))!=null?Jt:0,tt=it+at,et=L(tt),X=document.createElementNS(p.namespaceURI,"circle");X.setAttribute("cx",String(rt)),X.setAttribute("cy",String(et)),X.setAttribute("r","3"),X.setAttribute("fill","#ffffff"),X.setAttribute("stroke",M),X.setAttribute("stroke-width","1.5"),X.style.cursor="pointer";let ht=T(K.x),ct=`${m} @ ${ht}`,st=`value: ${Math.round(at*100)/100}`,wt=((Kt=u.get(m))!=null?Kt:[]).find(Et=>String(Et.x)===String(K.x));X.addEventListener("mouseenter",Et=>{var Bt,Yt;return yt(s,y,ct,st,(Yt=(Bt=wt==null?void 0:wt.notes)==null?void 0:Bt.length)!=null?Yt:0,Et)}),X.addEventListener("mouseleave",()=>bt(y)),X.addEventListener("click",Et=>{var Bt;Et.preventDefault(),pt(s,h,ct,at,(Bt=wt==null?void 0:wt.notes)!=null?Bt:[],o)}),p.appendChild(X)})})}function ln(s,r,t){var A;let{background:n,drilldown:e=!0}=(A=r.options)!=null?A:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=We(n)?"#000000":void 0,i=s.getBoundingClientRect().width||600,{inner:u,svg:a,tooltip:c,details:p}=St(s,n),y=Math.max(i,420);u.style.width=y+"px",o&&(a.style.color=o);let h=300,l=y/2,f=(h-28+28)/2,g=Math.min(y/2-20,h/2-20),D=t.rows.map(v=>Math.max(0,v.y)).reduce((v,k)=>v+k,0)||1,S=-Math.PI/2;t.rows.forEach((v,k)=>{var V;let H=v.x instanceof Date?v.x.toISOString().slice(0,10):String(v.x),T=v.y,E=T/D*Math.PI*2,x=l+g*Math.cos(S),N=f+g*Math.sin(S),b=l+g*Math.cos(S+E),L=f+g*Math.sin(S+E),C=E>Math.PI?1:0,_=document.createElementNS(a.namespaceURI,"path"),F=[`M ${l} ${f}`,`L ${x} ${N}`,`A ${g} ${g} 0 ${C} 1 ${b} ${L}`,"Z"].join(" ");_.setAttribute("d",F),_.setAttribute("fill",ut((V=v.series)!=null?V:H,k)),_.style.cursor="pointer",_.addEventListener("mouseenter",$=>{var W,Q;return yt(s,c,H,T,(Q=(W=v.notes)==null?void 0:W.length)!=null?Q:0,$)}),_.addEventListener("mouseleave",()=>bt(c)),_.addEventListener("click",()=>{var $;return pt(s,p,H,T,($=v.notes)!=null?$:[],e)}),a.appendChild(_),S+=E})}function un(s,r,t){var N;let{background:n,drilldown:e=!0}=(N=r.options)!=null?N:{};if(t.rows.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let o=n?"#111111":void 0,i=s.getBoundingClientRect().width||600,{inner:u,svg:a,tooltip:c,details:p}=St(s,n),y=Math.max(i,700);u.style.width=y+"px",o&&(a.style.color=o);let h=300,l=y-48-10,f=h-28-28,g=t.rows.map(b=>{let L=b.x;if(L instanceof Date)return L.getTime();if(typeof L=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(L)){let _=new Date(L);if(!isNaN(_.getTime()))return _.getTime()}let C=Number(L);return isNaN(C)?null:C}return typeof L=="number"?L:null}),d=t.rows.map(b=>b.y),D=g.filter(b=>b!==null);if(D.length===0){s.createDiv({cls:"prop-charts-empty",text:"No data (X is not numeric/date)."});return}let S=Math.min(...D),A=Math.max(...D),v=Math.min(...d),k=Math.max(...d),H=b=>48+(b-S)/(A-S||1)*l,T=b=>h-28-(b-v)/(k-v||1)*f,E=document.createElementNS(a.namespaceURI,"line");E.setAttribute("x1",String(48)),E.setAttribute("y1",String(28)),E.setAttribute("x2",String(48)),E.setAttribute("y2",String(h-28)),E.setAttribute("stroke","currentColor"),a.appendChild(E);let x=document.createElementNS(a.namespaceURI,"line");x.setAttribute("x1",String(48)),x.setAttribute("y1",String(h-28)),x.setAttribute("x2",String(y-10)),x.setAttribute("y2",String(h-28)),x.setAttribute("stroke","currentColor"),a.appendChild(x),t.rows.forEach((b,L)=>{let C=g[L];if(C==null)return;let _=H(C),F=T(d[L]),V=document.createElementNS(a.namespaceURI,"circle");V.setAttribute("cx",String(_)),V.setAttribute("cy",String(F)),V.setAttribute("r","4"),V.setAttribute("fill",ut(b.series,L)),V.style.cursor="pointer";let $=b.x instanceof Date?b.x.toISOString().slice(0,10):typeof b.x=="string"?b.x:String(b.x);V.addEventListener("mouseenter",W=>{var Q,P;return yt(s,c,$,b.y,(P=(Q=b.notes)==null?void 0:Q.length)!=null?P:0,W)}),V.addEventListener("mouseleave",()=>bt(c)),V.addEventListener("click",W=>{var Q;W.preventDefault(),pt(s,p,$,b.y,(Q=b.notes)!=null?Q:[],e)}),a.appendChild(V)})}function Wn(s){switch(s){case"auto":return"var(--text-accent, #5b6cff)";case"accent":return"var(--text-accent, #5b6cff)";case"green":return"#5ec27f";case"red":return"#ff6b6b";case"blue":return"#5b6cff";case"orange":return"#ffb347";case"purple":return"#b47cff";default:return"var(--text-accent, #5b6cff)"}}function dn(s,r,t="",n=""){let e=r===0?Math.round(s).toString():s.toFixed(r);return`${t}${e}${n}`}function Xn(s){let r=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${r}-${t}-${n}`}function zn(s){return{count:"Count notes","count-value":"Count notes with value","count-date":"Count notes with date",sum:"Sum of values",avg:"Average of values",min:"Smallest value",max:"Largest value",oldest:"Oldest date",newest:"Newest date",dateRange:"Date range (newest - oldest)",countAll:"Count all notes",countNonEmpty:"Count notes where property is set"}[s]||s}function pn(s,r,t){var C,_,F,V,$,W,Q,P,G,m,R,M;let n=(C=r.options)!=null?C:{},e=n.background;s.empty(),s.addClass("prop-charts-container"),s.addClass("prop-charts-metric");let o=(_=n.metricLabel)!=null?_:"",i=(F=n.metricLabelPosition)!=null?F:"above",u=Number((V=n.metricDecimals)!=null?V:0),a=($=n.metricPrefix)!=null?$:"",c=(W=n.metricSuffix)!=null?W:"",p=(Q=n.metricColor)!=null?Q:"auto",y=Wn(p),h=t.rows[0];if(!h){s.createDiv({cls:"prop-charts-empty",text:"No data available."});return}let l=(P=h.props)==null?void 0:P._metricValue,f=(G=h.props)==null?void 0:G._metricError,g=(m=h.props)==null?void 0:m._metricDataType,d=(R=h.props)==null?void 0:R._metricOperation,D=(M=h.notes)!=null?M:[],S=D.length,A=s.createDiv({cls:"prop-charts-metric-card"});e&&(A.style.backgroundColor=e);let v="\u2013",k="",H=!1;f?(v="\u2013",k=f,H=!0):S===0?(v="\u2013",k="No notes found"):l==null?(v="0",k="No valid values (property empty or invalid)"):(l instanceof Date?(v=Xn(l),d==="oldest"?k="Oldest":d==="newest"&&(k="Newest")):typeof l=="number"?d==="dateRange"?(v=dn(l,u,a,c),k="Days"):v=dn(l,u,a,c):v=String(l),k?k+=` \u2022 ${S} note${S===1?"":"s"}`:k=`${S} note${S===1?"":"s"}`);let T=A.createDiv({cls:"prop-charts-metric-content"});if(o){let O=T.createDiv({cls:"prop-charts-metric-label"});O.textContent=o,i==="below"&&(O.style.order="3")}let E=T.createDiv({cls:"prop-charts-metric-value"});if(E.textContent=v,E.style.color=H?"var(--text-error, #ff6b6b)":y,E.style.cursor=S>0&&!H?"pointer":"default",k){let O=T.createDiv({cls:"prop-charts-metric-subtext"});O.textContent=k,H&&(O.style.color="var(--text-error, #ff6b6b)")}let x=A.createDiv({cls:"prop-charts-metric-info"});x.textContent="\u24D8",x.style.cursor="help";let N=A.createDiv({cls:"prop-charts-metric-tooltip"});N.style.display="none";let b=[];g&&b.push(`Data type: ${g}`),d&&b.push(`Operation: ${zn(d)}`),b.push(`Notes: ${S}`);let L=b.join(`
`);x.addEventListener("mouseenter",O=>{let I=A.getBoundingClientRect();N.textContent=L,N.style.display="block";let z=N.getBoundingClientRect(),U=O.clientX-I.left+6,j=O.clientY-I.top+6;U+z.width>I.width-4&&(U=I.width-z.width-4),U<4&&(U=4),j+z.height>I.height-4&&(j=I.height-z.height-4),j<4&&(j=4),N.style.left=U+"px",N.style.top=j+"px"}),x.addEventListener("mouseleave",()=>{N.style.display="none"}),S>0&&!H&&(E.addEventListener("click",()=>{pt(s,s.createDiv({cls:"chart-notes-details"}),o||"Metric",typeof l=="number"?l:0,D,!0)}),A.style.cursor="pointer",A.addEventListener("click",()=>{pt(s,s.createDiv({cls:"chart-notes-details"}),o||"Metric",typeof l=="number"?l:0,D,!0)}))}var ge=class{render(r,t,n,e){var i;let{title:o}=(i=t.options)!=null?i:{};if(r.empty(),r.addClass("prop-charts-container"),t.type!=="metric"){let a=r.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});o&&(a.textContent=o)}switch(t.type){case"bar":De(r,t,n);break;case"stacked-bar":Xe(r,t,n);break;case"line":Ne(r,t,n,!1);break;case"stacked-area":cn(r,t,n);break;case"pie":ln(r,t,n);break;case"scatter":un(r,t,n);break;case"gantt":fe(r,t,n,e);break;case"metric":pn(r,t,n);break;default:r.createDiv({text:"Chart Notes: unsupported type: "+t.type})}}};var ye=class extends Zt.Plugin{constructor(t,n){super(t,n)}async onload(){console.log("Chart Notes: loading plugin (Bases-only)"),this.indexer=new pe(this.app),await this.indexer.buildIndex(),this.query=new me(()=>this.indexer.getAll(),[]),this.renderer=new ge,this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("create",async t=>{t instanceof Zt.TFile&&await this.indexer.updateFile(t)})),this.registerEvent(this.app.vault.on("delete",async t=>{t instanceof Zt.TFile&&this.indexer.removeFile(t)})),this.registerBasesView(we,{name:"Chart Notes",icon:"lucide-chart-area",factory:(t,n)=>new ue(t,n,this.renderer),options:()=>{let t=[];return t.push({type:"dropdown",key:"chartType",displayName:"Chart type",description:"Type of chart to render",default:"bar",options:{bar:"Bar","stacked-bar":"Stacked bar",line:"Line","stacked-area":"Stacked area",pie:"Pie",scatter:"Scatter",gantt:"Gantt",metric:"Indicator"}}),t.push({type:"property",key:"xProperty",displayName:"X axis / category (bars & slices)",description:"Property used for the X axis or categories (for pie, this is the slice).",shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="gantt"||e==="metric"}}),t.push({type:"property",key:"ganttLabelProperty",displayName:"Task label (Gantt)",description:`Label for each task bar.
If empty, uses the note title.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"yProperty",displayName:"Y value (empty = count)",description:`Numeric property summed on the Y axis.
Leave empty to just count notes.`,shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="pie"||e==="gantt"||e==="metric"}}),t.push({type:"property",key:"seriesProperty",displayName:"Series / color (optional)",description:"Property that defines series / color for bars, lines and stacked area.",shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="pie"||e==="metric"}}),t.push({type:"dropdown",key:"aggregateMode",displayName:"Value aggregation (Y)",description:`How to aggregate Y when multiple notes share the same X/series.
For line/stacked-area, 'Cumulative sum' turns the series into a running total.`,default:"sum",options:{sum:"Sum",count:"Count (ignore Y)","cumulative-sum":"Cumulative sum"},shouldHide:n=>{var o;let e=String((o=n.get("chartType"))!=null?o:"bar");return e==="scatter"||e==="gantt"||e==="stacked-bar"||e==="metric"}}),t.push({type:"property",key:"startProperty",displayName:"Start (Gantt)",description:"Start date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"endProperty",displayName:"End (Gantt)",description:"End date/datetime for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"dueProperty",displayName:"Due (deadline, optional)",description:"Due date / deadline for the task.",shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"property",key:"durationProperty",displayName:"Duration in minutes (optional)",description:`Duration of the task in minutes.
Used together with start/end/due.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="gantt"}}),t.push({type:"toggle",key:"drilldown",displayName:"Drilldown (click opens notes)",default:!0,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")==="metric"}}),t.push({type:"text",key:"title",displayName:"Title (optional)",description:`Custom chart title.
Falls back to the view name.`}),t.push({type:"property",key:"metricProperty",displayName:"Property",description:`Property to measure.
Leave empty to count all notes in this view.`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"dropdown",key:"metricDataType",displayName:"Data type",description:"Type of data in the property.",default:"number",options:{number:"Number",date:"Date",text:"Text/Other (count only)"},shouldHide:n=>{var i;if(String((i=n.get("chartType"))!=null?i:"bar")!=="metric")return!0;let o=n.get("metricProperty");return!o||o.trim()===""||o==="undefined"||o==="null"}}),t.push({type:"dropdown",key:"metricOperation",displayName:"How to calculate",description:`Operation to perform.
Options will be validated based on the selected data type.`,default:"countAll",options:{countAll:"Count all notes",countNonEmpty:"Count notes where property is set",sum:"Sum of values",avg:"Average of values",min:"Smallest value",max:"Largest value"},shouldHide:n=>{var a,c;if(String((a=n.get("chartType"))!=null?a:"bar")!=="metric")return!0;let o=String((c=n.get("metricDataType"))!=null?c:"number"),i=n.get("metricProperty");return i&&i.trim()!==""&&i!=="undefined"&&i!=="null"?o==="date":!1}}),t.push({type:"dropdown",key:"metricDateOperation",displayName:"Date operation",description:`Operation to perform on date values.
Only shown when data type is Date.`,default:"countNonEmpty",options:{countAll:"Count all notes",countNonEmpty:"Count notes with date",oldest:"Oldest date",newest:"Newest date",dateRange:"Date range (newest - oldest)"},shouldHide:n=>{var a,c;if(String((a=n.get("chartType"))!=null?a:"bar")!=="metric")return!0;let o=n.get("metricProperty");return o&&o.trim()!==""&&o!=="undefined"&&o!=="null"?String((c=n.get("metricDataType"))!=null?c:"number")!=="date":!0}}),t.push({type:"text",key:"metricLabel",displayName:"Label",description:`Text to display with the number.
e.g., Total tasks, Average duration`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"dropdown",key:"metricLabelPosition",displayName:"Label position",description:"Where to show the label relative to the number.",default:"above",options:{above:"Label above number",below:"Label below number"},shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"dropdown",key:"metricDecimals",displayName:"Decimal places",description:"Number of decimal places to show.",default:"0",options:{0:"0",1:"1",2:"2",3:"3"},shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"text",key:"metricPrefix",displayName:"Prefix (optional)",description:`Text to show before the number.
e.g., R$, %, #`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"text",key:"metricSuffix",displayName:"Suffix (optional)",description:`Text to show after the number.
e.g., h, days, units, %`,shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t.push({type:"dropdown",key:"metricColor",displayName:"Highlight color",description:"Color for the number display.",default:"auto",options:{auto:"Automatic (theme)",accent:"Accent color",green:"Green",red:"Red",blue:"Blue",orange:"Orange",purple:"Purple"},shouldHide:n=>{var e;return String((e=n.get("chartType"))!=null?e:"bar")!=="metric"}}),t}})}onunload(){console.log("Chart Notes: unloading plugin")}};
