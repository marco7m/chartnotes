/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ie=Object.defineProperty;var Ke=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Ue=Object.prototype.hasOwnProperty;var Ge=(n,t)=>{for(var e in t)ie(n,e,{get:t[e],enumerable:!0})},Be=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Qe(t))!Ue.call(n,o)&&o!==e&&ie(n,o,{get:()=>t[o],enumerable:!(s=Ke(t,o))||s.enumerable});return n};var Ye=n=>Be(ie({},"__esModule",{value:!0}),n);var sn={};Ge(sn,{default:()=>ne});module.exports=Ye(sn);var It=require("obsidian");var De=require("obsidian"),Xt=class{constructor(t){this.index=new Map;this.app=t}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)await this.updateFile(e)}async fullReindex(){await this.buildIndex()}getAll(){return Array.from(this.index.values())}async updateFile(t){if(t.extension!=="md")return;let e={};try{let o=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/);if(o){let i=(0,De.parseYaml)(o[1])||{};if(i&&typeof i=="object")for(let[m,c]of Object.entries(i))m!=="position"&&(e[m]=c)}let r=this.app.metadataCache.getFileCache(t);r!=null&&r.tags&&!e.tags&&(e.tags=r.tags.map(i=>i.tag.replace(/^#/,"")))}catch(s){console.error("Chart Notes: erro ao indexar",t.path,s)}this.index.set(t.path,{path:t.path,props:e})}removeFile(t){this.index.delete(t.path)}};function Te(n,t){if(!t||t.length===0)return!0;for(let e of t){if(e===".")return!0;let s=e.endsWith("/")?e:e+"/";if(n===e||n.startsWith(s))return!0}return!1}function Re(n,t){if(!t||t.length===0)return!0;let e=n.tags;if(!e)return!1;if(Array.isArray(e)){for(let o of t)if(e.includes(o)||e.includes("#"+o))return!0;return!1}let s=String(e);for(let o of t)if(s===o||s==="#"+o)return!0;return!1}function jt(n){return typeof n!="string"?!1:/^\d{4}-\d{2}-\d{2}/.test(n)}function $t(n){if(n instanceof Date)return n;if(typeof n!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(n)){let[e,s,o]=n.split("-");return new Date(Number(e),Number(s)-1,Number(o),0,0,0,0)}let t=new Date(n);return isNaN(t.getTime())?null:t}function ut(n){let t=new Date(n);return t.setHours(0,0,0,0),t}function qt(n,t){let e=new Date(n);return e.setDate(e.getDate()-t),e}function Ve(n,t){return qt(n,t*7)}function Oe(n,t){let e=new Date(n);return e.setMonth(e.getMonth()-t),e}function ce(n,t){let e=new Date(n);return e.setDate(e.getDate()+t),e}function Xe(n,t){return ce(n,t*7)}function qe(n,t){let e=new Date(n);return e.setMonth(e.getMonth()+t),e}function Ce(n){let t=n.toLowerCase();return!!(["date","scheduled","due","start","end","created","modified","datecreated","datemodified"].includes(t)||t.endsWith("date")||t.endsWith("at")||t.endsWith("on"))}function Me(n,t){let e=t?new Date(t):new Date,s=ut(e),o=n.trim().toLowerCase();if(o==="today")return s;if(o==="yesterday")return ut(qt(s,1));if(/^-\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(qt(s,r))}if(/^-\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(qt(s,r))}if(/^-\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Ve(s,r))}if(/^-\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Oe(s,r))}if(/^\+\d+$/.test(o)){let r=parseInt(o.slice(1),10);return ut(ce(s,r))}if(/^\+\d+d$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(ce(s,r))}if(/^\+\d+w$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(Xe(s,r))}if(/^\+\d+m$/.test(o)){let r=parseInt(o.slice(1,-1),10);return ut(qe(s,r))}return null}function ke(n){let t=n.trim(),e=t.match(/^([a-zA-Z0-9_.-]+)\s+between\s+(.+)\s+and\s+(.+)$/i);if(e){let h=e[1].trim(),g=e[2].trim(),k=e[3].trim(),A=Ce(h),M=ae(g,A),v=ae(k,A),L=M.valueType==="date"||v.valueType==="date"?"date":M.valueType;return{field:h,op:"between",value:M.value,value2:v.value,valueType:L}}let s=/(==|!=|>=|<=|>|<)/,o=t.split(s);if(o.length!==3)throw new Error("express\xE3o where inv\xE1lida: "+n);let r=o[0].trim(),i=o[1].trim(),m=o[2].trim(),c=Ce(r),d=ae(m,c);return{field:r,op:i,value:d.value,valueType:d.valueType}}function ae(n,t){let e=n.trim();if(e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"'))return{value:e.slice(1,-1),valueType:"string"};let s=e.toLowerCase(),o=s==="today"||s==="yesterday"||s.startsWith("-")||s.startsWith("+");if(t){if(e==="0"||s==="today")return{value:ut(new Date),valueType:"date"};let i=Me(e);if(i)return{value:i,valueType:"date"}}else if(o){let i=Me(e);if(i)return{value:i,valueType:"date"}}if(jt(e)){let i=$t(e);if(i)return{value:i,valueType:"date"}}let r=Number(e);return Number.isNaN(r)?{value:e,valueType:"string"}:{value:r,valueType:"number"}}function Ne(n,t){let e=n[t.field];if(e==null)return!1;if(t.valueType==="date"){let r=e instanceof Date?ut(e):jt(e)?ut($t(e)):null;if(!r)return!1;let i=t.value instanceof Date?t.value:null,m=t.value2 instanceof Date?t.value2:null;if(!i)return!1;let c=r.getTime(),d=ut(i).getTime();switch(t.op){case"==":return c===d;case"!=":return c!==d;case">":return c>d;case">=":return c>=d;case"<":return c<d;case"<=":return c<=d;case"between":if(!m)return!1;let h=ut(m).getTime();return c>=d&&c<=h}}if(t.valueType==="number"){let r=Number(e);if(isNaN(r))return!1;let i=Number(t.value);switch(t.op){case"==":return r===i;case"!=":return r!==i;case">":return r>i;case">=":return r>=i;case"<":return r<i;case"<=":return r<=i;case"between":return typeof t.value2!="number"?!1:r>=i&&r<=t.value2}}let s=String(e),o=String(t.value);switch(t.op){case"==":return s===o;case"!=":return s!==o;case">":return s>o;case">=":return s>=o;case"<":return s<o;case"<=":return s<=o;case"between":return!1}}function je(n){if(typeof n=="string"&&/^\d{4}-\d{2}-\d{2}/.test(n))return{key:n.slice(0,10),isDate:!0};if(jt(n)){let t=$t(n);if(t)return{key:t,isDate:!0}}return{key:n,isDate:!1}}function Ze(n,t){let e=n.x,s=t.x;if(e instanceof Date&&s instanceof Date)return e.getTime()-s.getTime();let o=String(e),r=String(s);return o<r?-1:o>r?1:0}function Je(n,t){var r,i;let e=Ze(n,t);if(e!==0)return e;let s=(r=n.series)!=null?r:"",o=(i=t.series)!=null?i:"";return s<o?-1:s>o?1:0}function tn(n){if(n==null)return 0;if(typeof n=="number")return n>0?Math.floor(n):0;if(typeof n=="string"){let t=n.trim().match(/^(\d+)/);if(t){let e=Number(t[1]);return Number.isFinite(e)&&e>0?Math.floor(e):0}}throw new Error(`aggregate.rolling inv\xE1lido: ${String(n)}`)}function en(n){var s,o;let t=new Map,e=[];for(let r of n){let i=(s=r.series)!=null?s:"__no_series__",c=((o=t.get(i))!=null?o:0)+r.y;t.set(i,c),e.push({...r,y:c})}return e}function nn(n,t){var i,m;let e=tn(t);if(!e||e<=1)return[...n];let s=new Map,o=new Map,r=[];for(let c of n){let d=(i=c.series)!=null?i:"__no_series__",h=s.get(d);h||(h=[],s.set(d,h));let g=(m=o.get(d))!=null?m:0;if(h.push(c.y),g+=c.y,h.length>e){let M=h.shift();g-=M}o.set(d,g);let k=h.length||1,A=g/k;r.push({...c,y:A})}return r}var Zt=class{constructor(t,e){this.getIndex=t,this.defaultPaths=e}run(t){var i,m,c;let e=this.getIndex(),s=(i=t.source)!=null&&i.paths&&t.source.paths.length?t.source.paths:this.defaultPaths,o=(m=t.source)!=null&&m.tags&&t.source.tags.length?t.source.tags:[],r=[];for(let d of e){let h=s&&s.length?Te(d.path,s):!0,g=o&&o.length?Re(d.props,o):!0;if(!h||!g)continue;let k=!0;if((c=t.source)!=null&&c.where&&t.source.where.length>0)for(let A of t.source.where){let M;try{M=ke(A)}catch(v){throw new Error(`Condi\xE7\xE3o inv\xE1lida: ${A} (${v.message})`)}if(!Ne(d.props,M)){k=!1;break}}k&&r.push(d)}return t.type==="gantt"?this.runGantt(t,r):t.type==="table"?this.runTable(t,r):this.runStandard(t,r)}runTable(t,e){var o,r;return{rows:e.map(i=>({x:i.path,y:0,notes:[i.path],props:i.props})),xField:(o=t.encoding)==null?void 0:o.x,yField:(r=t.encoding)==null?void 0:r.y}}runGantt(t,e){var g,k,A;let s=(g=t.encoding)!=null?g:{},o=s.start,r=s.end,i=(k=s.label)!=null?k:s.x,m=s.series,c=s.duration,d=s.due,h=[];for(let M of e){let v=(A=M.props)!=null?A:{},L=C=>Array.isArray(C)?C[0]:C,F=null;if(r){let C=L(v[r]),y=$t(C);y&&(F=y)}if(!F)continue;let I=null;if(o){let C=L(v[o]),y=$t(C);y&&(I=y)}if(!I&&c){let C=L(v[c]),y=Number(C);Number.isNaN(y)||(I=new Date(F.getTime()-y*6e4))}I||(I=new Date(F.getTime()));let Q;if(d){let C=L(v[d]),y=$t(C);y&&(Q=y)}let N;if(i){let C=L(v[i]);(C==null||C==="")&&(C=M.path),N=C}else N=M.path;let Y;if(m){let C=L(v[m]);C!=null&&(Y=String(C))}let U={x:N,y:0,notes:[M.path],series:Y,start:I,end:F,props:v};Q&&(U.due=Q),h.push(U)}return h.sort((M,v)=>{let L=M.start?M.start.getTime():0,F=v.start?v.start.getTime():0;return L-F}),{rows:h,xField:i,yField:r}}runStandard(t,e){var M,v,L,F,I,Q,N,Y,U,C;let s=(M=t.encoding)==null?void 0:M.x,o=(v=t.encoding)==null?void 0:v.y,r=(L=t.encoding)==null?void 0:L.series;if(!s)throw new Error("encoding.x \xE9 obrigat\xF3rio.");let i=(F=t.aggregate)!=null?F:{},m=(I=i.y)!=null?I:null,c=!!i.cumulative,d=i.rolling;if(!o&&m!=="count")throw new Error("encoding.y \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count').");let h=[];for(let y of e){let l=(Q=y.props)!=null?Q:{},S=_=>Array.isArray(_)?_[0]:_,w=S(l[s]);if(w==null)continue;let f=je(w),R=f.key,G=f.isDate,nt;if(r){let _=S(l[r]);_!=null&&String(_).trim()!==""&&(nt=String(_))}let H;if(m==="count")H=1;else{let _=S(l[o]);if(_==null)continue;let j=Number(_);if(Number.isNaN(j))continue;H=j}h.push({x:R,y:H,notes:[y.path],series:nt,props:l,_isDate:G,_origX:w})}if(h.length===0)return{rows:[],xField:s,yField:o};let g=[];if(m){let y=new Map;for(let l of h){let S=(N=l.series)!=null?N:"",w=l.x instanceof Date?l.x.toISOString().slice(0,10):String(l.x),f=S+"||"+w,R=(Y=y.get(f))!=null?Y:{sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,notes:[],xRep:l.x,isDate:l._isDate,series:l.series,props:l.props};R.sum+=l.y,R.count+=1,l.y<R.min&&(R.min=l.y),l.y>R.max&&(R.max=l.y),R.notes.push(...l.notes),R.props=(U=l.props)!=null?U:R.props,y.set(f,R)}for(let[,l]of y){let S=l.sum;switch(m){case"sum":S=l.sum;break;case"avg":S=l.sum/l.count;break;case"min":S=l.min;break;case"max":S=l.max;break;case"count":S=l.count;break}g.push({x:l.xRep,y:S,notes:l.notes,series:l.series,props:l.props})}}else g=h.map(y=>({x:y.x,y:y.y,notes:y.notes,series:y.series,props:y.props}));if(g.length===0)return{rows:[],xField:s,yField:o};let k=((C=t.sort)==null?void 0:C.x)==="desc"?"desc":"asc";if(g.sort((y,l)=>{let S=Je(y,l);return k==="asc"?S:-S}),(c||d)&&!(t.type==="line"||t.type==="area"))throw new Error("aggregate.cumulative / aggregate.rolling s\xF3 s\xE3o suportados em type: 'line' ou 'area'.");if(c&&d)throw new Error("Ainda n\xE3o \xE9 poss\xEDvel usar 'cumulative' e 'rolling' juntos no mesmo gr\xE1fico.");let A=g;return d?A=nn(g,d):c&&(A=en(g)),{rows:A,xField:s,yField:o}}};var Ct=require("obsidian");var Le=["#5b6cff","#5ec27f","#ffb347","#ff6b6b","#b47cff","#4dbbd5","#f78fb3","#50e3a4"];function it(n,t){if(!n)return"var(--text-accent, #5b6cff)";let e=Array.from(n).reduce((s,o)=>s*33+o.charCodeAt(0)>>>0,0);return Le[e%Le.length]}function At(n,t){n.addClass("prop-charts-container"),n.style.width="100%",n.style.maxWidth="100%",n.style.position="relative";let e=n.createDiv({cls:"chart-notes-scroll"});e.style.overflowX="auto",e.style.overflowY="hidden",e.style.width="100%",e.style.maxWidth="100%";let s=e.createDiv({cls:"chart-notes-inner"});s.style.display="block",s.style.minHeight=`${300}px`,t&&(s.style.background=t);let o="http://www.w3.org/2000/svg",r=document.createElementNS(o,"svg");r.setAttribute("width","100%"),r.setAttribute("height",String(300)),r.style.display="block",s.appendChild(r);let i=n.createDiv({cls:"chart-notes-tooltip"});i.style.display="none";let m=n.createDiv({cls:"chart-notes-details"});return m.style.display="none",{scroll:e,inner:s,svg:r,tooltip:i,details:m}}function mt(n,t,e,s,o,r){let i=n.getBoundingClientRect(),m=typeof s=="number"?Number.isInteger(s)?String(s):s.toFixed(2):String(s);t.innerHTML=`
    <div class="chart-notes-tooltip-title">${e}</div>
    <div class="chart-notes-tooltip-value">${m}</div>
    <div class="chart-notes-tooltip-notes">${o} nota${o===1?"":"s"}</div>
  `,t.style.display="block";let c=t.getBoundingClientRect(),d=r.clientX-i.left+6,h=r.clientY-i.top+6;d+c.width>i.width-4&&(d=i.width-c.width-4),d<4&&(d=4),h+c.height>i.height-4&&(h=i.height-c.height-4),h<4&&(h=4),t.style.left=d+"px",t.style.top=h+"px"}function gt(n){n.style.display="none"}function yt(n,t,e,s,o,r){if(!r)return;if(t.empty(),!o||o.length===0){t.style.display="none";return}t.style.display="block";let i=t.createEl("div",{cls:"chart-notes-details-header"}),m=i.createEl("div",{cls:"chart-notes-details-title"});m.textContent=`Notas em "${e}" (${o.length})`+(Number.isFinite(s)&&s!==0?` \u2013 valor ${Number.isInteger(s)?s:s.toFixed(2)}`:"");let c=i.createEl("button",{cls:"chart-notes-details-close"});c.textContent="\xD7",c.addEventListener("click",()=>{t.style.display="none"});let d=t.createEl("ul",{cls:"chart-notes-details-list"});for(let h of o){let k=d.createEl("li",{cls:"chart-notes-details-item"}).createEl("a",{cls:"chart-notes-details-link",text:h});k.href="#",k.addEventListener("click",A=>{A.preventDefault(),app.workspace.openLinkText(h,"",!1)})}}function Kt(n){if(!(n instanceof Date)||isNaN(n.getTime()))return"";let t=n.getDate().toString().padStart(2,"0"),e=(n.getMonth()+1).toString().padStart(2,"0");return`${t}/${e}`}function Ie(n){if(!n)return!1;let t=n.trim().toLowerCase();if(t==="#fff"||t==="#ffffff"||t==="white")return!0;if(!t.startsWith("#"))return!1;let e,s,o;if(t.length===4)e=parseInt(t[1]+t[1],16),s=parseInt(t[2]+t[2],16),o=parseInt(t[3]+t[3],16);else if(t.length===7)e=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);else return!1;return(.2126*e+.7152*s+.0722*o)/255>.7}var le=class extends Ct.Modal{constructor(e,s,o,r){var m;super(app);this.notePath=e,this.spec=s,this.refresh=o,this.reindexFile=r;let i=(m=s.encoding)!=null?m:{};this.startKey=i.start,this.endKey=i.end,this.durationKey=i.duration,this.dueKey=i.due}async onOpen(){var C,y;let{contentEl:e}=this;e.empty();let s=this.app.vault.getAbstractFileByPath(this.notePath);if(!(s instanceof Ct.TFile)){e.createEl("p",{text:"Arquivo n\xE3o encontrado: "+this.notePath});return}let o=await this.app.vault.read(s),r={},i=o,m=/^---\n([\s\S]*?)\n---\n?/m.exec(o);if(m){try{r=(C=(0,Ct.parseYaml)(m[1]))!=null?C:{}}catch(l){r={}}i=o.slice(m[0].length)}(typeof r!="object"||r==null)&&(r={});let c=(y=this.notePath.replace(/\.md$/i,"").split("/").pop())!=null?y:this.notePath,d=e.createDiv({cls:"gantt-edit-header"}),h=d.createEl("a",{text:c,cls:"gantt-edit-title"});h.href="#",h.addEventListener("click",l=>{l.preventDefault(),this.app.workspace.openLinkText(this.notePath,this.notePath,!0)});let g=d.createDiv({cls:"gantt-edit-subtitle"});g.textContent=this.notePath;let k=e.createDiv({cls:"gantt-edit-form"}),A=l=>{let S=k.createDiv({cls:"gantt-edit-row"}),w=S.createDiv({cls:"gantt-edit-label"});w.textContent=l;let f=S.createDiv({cls:"gantt-edit-field"});return{row:S,field:f}},M=l=>{if(!l)return"";let w=String(l).match(/^(\d{4}-\d{2}-\d{2})/);return w?w[1]:""},v=l=>{if(l=l.trim(),!!l&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l},L=null;if(this.startKey){let{field:l}=A(this.startKey+" (in\xEDcio)");L=l.createEl("input",{type:"date"}),L.value=M(r[this.startKey])}let F=null;if(this.endKey){let{field:l}=A(this.endKey+" (fim)");F=l.createEl("input",{type:"date"}),F.value=M(r[this.endKey])}let I=null;if(this.durationKey){let{field:l}=A(this.durationKey+" (minutos)");I=l.createEl("input",{type:"number"});let S=r[this.durationKey];I.value=S!=null?String(S):"",I.min="0",I.step="5"}let Q=null;if(this.dueKey){let{field:l}=A(this.dueKey+" (due)");Q=l.createEl("input",{type:"date"}),Q.value=M(r[this.dueKey])}let N=e.createDiv({cls:"gantt-edit-buttons"}),Y=N.createEl("button",{text:"Salvar",cls:"mod-cta"});N.createEl("button",{text:"Cancelar"}).addEventListener("click",l=>{l.preventDefault(),this.close()}),Y.addEventListener("click",async l=>{if(l.preventDefault(),this.startKey&&L){let f=v(L.value);f?r[this.startKey]=f:delete r[this.startKey]}if(this.endKey&&F){let f=v(F.value);f?r[this.endKey]=f:delete r[this.endKey]}if(this.durationKey&&I){let f=I.value.trim();if(f==="")delete r[this.durationKey];else{let R=Number(f);Number.isNaN(R)||(r[this.durationKey]=R)}}if(this.dueKey&&Q){let f=v(Q.value);f?r[this.dueKey]=f:delete r[this.dueKey]}let w=`---
${(0,Ct.stringifyYaml)(r).trim()}
---
`+i;if(await this.app.vault.modify(s,w),this.reindexFile)try{await this.reindexFile(this.notePath)}catch(f){}if(this.refresh)try{this.refresh()}catch(f){}new Ct.Notice("Task atualizada"),this.close()})}onClose(){this.contentEl.empty()}};function Jt(n,t,e,s){var fe,me,ge,ye,be,xe,ve,Se;let o=(fe=t.options)!=null?fe:{},r=o.background,i=(me=o.drilldown)!=null?me:!0,m=!0,c=a=>{if(a==null)return"";let E=String(a).trim();if(!E)return"";let P=E.match(/^\[\[(.+?)\]\]$/);P&&(E=P[1]);let V=E.lastIndexOf("/");return V>=0&&V<E.length-1&&(E=E.slice(V+1)),E};if(Array.from(n.querySelectorAll(".gantt-zoom-controls, .gantt-label-floating-btn, .chart-notes-scroll, .chart-notes-details, .chart-notes-tooltip, .prop-charts-empty")).forEach(a=>a.remove()),e.rows.length===0){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let d=e.rows.filter(a=>a.start&&a.end);if(d.length===0){n.createDiv({cls:"prop-charts-empty",text:"Gantt: faltam campos de data."});return}let h=t.encoding,g=h.group,k=h.duration,A=(a,E)=>{if(!a||!E)return;let P=a[E];return Array.isArray(P)?P[0]:P},v=d.map(a=>{var xt,lt;let E=a.start,P=a.end,V=a.props,Pt=typeof a.x=="string"?a.x:a.x instanceof Date?Kt(E):String(a.x),wt=c(Pt),bt,Ft=g?A(V,g):void 0;Ft!=null?bt=String(Ft):a.series!=null?bt=String(a.series):bt=wt;let ft=(xt=a.notes)==null?void 0:xt[0],Et=ft?(lt=ft.replace(/\.md$/i,"").split("/").pop())!=null?lt:ft:wt,Mt=a.due,_t,Nt=A(V,k);if(Nt!=null){let vt=Number(Nt);Number.isNaN(vt)||(_t=vt)}return{row:a,start:E,end:P,props:V,fullName:wt,groupKey:bt,notePath:ft,noteTitle:Et,due:Mt,estMinutes:_t}}).filter(a=>a.start instanceof Date&&!isNaN(a.start.getTime())&&a.end instanceof Date&&!isNaN(a.end.getTime()));if(v.length===0){n.createDiv({cls:"prop-charts-empty",text:"Gantt: datas inv\xE1lidas."});return}v.sort((a,E)=>{if(a.groupKey<E.groupKey)return-1;if(a.groupKey>E.groupKey)return 1;let P=a.start.getTime(),V=E.start.getTime();return P!==V?P-V:a.fullName.localeCompare(E.fullName)});let L=26,F=0,I=null;for(let a of v)a.groupKey!==I&&(I=a.groupKey,F+=1),F+=1;let Q=Math.min(...v.map(a=>a.start.getTime())),N=Math.max(...v.map(a=>a.end.getTime()));if(!isFinite(Q)||!isFinite(N)){n.createDiv({cls:"prop-charts-empty",text:"Gantt: intervalo de datas inv\xE1lido."});return}let Y=24*60*60*1e3,U=a=>{let E=new Date(a);return E.setHours(0,0,0,0),E.getTime()},C=U(Q),y=U(N),l=n.querySelector(".prop-charts-title-row");l||(l=n.createDiv({cls:"prop-charts-title-row"}));let S=n.dataset.ganttZoomMode||String((ge=o.zoomMode)!=null?ge:"100");n.dataset.ganttZoomMode=S;let w=n.dataset.ganttLabelMode||String((ye=o.labelMode)!=null?ye:"compact");n.dataset.ganttLabelMode=w;let f=l.createDiv({cls:"gantt-zoom-controls"});[{id:"fit",label:"Fit"},{id:"100",label:"100%"},{id:"150",label:"150%"},{id:"200",label:"200%"}].forEach(a=>{let E=f.createEl("button",{cls:"gantt-zoom-btn",text:a.label});a.id===S&&E.addClass("is-active"),E.addEventListener("click",P=>{P.preventDefault(),n.dataset.ganttZoomMode=a.id,Jt(n,t,e,s)})}),f.createEl("button",{cls:"gantt-zoom-btn gantt-fullscreen-btn",text:"\u2922"}).addEventListener("click",a=>{a.preventDefault();let E=n.querySelector(".chart-notes-zoom-button");E&&E.click()});let nt=Number(o.labelWidth),H=!Number.isNaN(nt)&&nt>120?nt:260,_=w==="wide"?H+160:H,j=n.getBoundingClientRect().width||600,tt=Math.max(j,820),T;if(S==="fit")T=j;else{let a=Number(S)/100||1;T=tt*a}let{inner:u,svg:p,tooltip:b,details:x}=At(n,r);u.style.width=T+"px";let D=(a,E,P,V,Pt,wt,bt,Ft,ft)=>{if(!a)return;let Et=Math.max(40,V-8),_t=Math.max(8,Math.floor(Et/6)),Nt=a.split(/\s+/),xt=[],lt="";for(let Tt of Nt){if(!lt){lt=Tt;continue}(lt+" "+Tt).length<=_t?lt+=" "+Tt:(xt.push(lt),lt=Tt)}lt&&xt.push(lt);let vt=Pt+2,Wt=xt.length*vt,Gt=P-Wt/2+Pt;xt.forEach((Tt,Vt)=>{let ot=document.createElementNS(p.namespaceURI,"text");ot.setAttribute("x",String(E)),ot.setAttribute("y",String(Gt+Vt*vt)),ot.setAttribute("text-anchor","start"),ot.setAttribute("font-size",String(Pt)),ot.setAttribute("fill","#111111"),wt&&ot.setAttribute("font-weight",wt),ot.textContent=Tt,bt&&ot.addEventListener("mouseenter",st=>bt(st)),Ft&&ot.addEventListener("mouseleave",()=>Ft()),ft&&(ot.style.cursor="pointer",ot.addEventListener("click",st=>ft(st))),p.appendChild(ot)})},Z=28,z=28,rt=10,O=Math.max(300,Z+z+F*L+24);p.setAttribute("height",String(O));let W=T-_-rt,K=Z+6;p.style.color="#111111";let J=y+Y-C||1,at=C-J*.02,ht=y+Y+J*.08,ct=a=>_+(a-at)/(ht-at)*W,$=(ht-at)/Y,kt=Math.max(4,Math.min(12,Math.floor(W/90)||4)),dt=$/kt,q=[1,2,3,5,7,10,14,21,30,60,90,180,365],pt=q[q.length-1];for(let a of q)if(a>=dt){pt=a;break}let Ut=[],He=U(at);for(let a=He;a<=ht+.5*Y;a+=pt*Y)Ut.push(a);let Ht=document.createElementNS(p.namespaceURI,"line");Ht.setAttribute("x1",String(_)),Ht.setAttribute("y1",String(K)),Ht.setAttribute("x2",String(T-rt)),Ht.setAttribute("y2",String(K)),Ht.setAttribute("stroke","#111111"),p.appendChild(Ht);for(let a of Ut){let E=ct(a),P=document.createElementNS(p.namespaceURI,"line");P.setAttribute("x1",String(E)),P.setAttribute("y1",String(K)),P.setAttribute("x2",String(E)),P.setAttribute("y2",String(O-z)),P.setAttribute("stroke","#111111"),P.setAttribute("stroke-opacity","0.20"),P.setAttribute("stroke-dasharray","2,4"),p.appendChild(P);let V=document.createElementNS(p.namespaceURI,"text");V.setAttribute("x",String(E)),V.setAttribute("y",String(K-4)),V.setAttribute("text-anchor","middle"),V.setAttribute("font-size","10"),V.setAttribute("fill","#111111"),V.textContent=Kt(new Date(a)),p.appendChild(V)}let he=new Date;he.setHours(0,0,0,0);let se=he.getTime();if(se>=at&&se<=ht){let a=ct(se),E=document.createElementNS(p.namespaceURI,"line");E.setAttribute("x1",String(a)),E.setAttribute("y1",String(K)),E.setAttribute("x2",String(a)),E.setAttribute("y2",String(O-z)),E.setAttribute("stroke","#4caf50"),E.setAttribute("stroke-width","2"),E.setAttribute("stroke-dasharray","4,2"),p.appendChild(E);let P=document.createElementNS(p.namespaceURI,"text");P.setAttribute("x",String(a+4)),P.setAttribute("y",String(K+12)),P.setAttribute("font-size","10"),P.setAttribute("fill","#4caf50"),P.textContent="hoje",p.appendChild(P)}let Yt=u.createEl("button",{cls:"gantt-label-floating-btn",text:"\u2194"});Yt.setAttr("title",w==="wide"?"Compactar nomes":"Expandir nomes"),Yt.style.left=`${_}px`,Yt.style.top="4px",Yt.addEventListener("click",a=>{a.preventDefault();let P=(n.dataset.ganttLabelMode||"compact")==="wide"?"compact":"wide";n.dataset.ganttLabelMode=P,Jt(n,t,e,s)});let ze=["status","priority"],re=Array.isArray(o.tooltipFields)?o.tooltipFields.map(a=>String(a)):null,We=re&&re.length?re:ze,zt=0,oe=null;for(let a of v){let E=a.start,P=a.end,V=(P.getTime()-E.getTime())/6e4,Pt=a.props,wt=a.notePath,bt=a.noteTitle,Ft=(xe=(be=a.row.notes)==null?void 0:be.length)!=null?xe:0,ft=a.due,Et=a.estMinutes,Mt=[];Mt.push(`${Kt(E)} \u2192 ${Kt(P)}`),typeof Et=="number"&&!Number.isNaN(Et)?Mt.push(`est: ${Math.round(Et)} min`):V>0&&Mt.push(`dura\xE7\xE3o: ${Math.round(V)} min`),ft instanceof Date&&Mt.push(`due: ${Kt(ft)}`);for(let et of We){let B=A(Pt,et);B!=null&&String(B).trim()!==""&&Mt.push(`${et}: ${String(B)}`)}let _t=Mt.join("<br>"),Nt=et=>{var B;et.preventDefault(),m&&wt?new le(wt,t,s==null?void 0:s.refresh,s==null?void 0:s.reindexFile).open():yt(n,x,bt,Et!=null?Et:V,(B=a.row.notes)!=null?B:[],i)},xt=et=>{bt&&_t&&mt(n,b,bt,_t,Ft,et)},lt=()=>gt(b);if(a.groupKey!==oe){oe=a.groupKey;let et=K+8+zt*L+L/2,B=c(oe);D(B,4,et,_-12,11,"600"),zt+=1}let vt=K+8+zt*L,Wt=L-10,Gt=ct(E.getTime()),Tt=ct(P.getTime()),Vt=Math.max(4,Tt-Gt),ot=a.fullName,st=document.createElementNS(p.namespaceURI,"rect");st.setAttribute("x",String(Gt)),st.setAttribute("y",String(vt)),st.setAttribute("width",String(Vt)),st.setAttribute("height",String(Wt)),st.setAttribute("rx","3"),st.setAttribute("ry","3"),st.setAttribute("fill",it((ve=a.row.series)!=null?ve:ot,zt)),st.setAttribute("stroke","rgba(0,0,0,0.25)"),st.setAttribute("stroke-width","0.5"),st.style.cursor=m&&wt?"pointer":"default",st.addEventListener("mouseenter",xt),st.addEventListener("mouseleave",lt),st.addEventListener("click",Nt),p.appendChild(st);let Ae=vt+Wt/2;if(Vt>=6){let et=it((Se=a.row.series)!=null?Se:ot,zt),B=document.createElementNS(p.namespaceURI,"circle");B.setAttribute("cx",String(Gt)),B.setAttribute("cy",String(Ae)),B.setAttribute("r","3.5"),B.setAttribute("fill","#ffffff"),B.setAttribute("stroke",et),B.setAttribute("stroke-width","1.5"),p.appendChild(B);let Lt=document.createElementNS(p.namespaceURI,"circle");Lt.setAttribute("cx",String(Tt)),Lt.setAttribute("cy",String(Ae)),Lt.setAttribute("r","3.5"),Lt.setAttribute("fill","#ffffff"),Lt.setAttribute("stroke",et),Lt.setAttribute("stroke-width","1.5"),p.appendChild(Lt)}let we=vt+Wt/2+2,Ot=g?16:4;if(w==="wide")D(ot,Ot,we,_-Ot-4,11,null,xt,lt,Nt);else{let et=ot,B=Math.max(40,_-Ot-8),Ee=Math.max(8,Math.floor(B/6));et.length>Ee&&(et=et.slice(0,Ee-1)+"\u2026");let St=document.createElementNS(p.namespaceURI,"text");St.setAttribute("x",String(Ot)),St.setAttribute("y",String(we)),St.setAttribute("text-anchor","start"),St.setAttribute("font-size","11"),St.setAttribute("fill","#111111"),St.textContent=et,St.style.cursor="pointer",St.addEventListener("mouseenter",xt),St.addEventListener("mouseleave",lt),St.addEventListener("click",Nt),p.appendChild(St)}if(ft instanceof Date){let et=ct(ft.getTime()),B=document.createElementNS(p.namespaceURI,"line");B.setAttribute("x1",String(et)),B.setAttribute("y1",String(vt)),B.setAttribute("x2",String(et)),B.setAttribute("y2",String(vt+Wt)),B.setAttribute("stroke","#ff6b6b"),B.setAttribute("stroke-width","2"),B.setAttribute("stroke-dasharray","4,2"),p.appendChild(B)}zt+=1}if(m){let a=n.createDiv({cls:"prop-charts-empty"});a.textContent="Clique em uma barra ou no nome para ajustar datas e estimate da tarefa."}}function ue(n,t,e){var _,j,tt,T;let s=(_=t.options)!=null?_:{},o=s.background,r=(j=s.drilldown)!=null?j:!0,i=(tt=e.rows)!=null?tt:[];if(!i.length){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:m,svg:c,tooltip:d,details:h}=At(n,o),g=n.getBoundingClientRect().width||600,k=Math.max(g,480);m.style.width=k+"px";let A=40,M=16,v=18,L=28,F=300;c.setAttribute("height",String(F));let I=k-A-M,Q=F-v-L,N=new Map;for(let u of i){let p=String(u.x),b=(T=N.get(p))!=null?T:{label:u.x,rows:[]};b.rows.push(u),N.set(p,b)}let U=Array.from(N.keys()).sort((u,p)=>u<p?-1:u>p?1:0).map(u=>N.get(u)),C=U.length,y=new Set;i.forEach(u=>{u.series!=null&&y.add(String(u.series))});let l=Array.from(y),S=l.length>1,w=S?"grouped":"single",f=0;i.forEach(u=>{u.y>f&&(f=u.y)}),(!isFinite(f)||f<=0)&&(f=1);let R=u=>v+Q-u/(f||1)*Q,G=R(0),nt=4;for(let u=0;u<=nt;u++){let p=f*u/nt,b=R(p),x=document.createElementNS(c.namespaceURI,"line");x.setAttribute("x1",String(A)),x.setAttribute("y1",String(b)),x.setAttribute("x2",String(k-M)),x.setAttribute("y2",String(b)),x.setAttribute("stroke","#cccccc"),x.setAttribute("stroke-opacity","0.25"),c.appendChild(x);let D=document.createElementNS(c.namespaceURI,"text");D.setAttribute("x",String(A-4)),D.setAttribute("y",String(b+3)),D.setAttribute("text-anchor","end"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=String(Math.round(p)),c.appendChild(D)}let H=C>0?I/C:I;if(U.forEach((u,p)=>{let b=A+H*(p+.5),x=String(u.label),D=document.createElementNS(c.namespaceURI,"text");D.setAttribute("x",String(b)),D.setAttribute("y",String(F-L+12)),D.setAttribute("text-anchor","middle"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=x,c.appendChild(D)}),S){let u=n.createDiv({cls:"chart-notes-legend"});l.forEach((p,b)=>{let x=u.createDiv({cls:"chart-notes-legend-item"}),D=x.createDiv();D.style.width="10px",D.style.height="10px",D.style.borderRadius="999px",D.style.backgroundColor=it(p,b),x.createSpan({text:p})})}U.forEach((u,p)=>{let b=A+H*(p+.5),x=u.rows;if(w==="single"){let O=x[0],W=O.y,K=H*.6,J=b-K/2,at=R(W),ht=Math.max(2,G-at),ct=it("bar",p),$=document.createElementNS(c.namespaceURI,"rect");$.setAttribute("x",String(J)),$.setAttribute("y",String(at)),$.setAttribute("width",String(K)),$.setAttribute("height",String(ht)),$.setAttribute("fill",ct),$.setAttribute("stroke","rgba(0,0,0,0.25)"),$.setAttribute("stroke-width","0.5"),$.style.cursor="pointer";let X=String(u.label),kt=`valor: ${Math.round(W*100)/100}`;$.addEventListener("mouseenter",dt=>{var q,pt;return mt(n,d,X,kt,(pt=(q=O.notes)==null?void 0:q.length)!=null?pt:0,dt)}),$.addEventListener("mouseleave",()=>gt(d)),$.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(n,h,X,W,(q=O.notes)!=null?q:[],r)}),c.appendChild($);return}let D=l.length,Z=H/Math.max(D+1,2),z=D*Z,rt=b-z/2;l.forEach((O,W)=>{let K=x.find(q=>(q.series!=null?String(q.series):"")===O);if(!K)return;let J=K.y,at=rt+W*Z,ht=R(J),ct=Math.max(2,G-ht),$=it(O,W),X=document.createElementNS(c.namespaceURI,"rect");X.setAttribute("x",String(at)),X.setAttribute("y",String(ht)),X.setAttribute("width",String(Z)),X.setAttribute("height",String(ct)),X.setAttribute("fill",$),X.setAttribute("stroke","rgba(0,0,0,0.25)"),X.setAttribute("stroke-width","0.5"),X.style.cursor="pointer";let kt=`${O} @ ${String(u.label)}`,dt=`valor: ${Math.round(J*100)/100}`;X.addEventListener("mouseenter",q=>{var pt,Ut;return mt(n,d,kt,dt,(Ut=(pt=K.notes)==null?void 0:pt.length)!=null?Ut:0,q)}),X.addEventListener("mouseleave",()=>gt(d)),X.addEventListener("click",q=>{var pt;q.preventDefault(),yt(n,h,kt,J,(pt=K.notes)!=null?pt:[],r)}),c.appendChild(X)})})}function Pe(n,t,e){var H,_,j,tt;let s=(H=t.options)!=null?H:{},o=s.background,r=(_=s.drilldown)!=null?_:!0,i=(j=e.rows)!=null?j:[];if(!i.length){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:m,svg:c,tooltip:d,details:h}=At(n,o),g=n.getBoundingClientRect().width||600,k=Math.max(g,480);m.style.width=k+"px";let A=40,M=16,v=18,L=28,F=300;c.setAttribute("height",String(F));let I=k-A-M,Q=F-v-L,N=new Map;for(let T of i){let u=String(T.x),p=(tt=N.get(u))!=null?tt:{label:T.x,rows:[]};p.rows.push(T),N.set(u,p)}let U=Array.from(N.keys()).sort((T,u)=>T<u?-1:T>u?1:0).map(T=>N.get(T)),C=U.length,y=new Set;i.forEach(T=>{T.series!=null&&y.add(String(T.series))});let l=Array.from(y);if(!l.length){ue(n,t,e);return}let S=0;U.forEach(T=>{let u=T.rows.reduce((p,b)=>p+b.y,0);u>S&&(S=u)}),(!isFinite(S)||S<=0)&&(S=1);let w=T=>v+Q-T/(S||1)*Q,f=w(0),R=4;for(let T=0;T<=R;T++){let u=S*T/R,p=w(u),b=document.createElementNS(c.namespaceURI,"line");b.setAttribute("x1",String(A)),b.setAttribute("y1",String(p)),b.setAttribute("x2",String(k-M)),b.setAttribute("y2",String(p)),b.setAttribute("stroke","#cccccc"),b.setAttribute("stroke-opacity","0.25"),c.appendChild(b);let x=document.createElementNS(c.namespaceURI,"text");x.setAttribute("x",String(A-4)),x.setAttribute("y",String(p+3)),x.setAttribute("text-anchor","end"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=String(Math.round(u)),c.appendChild(x)}let G=C>0?I/C:I;U.forEach((T,u)=>{let p=A+G*(u+.5),b=String(T.label),x=document.createElementNS(c.namespaceURI,"text");x.setAttribute("x",String(p)),x.setAttribute("y",String(F-L+12)),x.setAttribute("text-anchor","middle"),x.setAttribute("font-size","10"),x.setAttribute("fill","#111111"),x.textContent=b,c.appendChild(x)});let nt=n.createDiv({cls:"chart-notes-legend"});l.forEach((T,u)=>{let p=nt.createDiv({cls:"chart-notes-legend-item"}),b=p.createDiv();b.style.width="10px",b.style.height="10px",b.style.borderRadius="999px",b.style.backgroundColor=it(T,u),p.createSpan({text:T})}),U.forEach((T,u)=>{let p=A+G*(u+.5),b=G*.6,x=p-b/2,D=0;l.forEach((Z,z)=>{let rt=T.rows.find(dt=>(dt.series!=null?String(dt.series):"")===Z);if(!rt)return;let O=rt.y,W=D,K=D+O;D=K;let J=w(W),at=w(K),ht=Math.max(2,J-at),ct=it(Z,z),$=document.createElementNS(c.namespaceURI,"rect");$.setAttribute("x",String(x)),$.setAttribute("y",String(at)),$.setAttribute("width",String(b)),$.setAttribute("height",String(ht)),$.setAttribute("fill",ct),$.setAttribute("stroke","rgba(0,0,0,0.25)"),$.setAttribute("stroke-width","0.5"),$.style.cursor="pointer";let X=`${Z} @ ${String(T.label)}`,kt=`valor: ${Math.round(O*100)/100}`;$.addEventListener("mouseenter",dt=>{var q,pt;return mt(n,d,X,kt,(pt=(q=rt.notes)==null?void 0:q.length)!=null?pt:0,dt)}),$.addEventListener("mouseleave",()=>gt(d)),$.addEventListener("click",dt=>{var q;dt.preventDefault(),yt(n,h,X,O,(q=rt.notes)!=null?q:[],r)}),c.appendChild($)})})}function de(n,t,e,s){var _,j,tt,T;let o=(_=t.options)!=null?_:{},r=o.background,i=(j=o.drilldown)!=null?j:!0,m=(tt=e.rows)!=null?tt:[];if(!m.length){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let{inner:c,svg:d,tooltip:h,details:g}=At(n,r),k=n.getBoundingClientRect().width||600,A=Math.max(k,480);c.style.width=A+"px";let M=40,v=16,L=18,F=24,I=300;d.setAttribute("height",String(I));let Q=A-M-v,N=I-L-F,Y=new Map;for(let u of m){let p=u.series!=null?String(u.series):"__default__",b=(T=Y.get(p))!=null?T:[];b.push(u),Y.set(p,b)}let U=Array.from(Y.keys()),C=[],y=new Set;for(let u of m){let p=String(u.x);y.has(p)||(y.add(p),C.push(u.x))}let l=C.length||1,S=u=>{let p=String(u),b=C.findIndex(x=>String(x)===p);return b<0?M:l===1?M+Q/2:M+b/(l-1)*Q},w=u=>String(u),f=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;for(let u of m)u.y<f&&(f=u.y),u.y>R&&(R=u.y);(!isFinite(f)||!isFinite(R))&&(f=0,R=1),f===R&&(f===0?R=1:f=0);let G=u=>L+N-(u-f)/(R-f||1)*N,nt=4;for(let u=0;u<=nt;u++){let p=f+(R-f)*u/nt,b=G(p),x=document.createElementNS(d.namespaceURI,"line");x.setAttribute("x1",String(M)),x.setAttribute("y1",String(b)),x.setAttribute("x2",String(A-v)),x.setAttribute("y2",String(b)),x.setAttribute("stroke","#cccccc"),x.setAttribute("stroke-opacity","0.25"),d.appendChild(x);let D=document.createElementNS(d.namespaceURI,"text");D.setAttribute("x",String(M-4)),D.setAttribute("y",String(b+3)),D.setAttribute("text-anchor","end"),D.setAttribute("font-size","10"),D.setAttribute("fill","#111111"),D.textContent=Math.abs(p)>=100?String(Math.round(p)):String(Math.round(p*10)/10),d.appendChild(D)}let H=U.filter(u=>u!=="__default__");if(H.length>1){let u=n.createDiv({cls:"chart-notes-legend"});H.forEach((p,b)=>{let x=p,D=u.createDiv({cls:"chart-notes-legend-item"}),Z=D.createDiv();Z.style.width="10px",Z.style.height="10px",Z.style.borderRadius="999px",Z.style.backgroundColor=it(x,b),D.createSpan({text:x})})}U.forEach((u,p)=>{let b=Y.get(u);if(!(b!=null&&b.length))return;let x=u==="__default__"?it("line",p):it(u,p),D=[...b].sort((z,rt)=>{let O=C.findIndex(K=>String(K)===String(z.x)),W=C.findIndex(K=>String(K)===String(rt.x));return O-W}),Z="";if(D.forEach((z,rt)=>{let O=S(z.x),W=G(z.y);Z+=(rt===0?"M ":" L ")+O+" "+W}),s){let z=D[0],rt=D[D.length-1],O=S(z.x),W=S(rt.x),K=G(f);Z+=` L ${W} ${K} L ${O} ${K} Z`;let J=document.createElementNS(d.namespaceURI,"path");J.setAttribute("d",Z),J.setAttribute("fill",x),J.setAttribute("fill-opacity","0.18"),J.setAttribute("stroke",x),J.setAttribute("stroke-width","1.5"),d.appendChild(J)}else{let z=document.createElementNS(d.namespaceURI,"path");z.setAttribute("d",Z),z.setAttribute("fill","none"),z.setAttribute("stroke",x),z.setAttribute("stroke-width","2"),d.appendChild(z)}D.forEach(z=>{let rt=S(z.x),O=G(z.y),W=document.createElementNS(d.namespaceURI,"circle");W.setAttribute("cx",String(rt)),W.setAttribute("cy",String(O)),W.setAttribute("r","3"),W.setAttribute("fill","#ffffff"),W.setAttribute("stroke",x),W.setAttribute("stroke-width","1.5"),W.style.cursor="pointer";let K=w(z.x),J=u==="__default__"?"":String(z.series),at=J?`${J} @ ${K}`:K,ht=`valor: ${Math.round(z.y*100)/100}`;W.addEventListener("mouseenter",ct=>{var $,X;return mt(n,h,at,ht,(X=($=z.notes)==null?void 0:$.length)!=null?X:0,ct)}),W.addEventListener("mouseleave",()=>gt(h)),W.addEventListener("click",ct=>{var $;ct.preventDefault(),yt(n,g,at,z.y,($=z.notes)!=null?$:[],i)}),d.appendChild(W)})})}function Fe(n,t,e){var Q;let{background:s,drilldown:o=!0}=(Q=t.options)!=null?Q:{};if(e.rows.length===0){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=Ie(s)?"#000000":void 0,i=n.getBoundingClientRect().width||600,{inner:m,svg:c,tooltip:d,details:h}=At(n,s),g=Math.max(i,420);m.style.width=g+"px",r&&(c.style.color=r);let k=300,A=g/2,M=(k-28+28)/2,v=Math.min(g/2-20,k/2-20),F=e.rows.map(N=>Math.max(0,N.y)).reduce((N,Y)=>N+Y,0)||1,I=-Math.PI/2;e.rows.forEach((N,Y)=>{var H;let U=N.x instanceof Date?N.x.toISOString().slice(0,10):String(N.x),C=N.y,y=C/F*Math.PI*2,l=A+v*Math.cos(I),S=M+v*Math.sin(I),w=A+v*Math.cos(I+y),f=M+v*Math.sin(I+y),R=y>Math.PI?1:0,G=document.createElementNS(c.namespaceURI,"path"),nt=[`M ${A} ${M}`,`L ${l} ${S}`,`A ${v} ${v} 0 ${R} 1 ${w} ${f}`,"Z"].join(" ");G.setAttribute("d",nt),G.setAttribute("fill",it((H=N.series)!=null?H:U,Y)),G.style.cursor="pointer",G.addEventListener("mouseenter",_=>{var j,tt;return mt(n,d,U,C,(tt=(j=N.notes)==null?void 0:j.length)!=null?tt:0,_)}),G.addEventListener("mouseleave",()=>gt(d)),G.addEventListener("click",()=>{var _;return yt(n,h,U,C,(_=N.notes)!=null?_:[],o)}),c.appendChild(G),I+=y})}function _e(n,t,e){var S;let{background:s,drilldown:o=!0}=(S=t.options)!=null?S:{};if(e.rows.length===0){n.createDiv({cls:"prop-charts-empty",text:"Sem dados."});return}let r=s?"#111111":void 0,i=n.getBoundingClientRect().width||600,{inner:m,svg:c,tooltip:d,details:h}=At(n,s),g=Math.max(i,700);m.style.width=g+"px",r&&(c.style.color=r);let k=300,A=g-48-10,M=k-28-28,v=e.rows.map(w=>{let f=w.x;if(f instanceof Date)return f.getTime();if(typeof f=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(f)){let G=new Date(f);if(!isNaN(G.getTime()))return G.getTime()}let R=Number(f);return isNaN(R)?null:R}return typeof f=="number"?f:null}),L=e.rows.map(w=>w.y),F=v.filter(w=>w!==null);if(F.length===0){n.createDiv({cls:"prop-charts-empty",text:"Sem dados (X n\xE3o \xE9 num\xE9rico/data)."});return}let I=Math.min(...F),Q=Math.max(...F),N=Math.min(...L),Y=Math.max(...L),U=w=>48+(w-I)/(Q-I||1)*A,C=w=>k-28-(w-N)/(Y-N||1)*M,y=document.createElementNS(c.namespaceURI,"line");y.setAttribute("x1",String(48)),y.setAttribute("y1",String(28)),y.setAttribute("x2",String(48)),y.setAttribute("y2",String(k-28)),y.setAttribute("stroke","currentColor"),c.appendChild(y);let l=document.createElementNS(c.namespaceURI,"line");l.setAttribute("x1",String(48)),l.setAttribute("y1",String(k-28)),l.setAttribute("x2",String(g-10)),l.setAttribute("y2",String(k-28)),l.setAttribute("stroke","currentColor"),c.appendChild(l),e.rows.forEach((w,f)=>{let R=v[f];if(R==null)return;let G=U(R),nt=C(L[f]),H=document.createElementNS(c.namespaceURI,"circle");H.setAttribute("cx",String(G)),H.setAttribute("cy",String(nt)),H.setAttribute("r","4"),H.setAttribute("fill",it(w.series,f)),H.style.cursor="pointer";let _=w.x instanceof Date?w.x.toISOString().slice(0,10):typeof w.x=="string"?w.x:String(w.x);H.addEventListener("mouseenter",j=>{var tt,T;return mt(n,d,_,w.y,(T=(tt=w.notes)==null?void 0:tt.length)!=null?T:0,j)}),H.addEventListener("mouseleave",()=>gt(d)),H.addEventListener("click",j=>{var tt;j.preventDefault(),yt(n,h,_,w.y,(tt=w.notes)!=null?tt:[],o)}),c.appendChild(H)})}var $e=require("obsidian"),ee=class{render(t,e,s,o,r=!1){var d;let{title:i}=(d=e.options)!=null?d:{};t.empty(),t.addClass("prop-charts-container");let c=t.createDiv({cls:"prop-charts-title-row"}).createDiv({cls:"prop-charts-title"});switch(i&&(c.textContent=i),e.type){case"bar":ue(t,e,s);break;case"stacked-bar":Pe(t,e,s);break;case"line":de(t,e,s,!1);break;case"area":de(t,e,s,!0);break;case"pie":Fe(t,e,s);break;case"scatter":_e(t,e,s);break;case"gantt":Jt(t,e,s,o);break;default:t.createDiv({text:"Chart Notes: tipo n\xE3o suportado: "+e.type})}if(!r){let h=t.createEl("button",{cls:"chart-notes-zoom-button"});h.setAttr("type","button"),h.setAttr("aria-label","Expandir gr\xE1fico"),h.textContent="\u2922",h.addEventListener("click",g=>{g.preventDefault(),new pe(e,s,this,o).open()})}}},pe=class extends $e.Modal{constructor(e,s,o,r){super(app);this.size="large";this.spec=e,this.data=s,this.renderer=o,this.ctx=r}onOpen(){var c;let{contentEl:e}=this;e.empty(),this.modalEl.addClass("chart-notes-zoom-modal-shell"),e.addClass("chart-notes-zoom-modal"),this.applySize();let s=e.createDiv({cls:"chart-notes-zoom-header"}),o=(c=this.spec.options)!=null&&c.title&&this.spec.options.title.trim().length>0?this.spec.options.title:"Chart Notes";s.createEl("div",{text:o,cls:"chart-notes-zoom-title"});let r=s.createDiv({cls:"chart-notes-zoom-sizes"}),i=(d,h)=>{let g=r.createEl("button",{cls:"chart-notes-zoom-size-btn",text:d});(()=>{g.toggleClass("is-active",this.size===h)})(),g.addEventListener("click",A=>{A.preventDefault(),this.size=h,this.applySize(),r.querySelectorAll(".chart-notes-zoom-size-btn").forEach(v=>v.classList.remove("is-active")),g.classList.add("is-active")})};i("S","small"),i("M","medium"),i("L","large");let m=e.createDiv({cls:"chart-notes-zoom-body"});this.renderer.render(m,this.spec,this.data,this.ctx,!0)}onClose(){this.contentEl.empty()}applySize(){let e=this.modalEl;if(!e)return;let s="95vw",o="85vh";switch(this.size){case"small":s="60vw",o="55vh";break;case"medium":s="80vw",o="70vh";break;case"large":default:s="95vw",o="85vh";break}e.style.maxWidth=s,e.style.width=s,e.style.height=o,e.style.maxHeight=o}};var ne=class extends It.Plugin{constructor(e,s){super(e,s)}async onload(){console.log("loading Chart Notes plugin"),this.indexer=new Xt(this.app),await this.indexer.buildIndex(),this.query=new Zt(()=>this.indexer.getAll(),[]),this.renderer=new ee,this.registerEvent(this.app.vault.on("modify",async e=>{e instanceof It.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("create",async e=>{e instanceof It.TFile&&await this.indexer.updateFile(e)})),this.registerEvent(this.app.vault.on("delete",async e=>{e instanceof It.TFile&&this.indexer.removeFile(e)})),this.registerMarkdownCodeBlockProcessor("chart",async(e,s,o)=>{var h;let r;try{let g=(0,It.parseYaml)(e);if(!g||typeof g!="object"){s.createEl("div",{text:"Chart Notes: bloco vazio ou inv\xE1lido."});return}r=g}catch(g){s.createEl("div",{text:"Chart Notes: erro ao ler YAML: "+g.message});return}if(!r.type){s.createEl("div",{text:"Chart Notes: 'type' obrigat\xF3rio."});return}let i=r.type==="gantt",m=r.type==="table";if(!i&&!m){if(!r.encoding||!r.encoding.x){s.createEl("div",{text:"Chart Notes: 'encoding.x' \xE9 obrigat\xF3rio."});return}let k=((h=r.aggregate)==null?void 0:h.y)==="count";if(!r.encoding.y&&!k){s.createEl("div",{text:"Chart Notes: 'encoding.y' \xE9 obrigat\xF3rio (exceto quando aggregate.y = 'count')."});return}}r.encoding||(r.encoding={}),r.source||(r.source={});let d;try{d=this.query.run(r)}catch(g){s.createEl("div",{text:"Chart Notes: erro na query: "+g.message});return}this.renderer.render(s,r,d)})}onunload(){console.log("unloading Chart Notes plugin")}};
